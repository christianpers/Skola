(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{6:function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t);var o=function(){function e(t,n,i,o,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isActive=!1,this.onClickCallback=n,this.parentEl=t,this.isParamOutput=i,this.el=document.createElement("div");this.el.className="node-output node-component ".concat(o?"":"right-align"," ").concat(i?"param":"");var s=document.createElement("div");s.className="dot",this.el.appendChild(s);var u=document.createElement("p");u.className="label",u.innerHTML=i?"Data ut":r?"Grafik ut":"Ljud ut",this.el.appendChild(u),this.parentEl.appendChild(this.el),this.onClickBound=this.onClick.bind(this),a?this.el.style.display="none":(this.el.addEventListener("click",this.onClickBound),this.offsetLeft=void 0,this.offsetTop=void 0)}var t,n,o;return t=e,(n=[{key:"getOffsetLeft",value:function(){return this.offsetLeft||(this.offsetLeft=this.el.offsetLeft),this.offsetLeft}},{key:"getOffsetTop",value:function(){return this.offsetTop||(this.offsetTop=this.el.offsetTop),this.offsetTop}},{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.el.classList.add("selected"),this.onClickCallback({x:e.x,y:e.y})}},{key:"enable",value:function(){this.isActive=!0,this.el.classList.add("active"),this.el.classList.remove("selected")}},{key:"disable",value:function(){this.isActive=!1,this.el.classList.remove("active")}}])&&i(t.prototype,n),o&&i(t,o),e}();function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=function(){function e(t,n,i,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isActive=!1,this.onClickCallback=n,this.parentEl=t,this.inputType=a,this.el=document.createElement("div"),this.el.className="node-input node-component";var r=document.createElement("div");r.className="dot",this.el.appendChild(r);var s=document.createElement("p");s.className="label",s.innerHTML=i?o||"Grafik in":"Ljud in",this.el.appendChild(s),this.parentEl.appendChild(this.el),this.onClickBound=this.onClick.bind(this),this.el.addEventListener("click",this.onClickBound),this.offsetLeft=void 0,this.offsetTop=void 0}var t,n,i;return t=e,(n=[{key:"getOffsetLeft",value:function(){return this.offsetLeft||(this.offsetLeft=this.el.offsetLeft),this.offsetLeft}},{key:"getOffsetTop",value:function(){return this.offsetTop||(this.offsetTop=this.el.offsetTop),this.offsetTop}},{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.onClickCallback()}},{key:"enable",value:function(){this.isActive=!0,this.el.classList.add("active"),this.deactivatePossible()}},{key:"disable",value:function(){this.isActive=!1,this.el.classList.remove("active")}},{key:"activatePossible",value:function(){this.el.classList.add("not-possible")}},{key:"deactivatePossible",value:function(){this.el.classList.remove("not-possible")}}])&&a(t.prototype,n),i&&a(t,i),e}();function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onClickCallback=n,this.parentEl=t,this.el=document.createElement("div"),this.el.className="node-remove";var i=document.createElement("h5");i.className="label",i.innerHTML="Remove",this.el.appendChild(i),this.parentEl.appendChild(this.el),this.onClickBound=this.onClick.bind(this),this.el.addEventListener("click",this.onClickBound)}var t,n,i;return t=e,(n=[{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.onClickCallback()}}])&&s(t.prototype,n),i&&s(t,i),e}();function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hasOutput=!0,this.isGraphicsNode=!1,this.isLightNode=!1,this.hasGraphicsInput=!1,this.needsUpdate=!1,this.hasMultipleOutputs=!1,this.outDotPos=void 0,this.inDotPos=void 0}var t,n,i;return t=e,(n=[{key:"init",value:function(e,t,n,i,a,s,l,c){this.initNodeConfig=!!s,this.ID=this.initNodeConfig?s.id:"_"+Math.random().toString(36).substr(2,9),this.onConnectingCallback=n,this.onInputConnectionCallback=i,this.hasActiveInput=!1,this.type=a,this.onNodeActive=l,this.onNodeRemove=c,this.parentEl=t,this.lastDelta={x:0,y:0};var h=document.createElement("h4");h.innerHTML=this.type,h.className="node-type",this.el.appendChild(h),this.parentEl.appendChild(this.el),this.onOutputClickBound=this.onOutputClick.bind(this),this.onInputClickBound=this.onInputClick.bind(this),this.onRemoveClickBound=this.onRemoveClick.bind(this),this.remove=new u(this.topPartEl,this.onRemoveClickBound);var p=!this.isParam&&this.hasAudioInput||this.hasGraphicsInput;p&&!this.isCanvasNode&&(this.input=new r(this.bottomPartEl,this.onInputClickBound,this.isGraphicsNode)),this.hasOutput&&!this.hasMultipleOutputs&&(this.output=new o(this.bottomPartEl,this.onOutputClickBound,this.isParam,p,this.isSpeaker,this.isGraphicsNode)),this.moveCoords={start:{x:0,y:0},offset:{x:this.initNodeConfig?s.pos[0]:e.x,y:this.initNodeConfig?s.pos[1]:e.y}},this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0)"),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this)}},{key:"getOutputPos",value:function(){return{x:this.output.el.offsetLeft,y:this.output.el.offsetTop}}},{key:"getOutDotPos",value:function(e){return this.inDotPos||(this.inDotPos=e.getBoundingClientRect()),this.inDotPos}},{key:"getInDotPos",value:function(e){return this.outDotPos||(this.outDotPos=e.getBoundingClientRect()),this.outDotPos}},{key:"onRemoveClick",value:function(){this.onNodeRemove(this)}},{key:"activateDrag",value:function(){this.el.addEventListener("mousedown",this.onMouseDownBound)}},{key:"getOutputEl",value:function(){return this.output}},{key:"getInputEl",value:function(){return this.input}},{key:"getConnectNode",value:function(){return this}},{key:"enableOutput",value:function(){this.output.enable()}},{key:"disableOutput",value:function(){this.output.disable()}},{key:"enableInput",value:function(e){this.input&&this.input.enable()}},{key:"disableInput",value:function(){this.input&&this.input.disable()}},{key:"onOutputClick",value:function(e){this.onConnectingCallback(this,e)}},{key:"onInputClick",value:function(e){this.onInputConnectionCallback(this,"main",e)}},{key:"removeFromDom",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"onMouseDown",value:function(e){"INPUT"===e.target.nodeName||e.target.classList.contains("prevent-drag")||(e.stopPropagation(),e.preventDefault(),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,this.lastDelta.x=0,this.lastDelta.y=0,window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound))}},{key:"onMouseMove",value:function(e){var t=e.x-this.moveCoords.start.x,n=e.y-this.moveCoords.start.y;this.moveCoords.offset.x=t,this.moveCoords.offset.y=n,this.lastDelta.x=t,this.lastDelta.y=n,this.el.style[window.NS.transform]="translate3d(".concat(t,"px, ").concat(n,"px, 0)")}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}}])&&l(t.prototype,n),i&&l(t,i),e}();function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var p=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.el=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.el.classList.add("line-renderer"),t.appendChild(this.el),this.nodeManager=n,this.onMouseEnterRemoveCircleBound=this.onMouseEnterRemoveCircle.bind(this),this.onMouseLeaveRemoveCircleBound=this.onMouseLeaveRemoveCircle.bind(this),this.onRemoveClickBound=this.onRemoveClick.bind(this),this.currentMouseOverObj=void 0}var t,n,i;return t=e,(n=[{key:"addLine",value:function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","g"),n=document.createElementNS("http://www.w3.org/2000/svg","line"),i=document.createElementNS("http://www.w3.org/2000/svg","circle"),o=document.createElementNS("http://www.w3.org/2000/svg","text");return t.appendChild(n),t.appendChild(i),t.appendChild(o),t.setAttribute("id",e),n.setAttribute("x1","0"),n.setAttribute("y1","0"),n.setAttribute("x2","0"),n.setAttribute("y2","0"),n.setAttribute("stroke-width","2"),n.setAttribute("stroke","white"),n.setAttribute("stroke-linecap","round"),i.setAttribute("cx","0"),i.setAttribute("cy","0"),i.setAttribute("fill","black"),i.setAttribute("stroke","red"),i.setAttribute("stroke-width","2"),i.setAttribute("r","10"),i.addEventListener("mouseenter",this.onMouseEnterRemoveCircleBound),i.addEventListener("mouseleave",this.onMouseLeaveRemoveCircleBound),i.addEventListener("click",this.onRemoveClickBound),o.setAttribute("fill","white"),this.el.appendChild(t),{g:t,line:n,removeCircle:i,removeText:o}}},{key:"removeLine",value:function(e){var t=e.removeCircle;t.removeEventListener("mouseenter",this.onMouseEnterRemoveCircleBound),t.removeEventListener("mouseleave",this.onMouseLeaveRemoveCircleBound),t.removeEventListener("click",this.onRemoveClickBound),this.el.removeChild(e.g)}},{key:"onRemoveClick",value:function(e){var t=e.target.parentNode.getAttribute("id"),n=this.nodeManager._nodeConnections.find(function(e){return e.lineEl.g.getAttribute("id")===t});n&&this.nodeManager.removeConnection(n)}},{key:"onMouseEnterRemoveCircle",value:function(e){var t=e.target.parentNode.querySelector("text");t.textContent="Ta bort koppling",this.currentMouseOverObj=t}},{key:"onMouseLeaveRemoveCircle",value:function(e){this.currentMouseOverObj&&this.currentMouseOverObj.textContent&&(this.currentMouseOverObj.textContent=""),this.currentMouseOverObj=void 0}},{key:"update",value:function(){}},{key:"render",value:function(){for(var e=this.nodeManager._nodeConnections.length,t=0;t<e;t++){var n=this.nodeManager._nodeConnections[t].out,i=this.nodeManager._nodeConnections[t].in,o=this.nodeManager._nodeConnections[t].param,a=this.nodeManager._nodeConnections[t].inputType,r=this.nodeManager._nodeConnections[t].outputType,s=void 0;s=!!o?i.inputParams[o.title]:i.getInputEl(a);var u=n.getOutputEl(r),l=n.getOutDotPos(n.output?n.output.el:null,r),c=u.getOffsetLeft(),h=u.getOffsetTop(),p=n.moveCoords.offset.x+c+l.width-3,d=n.moveCoords.offset.y+h+7,f=s.getOffsetLeft(),m=s.getOffsetTop(),v=i.moveCoords.offset.x+f+4,y=i.moveCoords.offset.y+m+7,g=this.nodeManager._nodeConnections[t].lineEl.line;g.setAttribute("x1",p),g.setAttribute("y1",d),g.setAttribute("x2",v),g.setAttribute("y2",y);var b=this.nodeManager._nodeConnections[t].param?"yellow":"red";g.setAttribute("stroke",b);var C=this.nodeManager._nodeConnections[t].lineEl.removeCircle,w=(p+v)/2,k=(d+y)/2;C.setAttribute("cx",w),C.setAttribute("cy",k),C.setAttribute("stroke",b);var E=this.nodeManager._nodeConnections[t].lineEl.removeText;E.setAttribute("x",w-35),E.setAttribute("y",k-20)}}}])&&h(t.prototype,n),i&&h(t,i),e}(),d="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\tuniform float time;\n\tuniform vec2 resolution;\n\tvoid main()\t{\n\t\tgl_Position = vec4( position, 1.0 );\n\t}\n",f="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\tuniform float time;\n\tuniform vec2 resolution;\n\tuniform sampler2D u_texture0;\n    uniform sampler2D u_texture1;\n\tuniform vec2 u_res;\n\tuniform float u_connection0;\n    uniform float u_connection1;\n    uniform float u_finalConnection;\n    uniform float u_multiConnection;\n\tvoid main()\t{\n\t\tvec2 st = gl_FragCoord.xy/u_res.xy;\n\t\tvec4 bgColor = texture2D(u_texture0, st);\n        vec4 fgColor = texture2D(u_texture1, st);\n\t\tvec4 whiteColor = vec4(1., 1., 1., 1.);\n        vec4 transparentColor = vec4(1.0, 1.0, 1.0, 0.0);\n        vec4 finalFgColor = mix(transparentColor, fgColor, u_connection1);\n        vec4 finalBgColor = mix(transparentColor, bgColor, u_connection0);\n        \n        float ra = (finalFgColor.a) * finalFgColor.r + (1.0 - finalFgColor.a) * finalBgColor.r;\n        float ga = (finalFgColor.a) * finalFgColor.g + (1.0 - finalFgColor.a) * finalBgColor.g;\n        float ba = (finalFgColor.a) * finalFgColor.b + (1.0 - finalFgColor.a) * finalBgColor.b;\n\n        vec4 overlayColor = vec4(ra, ga, ba, 1.0);\n\n        vec4 finalColor = mix(fgColor + bgColor, overlayColor, u_multiConnection);\n\n        gl_FragColor = mix(whiteColor, finalColor, u_finalConnection);\n\t} \n\n",m="\nvoid main() {\n\tvec2 st = gl_FragCoord.xy/u_resolution.xy;\n    //st.x *= u_resolution.x/u_resolution.y;\n    vec3 color = vec3(1.);\n",v="\n\tgl_FragColor = vec4(color,1.0);\n}",y="\n\tvec2 center_st = vec2(0.5)-st;\n\tcolor *= (vec3(1.0) * shapeBorderCircle(center_st,0.6,0.06));\n",g="\n    \n    // float u_user_speed3 = 0.500;\n    // float u_user_pattern_scale = -0.294;\n    // float u_user_scale = 6.632;\n    // float u_user_rotation = 0.804;\n    // float u_user_speed2 = 0.028;\n    // float u_user_blur = 0.7;\n    // vec3 u_user_color1 = vec3(0.256,0.351,0.620);\n    // vec3 u_user_color2 = vec3(1.000,0.420,0.420);\n    \n    \n    // vec2 st = gl_FragCoord.xy/u_resolution.xy;\n    st.x *= u_resolution.x/u_resolution.y;\n    color = vec3(0.0);\n    vec2 pos = vec2(st*u_user_scale);\n\n    float DF = 0.0;\n\n    \n    // Add a random position\n    float a = 0.0;\n    vec2 vel = vec2(u_time*u_user_speed3);\n    DF += snoise(pos+vel)*u_user_pattern_scale+.25;\n\n    // Add a random position\n    a = snoise(pos*vec2(cos(u_time*.15),sin(u_time*u_user_rotation))*u_user_speed2)*3.405;\n    vel = vec2(cos(a),sin(a));\n    DF += snoise(pos+vel)*.25+.25;\n\n    color = vec3( smoothstep(u_user_blur,.75,fract(DF)) );\n    \n    color = mix(u_user_color1, u_user_color2, color);\n",b="\n    // vec2 st = gl_FragCoord.xy/u_resolution.xy;\n    st.x *= u_resolution.x/u_resolution.y;\n    color = vec3(.0);\n    \n    // Scale \n    st *= 5.;\n    \n    // Tile the space\n    vec2 i_st = floor(st);\n    vec2 f_st = fract(st);\n\n    float m_dist = 10.;  // minimun distance\n    vec2 m_point;        // minimum point\n    \n    for (int j=-1; j<=1; j++ ) {\n        for (int i=-1; i<=1; i++ ) {\n            vec2 neighbor = vec2(float(i),float(j));\n            vec2 point = random2(i_st + neighbor);\n            point = 0.5 + 0.5*sin(u_time + 6.2831*point);\n            vec2 diff = neighbor + point - f_st;\n            float dist = length(diff);\n\n            if( dist < m_dist ) {\n                m_dist = dist;\n                m_point = point;\n            }\n        }\n    }\n\n    // Assign a color using the closest point position\n    color += dot(m_point,vec2(0.30,0.60));\n    \n    // Add distance field to closest point center \n    color.g = m_dist;\n\n    // Show isolines\n    //color -= abs(sin(40.0*m_dist*(u_mouse.x/u_resolution.x)))*0.07;\n    \n    color = mix(u_user_fgColor, u_user_bgColor, m_dist);\n    //color *= vec3(.2, .6, .8);\n",C="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform vec2 u_resolution;\nuniform vec2 u_mouse;\nuniform float u_time;\n\n//CIRCLE\nuniform float u_noise_amount;\n\n//LAVA\nuniform float u_user_speed3;\nuniform float u_user_pattern_scale;\nuniform float u_user_scale;\nuniform float u_user_rotation;\nuniform float u_user_speed2;\nuniform float u_user_blur;\nuniform vec3 u_user_color1;\nuniform vec3 u_user_color2;\n\n//VORONOI\nuniform vec3 u_user_fgColor;\nuniform vec3 u_user_bgColor;\n\n// YUV to RGB matrix\nmat3 yuv2rgb = mat3(1.0, 0.0, 1.13983,\n                    1.0, -0.39465, -0.58060,\n                    1.0, 2.03211, 0.0);\n\nvec2 random2(vec2 st){\n    st = vec2( dot(st,vec2(127.1,311.7)),\n              dot(st,vec2(269.5,183.3)) );\n    return -1.0 + 2.0*fract(sin(st)*43758.5453123);\n}\n\n// Value Noise by Inigo Quilez - iq/2013\n// https://www.shadertoy.com/view/lsf3WH\nfloat noise(vec2 st) {\n    vec2 i = floor(st);\n    vec2 f = fract(st);\n\n    vec2 u = f*f*(3.0-2.0*f);\n\n    return mix( mix( dot( random2(i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),\n                     dot( random2(i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),\n                mix( dot( random2(i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),\n                     dot( random2(i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x), u.y);\n}\n\nmat2 rotate2d(float _angle){\n    return mat2(cos(_angle),-sin(_angle),\n                sin(_angle),cos(_angle));\n}\n\nfloat shapeCircle(vec2 st, float radius) {\n\t//st = vec2(0.5)-st;\n    float r = length(st)*2.0;\n    float a = atan(st.y,st.x);\n    float m = abs(mod(a+u_time*2.080,3.14*2.0)-3.14)/3.688;\n    float f = radius;\n    float mod1 = radius;\n    m += noise(st+u_time*0.1)*.5;\n    mod1 = sin(a*50.000)*noise(st+u_time*0.536)*0.156;\n    mod1 += (sin(a*20.000)*0.116*pow(m,1.576));\n    f += mod1 * u_noise_amount;\n    return 1.-smoothstep(f,f+0.007,r);\n}\n\nfloat shapeBorderCircle(vec2 st, float radius, float width) {\n    return shapeCircle(st,radius) - shapeCircle(st,radius-width);\n}\n\nvec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }\n\nfloat snoise(vec2 v) {\n    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                        -0.577350269189626,  // -1.0 + 2.0 * C.x\n                        0.024390243902439); // 1.0 / 41.0\n    vec2 i  = floor(v + dot(v, C.yy) );\n    vec2 x0 = v -   i + dot(i, C.xx);\n    vec2 i1;\n    i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n    vec4 x12 = x0.xyxy + C.xxzz;\n    x12.xy -= i1;\n    i = mod289(i); // Avoid truncation effects in permutation\n    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n        + i.x + vec3(0.0, i1.x, 1.0 ));\n\n    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n    m = m*m ;\n    m = m*m ;\n    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n    vec3 h = abs(x) - 0.5;\n    vec3 ox = floor(x + 0.5);\n    vec3 a0 = x - ox;\n    m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n    vec3 g;\n    g.x  = a0.x  * x0.x  + h.x  * x0.y;\n    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n    return 130.0 * dot(m, g);\n}\n";var w=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=new THREE.WebGLRenderer({alpha:!0})};function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var E=function(){function e(t,n,i,o,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onConnectingCallback=n,this.onInputConnectionCallback=i,this.addCallback=o,this.onNodeActive=a,this.removeCallback=r,this.mainRenderer=new w}var t,n,i;return t=e,(n=[{key:"createNode",value:function(e,t){var n=new e.obj(this.mainRenderer);n.init(t,this.parentEl,this.onConnectingCallback,this.onInputConnectionCallback,e.type,void 0,void 0,this.removeCallback),n.onResize({w:540,h:538}),this.addCallback(n)}}])&&k(t.prototype,n),i&&k(t,i),e}();function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var P=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="node-param node-component",this.param=n;var a=document.createElement("div");a.className="dot",this.el.appendChild(a);var r=document.createElement("p");r.className="label",r.innerHTML=n.param,this.el.appendChild(r),t.appendChild(this.el),this.el.addEventListener("click",function(e){console.log("param click"),e.preventDefault(),e.stopPropagation(),i(n)}),this.offsetLeft=void 0,this.offsetTop=void 0}var t,n,i;return t=e,(n=[{key:"getOffsetLeft",value:function(){return this.offsetLeft||(this.offsetLeft=this.el.offsetLeft),this.offsetLeft}},{key:"getOffsetTop",value:function(){return this.offsetTop||(this.offsetTop=this.el.offsetTop),this.offsetTop}},{key:"enable",value:function(){this.el.classList.add("active")}},{key:"disable",value:function(){this.el.classList.remove("active")}},{key:"activatePossible",value:function(){this.el.classList.add("not-possible")}},{key:"deactivatePossible",value:function(){this.el.classList.remove("not-possible")}}])&&O(t.prototype,n),i&&O(t,i),e}(),_={single:{isValid:function(e,t,n,i){var o=!0;return i.some(function(e){return e.in.ID===t.ID&&!e.param})&&(o=!1),o}},multiple:{isValid:function(e,t,n,i,o){if(e.outputs&&e.outputs[o]&&e.outputs[o].isParamOutput&&!t.isParam)return!1;return!0}},oscillatorTrigger:{isValid:function(e,t,n,i){var o=!0;return i.some(function(n){return n.out.ID===e.ID&&n.in.ID===t.ID})&&(o=!1),e.isSequencer||(o=!1),o}},gain:{isValid:function(e,t,n,i){var o=!0;return i.some(function(n){return n.in.ID===t.ID&&n.out.ID===e.ID})&&(o=!1),e.isEnvelope||(o=!1),o}},frequency:{isValid:function(e,t,n,i){var o=!0;return i.some(function(n){return n.in.ID===t.ID&&n.out.ID===e.ID})&&(o=!1),e.isEnvelope||e.isLFO||(o=!1),o}}};function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function R(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e,t,n){return(S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var L=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=R(this,T(t).call(this))).audioNode=null,e.isParam=!1,e.isKeyboardListener=!1,e.isOscillator=!1,e.isEnvelope=!1,e.isSpeaker=!1,e.isSignalMath=!1,e.hasAudioInput=!0,e.isSequencer=!1,e.isLFO=!1,e.isAnalyser=!1,e.isSynthOscillator=!1,e.inputHelpersType=_.single,e.params={},e.canBeConnected=!1,e.el=document.createElement("div"),e.el.className="node",e.topPartEl=document.createElement("div"),e.topPartEl.className="top-part",e.el.appendChild(e.topPartEl),e.bottomPartEl=document.createElement("div"),e.bottomPartEl.className="bottom-part",e.el.appendChild(e.bottomPartEl),e.inputParams={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(t,c),n=t,(i=[{key:"init",value:function(e,n,i,o,a,r,s,u,l){for(var c in S(T(t.prototype),"init",this).call(this,e,n,i,o,a,r,s,l),this.onParameterChange=u,this.connectedInputs=[],this.connectedOutputs=[],this.params)if(this.params[c].useAsInput){var h=new P(this.topPartEl,this.params[c],this.onInputClickBound);this.inputParams[this.params[c].title]=h}this.isSequencer&&(this.el.classList.add("sequencer"),this.createUI(),this.setup()),this.activateDrag()}},{key:"enableParam",value:function(e){var t=this.inputParams[e.title];e.isConnected=!0,t.enable(),e.slider&&e.disableSliderOnConnection&&e.slider.disableSlider()}},{key:"disableParam",value:function(e){var t=this.inputParams[e.title];e.isConnected=!1,t.disable(),e.slider&&e.slider.enableSlider()}},{key:"onParameterUpdate",value:function(){var e=this.getParams();this.onParameterChange(this,e)}},{key:"getParams",value:function(){var e={};for(var t in this.params){var n=this.params[t];e[n.param]=this.params[n.param].value}return e}},{key:"enableOutput",value:function(e,n){S(T(t.prototype),"enableOutput",this).call(this),this.connectedOutputs.push(n.in.ID)}},{key:"disableOutput",value:function(e,n){var i=this.connectedOutputs.filter(function(t){return t!==e.ID});this.connectedOutputs=i,0===this.connectedOutputs.length&&S(T(t.prototype),"disableOutput",this).call(this)}},{key:"enableInput",value:function(e){S(T(t.prototype),"enableInput",this).call(this),this.connectedInputs.push("".concat(e.ID,"-").concat(this.ID))}},{key:"disableInput",value:function(e){var n="".concat(e.ID,"-").concat(this.ID),i=this.connectedInputs.filter(function(e){return e!==n});this.connectedInputs=i,0===this.connectedInputs.length&&S(T(t.prototype),"disableInput",this).call(this)}}])&&M(n.prototype,i),o&&M(n,o),t}(),I=n(7),B=n.n(I);function D(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var j=function(){function e(t,n,i,o,a,r,s,u){var l=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=a,this.parameter=r,this.decimals=s,this.disable=u,this.value=(i-o.min)/(o.max-o.min),this.settings=o,this.el=document.createElement("div"),this.el.className="node-control node-range";var c=document.createElement("h5");c.innerHTML=n,c.className="node-range-title",this.el.appendChild(c),this.sliderBg=document.createElement("div"),this.sliderBg.className="node-range-slider-bg",this.knobEl=document.createElement("div"),this.knobEl.className="node-range-knob",this.sliderBg.appendChild(this.knobEl),this.el.appendChild(this.sliderBg),this.valueEl=document.createElement("p"),this.valueEl.className="node-range-value",this.valueEl.innerHTML=i,this.el.appendChild(this.valueEl),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),setTimeout(function(){l.setPos(l.sliderBg.clientHeight)},0),this.sliderBg.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"disableSlider",value:function(){this.disable=!0,this.el.style.opacity=.1}},{key:"enableSlider",value:function(){this.disable=!1,this.el.style.opacity=1}},{key:"remove",value:function(){this.sliderBg.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"getValue",value:function(){return this.value*(this.settings.max-this.settings.min)+this.settings.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onMouseDown",value:function(e){if(!this.disable){e.preventDefault(),e.stopPropagation();var t=this.sliderBg.getBoundingClientRect(),n=this.sliderBg.clientHeight,i=1-Math.round(100*(e.y-t.top))/100/n;this.value=i>1?1:i<0?0:i,this.setPos(n),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)),this.parameter),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}}},{key:"onMouseMove",value:function(e){var t=this.sliderBg.getBoundingClientRect(),n=this.sliderBg.clientHeight,i=1-Math.round(100*(e.y-t.top))/100/n;this.value=i>1?1:i<0?0:i,this.setPos(n),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)),this.parameter),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){this.value;var t=this.value*e;this.knobEl.style.height="".concat(t,"px")}}])&&D(t.prototype,n),i&&D(t,i),e}();function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function V(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function H(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e,t,n){return(F="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=U(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var q=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=U(t).call(this))||"object"!==A(i)&&"function"!=typeof i?H(n):i).el.classList.add("no-height"),e.hasConnectedTrigger=!1,e.connectedTriggerID=-1,t.BASE_FREQ=440,t.ROOT=Math.pow(2,1/12),e.isKeyboardListener=!0,e.isOscillator=!0,e.hasAudioInput=!1,e.hasEnvelopeConnection=!1;var o=document.createElement("div");o.className="range-container",e.topPartEl.appendChild(o),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(H(e));var a={parentEl:o,title:"Oktav",initValue:0,settings:{min:-3,max:3},valChangeCallback:e.onRangeChangeCallbackBound,param:"octave",decimals:0,disable:!1};e.octaveRangeSlider=new j(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={useAsInput:!1,value:a.initValue,param:"octave",slider:e.octaveRangeSlider,title:"Octave"},s={useAsInput:!0,param:"trigger",title:"Trigger",helper:_.oscillatorTrigger};return e.params[r.param]=r,e.params[s.param]=s,e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,L),n=t,(i=[{key:"enableParam",value:function(e,n){F(U(t.prototype),"enableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!0,this.connectedTriggerID=n.out.ID)}},{key:"disableParam",value:function(e){F(U(t.prototype),"disableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!1,this.connectedTriggerID=-1)}},{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getParams",value:function(e){e||(e=0);var t={};return t.frequency=this.getFrequency(e),t.type="sawtooth",t}},{key:"getAudioNode",value:function(){var e=new B.a.Oscillator;return e.type="sawtooth",e}},{key:"getFrequency",value:function(e){var n=12*parseInt(this.params.octave.value)+e;return t.BASE_FREQ*Math.pow(t.ROOT,n)}},{key:"onParameterChange",value:function(e,t){}}])&&V(n.prototype,i),o&&V(n,o),t}();function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function W(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Q=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=K(t).call(this))||"object"!==G(i)&&"function"!=typeof i?Y(n):i).inputHelpersType=_.multiple,e.el.classList.add("no-height"),e.audioNode=B.a.context.createGain();var o=document.createElement("div");o.className="range-container",e.topPartEl.appendChild(o),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(Y(e));var a={parentEl:o,title:"Vol",initValue:.5,settings:{min:0,max:1},valChangeCallback:e.onRangeChangeCallbackBound,param:"gain",decimals:2,disable:!1};e.gainRangeSlider=new j(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={useAsInput:!0,value:a.initValue,param:"gain",slider:e.gainRangeSlider,title:"Gain",helper:_.gain,disableSliderOnConnection:!0};return e.paramVals={},e.params[r.param]=r,e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}(t,L),n=t,(i=[{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getAudioNode",value:function(){return B.a.context.createGain()}}])&&W(n.prototype,i),o&&W(n,o),t}();function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function $(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ne=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=$(this,ee(t).call(this))).inputHelpersType=_.multiple,e.audioNode=B.a.context.destination,e.isSpeaker=!0,e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(t,L),n=t,(i=[{key:"getAudioNode",value:function(){var e=new B.a.Limiter;return e.connect(B.a.context.destination),e}}])&&J(n.prototype,i),o&&J(n,o),t}();function ie(e){return(ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ae(e){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ue=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=ae(t).call(this))||"object"!==ie(i)&&"function"!=typeof i?re(n):i).audioNode=new B.a.Filter,e.el.classList.add("no-height");var o=document.createElement("div");o.className="range-container",e.topPartEl.appendChild(o),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(re(e));var a={parentEl:o,title:"Frekvens",initValue:350,settings:{min:0,max:22e3},valChangeCallback:e.onRangeChangeCallbackBound,param:"frequency",decimals:0,disable:!1};e.freqRangeSlider=new j(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={parentEl:o,title:"Q",initValue:1,settings:{min:0,max:10},valChangeCallback:e.onRangeChangeCallbackBound,param:"Q",decimals:0,disable:!1};e.qRangeSlider=new j(r.parentEl,r.title,r.initValue,r.settings,r.valChangeCallback,r.param,r.decimals,r.disable);var s={useAsInput:!0,value:a.initValue,param:"frequency",slider:e.freqRangeSlider,title:"Filter Frequency",helper:_.frequency,disableSliderOnConnection:!1},u={useAsInput:!1,value:r.initValue,param:"Q",slider:e.qRangeSlider,title:"Q"};return e.paramVals={},e.params[s.param]=s,e.params[u.param]=u,e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&se(e,t)}(t,L),n=t,(i=[{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getAudioNode",value:function(){var e=new B.a.Filter;for(var t in this.params)e[t].value=this.params[t].value;return e}}])&&oe(n.prototype,i),o&&oe(n,o),t}();function le(e){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function de(e,t){return(de=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var fe=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=he(t).call(this))||"object"!==le(i)&&"function"!=typeof i?pe(n):i).el.classList.add("no-height"),e.isParam=!0,e.isKeyboardListener=!0,e.isEnvelope=!0,e.audioNode=new B.a.Envelope;var o=document.createElement("div");o.className="range-container",e.topPartEl.appendChild(o),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(pe(e));var a={parentEl:o,title:"A",initValue:.25,settings:{min:.01,max:2},valChangeCallback:e.onRangeChangeCallbackBound,param:"attack",decimals:2,disable:!1};e.attackRangeSlider=new j(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={parentEl:o,title:"D",initValue:.77,settings:{min:.01,max:2},valChangeCallback:e.onRangeChangeCallbackBound,param:"decay",decimals:2,disable:!1};e.decayRangeSlider=new j(r.parentEl,r.title,r.initValue,r.settings,r.valChangeCallback,r.param,r.decimals,r.disable);var s={parentEl:o,title:"S",initValue:.11,settings:{min:.01,max:1},valChangeCallback:e.onRangeChangeCallbackBound,param:"sustain",decimals:2,disable:!1};e.sustainRangeSlider=new j(s.parentEl,s.title,s.initValue,s.settings,s.valChangeCallback,s.param,s.decimals,s.disable);var u={parentEl:o,title:"R",initValue:.11,settings:{min:.01,max:2},valChangeCallback:e.onRangeChangeCallbackBound,param:"release",decimals:2,disable:!1};e.releaseRangeSlider=new j(u.parentEl,u.title,u.initValue,u.settings,u.valChangeCallback,u.param,u.decimals,u.disable);var l={useAsInput:!1,value:a.initValue,param:"attack",slider:e.attackRangeSlider,title:"Attack"},c={useAsInput:!1,value:r.initValue,param:"decay",slider:e.decayRangeSlider,title:"Decay"},h={useAsInput:!1,value:s.initValue,param:"sustain",slider:e.sustainRangeSlider,title:"Sustain"},p={useAsInput:!1,value:u.initValue,param:"release",slider:e.releaseRangeSlider,title:"Release"},d={};return d[l.param]=l,d[c.param]=c,d[h.param]=h,d[p.param]=p,e.paramDefaults={ADSR:d},e.params=Object.assign({},e.paramDefaults.ADSR),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&de(e,t)}(t,L),n=t,(i=[{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getAudioNode",value:function(e){var t=new(0,B.a.Envelope);for(var n in this.params)t[n]=this.params[n].value;return t}}])&&ce(n.prototype,i),o&&ce(n,o),t}();function me(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ve=function(){function e(t,n,i,o,a,r,s,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onConnectingCallback=n,this.onInputConnectionCallback=i,this.addCallback=o,this.initData=a,this.onParameterChange=r,this.onNodeActive=s,this.onNodeRemove=u}var t,n,i;return t=e,(n=[{key:"init",value:function(){if(this.initData)for(var e=0;e<this.initData.length;e++)this.initData[e].node.init(this.parentEl,this.onConnectingCallback,this.onInputConnectionCallback,this.initData[e].type,this.initData[e],this.onNodeActive,this.onParameterChange,this.onNodeRemove),this.addCallback(this.initData[e].node)}},{key:"createNode",value:function(e,t){var n=new e.obj;n.init(t,this.parentEl,this.onConnectingCallback,this.onInputConnectionCallback,e.type,void 0,this.onNodeActive,this.onParameterChange,this.onNodeRemove),this.addCallback(n)}}])&&me(t.prototype,n),i&&me(t,i),e}();function ye(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ge=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ID=999999999,this.resetConnecting=n,this.startPos={x:0,y:0},this.endPos={x:0,y:0},this.line=document.createElementNS("http://www.w3.org/2000/svg","line"),this.line.setAttribute("id",this.ID),this.line.setAttribute("x1",this.startPos.x),this.line.setAttribute("y1",this.startPos.y),this.line.setAttribute("x2",this.endPos.x),this.line.setAttribute("y2",this.endPos.y),this.line.setAttribute("stroke-width","2"),this.line.setAttribute("stroke","white"),this.line.setAttribute("stroke-linecap","round"),t.appendChild(this.line),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseClickBound=this.onMouseClick.bind(this)}var t,n,i;return t=e,(n=[{key:"onConnectionActive",value:function(e,t,n){var i=e.getOutDotPos(e.output?e.output.el:null,n),o=e.getOutputPos(n),a=e.moveCoords.offset.x+o.x+i.width,r=e.moveCoords.offset.y+o.y+7;this.startPos.x=t.x,this.startPos.y=t.y;var s=this.line,u=e.isParam?"yellow":"red";e.outputs&&e.outputs[n]&&(e.outputs[n].isParamOutput&&(u="yellow"));s.setAttribute("x1",a),s.setAttribute("y1",r),s.setAttribute("x2",a),s.setAttribute("y2",r),s.setAttribute("stroke",u),s.setAttribute("stroke-opacity",.6),window.addEventListener("mousemove",this.onMouseMoveBound),window.addEventListener("click",this.onMouseClickBound)}},{key:"onInputClick",value:function(e,t,n){window.removeEventListener("mousemove",this.onMouseMoveBound),window.removeEventListener("click",this.onMouseClickBound);var i=this.line,o=t.moveCoords.offset.x+200,a=t.moveCoords.offset.y+50,r=n.moveCoords.offset.x+200,s=n.moveCoords.offset.y+50,u=e?o:r,l=e?a:s;i.setAttribute("stroke","white"),i.setAttribute("stroke-opacity",0),i.setAttribute("x1",u),i.setAttribute("y1",l),i.setAttribute("x2",u),i.setAttribute("y2",l)}},{key:"onMouseMove",value:function(e){var t=this.line,n=parseFloat(t.getAttribute("x1")),i=parseFloat(t.getAttribute("y1")),o=n+(e.x-this.startPos.x),a=i+(e.y-this.startPos.y);this.endPos.x=o,this.endPos.y=a,t.setAttribute("x2",o),t.setAttribute("y2",a)}},{key:"onMouseClick",value:function(e){window.removeEventListener("mousemove",this.onMouseMoveBound),window.removeEventListener("click",this.onMouseClickBound),this.resetConnecting();var t=this.line;t.setAttribute("stroke","white"),t.setAttribute("x1",0),t.setAttribute("y1",0),t.setAttribute("x2",0),t.setAttribute("y2",0),t.setAttribute("stroke-opacity",0),console.log("click connection")}},{key:"resetLine",value:function(){window.removeEventListener("mousemove",this.onMouseMoveBound),window.removeEventListener("click",this.onMouseClickBound);var e=this.line;e.setAttribute("stroke","white"),e.setAttribute("x1",0),e.setAttribute("y1",0),e.setAttribute("x2",0),e.setAttribute("y2",0),e.setAttribute("stroke-opacity",0),console.log("reset connection")}}])&&ye(t.prototype,n),i&&ye(t,i),e}(),be=function(e){return e.framebuffer||e.texture},Ce=function(e,t,n){return!(e.framebuffer||e.texture||e.picker||e.isSequencer)&&(e.isParam&&!n.isConnected||e.isAnalyser&&!n.isConnected)},we=function(e,t,n){t.defaultVal=n.getValue(t)},ke={texture:{update:function(e,t){e.material.needsUpdate=!0,e.material.map=t.framebuffer?t.framebuffer.texture:t.texture},isValid:be,disconnect:function(e){e.material.needsUpdate=!0,e.material.map=null}},normalMap:{update:function(e,t){e.material.normalMap=t.framebuffer.texture,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0},isValid:be,disconnect:function(e){e.material.normalMap=null,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0}},bumpMap:{update:function(e,t){e.material.displacementMap=t.framebuffer.texture,e.material.displacementScale=.1,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0},isValid:be,disconnect:function(e){e.material.displacementMap=null,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0}},color:{update:function(e,t){e.material.color=t.currentColor},isValid:function(e){return!!e.picker},disconnect:we},position:{update:function(e,t,n){e.mesh.position[n.param]=t.getValue(n)},isValid:Ce,disconnect:we},rotation:{update:function(e,t,n){e.mesh.rotation[n.param]=t.getValue(n)},isValid:Ce,disconnect:we},scale:{update:function(e,t,n){var i=t.getValue();new THREE.Vector3(i,i,i);e.mesh.scale.set(i,i,i)},isValid:Ce,disconnect:function(e,t,n){n.isAnalyser?e.mesh.scale.set(1,1,1):t.defaultVal=n.getValue(t)}},shaderParam:{update:function(e,t,n){e.mesh.material.uniforms[n.param].value=t.getValue()},isValid:Ce,disconnect:we},light:{update:function(e,t,n){var i=t.getValue(n);e.mesh.position[n.param]=i,e.light.position[n.param]=i},isValid:Ce,disconnect:we}};function Ee(e){return(Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Oe=function(e,t,n){for(var i=function(i){if(function t(i){var o=e.filter(function(e){return e.in.ID===i.ID&&!e.param});return!!o.find(function(e){return e.out.isOscillator&&e.out.ID===n.ID})||o.length>0&&t(o[0].out)}(t[i].in))return{v:!0}},o=0;o<t.length;o++){var a=i(o);if("object"===Ee(a))return a.v}return!1},Pe={updateOscillators:function(e){for(var t=e.filter(function(e){return e.param&&"gain"===e.param.param&&e.out.isEnvelope}),n=e.filter(function(e){return e.out.isOscillator&&!e.param}),i=0;i<n.length;i++){var o=Oe(e,t,n[i].out);n[i].out.hasEnvelopeConnection=o}}};function _e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var xe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.collectedInputs=[]}var t,n,i;return t=e,(n=[{key:"showAvailable",value:function(e,t,n,i){var o=t.map(function(e){return e});this.collectedInputs=[];for(var a=0;a<o.length;a++){var r=o[a],s={node:r,inputs:[],params:[]};if(r.input)s.inputs.push(r.input);else if(r.inputs)for(var u in r.inputs)s.inputs.push(r.inputs[u]);for(var l in r.inputParams)s.params.push(r.inputParams[l]);this.collectedInputs.push(s)}for(var c=0;c<this.collectedInputs.length;c++){var h=this.collectedInputs[c].inputs,p=this.collectedInputs[c].params,d=this.collectedInputs[c].node;if(d.isGraphicsNode){for(var f=0;f<h.length;f++){var m=h[f];d.inputHelpersType.isValid(e,d,m.inputType)||m.activatePossible()}for(var v=0;v<p.length;v++){var y=p[v];ke[y.param.paramHelpersType].isValid(e,d,y.param)||y.activatePossible()}}else{for(var g=0;g<h.length;g++){var b=h[g];d.inputHelpersType.isValid(e,d,void 0,n,i)||b.activatePossible()}for(var C=0;C<p.length;C++){var w=p[C];w.param.helper.isValid(e,d,w.param,n)||w.activatePossible()}}}}},{key:"resetAvailable",value:function(){for(var e=0;e<this.collectedInputs.length;e++){for(var t=this.collectedInputs[e].inputs,n=this.collectedInputs[e].params,i=0;i<t.length;i++){t[i].deactivatePossible()}for(var o=0;o<n.length;o++){n[o].deactivatePossible()}}}}])&&_e(t.prototype,n),i&&_e(t,i),e}();function Me(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Re=function(){function e(t,n,i,o){var a=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.hasConfig=!!t,this.onNodeActiveCallback=i,this.availableConnections=new xe,this.constructorIsDone=!1,this.keyboardManager=n,this._nodes=[],this._nodeConnections=[],this._graphicNodes=[],this._graphicNodeLength=0,this.resetConnectingBound=this.resetConnecting.bind(this),this.nodeConnectionRenderer=new p(o,this),this.nodeConnectionLine=new ge(this.nodeConnectionRenderer.el,this.resetConnectingBound),this.isConnecting=!1,this.outputActiveNode=null,this.outputActiveType=void 0,this.onConnectingBound=this.onConnecting.bind(this),this.onInputConnectionBound=this.onInputConnection.bind(this),this.addBound=this.add.bind(this),this.removeBound=this.onNodeRemove.bind(this),this.onAudioNodeParamChangeBound=this.onAudioNodeParamChange.bind(this),this.audioNodeManager=new ve(o,this.onConnectingBound,this.onInputConnectionBound,this.addBound,this.hasConfig?this.config.nodes:[],this.onAudioNodeParamChangeBound,i,this.removeBound),this.audioNodeManager.init(),this.graphicsNodeManager=new E(o,this.onConnectingBound,this.onInputConnectionBound,this.addBound,i,this.removeBound),this.hasConfig){for(var r=function(e){a.isConnecting=!0;var t=a._nodes.find(function(t){return t.ID===a.config.connections[e].out}),n=a._nodes.find(function(t){return t.ID===a.config.connections[e].in});a.outputActiveNode=t,a.onInputConnection(n)},s=0;s<this.config.connections.length;s++)r(s);this.outputActiveNode=null;var u=this.getAudioConnections(this._nodeConnections);this.keyboardManager.onAudioNodeConnectionUpdate(u);var l=u.filter(function(e){return e.out.isSequencer}),c=[];for(s=0;s<l.length;s++){var h=l[s].out.ID;c.indexOf(h)<0&&(l[s].out.sequencerManager.onAudioNodeConnectionUpdate(u),c.push(h))}c=[]}this.constructorIsDone=!0}var t,n,i;return t=e,(n=[{key:"onNodeAddedFromLibrary",value:function(e,t,n){if("graphics"===e){if(this._graphicNodes.some(function(e){return e.isCanvasNode})&&"Canvas"===t.type)return;this.graphicsNodeManager.createNode(t,n)}else this.audioNodeManager.createNode(t,n)}},{key:"onNodeRemove",value:function(e){for(var t=this._nodeConnections.filter(function(t){return t.out.ID===e.ID||t.in.ID===e.ID}),n=0;n<t.length;n++)this.removeConnection(t[n]);this.remove(e)}},{key:"onAudioNodeParamChange",value:function(e,t){this.keyboardManager.onAudioNodeParamChange(e,t)}},{key:"disconnectAnalyserNodes",value:function(e){for(var t=e.filter(function(e){return e.in.isAnalyser}),n=0;n<t.length;n++)t[n].in.dispose()}},{key:"getAudioConnections",value:function(e){return e.filter(function(e){return!e.out.isGraphicsNode&&!e.in.isGraphicsNode})}},{key:"resetConnecting",value:function(){this.isConnecting=!1,this.outputActiveNode=null,this.outputActiveType=void 0,this.nodeConnectionLine.resetLine(),this.availableConnections.resetAvailable()}},{key:"onConnecting",value:function(e,t,n){if(!this.isConnecting&&!this.outputActiveNode){this._nodeConnections.some(function(t){return t.out.ID===e.ID});this.isConnecting=!0,this.outputActiveNode=e,this.outputActiveType=n,this.nodeConnectionLine.onConnectionActive(e,t,n),this.availableConnections.showAvailable(e,this._nodes,this._nodeConnections,n)}}},{key:"onInputConnection",value:function(e,t,n){if(this.availableConnections.resetAvailable(),this.isConnecting&&this.outputActiveNode){if(e.isGraphicsNode){if(n&&!ke[n.paramHelpersType].isValid(this.outputActiveNode,e,n,this._nodeConnections))return void this.resetConnecting();if(!e.inputHelpersType.isValid(this.outputActiveNode,e,t))return void this.resetConnecting()}else if(n&&n.helper){if(!n.helper.isValid(this.outputActiveNode,e,n,this._nodeConnections))return void this.resetConnecting()}else if(!e.inputHelpersType.isValid(this.outputActiveNode,e,void 0,this._nodeConnections,this.outputActiveType))return void this.resetConnecting();this.nodeConnectionLine.onInputClick(!0,e,this.outputActiveNode),this.isConnecting=!1;var i=n?"".concat(n.parent,"-").concat(n.param):"",o="".concat(e.ID,"---").concat(this.outputActiveNode.ID,"---").concat(i),a={param:n,out:this.outputActiveNode,in:e,lineEl:this.nodeConnectionRenderer.addLine(o),inputType:t,outputType:this.outputActiveType};if(this.outputActiveNode.enableOutput(n||void 0,a),n?e.enableParam(n,a):e.enableInput(this.outputActiveNode,t),this._nodeConnections.push(a),this.constructorIsDone){var r=this.getAudioConnections(this._nodeConnections);Pe.updateOscillators(r),this.disconnectAnalyserNodes(r),this.keyboardManager.onAudioNodeConnectionUpdate(r);for(var s=r.filter(function(e){return e.out.isSequencer}),u=[],l=0;l<s.length;l++){var c=s[l].out.ID;u.indexOf(c)<0&&(s[l].out.sequencerManager.onAudioNodeConnectionUpdate(r),u.push(c))}u=[]}this.resetConnecting()}}},{key:"removeConnection",value:function(e){e.param?e.in.disableParam(e.param,e):e.in.disableInput(e.out,e.inputType),e.out.disableOutput(e.in,e.param,e.outputType);var t=this._nodeConnections.filter(function(t){return t.out.ID!==e.out.ID||t.in.ID!==e.in.ID});e.param&&(t=this._nodeConnections.filter(function(t){return!t.param||(t.param.title!==e.param.title||t.in.ID!==e.in.ID)})),this._nodeConnections=t;var n=this.getAudioConnections(this._nodeConnections);Pe.updateOscillators(n),this.disconnectAnalyserNodes(n),this.keyboardManager.onAudioNodeConnectionUpdate(n);for(var i=n.filter(function(e){return e.out.isSequencer}),o=[],a=0;a<i.length;a++){var r=i[a].out.ID;o.indexOf(r)<0&&(i[a].out.sequencerManager.onAudioNodeConnectionUpdate(n),o.push(r))}o=[],this.nodeConnectionRenderer.removeLine(e.lineEl)}},{key:"onNodePlaced",value:function(e){console.log("node placed",e)}},{key:"add",value:function(e){if(this._nodes.push(e),(e.isRenderNode||e.isCanvasNode||e.needsUpdate)&&(this._graphicNodes.push(e),this._graphicNodeLength=this._graphicNodes.length),e.isSequencer){var t=this.getAudioConnections(this._nodeConnections);e.sequencerManager.init(t)}}},{key:"remove",value:function(e){if(e.isGraphicsNode||e.needsUpdate){var t=this._graphicNodes.filter(function(t){return t.ID!==e.ID});this._graphicNodes=t,this._graphicNodeLength=this._graphicNodes.length}e.removeFromDom();var n=this._nodes.filter(function(t){return t.ID!==e.ID});this._nodes=n}},{key:"update",value:function(){this.nodeConnectionRenderer.update();for(var e=0;e<this._graphicNodeLength;e++)this._graphicNodes[e].update()}},{key:"render",value:function(){this.nodeConnectionRenderer.render();for(var e=0;e<this._graphicNodeLength;e++)this._graphicNodes[e].render()}}])&&Me(t.prototype,n),i&&Me(t,i),e}();function Se(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Te=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.workspaceManager=t,this.parentEl=t.el,this.el=document.createElement("div"),this.el.style.width="200px",this.el.style.height="200px",this.el.style.position="absolute",this.el.style.top="0",this.el.style.left="0",this.el.style.background="rgba(50, 50, 50, .9)",this.el.style.borderRadius="4px",this.parentEl.appendChild(this.el),this.moveCoords={start:{x:0,y:0},offset:{x:n.x,y:n.y}},this.deltaX=0,this.deltaY=0,this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this)}var t,n,i;return t=e,(n=[{key:"getPos",value:function(){var e=Math.abs(this.workspaceManager.moveCoords.offset.x),t=Math.abs(this.workspaceManager.moveCoords.offset.y);return{x:this.moveCoords.offset.x+e,y:this.moveCoords.offset.y+t}}},{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this.deltaX=0,this.deltaY=0,this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y}},{key:"onMouseMove",value:function(e){var t=e.x,n=e.y,i=t-this.moveCoords.start.x,o=n-this.moveCoords.start.y;this.moveCoords.offset.x=i,this.moveCoords.offset.y=o;var a=Math.abs(this.workspaceManager.moveCoords.offset.x),r=Math.abs(this.workspaceManager.moveCoords.offset.y);this.el.style[window.NS.transform]="translate3d(".concat(i+a,"px, ").concat(o+r,"px, 0)"),this.deltaX=i,this.deltaY=o}},{key:"onMouseUp",value:function(e){this.parentEl.removeChild(this.el)}}])&&Se(t.prototype,n),i&&Se(t,i),e}();function Ne(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Le=function(){function e(t,n,i,o){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onNodeAddedCallback=i,this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.workspaceManager=o,this.nodeToPlaceData={type:void 0,data:void 0},this.el=document.createElement("div"),this.el.className="node-library";var r=document.createElement("div");r.className="inner-scroll",this.el.appendChild(r),this.parentEl.appendChild(this.el);var s=function(e){var t=document.createElement("div");t.className="level-0";var i=document.createElement("h4");i.className="level-title",i.innerHTML=e,t.appendChild(i);var o=function(o){var r=document.createElement("div");r.className="level-1",(i=document.createElement("h4")).className="level-title",i.innerHTML=o,r.appendChild(i),t.appendChild(r);var s=document.createElement("div");s.className="node-container",r.appendChild(s);for(var u=function(t){var i=document.createElement("div");i.className="library-node audio",i.setAttribute("data-type-0",e),i.setAttribute("data-type-1",o);var r=document.createElement("h4");r.className="node-type",r.innerHTML=n[e][o][t].type;var u=document.createElement("img");u.className="node-add",u.src="assets/add.svg",i.appendChild(r),i.appendChild(u),s.appendChild(i),i.addEventListener("mousedown",function(i){a.nodeToPlaceData.type=e,a.nodeToPlaceData.data=n[e][o][t],a.onMouseDown(i)})},l=0;l<n[e][o].length;l++)u(l)};for(var s in n[e])o(s);r.appendChild(t)};for(var u in n)s(u)}var t,n,i;return t=e,(n=[{key:"onMouseDown",value:function(e){this.el.style.opacity=.1,this.nodePlaceHelper=new Te(this.workspaceManager,{x:e.clientX,y:e.clientY}),this.nodePlaceHelper.onMouseDown(e),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){this.nodePlaceHelper.onMouseMove(e)}},{key:"onMouseUp",value:function(){this.nodePlaceHelper.onMouseUp(),this.el.style.opacity=1,window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound);var e=this.nodePlaceHelper.getPos();Math.abs(this.nodePlaceHelper.deltaX)>4&&this.onNodeAddedCallback(this.nodeToPlaceData.type,this.nodeToPlaceData.data,e),this.nodeToPlaceData={type:void 0,data:void 0}}}])&&Ne(t.prototype,n),i&&Ne(t,i),e}();function Ie(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Be=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nodes={},this.step=t,this.currentConnections=[],this.oscillatorNodes=[],this.synthOscillatorNodes=[],this.triggerNodes=[]}var t,n,i;return t=e,(n=[{key:"reset",value:function(e){for(var t=0;t<this.currentConnections.length;t++){var n=this.currentConnections[t],i=this.nodes[n.out.ID]?this.nodes[n.out.ID].audioNode:void 0,o=this.nodes[n.in.ID]?this.nodes[n.in.ID].audioNode:void 0,a=this.nodes[n.in.ID]?this.nodes[n.in.ID].musicNode:void 0;if(i&&o)if(n.out.isParam);else{if(a&&a.isAnalyser)continue;o.disconnect()}}this.nodes={},this.oscillatorNodes=[],this.currentConnections=e,this.triggerNodes=[],this.synthOscillatorNodes=[]}},{key:"updateConnections",value:function(e){console.log("updateConnections"),this.reset(e);for(var t=0;t<e.length;t++){var n=e[t];if(!n.out.isSequencer){if(!this.nodes[n.in.ID]){var i={audioNode:n.in.getAudioNode(),musicNode:n.in};this.nodes[n.in.ID]=i}if(!this.nodes[n.out.ID]){var o=n.out.getAudioNode(n.param?n.param.param:void 0),a={audioNode:o,musicNode:n.out};this.nodes[n.out.ID]=a,n.out.isEnvelope&&this.triggerNodes.push(o),(n.out.isOscillator||n.out.isLFO)&&this.oscillatorNodes.push(a),n.out.isSynthOscillator&&this.synthOscillatorNodes.push(a)}}}for(var r=0;r<e.length;r++){var s=e[r],u=this.nodes[s.out.ID]?this.nodes[s.out.ID].audioNode:void 0,l=this.nodes[s.in.ID]?this.nodes[s.in.ID].audioNode:void 0;this.nodes[s.out.ID]&&this.nodes[s.out.ID].musicNode,this.nodes[s.in.ID]&&this.nodes[s.in.ID].musicNode;if(!s.out.isSequencer||u)if(s.out.isParam){var c=s.param.param;u.connect(l[c])}else u.connect(l)}}},{key:"onParamChange",value:function(e){this.nodes[e.ID]&&(e.isOscillator?this._updateOscillatorParams(this.nodes[e.ID].audioNode,e):e.isSynthOscillator||this._updateParams(this.nodes[e.ID].audioNode,e))}},{key:"_updateSynthOscillatorParams",value:function(e,t){for(var n=0;n<t.synthParams.length;n++){var i=t.params[t.synthParams[n]];i.setParam?i.setParam(e,i.value):e[t.synthParams[n]].value=i.value}}},{key:"_updateOscillatorParams",value:function(e,t){e.frequency.value=t.getFrequency(this.step)}},{key:"_updateParams",value:function(e,t){var n=function(e,t){for(var n in e.params)if(e.params[n].param===t)return e.params[n].isConnected};for(var i in t.params)"gain"===i&&n(t,i)||("frequency"===i||"amplitude"===i||"Q"===i||"gain"===i||"threshold"===i||"ratio"===i?e[i].value=t.params[i].value:e[i]=t.params[i].value)}},{key:"play",value:function(e,t){var n=this.triggerNodes.length,i=this.oscillatorNodes.length,o=this.synthOscillatorNodes.length;for(var a in this.nodes){var r=this.nodes[a];r.musicNode.isOscillator?this._updateOscillatorParams(r.audioNode,r.musicNode):r.musicNode.isSynthOscillator?this._updateSynthOscillatorParams(r.audioNode,r.musicNode):this._updateParams(r.audioNode,r.musicNode)}for(var s=0;s<n;s++)this.triggerNodes[s].triggerAttackRelease(B.a.Time("8n"),e);for(var u=0;u<i;u++){var l=this.oscillatorNodes[u];l.musicNode.isOscillator&&l.musicNode.hasConnectedTrigger&&l.musicNode.connectedTriggerID===t?l.musicNode.hasEnvelopeConnection?l.audioNode.start(e).stop(e+B.a.Time(2)):l.audioNode.start(e).stop(e+B.a.Time("8n")):l.musicNode.isLFO&&(l.audioNode.phase=0,l.audioNode.start(e))}for(var c=0;c<o;c++){var h=this.synthOscillatorNodes[c];if(h.musicNode.connectedTriggerID===t){var p=h.musicNode.getFrequency(this.step);h.audioNode.triggerAttackRelease(p,"8n")}}}},{key:"keyDown",value:function(){var e=this.triggerNodes.length,t=this.oscillatorNodes.length,n=this.synthOscillatorNodes.length;for(var i in this.nodes){var o=this.nodes[i];o.musicNode.isOscillator?this._updateOscillatorParams(o.audioNode,o.musicNode):o.musicNode.isSynthOscillator?this._updateSynthOscillatorParams(o.audioNode,o.musicNode):this._updateParams(o.audioNode,o.musicNode)}for(var a=0;a<t;a++){var r=this.oscillatorNodes[a];r.musicNode.isOscillator?r.audioNode.start():r.musicNode.isLFO&&(r.audioNode.phase=0,r.audioNode.start())}for(var s=0;s<e;s++)this.triggerNodes[s].triggerAttack();for(var u=0;u<n;u++){var l=this.synthOscillatorNodes[u],c=l.musicNode.getFrequency(this.step);l.audioNode.triggerAttack(c)}}},{key:"keyUp",value:function(){for(var e=this.triggerNodes.length,t=this.oscillatorNodes.length,n=this.synthOscillatorNodes.length,i=0;i<t;i++){var o=this.oscillatorNodes[i];o.musicNode.isOscillator?o.musicNode.hasEnvelopeConnection||o.audioNode.stop():o.musicNode.isLFO}for(var a=0;a<e;a++)this.triggerNodes[a].triggerRelease();for(var r=0;r<n;r++){var s=this.synthOscillatorNodes[r];s.musicNode.getFrequency(this.step);s.audioNode.triggerRelease()}}}])&&Ie(t.prototype,n),i&&Ie(t,i),e}();function De(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var je=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),e.KEY_INTS=[65,83,68,70,71,72,74,75,76,186,222,219],this.keys=[];for(var n=0;n<e.KEY_INTS.length;n++){var i={keyNr:e.KEY_INTS[n],step:n,triggered:!1,synth:new Be(n)};this.keys.push(i)}window.addEventListener("keydown",function(e){var n=e.keyCode,i=t.getKey(n);if(null!==i){if(e.preventDefault(),i.triggered)return;i.triggered=!0,i.synth.keyDown()}}),window.addEventListener("keyup",function(e){e.preventDefault();var n=e.keyCode,i=t.getKey(n);if(null!==i){if(!i.triggered)return;i.triggered=!1,i.synth.keyUp()}})}var t,n,i;return t=e,(n=[{key:"play",value:function(e,t){this.keys[e].synth.play(t)}},{key:"onAudioNodeConnectionUpdate",value:function(e){for(var t=0;t<this.keys.length;t++)this.keys[t].synth.updateConnections(e)}},{key:"onAudioNodeParamChange",value:function(e,t){for(var n=0;n<this.keys.length;n++)this.keys[n].synth.onParamChange(e,t)}},{key:"getKey",value:function(e){for(var t=null,n=0;n<this.keys.length;n++)this.keys[n].keyNr!==e||(t=this.keys[n]);return t}}])&&De(t.prototype,n),i&&De(t,i),e}();function Ae(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ve=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="node-settings",this.paramContainer=document.createElement("div"),this.paramContainer.className="param-container",this.el.appendChild(this.paramContainer),t.appendChild(this.el),this.currentParams={},this.currentNode=null,this.onParameterChangeBound=this.onParameterChange.bind(this),window.addEventListener("mousedown",function(){n.hide()})}var t,n,i;return t=e,(n=[{key:"onParameterChange",value:function(){for(var e in this.currentParams){var t=this.currentParams[e].getReadyValue();this.currentNode.setParamVal(t,this.currentParams[e].parameter)}this.currentNode.onParameterUpdate()}},{key:"show",value:function(e){this.reset(),this.currentNode=e;var t=e.params;for(var n in t)if(t[n].obj){var i=t[n].objSettings,o=e.paramVals[i.param],a=new t[n].obj(this.paramContainer,i.title,o,i.range,this.onParameterChangeBound,i.param,i.decimals,t[n].isConnected&&"gain"===i.param);this.currentParams[n]=a}Object.keys(t).length>0&&this.el.classList.add("visible")}},{key:"hide",value:function(){this.el.classList.remove("visible"),this.reset()}},{key:"reset",value:function(){for(var e in this.currentParams)this.currentParams[e].remove();this.currentNode=null,this.currentParams={}}}])&&Ae(t.prototype,n),i&&Ae(t,i),e}();function He(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Fe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=3e3,this.height=2e3,this.containerEl=document.createElement("div"),this.containerEl.className="workspace-container",t.appendChild(this.containerEl),this.el=document.createElement("div"),this.el.className="workspace",this.el.style.width=this.width+"px",this.el.style.height=this.height+"px",this.containerEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.currentScale=1,this.moveCoords={start:{x:0,y:0},offset:{x:-(this.width/2-window.innerWidth/2),y:-(this.height/2-window.innerHeight/2)}},this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0)"),this.el.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"setScale",value:function(e){this.currentScale=e,this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0) scale(").concat(e,")")}},{key:"onMouseDown",value:function(e){"INPUT"===e.target.nodeName||e.target.classList.contains("prevent-drag")||(e.preventDefault(),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,window.addEventListener("mousemove",this.onMouseMoveBound),window.addEventListener("mouseup",this.onMouseUpBound))}},{key:"onMouseMove",value:function(e){e.preventDefault();var t=e.x-this.moveCoords.start.x,n=e.y-this.moveCoords.start.y;this.moveCoords.offset.x=t,this.moveCoords.offset.y=n,this.el.style[window.NS.transform]="translate3d(".concat(t,"px, ").concat(n,"px, 0) scale(").concat(this.currentScale,")")}},{key:"onMouseUp",value:function(e){window.removeEventListener("mousemove",this.onMouseMoveBound),window.removeEventListener("mouseup",this.onMouseUpBound)}},{key:"onResize",value:function(e,t){this.containerEl.style.width="".concat(e,"px"),this.containerEl.style.height="".concat(t,"px")}}])&&He(t.prototype,n),i&&He(t,i),e}();function Ue(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ze=function(){function e(t,n,i,o){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.settings=n,this.onChangeCallback=o,this.regExp=/^[0-9]*$/,this.value=i,this.onInputChangeBound=this.onInputChange.bind(this),this.plusEl=document.createElement("div"),this.plusEl.className="node-stepper-control plus",this.plusEl.innerHTML="+",this.plusEl.addEventListener("click",function(){a.onStepperChange(!0)}),this.minusEl=document.createElement("div"),this.minusEl.className="node-stepper-control minus",this.minusEl.innerHTML="-",this.minusEl.addEventListener("click",function(){a.onStepperChange(!1)}),this.inputEl=document.createElement("input"),this.inputEl.className="node-stepper-input",this.inputEl.value=i,this.inputSetButton=document.createElement("h4"),this.inputSetButton.className="input-set-button",this.inputSetButton.innerHTML="OK",this.inputSetButton.addEventListener("click",this.onInputChangeBound),this.el=document.createElement("div"),this.el.className="node-stepper";var r=document.createElement("div");r.className="left-container",r.appendChild(this.plusEl),r.appendChild(this.minusEl);var s=document.createElement("h4");s.className="label",s.innerHTML=n.label;var u=document.createElement("div");u.className="control-wrapper",u.appendChild(r),u.appendChild(this.inputEl),u.appendChild(this.inputSetButton),this.el.appendChild(s),this.el.appendChild(u),t.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"isValidInput",value:function(e){return!!this.regExp.test(e)&&!(e<this.settings.min||e>this.settings.max)}},{key:"onInputChange",value:function(e){var t=Number(this.inputEl.value);this.isValidInput(t)&&(this.onChangeCallback(t),this.value=t),this.inputEl.value=this.value}},{key:"onStepperChange",value:function(e){var t=e?this.value+1:this.value-1;this.isValidInput(t)&&(this.onChangeCallback(t),this.value=t,this.inputEl.value=this.value)}}])&&Ue(t.prototype,n),i&&Ue(t,i),e}();function qe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ge=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="global-audio-settings",this.onBPMChangeBound=this.onBPMChange.bind(this),this.bpmNodeStepper=new ze(this.el,{min:40,max:200,label:"BPM"},B.a.Transport.bpm.value,this.onBPMChangeBound),t.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"onBPMChange",value:function(e){B.a.Transport.bpm.value=e}}])&&qe(t.prototype,n),i&&qe(t,i),e}();function We(e){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ke(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ye(e){return(Ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qe(e,t){return(Qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ze=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=Ye(t).call(this))||"object"!==We(i)&&"function"!=typeof i?Xe(n):i).isParam=!0,e.isLFO=!0,e.el.classList.add("no-height"),e.audioNode=new B.a.LFO;var o=document.createElement("div");o.className="range-container",e.topPartEl.appendChild(o),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(Xe(e));var a={parentEl:o,title:"Frekvens",initValue:6,settings:{min:.1,max:17},valChangeCallback:e.onRangeChangeCallbackBound,param:"frequency",decimals:2,disable:!1};e.freqRangeSlider=new j(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={useAsInput:!0,value:a.initValue,param:"frequency",slider:e.freqRangeSlider,title:"LFO Frequency",helper:_.frequency,disableSliderOnConnection:!1},s={parentEl:o,title:"Amplitud",initValue:.25,settings:{min:.1,max:.5},valChangeCallback:e.onRangeChangeCallbackBound,param:"amplitude",decimals:2,disable:!1};e.amplitudeRangeSlider=new j(s.parentEl,s.title,s.initValue,s.settings,s.valChangeCallback,s.param,s.decimals,s.disable);var u={useAsInput:!0,value:s.initValue,param:"amplitude",slider:e.amplitudeRangeSlider,title:"Amplitude",helper:_.frequency,disableSliderOnConnection:!1};return e.params[r.param]=r,e.params[u.param]=u,e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qe(e,t)}(t,L),n=t,(i=[{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getAudioNode",value:function(){var e=new B.a.LFO;return e.min=-22e3,e.max=22e3,e}}])&&Ke(n.prototype,i),o&&Ke(n,o),t}();function Je(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var $e=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.triggerID=i,this.cols=t,this.rows=n,this.synths=[],this.masterSynth=new Be(0);for(var o=0;o<t;o++){for(var a=[],r=0;r<n;r++)a.push({synth:null,isActive:!1});this.synths.push(a)}}var t,n,i;return t=e,(n=[{key:"init",value:function(e){this.masterSynth.updateConnections(e)}},{key:"removeAllSynths",value:function(){for(var e=this.cols,t=this.rows,n=0;n<e;n++)for(var i=0;i<t;i++)this.synths[n][i].isActive&&(this.synths[n][i].synth.reset(),this.synths[n][i].isActive=!1)}},{key:"addSynth",value:function(e,t){var n=new Be(t);n.updateConnections(this.masterSynth.currentConnections),this.synths[e][t].synth=n,this.synths[e][t].isActive=!0}},{key:"removeSynth",value:function(e,t){this.synths[e][t].isActive&&(this.synths[e][t].synth.reset(),this.synths[e][t].isActive=!1)}},{key:"play",value:function(e,t,n){this.synths[e][t].synth.play(n,this.triggerID)}},{key:"onAudioNodeConnectionUpdate",value:function(e){for(var t=this.cols,n=this.rows,i=0;i<t;i++)for(var o=0;o<n;o++)this.synths[i][o].isActive&&this.synths[i][o].synth.updateConnections(e);this.masterSynth.updateConnections(e)}},{key:"onAudioNodeParamChange",value:function(e,t){for(var n=this.cols,i=this.rows,o=0;o<n;o++)for(var a=0;a<i;a++)this.synths[o][a].isActive&&this.synths[o][a].synth.onParamChange(e,t);this.masterSynth.onParamChange(e,t)}}])&&Je(t.prototype,n),i&&Je(t,i),e}();function et(e){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function nt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function it(e,t,n){return(it="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ot(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ot(e){return(ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function at(e,t){return(at=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var rt=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,e=!(i=ot(t).call(this))||"object"!==et(i)&&"function"!=typeof i?nt(n):i,t.ROWS=12,t.COLS=16,e.isSequencer=!0,e.loop=null,e.hasAudioInput=!1,e.isParam=!0,e.data=[];for(var o=t.ROWS,a=t.COLS,r=0;r<a;r++){for(var s=[],u=0;u<o;u++){var l={active:!1,el:null,parentEl:null,step:o-1-u};s.push(l)}e.data.push(s)}return e.outConnections=[],e.outConnectionsLength=0,e.isPlaying=!1,e.onBtnClickBound=e.onBtnClick.bind(nt(e)),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&at(e,t)}(t,L),n=t,(i=[{key:"init",value:function(e,n,i,o,a,r,s,u,l){it(ot(t.prototype),"init",this).call(this,e,n,i,o,a,r,s,u,l),this.sequencerManager=new $e(t.COLS,t.ROWS,this.ID)}},{key:"removeFromDom",value:function(){this.sequencerManager.removeAllSynths(),it(ot(t.prototype),"removeFromDom",this).call(this)}},{key:"getKey",value:function(e,t){return"col".concat(e,"-row").concat(t)}},{key:"onRemoveClick",value:function(){this.loop.stop(),this.playEl.removeEventListener("click",this.onPlayClickBound),this.pauseEl.removeEventListener("click",this.onPauseClickBound),it(ot(t.prototype),"onRemoveClick",this).call(this)}},{key:"createUI",value:function(){var e=t.ROWS,n=t.COLS,i=document.createElement("div");i.className="sequencer-container";for(var o=0;o<n;o++){var a=document.createElement("div");a.className="sequencer-col",i.appendChild(a);for(var r=0;r<e;r++){var s=document.createElement("div");s.className="sequencer-btn",s.setAttribute("data-col",o),s.setAttribute("data-row",r),a.appendChild(s),s.addEventListener("click",this.onBtnClickBound),this.data[o][r].el=s,this.data[o][r].parentEl=a}}this.topPartEl.appendChild(i);var u=document.createElement("div");u.className="sequencer-controls";var l=document.createElement("div");l.className="inner-controls",this.playEl=document.createElement("h5"),this.playEl.innerHTML="Spela",this.pauseEl=document.createElement("h5"),this.pauseEl.innerHTML="Nollställ",this.onPlayClickBound=this.onPlayClick.bind(this),this.onPauseClickBound=this.onPauseClick.bind(this),this.playEl.addEventListener("click",this.onPlayClickBound),this.pauseEl.addEventListener("click",this.onPauseClickBound),l.appendChild(this.playEl),l.appendChild(this.pauseEl),u.appendChild(l),this.topPartEl.appendChild(u)}},{key:"onPlayClick",value:function(){this.isPlaying||(this.isPlaying=!0,this.loop.start())}},{key:"onPauseClick",value:function(){this.isPlaying=!1,this.loop.stop(),this.reset()}},{key:"reset",value:function(){for(var e=t.ROWS,n=t.COLS,i=0;i<n;i++){this.data[i][0].parentEl.classList.remove("active");for(var o=0;o<e;o++)this.data[i][o].active=!1}this.sequencerManager.removeAllSynths(),this.update()}},{key:"setup",value:function(){var e=this;this.loop=new B.a.Sequence(function(n,i){for(var o=0;o<t.COLS;o++){e.data[o][0].parentEl.classList.remove("active")}var a=e.data[i];e.data[i][0].parentEl.classList.add("active");for(var r=0;r<t.ROWS;r++)a[r].active&&e.outConnectionsLength>0&&e.sequencerManager.play(i,a[r].step,n)},[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],"8n")}},{key:"onBtnClick",value:function(e){e.stopPropagation(),e.preventDefault();var t=parseInt(e.target.getAttribute("data-col")),n=parseInt(e.target.getAttribute("data-row")),i=this.data[t][n];i.active=!i.active,i.active?this.sequencerManager.addSynth(t,i.step):this.sequencerManager.removeSynth(t,i.step),this.update()}},{key:"onOutputClick",value:function(e){0===this.outConnectionsLength&&this.onConnectingCallback(this,e)}},{key:"enableOutput",value:function(e,t){this.output.enable(),this.outConnections.push(t.in),this.outConnectionsLength=this.outConnections.length}},{key:"disableOutput",value:function(e,t){this.outConnections=this.outConnections.filter(function(t){return t.ID!==e.ID}),this.outConnectionsLength=this.outConnections.length,0===this.outConnections.length&&(this.output.disable(),this.sequencerManager.removeAllSynths(),this.onPauseClick())}},{key:"update",value:function(){for(var e=t.ROWS,n=t.COLS,i=0;i<n;i++)for(var o=0;o<e;o++){var a=this.data[i][o];a.active?a.el.classList.add("active"):a.el.classList.remove("active")}}}])&&tt(n.prototype,i),o&&tt(n,o),t}();function st(e){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ut(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function lt(e,t){return!t||"object"!==st(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ct(e,t,n){return(ct="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ht(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ht(e){return(ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pt(e,t){return(pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var dt=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=lt(this,ht(t).call(this))).el.classList.add("no-height"),e.el.classList.add("waveform-node"),e.needsUpdate=!0,e.isAnalyser=!0,e.isDisposed=!1,e.hasMultipleOutputs=!0,e.arrSize=256,e.audioValue=0,e.isConnected=!1,e.audioConnections=[],e.audioNode=B.a.context.createAnalyser(),e.audioNode.fftSize=e.arrSize,e.canvas=document.createElement("canvas"),e.canvas.className="waveform-canvas",e.canvas.width="200",e.canvas.height="100",e.ctx=e.canvas.getContext("2d"),e.value=new Uint8Array(e.arrSize),e.topPartEl.appendChild(e.canvas),e.params={},e}var n,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pt(e,t)}(t,L),n=t,(i=[{key:"init",value:function(e,n,i,a,r,s,u,l,c){ct(ht(t.prototype),"init",this).call(this,e,n,i,a,r,s,u,l,c),this.onOutputClickAudioBound=this.onOutputClickAudio.bind(this),this.onOutputClickDataBound=this.onOutputClickData.bind(this);var h=document.createElement("div");h.className="multiple-outputs",this.bottomPartEl.appendChild(h),this.outputAudio=new o(h,this.onOutputClickAudioBound,!1,!1,!1,!1),this.outputData=new o(h,this.onOutputClickDataBound,!0,!1,!1,!1),this.outputDataConnection=null,this.outputs={"analyser-audio":this.outputAudio,"analyser-data":this.outputData},this.enabledOutputs=[],this.inDotPos={"analyser-audio":null,"analyser-data":null}}},{key:"onOutputClickAudio",value:function(e){this.onConnectingCallback(this,e,"analyser-audio")}},{key:"onOutputClickData",value:function(e){this.onConnectingCallback(this,e,"analyser-data")}},{key:"getOutputPos",value:function(e){return{x:this.outputs[e].el.offsetLeft,y:this.outputs[e].el.offsetTop}}},{key:"getOutDotPos",value:function(e,t){return this.inDotPos[t]||(this.inDotPos[t]=this.outputs[t].el.getBoundingClientRect()),this.inDotPos[t]}},{key:"getOutputEl",value:function(e){return this.outputs[e]}},{key:"dispose",value:function(){this.isDisposed||(this.audioNode.disconnect(),this.isDisposed=!0)}},{key:"enableInput",value:function(e){ct(ht(t.prototype),"enableInput",this).call(this,e),this.isConnected=!0}},{key:"disableInput",value:function(e){ct(ht(t.prototype),"disableInput",this).call(this,e),this.isConnected=!1}},{key:"enableOutput",value:function(e,t){var n=t.outputType;this.outputs[n].enable(),this.enabledOutputs.push(n),"analyser-data"===n&&(this.outputDataConnection=t)}},{key:"disableOutput",value:function(e,t,n){this.outputs[n].disable(),this.enabledOutputs=this.enabledOutputs.filter(function(e){return e!==n}),"analyser-data"===n&&(this.audioValue=0,this.outputDataConnection=null)}},{key:"getAudioNode",value:function(){return this.isDisposed&&(this.audioNode=B.a.context.createAnalyser(),this.audioNode.fftSize=this.arrSize,this.isDisposed=!1),this.audioNode}},{key:"getValue",value:function(){return this.isConnected?this.audioValue:0}},{key:"update",value:function(){this.isConnected&&this.audioNode.getByteTimeDomainData(this.value)}},{key:"render",value:function(){var e=this.canvas.width,t=this.canvas.height;this.ctx.clearRect(0,0,e,t),this.ctx.fillStyle="black",this.ctx.strokeStyle="red";var n=0;this.ctx.beginPath();for(var i=0;i<this.arrSize;i++){var o=i/this.arrSize*e,a=(1-this.value[i]/256)*t;n+=1-this.value[i]/256,this.ctx.lineTo(o,a)}if(this.audioValue=100*(n/this.arrSize-.5),this.ctx.stroke(),this.outputDataConnection&&this.outputDataConnection.param){var r=this.outputDataConnection.param;this.outputDataConnection.in.updateParam(r,this)}}}])&&ut(n.prototype,i),a&&ut(n,a),t}();function ft(e){return(ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yt(e,t,n){return(yt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=gt(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function gt(e){return(gt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bt(e,t){return(bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ct=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=gt(t).call(this))||"object"!==ft(i)&&"function"!=typeof i?vt(n):i).el.classList.add("no-height"),e.hasConnectedTrigger=!1,e.connectedTriggerID=-1,e.synthParams=[],t.BASE_FREQ=440,t.ROOT=Math.pow(2,1/12),e.isKeyboardListener=!0,e.isSynthOscillator=!0,e.hasAudioInput=!1,e.hasEnvelopeConnection=!1;var o=document.createElement("div");o.className="range-container",e.topPartEl.appendChild(o),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(vt(e));var a={parentEl:o,title:"Oktav",initValue:-2,settings:{min:-4,max:0},valChangeCallback:e.onRangeChangeCallbackBound,param:"octave",decimals:0,disable:!1};e.octaveRangeSlider=new j(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={useAsInput:!1,value:a.initValue,param:"octave",slider:e.octaveRangeSlider,title:"Octave"},s={useAsInput:!0,param:"trigger",title:"Trigger",helper:_.oscillatorTrigger};return e.params[r.param]=r,e.params[s.param]=s,e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bt(e,t)}(t,L),n=t,(i=[{key:"enableParam",value:function(e,n){yt(gt(t.prototype),"enableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!0,this.connectedTriggerID=n.out.ID)}},{key:"disableParam",value:function(e){yt(gt(t.prototype),"disableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!1,this.connectedTriggerID=-1)}},{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getParams",value:function(e){e||(e=0);return{}}},{key:"getAudioNode",value:function(){return new B.a.MembraneSynth}},{key:"getFrequency",value:function(e){var n=12*parseInt(this.params.octave.value)+e;return t.BASE_FREQ*Math.pow(t.ROOT,n)}}])&&mt(n.prototype,i),o&&mt(n,o),t}();function wt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var kt=function(){function e(t,n,i,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.waves=["sine","sawtooth","square","triangle"],this.parentEl=t,this.onChange=n,this.param=o,this.partialCount=0;var r=document.createElement("h4");r.className="wave-type-label",r.innerHTML=a;var s=document.createElement("div");s.className="wave-type-selector-container",s.appendChild(r);var u=document.createElement("div");u.className="wave-types-container",s.appendChild(u),this.onWaveClickBound=this.onWaveClick.bind(this),this.waveTypeEls=[];for(var l=0;l<this.waves.length;l++){var c=document.createElement("h4");c.className="wave-type",c.innerHTML=this.waves[l],c.setAttribute("data-wave",this.waves[l]),c.addEventListener("click",this.onWaveClickBound),this.waveTypeEls.push(c),u.appendChild(c)}t.appendChild(s)}var t,n,i;return t=e,(n=[{key:"onWaveClick",value:function(e){for(var t=0;t<this.waveTypeEls.length;t++)this.waveTypeEls[t].classList.remove("active");var n=e.target.getAttribute("data-wave");e.target.classList.add("active"),this.onChange(n,this.param)}},{key:"remove",value:function(){for(var e=0;e<this.waveTypeEls.length;e++)this.waveTypeEls[e].removeEventListener("click",this.onWaveClickBound);this.parentEl.removeChild(this.el)}}])&&wt(t.prototype,n),i&&wt(t,i),e}();function Et(e){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ot(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _t(e,t,n){return(_t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=xt(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function xt(e){return(xt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mt(e,t){return(Mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Rt=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=xt(t).call(this))||"object"!==Et(i)&&"function"!=typeof i?Pt(n):i).el.classList.add("no-height"),e.hasConnectedTrigger=!1,e.connectedTriggerID=-1,e.synthParams=[],t.BASE_FREQ=440,t.ROOT=Math.pow(2,1/12),e.isKeyboardListener=!0,e.isSynthOscillator=!0,e.hasAudioInput=!1,e.hasEnvelopeConnection=!1;var o=document.createElement("div");o.className="range-container";var a=document.createElement("div");a.className="wave-type-container",e.topPartEl.appendChild(a),e.onWaveChangeCallbackBound=e.onWaveChangeCallback.bind(Pt(e)),e.waveTypeSelector=new kt(a,e.onWaveChangeCallbackBound,"sine","oscillator-type","Oscillator vågtyp"),e.topPartEl.appendChild(o),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(Pt(e));var r={parentEl:o,title:"Oktav",initValue:0,settings:{min:-4,max:4},valChangeCallback:e.onRangeChangeCallbackBound,param:"octave",decimals:0,disable:!1};e.octaveRangeSlider=new j(r.parentEl,r.title,r.initValue,r.settings,r.valChangeCallback,r.param,r.decimals,r.disable);var s={useAsInput:!1,value:r.initValue,param:"octave",slider:e.octaveRangeSlider,title:"Octave"},u={useAsInput:!1,value:"sine",param:"oscillator-type",title:"oscillator type",setParam:function(e,t){e.oscillator.type=t}},l={useAsInput:!0,param:"trigger",title:"Trigger",helper:_.oscillatorTrigger};return e.params[s.param]=s,e.params[l.param]=l,e.params[u.param]=u,e.synthParams.push(u.param),e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mt(e,t)}(t,L),n=t,(i=[{key:"enableParam",value:function(e,n){_t(xt(t.prototype),"enableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!0,this.connectedTriggerID=n.out.ID)}},{key:"disableParam",value:function(e){_t(xt(t.prototype),"disableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!1,this.connectedTriggerID=-1)}},{key:"onWaveChangeCallback",value:function(e,t){this.params[t].value=e}},{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getParams",value:function(e){e||(e=0);return{}}},{key:"getAudioNode",value:function(){return new B.a.FMSynth}},{key:"getFrequency",value:function(e){var n=12*parseInt(this.params.octave.value)+e;return t.BASE_FREQ*Math.pow(t.ROOT,n)}}])&&Ot(n.prototype,i),o&&Ot(n,o),t}();n(8),n(12),n(14),n(9),n(15),n(10),n(16),n(17),n(18),n(11),n(19),n(20),n(21),n(22),n(23),n(24),n(25),n(26);var St=function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="node-param-header node-component",i&&(this.el.style.marginTop="10px");var o=document.createElement("h2");o.innerHTML=n,this.el.appendChild(o),t.appendChild(this.el)},Tt={general:{isValid:function(e){return!0}},needsFramebuffer:{isValid:function(e){return e.framebuffer||e.isForegroundNode}},sceneNode:{isValid:function(e,t,n){return!(t.enabledInputs.some(function(t){return t.out.ID===e.ID})||!n)&&{background:function(){return e.isBackgroundNode},foreground:function(){return e.isForegroundNode},light:function(){return e.isLightNode&&!t.foregroundRender.hasConnectedLight}}[n]()}}};function Nt(e){return(Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Lt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function It(e,t){return!t||"object"!==Nt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Bt(e,t,n){return(Bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Dt(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Dt(e){return(Dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function jt(e,t){return(jt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var At=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=It(this,Dt(t).call(this))).params={},e.inputParams={},e.isForegroundNode=!1,e.isBackgroundNode=!1,e.currentOutConnections=[],e.currentOutConnectionsLength=0,e.el=document.createElement("div"),e.el.className="node",e.topPartEl=document.createElement("div"),e.topPartEl.className="top-part",e.el.appendChild(e.topPartEl),e.bottomPartEl=document.createElement("div"),e.bottomPartEl.className="bottom-part",e.el.appendChild(e.bottomPartEl),e.inputHelpersType=Tt.general,e.isGraphicsNode=!0,e.isRenderNode=!1,e.canConnectToMaterial=!1,e.isCanvasNode=!1,e.dotPos=void 0,e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jt(e,t)}(t,c),n=t,(i=[{key:"init",value:function(e,n,i,o,a,r,s,u){var l=this;Bt(Dt(t.prototype),"init",this).call(this,e,n,i,o,a,r,s,u);var c=[];for(var h in this.params)this.params[h].useAsInput&&this.params[h].parent&&function(){var e=l.params[h].parent;if(c.some(function(t){return t.parent===e})){c.find(function(t){return t.parent===e}).children.push(l.params[h])}else{var t={parent:e,children:[]};c.push(t),t.children.push(l.params[h])}}();if(c.length>0)for(var p=0;p<c.length;p++)for(var d=c[p],f=(new St(this.topPartEl,d.parent,p>0),0);f<d.children.length;f++){var m=new P(this.topPartEl,d.children[f],this.onInputClickBound);this.inputParams[d.children[f].title]=m}else for(var v in this.params)if(this.params[v].useAsInput){var y=new P(this.topPartEl,this.params[v],this.onInputClickBound);this.inputParams[this.params[v].title]=y}this.activateDrag()}},{key:"enableParam",value:function(e,t){var n=this.inputParams[e.title];e.isConnected=!0,n.enable(),ke[e.paramHelpersType].update(this,t.out,e)}},{key:"updateParam",value:function(e,t){ke[e.paramHelpersType].update(this,t,e)}},{key:"disableParam",value:function(e,t){var n=this.inputParams[e.title];e.isConnected=!1,n.disable(),ke[e.paramHelpersType].disconnect(this,e,t.out)}},{key:"getDotPos",value:function(e){return this.dotPos||(this.dotPos=e.getBoundingClientRect()),this.dotPos}},{key:"setParamVal",value:function(e,t){this.paramVals[t]=e}},{key:"onParameterUpdate",value:function(){this.getParams()}},{key:"getParams",value:function(){var e={};for(var t in this.params){var n=this.params[t];e[n.objSettings.param]=this.paramVals[n.objSettings.param]}return e}},{key:"onResize",value:function(){}}])&&Lt(n.prototype,i),o&&Lt(n,o),t}();function Vt(e){return(Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ht(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ft(e,t){return!t||"object"!==Vt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ut(e){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zt(e,t){return(zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qt=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Ft(this,Ut(t).call(this))).isRenderNode=!0,n.canConnectToMaterial=!0,n.scene=new THREE.Scene,n.renderer=e.renderer,n.framebuffer=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter}),n}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zt(e,t)}(t,At),n=t,(i=[{key:"update",value:function(){}},{key:"render",value:function(){this.renderer.setRenderTarget(this.framebuffer),this.renderer.render(this.scene,this.camera),this.renderer.setRenderTarget(null)}},{key:"onResize",value:function(e){var t=e.w,n=e.h;this.framebuffer.setSize(t,n),this.camera.aspect?this.camera.aspect=t/n:(this.camera.left=t/-2,this.camera.right=t/2,this.camera.top=n/-2,this.camera.bottom=n/2),this.camera.updateProjectionMatrix()}}])&&Ht(n.prototype,i),o&&Ht(n,o),t}();function Gt(e){return(Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Kt(e,t){return!t||"object"!==Gt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Yt(e,t,n){return(Yt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Xt(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Xt(e){return(Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qt(e,t){return(Qt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Zt=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Kt(this,Xt(t).call(this,e))).isBackgroundNode=!0,n.el.classList.add("no-height"),n.shader="".concat(C).concat(m).concat(g).concat(v);var i=window.innerWidth,o=window.innerHeight;n.camera=new THREE.OrthographicCamera(i/-2,i/2,o/2,o/-2,1,1e3),n.startTime=Date.now();var a=new THREE.PlaneGeometry(2,2),r={};r.u_resolution={value:new THREE.Vector2(window.innerWidth,window.innerHeight)},r.u_time={value:0};var s={u_user_speed3:{value:.5},u_user_pattern_scale:{value:-.358},u_user_scale:{value:7.032},u_user_rotation:{value:.804},u_user_speed2:{value:.028},u_user_blur:{value:.7}};s.u_user_color1={value:new THREE.Color(.256,.351,.62)},s.u_user_color2={value:new THREE.Color(1,.42,.42)};var u=Object.assign({},r,s);n.material=new THREE.ShaderMaterial({uniforms:u,vertexShader:d,fragmentShader:n.shader}),n.mesh=new THREE.Mesh(a,n.material),n.scene.add(n.mesh),n.paramVals={};return n.params={blurParam:{title:"Blur",param:"u_user_blur",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:.01,max:10},defaultVal:.7,decimals:2},distortionParam:{title:"Distortion",param:"u_user_speed2",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:.001,max:10},defaultVal:.02,decimals:2},rotationParam:{title:"Rotation",param:"u_user_rotation",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:.01,max:2},defaultVal:.8,decimals:2},patternScaleParam:{title:"Pattern Scale",param:"u_user_pattern_scale",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,decimals:2},scaleParam:{title:"Scale",param:"u_user_scale",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:1,max:20},defaultVal:7,decimals:2},speed3Param:{title:"Speed3",param:"u_user_speed3",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:0,max:2},value:.5,decimals:2}},n}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qt(e,t)}(t,qt),n=t,(i=[{key:"enableOutput",value:function(e,n){Yt(Xt(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var i=this.currentOutConnections.map(function(e){return e}),o=i.filter(function(e){return e.param}),a=i.filter(function(e){return!e.param});n?o=o.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=o.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&Yt(Xt(t.prototype),"disableOutput",this).call(this)}},{key:"update",value:function(){Yt(Xt(t.prototype),"update",this).call(this);var e=Date.now()-this.startTime;this.mesh.material.uniforms.u_time.value=.005*e}},{key:"onResize",value:function(e){Yt(Xt(t.prototype),"onResize",this).call(this,e);var n=e.w,i=e.h;this.mesh.material.uniforms.u_resolution.value=new THREE.Vector2(n,i)}}])&&Wt(n.prototype,i),o&&Wt(n,o),t}();function Jt(e){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function en(e,t){return!t||"object"!==Jt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function tn(e,t,n){return(tn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=nn(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function nn(e){return(nn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function on(e,t){return(on=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var an=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=en(this,nn(t).call(this,e))).isBackgroundNode=!0,n.el.classList.add("no-height"),n.shader="".concat(C).concat(m).concat(b).concat(v);var i=window.innerWidth,o=window.innerHeight;n.camera=new THREE.OrthographicCamera(i/-2,i/2,o/2,o/-2,1,1e3),n.startTime=Date.now();var a=new THREE.PlaneGeometry(2,2),r={};r.u_resolution={value:new THREE.Vector2(window.innerWidth,window.innerHeight)},r.u_time={value:0};var s={};s.u_user_fgColor={value:new THREE.Color(1,1,1)},s.u_user_bgColor={value:new THREE.Color(0,0,0)};var u=Object.assign({},r,s);n.material=new THREE.ShaderMaterial({uniforms:u,vertexShader:d,fragmentShader:n.shader}),n.mesh=new THREE.Mesh(a,n.material),n.scene.add(n.mesh),n.paramVals={};var l={title:"FG Color",param:"u_user_fgColor",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,defaultVal:n.material.uniforms.u_user_fgColor.value},c={title:"BG Color",param:"u_user_bgColor",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,defaultVal:n.material.uniforms.u_user_bgColor.value};return n.params={fgColorParam:l,bgColorParam:c},n}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&on(e,t)}(t,qt),n=t,(i=[{key:"enableOutput",value:function(e,n){tn(nn(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var i=this.currentOutConnections.map(function(e){return e}),o=i.filter(function(e){return e.param}),a=i.filter(function(e){return!e.param});n?o=o.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=o.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&tn(nn(t.prototype),"disableOutput",this).call(this)}},{key:"update",value:function(){tn(nn(t.prototype),"update",this).call(this);var e=Date.now()-this.startTime;this.mesh.material.uniforms.u_time.value=.005*e}},{key:"onResize",value:function(e){tn(nn(t.prototype),"onResize",this).call(this,e);var n=e.w,i=e.h;this.mesh.material.uniforms.u_resolution.value=new THREE.Vector2(n,i)}}])&&$t(n.prototype,i),o&&$t(n,o),t}();function rn(e){return(rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function un(e,t){return!t||"object"!==rn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ln(e,t,n){return(ln="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=cn(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function cn(e){return(cn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hn(e,t){return(hn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pn=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=un(this,cn(t).call(this,e))).isBackgroundNode=!0,n.shader="".concat(C).concat(m).concat(y).concat(v);var i=window.innerWidth,o=window.innerHeight;n.camera=new THREE.OrthographicCamera(i/-2,i/2,o/2,o/-2,1,1e3),n.startTime=Date.now();var a=new THREE.PlaneGeometry(2,2),r={};r.u_resolution={value:new THREE.Vector2(window.innerWidth,window.innerHeight)},r.u_time={value:0};var s={u_noise_amount:{value:.5}},u=Object.assign({},r,s);n.material=new THREE.ShaderMaterial({uniforms:u,vertexShader:d,fragmentShader:n.shader}),n.mesh=new THREE.Mesh(a,n.material),n.scene.add(n.mesh),n.paramVals={};return n.params={amountParam:{title:"Amount",param:"u_noise_amount",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0}},n}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hn(e,t)}(t,qt),n=t,(i=[{key:"enableOutput",value:function(e,n){ln(cn(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var i=this.currentOutConnections.map(function(e){return e}),o=i.filter(function(e){return e.param}),a=i.filter(function(e){return!e.param});n?o=o.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=o.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&ln(cn(t.prototype),"disableOutput",this).call(this)}},{key:"update",value:function(){ln(cn(t.prototype),"update",this).call(this);var e=Date.now()-this.startTime;this.mesh.material.uniforms.u_time.value=.005*e}},{key:"onResize",value:function(e){ln(cn(t.prototype),"onResize",this).call(this,e);var n=e.w,i=e.h;this.mesh.material.uniforms.u_resolution.value=new THREE.Vector2(n,i)}}])&&sn(n.prototype,i),o&&sn(n,o),t}();function dn(e){return(dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function mn(e,t){return!t||"object"!==dn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vn(e,t,n){return(vn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=yn(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function yn(e){return(yn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function gn(e,t){return(gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var bn=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=mn(this,yn(t).call(this))).isForegroundNode=!0,e.el.classList.add("no-height");window.innerWidth,window.innerHeight;e.geometry=new THREE.BoxGeometry(3,3,3,10,10,10),e.material=new THREE.MeshPhongMaterial({}),e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Material",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Material",paramHelpersType:"texture",needsFrameUpdate:!1},colorParam:n,bumpMapParam:{title:"Displacement",param:"normalMap",useAsInput:!0,parent:"Material",paramHelpersType:"normalMap",needsFrameUpdate:!1},positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},rotationXParam:{title:"Rotation x",param:"x",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},scaleParam:{title:"Scale",param:"scale",useAsInput:!0,parent:"Scale",paramHelpersType:"scale",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:0}},e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gn(e,t)}(t,At),n=t,(i=[{key:"getMesh",value:function(){return this.mesh}},{key:"enableOutput",value:function(e,n){vn(yn(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var i=this.currentOutConnections.map(function(e){return e}),o=i.filter(function(e){return e.param}),a=i.filter(function(e){return!e.param});n?o=o.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=o.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&vn(yn(t.prototype),"disableOutput",this).call(this)}},{key:"update",value:function(){vn(yn(t.prototype),"update",this).call(this)}}])&&fn(n.prototype,i),o&&fn(n,o),t}();function Cn(e){return(Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function kn(e,t){return!t||"object"!==Cn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function En(e,t,n){return(En="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=On(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function On(e){return(On=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pn(e,t){return(Pn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _n=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=kn(this,On(t).call(this))).isForegroundNode=!0,e.el.classList.add("no-height");window.innerWidth,window.innerHeight;e.geometry=new THREE.SphereGeometry(2,32,32),e.material=new THREE.MeshPhongMaterial({}),e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Material",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Material",paramHelpersType:"texture",needsFrameUpdate:!1},colorParam:n,bumpMapParam:{title:"Displacement",param:"normalMap",useAsInput:!0,parent:"Material",paramHelpersType:"normalMap",needsFrameUpdate:!1},positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},rotationXParam:{title:"Rotation x",param:"x",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},scaleParam:{title:"Scale",param:"scale",useAsInput:!0,parent:"Scale",paramHelpersType:"scale",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:1}},e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pn(e,t)}(t,At),n=t,(i=[{key:"getMesh",value:function(){return this.mesh}},{key:"enableOutput",value:function(e,n){En(On(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var i=this.currentOutConnections.map(function(e){return e}),o=i.filter(function(e){return e.param}),a=i.filter(function(e){return!e.param});n?o=o.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=o.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&En(On(t.prototype),"disableOutput",this).call(this)}}])&&wn(n.prototype,i),o&&wn(n,o),t}();function xn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Mn=function(){function e(t,n,i,o,a){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=i,this.onInputChangeCallback=a,this.decimals=o,this.onInputChangeBound=this.onInputChange.bind(this),this.el=document.createElement("div"),this.el.className="horizontal-range-slider";var s=document.createElement("div");s.className="input-container";var u=document.createElement("p");u.innerHTML="Min",s.appendChild(u),this.inputLowEl=document.createElement("input"),this.inputLowEl.type="number",this.inputLowEl.value=-2,this.inputLowEl.step=1,this.inputLowEl.min=-10,this.inputLowEl.max=1,this.inputLowEl.addEventListener("change",this.onInputChangeBound),s.appendChild(this.inputLowEl);var l=document.createElement("div");l.className="input-container";var c=document.createElement("p");c.innerHTML="Max",l.appendChild(c),this.inputHighEl=document.createElement("input"),this.inputHighEl.type="number",this.inputHighEl.value=2,this.inputHighEl.step=.1,this.inputHighEl.min=2,this.inputHighEl.max=10,this.inputHighEl.addEventListener("change",this.onInputChangeBound),l.appendChild(this.inputHighEl),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var h=document.createElement("div");h.appendChild(s),h.appendChild(this.rangeInnerContainer),h.appendChild(l),h.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=this.inputLowEl.value;var p=document.createElement("div");p.className="value-container";var d=document.createElement("p");d.innerHTML="Value",p.appendChild(d),p.appendChild(this.valueEl),this.el.appendChild(h),this.el.appendChild(p),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),this.value=0,setTimeout(function(){r.setPos(100)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"onInputChange",value:function(e){this.onInputChangeCallback()}},{key:"setDefaultValues",value:function(e){var t=e.minMax;this.inputLowEl.value=t.min,this.inputLowEl.min=t.min-20,this.inputLowEl.max=t.max+20,this.inputHighEl.value=t.max,this.inputHighEl.min=t.max-20,this.inputHighEl.max=t.max+20;var n=e.defaultVal;this.value=(n-t.min)/(t.max-t.min),this.valueEl.innerHTML=n,this.setPos(100),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)))}},{key:"getMinMaxValue",value:function(){return{min:parseFloat(this.inputLowEl.value),max:parseFloat(this.inputHighEl.value)}}},{key:"remove",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e){this.value=e,this.setPos(100);var t=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=t,this.valChangeCallback&&this.valChangeCallback(t)}},{key:"getValue",value:function(){var e=this.getMinMaxValue();return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.setPos(100),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.setPos(100),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.setPos(100),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=e-this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(0px, ".concat(t,"px, 0)")}}])&&xn(t.prototype,n),i&&xn(t,i),e}(),Rn={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}};function Sn(e){return(Sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Tn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Nn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ln(e,t,n){return(Ln="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=In(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function In(e){return(In=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Bn(e,t){return(Bn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Dn=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=In(t).call(this))||"object"!==Sn(i)&&"function"!=typeof i?Nn(n):i).el.classList.add("no-height"),e.el.classList.add("left-padding"),e.el.classList.add("param-driver-node"),e.isParam=!0,e.animateValues={isRunning:!1,timestamp:0,duration:0,reqAnimFrame:-1,firstRunOffset:0},e.onRangeValChangeBound=e.onRangeValChange.bind(Nn(e)),e.onInputChangeBound=e.onInputChange.bind(Nn(e)),e.horizontalRangeSlider=new Mn(e.topPartEl,0,e.onRangeValChangeBound,2,e.onInputChangeBound),e.durationEl=document.createElement("input"),e.durationEl.type="number",e.durationEl.value=2e3,e.durationEl.step=1,e.durationEl.min=400,e.durationEl.max=1e4,e.durationEl.addEventListener("change",e.onInputChangeBound);var o=document.createElement("div");o.className="duration-container (ms)";var a=document.createElement("p");a.innerHTML="Duration",o.appendChild(a),o.appendChild(e.durationEl);var r=document.createElement("div");return r.className="top-bottom-container",r.appendChild(o),e.onToggleStartClickBound=e.onToggleStartClick.bind(Nn(e)),e.toggleStartBtn=document.createElement("div"),e.toggleStartBtn.className="toggle-start",e.toggleStartBtn.addEventListener("click",e.onToggleStartClickBound),e.toggleBtnText=document.createElement("p"),e.toggleBtnText.innerHTML="Start",e.toggleStartBtn.appendChild(e.toggleBtnText),r.appendChild(e.toggleStartBtn),e.topPartEl.appendChild(r),e.modifier={},e.paramVals={},e.params={},e.updateBound=e.update.bind(Nn(e)),e.update(),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bn(e,t)}(t,At),n=t,(i=[{key:"onInputChange",value:function(e){this.reset()}},{key:"reset",value:function(){this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"}},{key:"onToggleStartClick",value:function(){this.animateValues.isRunning?(this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"):(this.toggleBtnText.innerHTML="Stop",this.animateValues.timestamp=Date.now(),this.animateValues.duration=parseInt(this.durationEl.value),this.animateValues.firstRunOffset=Math.floor(this.horizontalRangeSlider.value*this.animateValues.duration),this.animateValues.isReverse=!1,this.animateValues.easing=Rn.linear,this.animateValues.isRunning=!0)}},{key:"getValue",value:function(){return this.horizontalRangeSlider.getReadyValue()}},{key:"update",value:function(){if(this.animateValues.reqAnimFrame=requestAnimationFrame(this.updateBound),this.animateValues.isRunning){var e=Date.now(),t=e-this.animateValues.timestamp+this.animateValues.firstRunOffset,n=this.animateValues.easing(Math.min(t/this.animateValues.duration,1)),i=this.animateValues.isReverse?1-n:n;i>=1?(this.animateValues.timestamp=e,this.animateValues.isReverse=!0,this.animateValues.firstRunOffset=0):i<=0&&(this.animateValues.timestamp=e,this.animateValues.isReverse=!1),this.horizontalRangeSlider.setValue(i)}}},{key:"onRangeValChange",value:function(e){for(var t=0;t<this.currentOutConnectionsLength;t++){var n=this.currentOutConnections[t].param;this.currentOutConnections[t].in.updateParam(n,this)}}},{key:"enableOutput",value:function(e,n){Ln(In(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length,1===this.currentOutConnectionsLength&&this.horizontalRangeSlider.setDefaultValues(e)}},{key:"enableInput",value:function(e){Ln(In(t.prototype),"enableInput",this).call(this)}},{key:"disableOutput",value:function(e,n){var i=this.currentOutConnections.map(function(e){return e}),o=i.filter(function(e){return e.param}),a=i.filter(function(e){return!e.param});n?o=o.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(e){return e.in.ID!==nodeIn.ID});var r=o.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&Ln(In(t.prototype),"disableOutput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),window.cancelAnimationFrame(this.animateValues.reqAnimFrame),Ln(In(t.prototype),"removeFromDom",this).call(this)}}])&&Tn(n.prototype,i),o&&Tn(n,o),t}();function jn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var An=function(){function e(t,n,i,o,a,r,s){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=i,this.height=s||60,this.decimals=o,this.value=(n-a.min)/(a.max-a.min),this.settings=a,this.el=document.createElement("div"),this.el.className="vertical-slider prevent-drag";var l=document.createElement("h4");l.className="vertical-slider-label",l.innerHTML=r,this.el.appendChild(l),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeInnerContainer.style.height="".concat(this.height,"px"),this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var c=document.createElement("div");c.appendChild(this.rangeInnerContainer),c.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=n;var h=document.createElement("div");h.className="value-container",h.appendChild(this.valueEl),this.el.appendChild(c),this.el.appendChild(h),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),setTimeout(function(){u.setPos(u.height)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"remove",value:function(){this.rangeInnerContainer.removeEventListener("click",this.onRangeClickBound),this.rangeKnob.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e){this.value=e,this.setPos(this.height);var t=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=t,this.valChangeCallback&&this.valChangeCallback(t)}},{key:"getValue",value:function(){var e=this.settings;return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),i=1-Math.round(100*(e.y-n.top))/100/t;this.value=i>1?1:i<0?0:i,this.setPos(t),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),i=1-Math.round(100*(e.y-n.top))/100/t;this.value=i>1?1:i<0?0:i,this.setPos(t),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),i=1-Math.round(100*(e.y-n.top))/100/t;this.value=i>1?1:i<0?0:i,this.setPos(t),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=e-this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(0px, ".concat(t,"px, 0)")}}])&&jn(t.prototype,n),i&&jn(t,i),e}();function Vn(e){return(Vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Fn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Un(e,t,n){return(Un="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=zn(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function zn(e){return(zn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qn(e,t){return(qn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Gn=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=zn(t).call(this))||"object"!==Vn(i)&&"function"!=typeof i?Fn(n):i).needsUpdate=!0,e.el.classList.add("no-height"),e.el.classList.add("left-padding"),e.el.classList.add("orbit-driver-node"),e.isParam=!0,e.animateValues={isRunning:!1,reqAnimFrame:-1,counter:1552337385540},e.currentOrbit=10,e.currentSpeed=0,e.currentRotationY=0,e.currentRotationX=0,e.outValues={Position:{x:0,y:0,z:0},Rotation:{x:0,y:0}},e.onSpeedChangeBound=e.onSpeedChange.bind(Fn(e)),e.onOrbitChangeBound=e.onOrbitChange.bind(Fn(e)),e.onRotationChangeYBound=e.onRotationChangeY.bind(Fn(e)),e.onRotationChangeXBound=e.onRotationChangeX.bind(Fn(e));var o=document.createElement("div");return o.className="settings-container-outer",e.topPartEl.appendChild(o),e.speedSlider=new An(o,0,e.onSpeedChangeBound,2,{min:-2,max:2},"Orbit speed"),e.orbitSlider=new An(o,0,e.onOrbitChangeBound,0,{min:0,max:20},"Orbit radie"),e.rotationXSlider=new An(o,0,e.onRotationChangeXBound,3,{min:-.1,max:.1},"Rotation X"),e.rotationYSlider=new An(o,0,e.onRotationChangeYBound,3,{min:-.1,max:.1},"Rotation Y"),e.topPartEl.appendChild(o),e.onToggleStartClickBound=e.onToggleStartClick.bind(Fn(e)),e.toggleStartBtn=document.createElement("div"),e.toggleStartBtn.className="toggle-start",e.toggleStartBtn.addEventListener("click",e.onToggleStartClickBound),e.toggleBtnText=document.createElement("p"),e.toggleBtnText.innerHTML="Start",e.toggleStartBtn.appendChild(e.toggleBtnText),e.topPartEl.appendChild(e.toggleStartBtn),e.modifier={},e.paramVals={},e.params={},e.updateBound=e.update.bind(Fn(e)),e.update(),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qn(e,t)}(t,At),n=t,(i=[{key:"onRotationChangeX",value:function(e){this.currentRotationX=e}},{key:"onRotationChangeY",value:function(e){this.currentRotationY=e}},{key:"onOrbitChange",value:function(e){this.currentOrbit=e}},{key:"onSpeedChange",value:function(e){this.currentSpeed=e}},{key:"reset",value:function(){this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"}},{key:"onToggleStartClick",value:function(){this.animateValues.isRunning?(this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"):(this.toggleBtnText.innerHTML="Stop",this.animateValues.isRunning=!0)}},{key:"getValue",value:function(e){return this.outValues[e.parent][e.param]}},{key:"update",value:function(){if(this.animateValues.isRunning){var e=.01*this.animateValues.counter,t=Math.cos(e*this.currentSpeed)*this.currentOrbit,n=Math.sin(e*this.currentSpeed)*this.currentOrbit;this.outValues.Position.x=t,this.outValues.Position.z=n,this.outValues.Rotation.y+=this.currentRotationY,this.outValues.Rotation.x+=this.currentRotationX;for(var i=0;i<this.currentOutConnectionsLength;i++){var o=this.currentOutConnections[i].param;this.currentOutConnections[i].in.updateParam(o,this)}this.animateValues.counter++}}},{key:"render",value:function(){}},{key:"enableOutput",value:function(e,n){Un(zn(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"enableInput",value:function(e){Un(zn(t.prototype),"enableInput",this).call(this)}},{key:"disableOutput",value:function(e,n){var i=this.currentOutConnections.map(function(e){return e}),o=i.filter(function(e){return e.param}),a=i.filter(function(e){return!e.param});n?o=o.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(e){return e.in.ID!==nodeIn.ID});var r=o.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&(Un(zn(t.prototype),"disableOutput",this).call(this),this.onToggleStartClick())}},{key:"removeFromDom",value:function(){this.reset(),window.cancelAnimationFrame(this.animateValues.reqAnimFrame),this.speedSlider.remove(),this.orbitSlider.remove(),this.rotationXSlider.remove(),this.rotationYSlider.remove(),Un(zn(t.prototype),"removeFromDom",this).call(this)}}])&&Hn(n.prototype,i),o&&Hn(n,o),t}();function Wn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Kn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=window.innerWidth,o=window.innerHeight;this.camera=new THREE.PerspectiveCamera(75,i/o,.1,1e3),this.camera.position.z=10,this.cameraControls=new THREE.OrbitControls(this.camera,n),this.cameraControls.enabled=!1,this.scene=new THREE.Scene,this.renderer=t.renderer,this.axesHelper=new THREE.AxesHelper(5),this.axesHelper.name="AxesHelper",this.ambientLight=new THREE.AmbientLight,this.scene.add(this.ambientLight),this.connectedNodes=[],this.hasConnectedLight=!1,this.framebuffer=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter})}var t,n,i;return t=e,(n=[{key:"toggleAxesHelper",value:function(e){if(e)this.scene.add(this.axesHelper);else{this.scene.getObjectByName(this.axesHelper.name);this.scene.remove(this.axesHelper)}}},{key:"toggleCameraControl",value:function(e){e?(this.cameraControls.enabled=!0,this.renderer.domElement.classList.add("prevent-drag")):(this.cameraControls.enabled=!1,this.renderer.domElement.classList.remove("prevent-drag"))}},{key:"addLight",value:function(e){var t="".concat(e.ID,"-light");e.light.name=t;var n="".concat(e.ID,"-mesh");e.mesh.name=n,this.scene.add(e.light),this.scene.add(e.mesh),this.hasConnectedLight=!0}},{key:"removeLight",value:function(e){var t="".concat(e.ID,"-light"),n=this.scene.getObjectByName(t);this.scene.remove(n);var i="".concat(e.ID,"-mesh"),o=this.scene.getObjectByName(i);this.scene.remove(o),this.hasConnectedLight=!1}},{key:"addNode",value:function(e){this.connectedNodes.push(e);var t="".concat(e.ID,"-mesh");e.mesh.name=t,this.scene.add(e.mesh)}},{key:"removeNode",value:function(e){this.connectedNodes=this.connectedNodes.filter(function(t){return t.ID!==e.ID});var t="".concat(e.ID,"-mesh"),n=this.scene.getObjectByName(t);this.scene.remove(n)}},{key:"update",value:function(){}},{key:"render",value:function(){this.renderer.setRenderTarget(this.framebuffer),this.renderer.render(this.scene,this.camera)}},{key:"onResize",value:function(e){var t=e.w,n=e.h;this.framebuffer.setSize(t,n),this.camera.aspect?this.camera.aspect=t/n:(this.camera.left=t/-2,this.camera.right=t/2,this.camera.top=n/-2,this.camera.bottom=n/2),this.camera.updateProjectionMatrix()}}])&&Wn(t.prototype,n),i&&Wn(t,i),e}();function Yn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Xn=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onResizeCallback=n,this.onNodeResizerDown=i,this.el=document.createElement("div"),this.el.className="node-resizer",this.innerEl=document.createElement("div"),this.innerEl.className="node-resizer-inner",this.el.appendChild(this.innerEl),t.appendChild(this.el),this.currentDims={w:0,h:0},this.currentNodeDims={w:0,h:0},this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.moveCoords={start:{x:0,y:0},offset:{x:0,y:0}},this.innerEl.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this.onNodeResizerDown(),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){e.stopPropagation(),e.preventDefault();var t=e.x-this.moveCoords.start.x,n=e.y-this.moveCoords.start.y;this.onResizeCallback({x:t,y:n})}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"remove",value:function(){this.innerEl.removeEventListener("mousedown",this.onMouseDownBound)}}])&&Yn(t.prototype,n),i&&Yn(t,i),e}();function Qn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Zn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="camera-control-setting",this.foregroundController=n,this.label=document.createElement("h4"),this.label.innerHTML="Kamera kontroll (inaktiv)",this.el.appendChild(this.label),this.toggleEl=document.createElement("div"),this.toggleEl.className="toggle-el",this.isEnabled=!1,this.el.appendChild(this.toggleEl),this.onClickBound=this.onClick.bind(this),this.toggleEl.addEventListener("click",this.onClickBound),t.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.isEnabled=!this.isEnabled,this.isEnabled?(this.toggleEl.classList.add("enabled"),this.label.innerHTML="Kamera kontroll (aktiv)"):(this.toggleEl.classList.remove("enabled"),this.label.innerHTML="Kamera kontroll (inaktiv)"),this.foregroundController.toggleCameraControl(this.isEnabled)}}])&&Qn(t.prototype,n),i&&Qn(t,i),e}();function Jn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var $n=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="axes-helper-setting",this.foregroundController=n,this.label=document.createElement("h4"),this.label.innerHTML="Visa x y z axlar (inaktiv)",this.el.appendChild(this.label),this.toggleEl=document.createElement("div"),this.toggleEl.className="toggle-el",this.isEnabled=!1,this.el.appendChild(this.toggleEl),this.onClickBound=this.onClick.bind(this),this.toggleEl.addEventListener("click",this.onClickBound),t.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.isEnabled=!this.isEnabled,this.isEnabled?(this.toggleEl.classList.add("enabled"),this.label.innerHTML="Visa x y z axlar (aktiv)"):(this.toggleEl.classList.remove("enabled"),this.label.innerHTML="Visa x y z axlar (inaktiv)"),this.foregroundController.toggleAxesHelper(this.isEnabled)}}])&&Jn(t.prototype,n),i&&Jn(t,i),e}();function ei(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ti=function(){function e(t,n,i,o,a,r,s){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=i,this.decimals=o,this.value=(n-a.min)/(a.max-a.min),this.settings=a,this.el=document.createElement("div"),this.el.className="horizontal-slider prevent-drag "+r;var l=document.createElement("h4");l.className="horizontal-slider-label",l.innerHTML=s,this.el.appendChild(l),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var c=document.createElement("div");c.appendChild(this.rangeInnerContainer),c.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=n;var h=document.createElement("div");h.className="value-container",h.appendChild(this.valueEl),this.el.appendChild(c),this.el.appendChild(h),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),setTimeout(function(){u.setPos(120)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"remove",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e){this.value=e,this.setPos(120);var t=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=t,this.valChangeCallback&&this.valChangeCallback(t)}},{key:"getValue",value:function(){var e=this.settings;return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(".concat(t,"px, 0px, 0)")}}])&&ei(t.prototype,n),i&&ei(t,i),e}();function ni(e){return(ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ii(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function oi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ai(e,t,n){return(ai="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ri(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ri(e){return(ri=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function si(e,t){return(si=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ui=function(e){function t(e){var n,i,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,(n=!(o=ri(t).call(this))||"object"!==ni(o)&&"function"!=typeof o?oi(i):o).mainRender=e,n.hasOutput=!1,n.isGraphicsNode=!0,n.hasGraphicsInput=!0,n.isCanvasNode=!0,n.inputHelpersType=Tt.sceneNode,n.enabledInputs=[],n.el=document.createElement("div"),n.el.className="node canvas",n.topPartEl=document.createElement("div"),n.topPartEl.className="top-part",n.el.appendChild(n.topPartEl),n.bottomPartEl=document.createElement("div"),n.bottomPartEl.className="bottom-part",n.bottomPartSettings=document.createElement("div"),n.bottomPartSettings.className="bottom-part-settings",n.bottomPartEl.appendChild(n.bottomPartSettings),n.onNodeResizerDownBound=n.onNodeResizerDown.bind(oi(n)),n.onResizeFromNodeResizerBound=n.onResizeFromNodeResizer.bind(oi(n)),n.nodeResizer=new Xn(n.bottomPartEl,n.onResizeFromNodeResizerBound,n.onNodeResizerDownBound),n.el.appendChild(n.bottomPartEl),n.foregroundRender=new Kn(n.mainRender,n.topPartEl),n.cameraControlSetting=new Zn(n.bottomPartSettings,n.foregroundRender),n.onAmbientLightSettingChangeBound=n.onAmbientLightSettingChange.bind(oi(n)),n.ambientLightSetting=new ti(n.bottomPartSettings,1,n.onAmbientLightSettingChangeBound,2,{min:0,max:1},"ambient-light","Ambient light"),n.axesHelper=new $n(n.bottomPartSettings,n.foregroundRender),n.scene=new THREE.Scene,n.renderer=n.mainRender.renderer,n.renderer.setSize(n.topPartEl.clientWidth,n.topPartEl.clientHeight),n.topPartEl.appendChild(n.renderer.domElement);var a=new THREE.PlaneGeometry(2,2),r={};r.u_res={value:new THREE.Vector2(window.innerWidth,window.innerHeight)};var s={u_connection0:{value:0}};s.u_texture0={value:new Image},s.u_connection1={value:0},s.u_texture1={value:new Image},s.u_finalConnection={value:0},s.u_multiConnection={value:0};var u=Object.assign({},r,s);return n.material=new THREE.ShaderMaterial({uniforms:u,vertexShader:d,fragmentShader:f}),n.mesh=new THREE.Mesh(a,n.material),n.scene.add(n.mesh),n}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&si(e,t)}(t,c),n=t,(i=[{key:"init",value:function(e,n,i,o,a,s,u,l){var c=this;ai(ri(t.prototype),"init",this).call(this,e,n,i,o,a,s,u,l);var h=window.innerWidth,p=window.innerHeight;this.orthoCamera=new THREE.OrthographicCamera(h/-2,h/2,p/2,p/-2,1,1e3),this.bottomPartEl.classList.add("multiple-inputs"),this.onInputClickBackgroundBound=this.onInputClickBackground.bind(this),this.onInputClickForegroundBound=this.onInputClickForeground.bind(this),this.onInputClickLightBound=this.onInputClickLight.bind(this),this.inputBackground=new r(this.bottomPartEl,this.onInputClickBackgroundBound,this.isGraphicsNode,"Bakgrund In","background"),this.inputForeground=new r(this.bottomPartEl,this.onInputClickForegroundBound,this.isGraphicsNode,"Förgrund In","foreground"),this.inputLight=new r(this.bottomPartEl,this.onInputClickLightBound,this.isGraphicsNode,"Ljus In","light"),this.inputs={background:this.inputBackground,foreground:this.inputForeground,light:this.inputLight},setTimeout(function(){c.onResize()},100),this.activateDrag()}},{key:"onAmbientLightSettingChange",value:function(e){this.foregroundRender.ambientLight.intensity=e}},{key:"onNodeResizerDown",value:function(){this.nodeResizer.currentDims.w=this.topPartEl.clientWidth,this.nodeResizer.currentDims.h=this.topPartEl.clientHeight,this.nodeResizer.currentNodeDims.w=this.el.clientWidth,this.nodeResizer.currentNodeDims.h=this.el.clientHeight}},{key:"onResizeFromNodeResizer",value:function(e){this.el.style.width=this.nodeResizer.currentNodeDims.w+e.x+"px",this.el.style.height=this.nodeResizer.currentNodeDims.h+e.y+"px",this.topPartEl.style.width=this.nodeResizer.currentDims.w+e.x+"px",this.topPartEl.style.height=this.nodeResizer.currentDims.h+e.y+"px",this.inputBackground.offsetLeft=this.inputBackground.el.offsetLeft,this.inputBackground.offsetTop=this.inputBackground.el.offsetTop,this.inputForeground.offsetLeft=this.inputForeground.el.offsetLeft,this.inputForeground.offsetTop=this.inputForeground.el.offsetTop,this.inputLight.offsetLeft=this.inputLight.el.offsetLeft,this.inputLight.offsetTop=this.inputLight.el.offsetTop,this.onResize()}},{key:"onInputClickBackground",value:function(e){this.onInputConnectionCallback(this,"background",e)}},{key:"onInputClickForeground",value:function(e){this.onInputConnectionCallback(this,"foreground",e)}},{key:"onInputClickLight",value:function(e){this.onInputConnectionCallback(this,"light",e)}},{key:"getInputEl",value:function(e){return this.inputs[e]}},{key:"getDotPos",value:function(e){return e.getBoundingClientRect()}},{key:"setBackgroundTexture",value:function(e){this.mesh.material.uniforms.u_texture0.value=e}},{key:"enableInput",value:function(e,t){if(this.inputs[t].enable(),e.isBackgroundNode){var n=e.framebuffer?e.framebuffer.texture:e.texture;this.mesh.material.uniforms.u_texture0.value=n,this.mesh.material.uniforms.u_connection0.value=1}else if(e.isForegroundNode){if(this.foregroundRender.addNode(e),1===this.foregroundRender.connectedNodes.length){var i=this.foregroundRender.framebuffer.texture;this.mesh.material.uniforms.u_texture1.value=i,this.mesh.material.uniforms.u_connection1.value=1}}else e.isLightNode&&this.foregroundRender.addLight(e);var o={out:e,type:t};this.enabledInputs.push(o),e.isLightNode||(this.mesh.material.uniforms.u_finalConnection.value=1,this.inputs.background.isActive&&this.inputs.foreground.isActive&&(this.mesh.material.uniforms.u_multiConnection.value=1))}},{key:"disableInput",value:function(e,t){"background"===t?(this.inputs[t].disable(),this.mesh.material.uniforms.u_texture0.value=null,this.mesh.material.uniforms.u_connection0.value=0,this.mesh.material.uniforms.u_multiConnection.value=0):"foreground"===t?(this.foregroundRender.removeNode(e),0===this.foregroundRender.connectedNodes.length&&(this.inputs[t].disable(),this.mesh.material.uniforms.u_texture1.value=null,this.mesh.material.uniforms.u_connection1.value=0)):"light"===t&&(this.inputs[t].disable(),this.foregroundRender.removeLight(e)),this.enabledInputs=this.enabledInputs.filter(function(t){return t.out.ID!==e.ID}),0===this.enabledInputs.filter(function(e){return!e.out.isLightNode}).length?this.mesh.material.uniforms.u_finalConnection.value=0:this.inputs.foreground.isActive||(this.mesh.material.uniforms.u_multiConnection.value=0)}},{key:"update",value:function(){this.foregroundRender.update()}},{key:"render",value:function(){this.renderer.clear(),this.foregroundRender.render(),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.orthoCamera)}},{key:"onResize",value:function(){var e=this.topPartEl.clientWidth,t=this.topPartEl.clientHeight;this.foregroundRender.onResize({w:e,h:t}),this.mesh.material.uniforms.u_res.value=new THREE.Vector2(e,t),this.orthoCamera.left=e/-2,this.orthoCamera.right=e/2,this.orthoCamera.top=t/-2,this.orthoCamera.bottom=t/2,this.orthoCamera.updateProjectionMatrix(),this.renderer.setSize(e,t)}}])&&ii(n.prototype,i),o&&ii(n,o),t}(),li=n(28);function ci(e){return(ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function pi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function di(e,t,n){return(di="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=fi(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function fi(e){return(fi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mi(e,t){return(mi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var vi=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=fi(t).call(this))||"object"!==ci(i)&&"function"!=typeof i?pi(n):i).el.classList.add("no-height"),e.el.classList.add("color-node"),e.isParam=!0,e.paramVals={},e.params={};var o=document.createElement("div");o.className="color-picker-parent prevent-drag";var a=document.createElement("h4");a.innerHTML="Välj färg",e.colorPreview=document.createElement("div"),e.colorPreview.className="color-preview",o.appendChild(a),o.appendChild(e.colorPreview),e.topPartEl.appendChild(o);var r={parent:o,color:"#FFFFFF",alpha:!1};return e.currentColor=void 0,e.picker=new li.a(r),e.onPickerChangeBound=e.onPickerChange.bind(pi(e)),e.picker.onChange=e.onPickerChangeBound,e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mi(e,t)}(t,At),n=t,(i=[{key:"onPickerChange",value:function(e){var t="rgb(".concat(e._rgba[0],",").concat(e._rgba[1],",").concat(e._rgba[2],")");this.setColor(t),this.currentColor=new THREE.Color(e.rgbString);for(var n=0;n<this.currentOutConnectionsLength;n++){var i=this.currentOutConnections[n].param;this.currentOutConnections[n].in.updateParam(i,this)}}},{key:"getValue",value:function(){return this.currentColor}},{key:"setColor",value:function(e){this.colorPreview.style.background=e}},{key:"enableOutput",value:function(e,n){if(di(fi(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length,1===this.currentOutConnectionsLength){var i="#".concat(e.defaultVal.getHexString());this.picker.color=i,this.currentColor=e.defaultVal,this.setColor(i)}}},{key:"disableOutput",value:function(e,n){var i=this.currentOutConnections.map(function(e){return e}),o=i.filter(function(e){return e.param}),a=i.filter(function(e){return!e.param});n?o=o.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(e){return e.in.ID!==nodeIn.ID});var r=o.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&di(fi(t.prototype),"disableOutput",this).call(this)}}])&&hi(n.prototype,i),o&&hi(n,o),t}();function yi(e){return(yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gi(e,t){return!t||"object"!==yi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function bi(e){return(bi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ci(e,t){return(Ci=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var wi=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=gi(this,bi(t).call(this))).isLightNode=!0,e.el.classList.add("no-height"),e.light=new THREE.DirectionalLight(16777215,1),e.light.position.set(0,0,0),e.geometry=new THREE.SphereGeometry(1,10,10),e.material=new THREE.MeshBasicMaterial,e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Material",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={colorParam:n,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:4}},e.paramVals={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ci(e,t)}(t,At),t}();function ki(e){return(ki="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ei(e,t){return!t||"object"!==ki(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Oi(e){return(Oi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pi(e,t){return(Pi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _i=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Ei(this,Oi(t).call(this))).isLightNode=!0,e.el.classList.add("no-height"),e.light=new THREE.PointLight(16777215,1,100),e.light.position.set(0,0,0),e.geometry=new THREE.SphereGeometry(1,20,20),e.material=new THREE.MeshBasicMaterial,e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Material",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Material",paramHelpersType:"texture",needsFrameUpdate:!1},colorParam:n,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:4}},e.paramVals={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pi(e,t)}(t,At),t}();function xi(e){return(xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ri(e,t){return!t||"object"!==xi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Si(e,t,n){return(Si="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ti(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Ti(e){return(Ti=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ni(e,t){return(Ni=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Li=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Ri(this,Ti(t).call(this))).isGraphicsNode=!0,e.isBackgroundNode=!0,e.currentOutConnections=[],e.el.classList.add("no-height"),e.el.classList.add("texture-selector-node"),e.texture=(new THREE.TextureLoader).load("assets/test/Image1.png"),e.texture.magFilter=THREE.LinearFilter,e.texture.minFilter=THREE.LinearFilter;var n=[{rymden:[{title:"Jorden",name:"space/2k_earth_daymap.jpg"},{title:"Solen",name:"space/2k_sun.jpg"},{title:"Mars",name:"space/2k_mars.jpg"}]}];e.wrapper=document.createElement("div"),e.wrapper.className="wrapper";for(var i=0;i<n.length;i++){var o=n[i],a=function(t){var n=o[t],i=document.createElement("h4");i.innerHTML=t;var a=document.createElement("div");a.className="children-container",a.appendChild(i);for(var r=function(t){var i=document.createElement("div");i.className="child-wrapper";var o=document.createElement("h4");o.innerHTML=n[t].title,i.onclick=function(o){o.preventDefault(),o.stopPropagation(),e.onTextureSelected(n[t],i)},i.appendChild(o),a.appendChild(i)},s=0;s<n.length;s++)r(s);e.wrapper.appendChild(a)};for(var r in o)a(r)}return e.topPartEl.appendChild(e.wrapper),e.params={},e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ni(e,t)}(t,At),n=t,(i=[{key:"onTextureSelected",value:function(e,t){var n="assets/textures/".concat(e.name);this.texture=(new THREE.TextureLoader).load(n);for(var i=0;i<this.currentOutConnectionsLength;i++){var o=this.currentOutConnections[i].param;this.currentOutConnections[i].in.isCanvasNode?this.currentOutConnections[i].in.setBackgroundTexture(this.texture):o&&this.currentOutConnections[i].in.updateParam(o,this)}for(var a=this.wrapper.querySelectorAll(".child-wrapper"),r=0;r<a.length;r++)a[r].classList.remove("active");t.classList.add("active")}},{key:"enableOutput",value:function(e,n){Si(Ti(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var i=this.currentOutConnections.map(function(e){return e}),o=i.filter(function(e){return e.param}),a=i.filter(function(e){return!e.param});n?o=o.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=o.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&Si(Ti(t.prototype),"disableOutput",this).call(this)}}])&&Mi(n.prototype,i),o&&Mi(n,o),t}();function Ii(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Bi=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),B.a.Transport.bpm.value=140,B.a.Transport.start(),this.historyState={id:window.location.pathname},window.addEventListener("popstate",this.onPopStateChange.bind(this)),window.addEventListener("resize",function(){t.onResize()}),this.nodeTypes={audio:{audio:[{type:"Oscillator",obj:q},{type:"Gain",obj:Q},{type:"Filter",obj:ue},{type:"Speaker",obj:ne}],synthar:[{type:"Kick",obj:Ct},{type:"FM Synth",obj:Rt}],data:[{type:"LFO",obj:Ze},{type:"Envelope",obj:fe}],triggers:[{type:"SequencerNode",obj:rt}],"Ljud analys":[{type:"Ljudvåg",obj:dt}]},graphics:{Canvas:[{type:"Canvas",obj:ui}],"3D - Shapes":[{type:"Cube",obj:bn},{type:"Sphere",obj:_n}],"Procedural Texture (Material)":[{type:"Circle",obj:pn},{type:"Voronoi",obj:an},{type:"LavaNoise",obj:Zt}],Modifiers:[{type:"Color",obj:vi},{type:"ParamDriver",obj:Dn},{type:"OrbitDriver",obj:Gn}],Ljus:[{type:"Directional Light",obj:wi},{type:"Point Light",obj:_i}],Textures:[{type:"Texture Selector",obj:Li}]}},this.onNodeAddedFromLibraryBound=this.onNodeAddedFromLibrary.bind(this),this.nodeSettings=new Ve(document.body),this.workspaceManager=new Fe(document.body),this.onScaleChangeBound=this.onScaleChange.bind(this),this.globalAudioSettings=new Ge(this.workspaceManager.containerEl),this.onResize();new Le(document.body,this.nodeTypes,this.onNodeAddedFromLibraryBound,this.workspaceManager),new ue,new ne,new q,new Q,new fe,new Ze;this.keyboardManager=new je,this.onNodeActiveBound=this.onNodeActive.bind(this),this.nodeManager=new Re(null,this.keyboardManager,this.onNodeActiveBound,this.workspaceManager.el)}var t,n,i;return t=e,(n=[{key:"onScaleChange",value:function(e){console.log(e)}},{key:"onNodeActive",value:function(e){this.nodeSettings.show(e)}},{key:"onNodeAddedFromLibrary",value:function(e,t,n){this.nodeManager.onNodeAddedFromLibrary(e,t,n)}},{key:"onPopStateChange",value:function(e){console.log("hash change: ",e)}},{key:"pushState",value:function(e,t){window.history.pushState({id:e},"",t)}},{key:"update",value:function(){this.nodeManager.update()}},{key:"render",value:function(){this.nodeManager.render()}},{key:"onResize",value:function(e,t){this.workspaceManager.onResize(e,t)}}])&&Ii(t.prototype,n),i&&Ii(t,i),e}();function Di(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,"default",function(){return ji});var ji=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),window.NS={},window.NS.transform=function(){var e=document.createElement("div");if(null==e.style.transform){var t=["Webkit","Moz","ms"];for(var n in t)if(void 0!==e.style[t[n]+"Transform"])return t[n]+"Transform"}return"transform"}(),window.NS.iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,this.main=new Bi,this.onResize(),window.addEventListener("resize",function(){t.onResize()}),this.reqFrame()}var t,n,i;return t=e,(n=[{key:"init",value:function(){console.log("test")}},{key:"reqFrame",value:function(){var e=this;this.main.update(),this.main.render(),requestAnimationFrame(function(){e.reqFrame()})}},{key:"onResize",value:function(){var e=window.innerWidth,t=window.innerHeight;this.main.onResize(e,t)}}])&&Di(t.prototype,n),i&&Di(t,i),e}()}}]);