(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{30:function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}n.r(t);var i=function(){function e(t,n,o,i,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isActive=!1,this.onClickCallback=n,this.parentEl=t,this.isParamOutput=o,this.el=document.createElement("div"),this.el.className="node-output node-component ".concat(i?"":"right-align"," ").concat(o?"param":"");var s=document.createElement("div");s.className="dot",this.el.appendChild(s);var u=document.createElement("p");u.className="label",u.innerHTML=o?"Data ut":r?"Grafik ut":"Ljud ut",this.el.appendChild(u),this.parentEl.appendChild(this.el),this.onClickBound=this.onClick.bind(this),a?this.el.style.display="none":(s.addEventListener("click",this.onClickBound),this.offsetLeft=void 0,this.offsetTop=void 0)}var t,n,i;return t=e,(n=[{key:"getOffsetLeft",value:function(){return this.offsetLeft||(this.offsetLeft=this.el.offsetLeft),this.offsetLeft}},{key:"getOffsetTop",value:function(){return this.offsetTop=this.el.offsetTop,this.offsetTop}},{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.el.classList.add("selected"),this.onClickCallback({x:e.x,y:e.y})}},{key:"enable",value:function(){this.isActive=!0,this.el.classList.add("active"),this.el.classList.remove("selected")}},{key:"disable",value:function(){this.isActive=!1,this.el.classList.remove("active")}}])&&o(t.prototype,n),i&&o(t,i),e}();function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(){function e(t,n,o,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isActive=!1,this.onClickCallback=n,this.parentEl=t,this.inputType=a,this.el=document.createElement("div"),this.el.className="node-input node-component";var r=document.createElement("div");r.className="dot",this.el.appendChild(r);var s=document.createElement("p");s.className="label",s.innerHTML=o?i||"Grafik in":"Ljud in",this.el.appendChild(s),this.parentEl.appendChild(this.el),this.onClickBound=this.onClick.bind(this),this.el.addEventListener("click",this.onClickBound),this.offsetLeft=void 0,this.offsetTop=void 0}var t,n,o;return t=e,(n=[{key:"getOffsetLeft",value:function(){return this.offsetLeft||(this.offsetLeft=this.el.offsetLeft),this.offsetLeft}},{key:"getOffsetTop",value:function(){return this.offsetTop||(this.offsetTop=this.el.offsetTop),this.offsetTop}},{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.onClickCallback()}},{key:"enable",value:function(){this.isActive=!0,this.el.classList.add("active"),this.deactivatePossible()}},{key:"disable",value:function(){this.isActive=!1,this.el.classList.remove("active")}},{key:"activatePossible",value:function(){this.el.classList.add("not-possible")}},{key:"deactivatePossible",value:function(){this.el.classList.remove("not-possible")}}])&&a(t.prototype,n),o&&a(t,o),e}();function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onClickCallback=n,this.parentEl=t,this.el=document.createElement("div"),this.el.className="node-remove";var o=document.createElement("h5");o.className="label",o.innerHTML="Remove",this.el.appendChild(o),this.parentEl.appendChild(this.el),this.onClickBound=this.onClick.bind(this),this.el.addEventListener("click",this.onClickBound)}var t,n,o;return t=e,(n=[{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.onClickCallback()}}])&&s(t.prototype,n),o&&s(t,o),e}();function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var c=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="node-param node-component collapsed-param";var i=document.createElement("div");i.className="dot",this.el.appendChild(i);var a=document.createElement("p");a.className="label",a.innerHTML="".concat(o," parametrar"),this.el.appendChild(a),t.insertBefore(this.el,n),this.offsetLeft=void 0,this.offsetTop=void 0}var t,n,o;return t=e,(n=[{key:"getOffsetLeft",value:function(){return this.offsetLeft||(this.offsetLeft=this.el.offsetLeft),this.offsetLeft}},{key:"getOffsetTop",value:function(){return this.offsetTop||(this.offsetTop=this.el.offsetTop),this.offsetTop}},{key:"enable",value:function(){this.el.classList.add("active")}},{key:"disable",value:function(){this.el.classList.remove("active")}}])&&l(t.prototype,n),o&&l(t,o),e}();function h(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hasOutput=!0,this.isGraphicsNode=!1,this.isLightNode=!1,this.hasGraphicsInput=!1,this.needsUpdate=!1,this.hasMultipleOutputs=!1,this.initAsNotCollapsed=!1,this.returnsSingleNumber=!1,this.outDotPos=void 0,this.inDotPos=void 0,this.isCollapsed=!1,this.nodeCollapsedParam=null}var t,n,o;return t=e,(n=[{key:"init",value:function(e,t,n,o,a,s,l,c){this.initNodeConfig=!!s,this.ID=this.initNodeConfig?s.id:"_"+Math.random().toString(36).substr(2,9),this.onConnectingCallback=n,this.onInputConnectionCallback=o,this.hasActiveInput=!1,this.type=a,this.onNodeActive=l,this.onNodeRemove=c,this.parentEl=t,this.lastDelta={x:0,y:0};var h=document.createElement("h4");h.innerHTML=this.type,h.className="node-type",this.el.appendChild(h),this.parentEl.appendChild(this.el),this.onOutputClickBound=this.onOutputClick.bind(this),this.onInputClickBound=this.onInputClick.bind(this),this.onRemoveClickBound=this.onRemoveClick.bind(this);var p=!this.isParam&&this.hasAudioInput||this.hasGraphicsInput;p&&!this.isCanvasNode&&(this.input=new r(this.bottomPartEl,this.onInputClickBound,this.isGraphicsNode)),this.hasOutput&&!this.hasMultipleOutputs&&(this.output=new i(this.bottomPartEl,this.onOutputClickBound,this.isParam,p,this.isSpeaker,this.isGraphicsNode)),this.moveCoords={start:{x:0,y:0},offset:{x:this.initNodeConfig?s.pos[0]:e.x,y:this.initNodeConfig?s.pos[1]:e.y}},this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0)");var d=document.createElement("div");d.className="node-top-options",this.el.appendChild(d),this.initAsNotCollapsed||(this.onToggleCollapseBound=this.onToggleCollapse.bind(this),this.toggleCollapseView=document.createElement("div"),this.toggleCollapseView.className="node-toggle-collapse",this.toggleCollapseLabel=document.createElement("h5"),this.toggleCollapseView.appendChild(this.toggleCollapseLabel),d.appendChild(this.toggleCollapseView),this.toggleCollapseView.addEventListener("click",this.onToggleCollapseBound),this.onToggleCollapse()),this.remove=new u(d,this.onRemoveClickBound),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this)}},{key:"postInit",value:function(){var e=Object.keys(this.inputParams);e.length>0&&(this.collapsedParam=new c(this.topPartEl,e[e.length-1].el,e.length))}},{key:"onToggleCollapse",value:function(){this.isCollapsed?(this.topPartEl.classList.remove("hide"),this.toggleCollapseLabel.innerHTML="Minimera",this.isCollapsed=!1,this.el.style.zIndex=1):(this.topPartEl.classList.add("hide"),this.toggleCollapseLabel.innerHTML="Expandera",this.isCollapsed=!0,this.el.style.zIndex="")}},{key:"getOutputPos",value:function(){return{x:this.output.el.offsetLeft,y:this.output.el.offsetTop}}},{key:"getOutDotPos",value:function(e){return this.inDotPos||(this.inDotPos=e.getBoundingClientRect()),this.inDotPos}},{key:"getInDotPos",value:function(e){return this.outDotPos||(this.outDotPos=e.getBoundingClientRect()),this.outDotPos}},{key:"onRemoveClick",value:function(){this.onNodeRemove(this)}},{key:"activateDrag",value:function(){this.el.addEventListener("mousedown",this.onMouseDownBound)}},{key:"getOutputEl",value:function(){return this.output}},{key:"getInputEl",value:function(){return this.input}},{key:"getConnectNode",value:function(){return this}},{key:"enableOutput",value:function(){this.output.enable()}},{key:"disableOutput",value:function(){this.output.disable()}},{key:"enableInput",value:function(e){this.input&&this.input.enable()}},{key:"disableInput",value:function(){this.input&&this.input.disable()}},{key:"setAsDisabled",value:function(){this.el.style.opacity=.1}},{key:"setAsEnabled",value:function(){this.el.style.opacity=1}},{key:"onOutputClick",value:function(e){this.onConnectingCallback(this,e)}},{key:"onInputClick",value:function(e){this.onInputConnectionCallback(this,"main",e)}},{key:"removeFromDom",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound),this.toggleCollapseView&&this.toggleCollapseView.removeEventListener("click",this.onToggleCollapseBound),this.parentEl.removeChild(this.el)}},{key:"onMouseDown",value:function(e){"INPUT"===e.target.nodeName||e.target.classList.contains("prevent-drag")||(e.stopPropagation(),e.preventDefault(),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,this.lastDelta.x=0,this.lastDelta.y=0,window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound))}},{key:"onMouseMove",value:function(e){var t=e.x-this.moveCoords.start.x,n=e.y-this.moveCoords.start.y;this.moveCoords.offset.x=t,this.moveCoords.offset.y=n,this.lastDelta.x=t,this.lastDelta.y=n,this.el.style[window.NS.transform]="translate3d(".concat(t,"px, ").concat(n,"px, 0)")}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}}])&&h(t.prototype,n),o&&h(t,o),e}();function d(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var f=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.el=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.el.classList.add("line-renderer"),t.appendChild(this.el),this.nodeManager=n,this.onMouseEnterRemoveCircleBound=this.onMouseEnterRemoveCircle.bind(this),this.onMouseLeaveRemoveCircleBound=this.onMouseLeaveRemoveCircle.bind(this),this.onRemoveClickBound=this.onRemoveClick.bind(this),this.currentMouseOverObj=void 0}var t,n,o;return t=e,(n=[{key:"addLine",value:function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","g"),n=document.createElementNS("http://www.w3.org/2000/svg","line"),o=document.createElementNS("http://www.w3.org/2000/svg","circle"),i=document.createElementNS("http://www.w3.org/2000/svg","text");return t.appendChild(n),t.appendChild(o),t.appendChild(i),t.setAttribute("id",e),n.setAttribute("x1","0"),n.setAttribute("y1","0"),n.setAttribute("x2","0"),n.setAttribute("y2","0"),n.setAttribute("stroke-width","2"),n.setAttribute("stroke","white"),n.setAttribute("stroke-linecap","round"),o.setAttribute("cx","0"),o.setAttribute("cy","0"),o.setAttribute("fill","black"),o.setAttribute("stroke","red"),o.setAttribute("stroke-width","2"),o.setAttribute("r","10"),o.addEventListener("mouseenter",this.onMouseEnterRemoveCircleBound),o.addEventListener("mouseleave",this.onMouseLeaveRemoveCircleBound),o.addEventListener("click",this.onRemoveClickBound),i.setAttribute("fill","white"),this.el.appendChild(t),{g:t,line:n,removeCircle:o,removeText:i}}},{key:"removeLine",value:function(e){var t=e.removeCircle;t.removeEventListener("mouseenter",this.onMouseEnterRemoveCircleBound),t.removeEventListener("mouseleave",this.onMouseLeaveRemoveCircleBound),t.removeEventListener("click",this.onRemoveClickBound),this.el.removeChild(e.g)}},{key:"onRemoveClick",value:function(e){var t=e.target.parentNode.getAttribute("id"),n=this.nodeManager._nodeConnections.find(function(e){return e.lineEl.g.getAttribute("id")===t});n&&this.nodeManager.removeConnection(n)}},{key:"onMouseEnterRemoveCircle",value:function(e){var t=e.target.parentNode.querySelector("text");t.textContent="Ta bort koppling",this.currentMouseOverObj=t}},{key:"onMouseLeaveRemoveCircle",value:function(e){this.currentMouseOverObj&&this.currentMouseOverObj.textContent&&(this.currentMouseOverObj.textContent=""),this.currentMouseOverObj=void 0}},{key:"update",value:function(){}},{key:"render",value:function(){for(var e=this.nodeManager._nodeConnections.length,t=0;t<e;t++){var n=this.nodeManager._nodeConnections[t].out,o=this.nodeManager._nodeConnections[t].in,i=this.nodeManager._nodeConnections[t].param,a=this.nodeManager._nodeConnections[t].inputType,r=this.nodeManager._nodeConnections[t].outputType,s=void 0;s=!!i?o.inputParams[i.title]:o.getInputEl(a);var u=n.getOutputEl(r),l=n.getOutDotPos(n.output?n.output.el:null,r),c=u.getOffsetLeft(),h=u.getOffsetTop(),p=n.moveCoords.offset.x+c+l.width-3,d=n.moveCoords.offset.y+h+7,f=s.getOffsetLeft(),m=s.getOffsetTop(),v=o.moveCoords.offset.x+f+4,y=o.moveCoords.offset.y+m+7,g=this.nodeManager._nodeConnections[t].lineEl.line;g.setAttribute("x1",p),g.setAttribute("y1",d),g.setAttribute("x2",v),g.setAttribute("y2",y);var b=this.nodeManager._nodeConnections[t].param?"yellow":"red";g.setAttribute("stroke",b);var C=this.nodeManager._nodeConnections[t].lineEl.removeCircle,w=(p+v)/2,k=(d+y)/2;C.setAttribute("cx",w),C.setAttribute("cy",k),C.setAttribute("stroke",b);var E=this.nodeManager._nodeConnections[t].lineEl.removeText;E.setAttribute("x",w-35),E.setAttribute("y",k-20)}}}])&&d(t.prototype,n),o&&d(t,o),e}(),m="\n    attribute float size;\n    varying vec3 vColor;\n    void main() {\n        vColor = color;\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        // gl_PointSize = size * ( 3.0 / -mvPosition.z );\n        gl_PointSize = size;\n        gl_Position = projectionMatrix * mvPosition;\n    }\n",v='\n    // uniform sampler2D texture;\n    varying vec3 vColor;\n    // struct PointLight {\n    //     vec3 color;\n    //     vec3 position; // light position, in camera coordinates\n    //     float distance; // used for attenuation purposes. Since\n    //                     // we\'re writing our own shader, it can\n    //                     // really be anything we want (as long\n    //                     // as we assign it to our light in its\n    //                     // "distance" field\n    // };\n    \n    // uniform PointLight pointLights[NUM_POINT_LIGHTS];\n    void main() {\n        gl_FragColor = vec4( vColor, 1.0 );\n        // gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );\n    }\n',y="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\tuniform float time;\n\tuniform vec2 resolution;\n\tvoid main()\t{\n\t\tgl_Position = vec4( position, 1.0 );\n\t}\n",g="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\tuniform float time;\n\tuniform vec2 resolution;\n\tuniform sampler2D u_texture0;\n    uniform sampler2D u_texture1;\n\tuniform vec2 u_res;\n\tuniform float u_connection0;\n    uniform float u_connection1;\n    uniform float u_finalConnection;\n    uniform float u_multiConnection;\n\tvoid main()\t{\n\t\tvec2 st = gl_FragCoord.xy/u_res.xy;\n\t\tvec4 bgColor = texture2D(u_texture0, st);\n        vec4 fgColor = texture2D(u_texture1, st);\n\t\tvec4 whiteColor = vec4(1., 1., 1., 1.);\n        vec4 transparentColor = vec4(1.0, 1.0, 1.0, 0.0);\n        vec4 finalFgColor = mix(transparentColor, fgColor, u_connection1);\n        vec4 finalBgColor = mix(transparentColor, bgColor, u_connection0);\n        \n        float ra = (finalFgColor.a) * finalFgColor.r + (1.0 - finalFgColor.a) * finalBgColor.r;\n        float ga = (finalFgColor.a) * finalFgColor.g + (1.0 - finalFgColor.a) * finalBgColor.g;\n        float ba = (finalFgColor.a) * finalFgColor.b + (1.0 - finalFgColor.a) * finalBgColor.b;\n\n        vec4 overlayColor = vec4(ra, ga, ba, 1.0);\n\n        vec4 finalColor = mix(fgColor + bgColor, overlayColor, u_multiConnection);\n\n        gl_FragColor = mix(whiteColor, finalColor, u_finalConnection);\n\t} \n\n",b="\nvoid main() {\n\tvec2 st = gl_FragCoord.xy/u_resolution.xy;\n    //st.x *= u_resolution.x/u_resolution.y;\n    vec3 color = vec3(1.);\n",C="\n\tgl_FragColor = vec4(color,1.0);\n}",w="\n\tvec2 center_st = vec2(0.5)-st;\n\tcolor *= (vec3(1.0) * shapeBorderCircle(center_st,0.6,0.06));\n",k="\n    \n    // float u_user_speed3 = 0.500;\n    // float u_user_pattern_scale = -0.294;\n    // float u_user_scale = 6.632;\n    // float u_user_rotation = 0.804;\n    // float u_user_speed2 = 0.028;\n    // float u_user_blur = 0.7;\n    // vec3 u_user_color1 = vec3(0.256,0.351,0.620);\n    // vec3 u_user_color2 = vec3(1.000,0.420,0.420);\n    \n    \n    // vec2 st = gl_FragCoord.xy/u_resolution.xy;\n    st.x *= u_resolution.x/u_resolution.y;\n    color = vec3(0.0);\n    vec2 pos = vec2(st*u_user_scale);\n\n    float DF = 0.0;\n\n    \n    // Add a random position\n    float a = 0.0;\n    vec2 vel = vec2(u_time*u_user_speed3);\n    DF += snoise(pos+vel)*u_user_pattern_scale+.25;\n\n    // Add a random position\n    a = snoise(pos*vec2(cos(u_time*.15),sin(u_time*u_user_rotation))*u_user_speed2)*3.405;\n    vel = vec2(cos(a),sin(a));\n    DF += snoise(pos+vel)*.25+.25;\n\n    color = vec3( smoothstep(u_user_blur,.75,fract(DF)) );\n    \n    color = mix(u_user_color1, u_user_color2, color);\n",E="\n    // vec2 st = gl_FragCoord.xy/u_resolution.xy;\n    st.x *= u_resolution.x/u_resolution.y;\n    color = vec3(.0);\n    \n    // Scale \n    st *= 5.;\n    \n    // Tile the space\n    vec2 i_st = floor(st);\n    vec2 f_st = fract(st);\n\n    float m_dist = 10.;  // minimun distance\n    vec2 m_point;        // minimum point\n    \n    for (int j=-1; j<=1; j++ ) {\n        for (int i=-1; i<=1; i++ ) {\n            vec2 neighbor = vec2(float(i),float(j));\n            vec2 point = random2(i_st + neighbor);\n            point = 0.5 + 0.5*sin(u_time + 6.2831*point);\n            vec2 diff = neighbor + point - f_st;\n            float dist = length(diff);\n\n            if( dist < m_dist ) {\n                m_dist = dist;\n                m_point = point;\n            }\n        }\n    }\n\n    // Assign a color using the closest point position\n    color += dot(m_point,vec2(0.30,0.60));\n    \n    // Add distance field to closest point center \n    color.g = m_dist;\n\n    // Show isolines\n    //color -= abs(sin(40.0*m_dist*(u_mouse.x/u_resolution.x)))*0.07;\n    \n    color = mix(u_user_fgColor, u_user_bgColor, m_dist);\n    //color *= vec3(.2, .6, .8);\n",O="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform vec2 u_resolution;\nuniform vec2 u_mouse;\nuniform float u_time;\n\n//CIRCLE\nuniform float u_noise_amount;\n\n//LAVA\nuniform float u_user_speed3;\nuniform float u_user_pattern_scale;\nuniform float u_user_scale;\nuniform float u_user_rotation;\nuniform float u_user_speed2;\nuniform float u_user_blur;\nuniform vec3 u_user_color1;\nuniform vec3 u_user_color2;\n\n//VORONOI\nuniform vec3 u_user_fgColor;\nuniform vec3 u_user_bgColor;\n\n// YUV to RGB matrix\nmat3 yuv2rgb = mat3(1.0, 0.0, 1.13983,\n                    1.0, -0.39465, -0.58060,\n                    1.0, 2.03211, 0.0);\n\nvec2 random2(vec2 st){\n    st = vec2( dot(st,vec2(127.1,311.7)),\n              dot(st,vec2(269.5,183.3)) );\n    return -1.0 + 2.0*fract(sin(st)*43758.5453123);\n}\n\n// Value Noise by Inigo Quilez - iq/2013\n// https://www.shadertoy.com/view/lsf3WH\nfloat noise(vec2 st) {\n    vec2 i = floor(st);\n    vec2 f = fract(st);\n\n    vec2 u = f*f*(3.0-2.0*f);\n\n    return mix( mix( dot( random2(i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),\n                     dot( random2(i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),\n                mix( dot( random2(i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),\n                     dot( random2(i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x), u.y);\n}\n\nmat2 rotate2d(float _angle){\n    return mat2(cos(_angle),-sin(_angle),\n                sin(_angle),cos(_angle));\n}\n\nfloat shapeCircle(vec2 st, float radius) {\n\t//st = vec2(0.5)-st;\n    float r = length(st)*2.0;\n    float a = atan(st.y,st.x);\n    float m = abs(mod(a+u_time*2.080,3.14*2.0)-3.14)/3.688;\n    float f = radius;\n    float mod1 = radius;\n    m += noise(st+u_time*0.1)*.5;\n    mod1 = sin(a*50.000)*noise(st+u_time*0.536)*0.156;\n    mod1 += (sin(a*20.000)*0.116*pow(m,1.576));\n    f += mod1 * u_noise_amount;\n    return 1.-smoothstep(f,f+0.007,r);\n}\n\nfloat shapeBorderCircle(vec2 st, float radius, float width) {\n    return shapeCircle(st,radius) - shapeCircle(st,radius-width);\n}\n\nvec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }\n\nfloat snoise(vec2 v) {\n    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                        -0.577350269189626,  // -1.0 + 2.0 * C.x\n                        0.024390243902439); // 1.0 / 41.0\n    vec2 i  = floor(v + dot(v, C.yy) );\n    vec2 x0 = v -   i + dot(i, C.xx);\n    vec2 i1;\n    i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n    vec4 x12 = x0.xyxy + C.xxzz;\n    x12.xy -= i1;\n    i = mod289(i); // Avoid truncation effects in permutation\n    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n        + i.x + vec3(0.0, i1.x, 1.0 ));\n\n    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n    m = m*m ;\n    m = m*m ;\n    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n    vec3 h = abs(x) - 0.5;\n    vec3 ox = floor(x + 0.5);\n    vec3 a0 = x - ox;\n    m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n    vec3 g;\n    g.x  = a0.x  * x0.x  + h.x  * x0.y;\n    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n    return 130.0 * dot(m, g);\n}\n";var P=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=new THREE.WebGLRenderer({alpha:!0})};function x(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var _=function(){function e(t,n,o,i,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onConnectingCallback=n,this.onInputConnectionCallback=o,this.addCallback=i,this.onNodeActive=a,this.removeCallback=r,this.mainRenderer=new P}var t,n,o;return t=e,(n=[{key:"createNode",value:function(e,t){var n=new e.obj(this.mainRenderer);n.init(t,this.parentEl,this.onConnectingCallback,this.onInputConnectionCallback,e.type,void 0,void 0,this.removeCallback),n.onResize({w:540,h:538}),this.addCallback(n)}}])&&x(t.prototype,n),o&&x(t,o),e}();function M(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var T=function(){function e(t,n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="node-param node-component",this.param=n;var a=document.createElement("div");a.className="dot",this.el.appendChild(a);var r=document.createElement("p");r.className="label",r.innerHTML=n.param,this.el.appendChild(r),t.appendChild(this.el),this.el.addEventListener("click",function(e){console.log("param click"),e.preventDefault(),e.stopPropagation(),o(n)}),this.offsetLeft=void 0,this.offsetTop=void 0}var t,n,o;return t=e,(n=[{key:"getOffsetLeft",value:function(){return this.offsetLeft||(this.offsetLeft=this.el.offsetLeft),this.offsetLeft}},{key:"getOffsetTop",value:function(){return this.offsetTop=this.el.offsetTop,this.offsetTop}},{key:"enable",value:function(){this.el.classList.add("active")}},{key:"disable",value:function(){this.el.classList.remove("active")}},{key:"activatePossible",value:function(){this.el.classList.add("not-possible")}},{key:"deactivatePossible",value:function(){this.el.classList.remove("not-possible")}}])&&M(t.prototype,n),o&&M(t,o),e}(),R={single:{isValid:function(e,t,n,o){var i=!0;return o.some(function(e){return e.in.ID===t.ID&&!e.param})&&(i=!1),i}},multiple:{isValid:function(e,t,n,o,i){if(e.outputs&&e.outputs[i]&&e.outputs[i].isParamOutput&&!t.isParam)return!1;return!0}},oscillatorTrigger:{isValid:function(e,t,n,o){var i=!0;return o.some(function(n){return n.out.ID===e.ID&&n.in.ID===t.ID})&&(i=!1),e.isSequencer||(i=!1),i}},gain:{isValid:function(e,t,n,o){var i=!0;return o.some(function(n){return n.in.ID===t.ID&&n.out.ID===e.ID})&&(i=!1),e.isEnvelope||(i=!1),i}},frequency:{isValid:function(e,t,n,o){var i=!0;return o.some(function(n){return n.in.ID===t.ID&&n.out.ID===e.ID})&&(i=!1),e.isEnvelope||e.isLFO||(i=!1),i}}};function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function N(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function I(e,t,n){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=D(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var A=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=N(this,D(t).call(this))).audioNode=null,e.isParam=!1,e.isKeyboardListener=!1,e.isOscillator=!1,e.isEnvelope=!1,e.isSpeaker=!1,e.isSignalMath=!1,e.hasAudioInput=!0,e.isSequencer=!1,e.isLFO=!1,e.isAnalyser=!1,e.isSynthOscillator=!1,e.inputHelpersType=R.single,e.params={},e.canBeConnected=!1,e.el=document.createElement("div"),e.el.className="node",e.topPartEl=document.createElement("div"),e.topPartEl.className="top-part",e.el.appendChild(e.topPartEl),e.bottomPartEl=document.createElement("div"),e.bottomPartEl.className="bottom-part",e.el.appendChild(e.bottomPartEl),e.inputParams={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}(t,p),n=t,(o=[{key:"init",value:function(e,n,o,i,a,r,s,u,l){for(var c in I(D(t.prototype),"init",this).call(this,e,n,o,i,a,r,s,l),this.onParameterChange=u,this.connectedInputs=[],this.connectedOutputs=[],this.params)if(this.params[c].useAsInput){var h=new T(this.topPartEl,this.params[c],this.onInputClickBound);this.inputParams[this.params[c].title]=h}this.isSequencer&&(this.el.classList.add("sequencer"),this.createUI(),this.setup()),this.activateDrag(),this.postInit()}},{key:"enableParam",value:function(e){var t=this.inputParams[e.title];e.isConnected=!0,t.enable(),e.slider&&e.disableSliderOnConnection&&e.slider.disableSlider()}},{key:"disableParam",value:function(e){var t=this.inputParams[e.title];e.isConnected=!1,t.disable(),e.slider&&e.slider.enableSlider()}},{key:"onParameterUpdate",value:function(){var e=this.getParams();this.onParameterChange(this,e)}},{key:"getParams",value:function(){var e={};for(var t in this.params){var n=this.params[t];e[n.param]=this.params[n.param].value}return e}},{key:"enableOutput",value:function(e,n){I(D(t.prototype),"enableOutput",this).call(this),this.connectedOutputs.push(n.in.ID)}},{key:"disableOutput",value:function(e,n){var o=this.connectedOutputs.filter(function(t){return t!==e.ID});this.connectedOutputs=o,0===this.connectedOutputs.length&&I(D(t.prototype),"disableOutput",this).call(this)}},{key:"enableInput",value:function(e){I(D(t.prototype),"enableInput",this).call(this),this.connectedInputs.push("".concat(e.ID,"-").concat(this.ID))}},{key:"disableInput",value:function(e){var n="".concat(e.ID,"-").concat(this.ID),o=this.connectedInputs.filter(function(e){return e!==n});this.connectedInputs=o,0===this.connectedInputs.length&&I(D(t.prototype),"disableInput",this).call(this)}}])&&L(n.prototype,o),i&&L(n,i),t}(),j=n(6),V=n.n(j);function H(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var F=function(){function e(t,n,o,i,a,r,s,u){var l=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=a,this.parameter=r,this.decimals=s,this.disable=u,this.value=(o-i.min)/(i.max-i.min),this.settings=i,this.el=document.createElement("div"),this.el.className="node-control node-range";var c=document.createElement("h5");c.innerHTML=n,c.className="node-range-title",this.el.appendChild(c),this.sliderBg=document.createElement("div"),this.sliderBg.className="node-range-slider-bg",this.knobEl=document.createElement("div"),this.knobEl.className="node-range-knob",this.sliderBg.appendChild(this.knobEl),this.el.appendChild(this.sliderBg),this.valueEl=document.createElement("p"),this.valueEl.className="node-range-value",this.valueEl.innerHTML=o,this.el.appendChild(this.valueEl),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),setTimeout(function(){l.setPos(l.sliderBg.clientHeight)},0),this.sliderBg.addEventListener("mousedown",this.onMouseDownBound)}var t,n,o;return t=e,(n=[{key:"disableSlider",value:function(){this.disable=!0,this.el.style.opacity=.1}},{key:"enableSlider",value:function(){this.disable=!1,this.el.style.opacity=1}},{key:"remove",value:function(){this.sliderBg.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"getValue",value:function(){return this.value*(this.settings.max-this.settings.min)+this.settings.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onMouseDown",value:function(e){if(!this.disable){e.preventDefault(),e.stopPropagation();var t=this.sliderBg.getBoundingClientRect(),n=this.sliderBg.clientHeight,o=1-Math.round(100*(e.y-t.top))/100/n;this.value=o>1?1:o<0?0:o,this.setPos(n),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)),this.parameter),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}}},{key:"onMouseMove",value:function(e){var t=this.sliderBg.getBoundingClientRect(),n=this.sliderBg.clientHeight,o=1-Math.round(100*(e.y-t.top))/100/n;this.value=o>1?1:o<0?0:o,this.setPos(n),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)),this.parameter),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){this.value;var t=this.value*e;this.knobEl.style.height="".concat(t,"px")}}])&&H(t.prototype,n),o&&H(t,o),e}();function U(e){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function G(e,t,n){return(G="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Y(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var X=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=Y(t).call(this))||"object"!==U(o)&&"function"!=typeof o?q(n):o).el.classList.add("no-height"),e.hasConnectedTrigger=!1,e.connectedTriggerID=-1,t.BASE_FREQ=440,t.ROOT=Math.pow(2,1/12),e.isKeyboardListener=!0,e.isOscillator=!0,e.hasAudioInput=!1,e.hasEnvelopeConnection=!1;var i=document.createElement("div");i.className="range-container",e.topPartEl.appendChild(i),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(q(e));var a={parentEl:i,title:"Oktav",initValue:0,settings:{min:-3,max:3},valChangeCallback:e.onRangeChangeCallbackBound,param:"octave",decimals:0,disable:!1};e.octaveRangeSlider=new F(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={useAsInput:!1,value:a.initValue,param:"octave",slider:e.octaveRangeSlider,title:"Octave"},s={useAsInput:!0,param:"trigger",title:"Trigger",helper:R.oscillatorTrigger};return e.params[r.param]=r,e.params[s.param]=s,e.paramVals={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}(t,A),n=t,(o=[{key:"enableParam",value:function(e,n){G(Y(t.prototype),"enableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!0,this.connectedTriggerID=n.out.ID)}},{key:"disableParam",value:function(e){G(Y(t.prototype),"disableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!1,this.connectedTriggerID=-1)}},{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getParams",value:function(e){e||(e=0);var t={};return t.frequency=this.getFrequency(e),t.type="sawtooth",t}},{key:"getAudioNode",value:function(){var e=new V.a.Oscillator;return e.type="sawtooth",e}},{key:"getFrequency",value:function(e){var n=12*parseInt(this.params.octave.value)+e;return t.BASE_FREQ*Math.pow(t.ROOT,n)}},{key:"onParameterChange",value:function(e,t){}}])&&z(n.prototype,o),i&&z(n,i),t}();function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Z(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function J(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $(e,t){return($=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ee=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=Q(t).call(this))||"object"!==W(o)&&"function"!=typeof o?J(n):o).inputHelpersType=R.multiple,e.el.classList.add("no-height"),e.audioNode=V.a.context.createGain();var i=document.createElement("div");i.className="range-container",e.topPartEl.appendChild(i),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(J(e));var a={parentEl:i,title:"Vol",initValue:.5,settings:{min:0,max:1},valChangeCallback:e.onRangeChangeCallbackBound,param:"gain",decimals:2,disable:!1};e.gainRangeSlider=new F(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={useAsInput:!0,value:a.initValue,param:"gain",slider:e.gainRangeSlider,title:"Gain",helper:R.gain,disableSliderOnConnection:!0};return e.paramVals={},e.params[r.param]=r,e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$(e,t)}(t,A),n=t,(o=[{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getAudioNode",value:function(){return V.a.context.createGain()}}])&&Z(n.prototype,o),i&&Z(n,i),t}();function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function oe(e,t){return!t||"object"!==te(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ie(e){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var re=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=oe(this,ie(t).call(this))).inputHelpersType=R.multiple,e.audioNode=V.a.context.destination,e.isSpeaker=!0,e.initAsNotCollapsed=!0,e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(t,A),n=t,(o=[{key:"getAudioNode",value:function(){var e=new V.a.Limiter;return e.connect(V.a.context.destination),e}}])&&ne(n.prototype,o),i&&ne(n,i),t}();function se(e){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ue(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function le(e){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ce(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function he(e,t){return(he=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pe=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=le(t).call(this))||"object"!==se(o)&&"function"!=typeof o?ce(n):o).audioNode=new V.a.Filter,e.el.classList.add("no-height");var i=document.createElement("div");i.className="range-container",e.topPartEl.appendChild(i),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(ce(e));var a={parentEl:i,title:"Frekvens",initValue:350,settings:{min:0,max:22e3},valChangeCallback:e.onRangeChangeCallbackBound,param:"frequency",decimals:0,disable:!1};e.freqRangeSlider=new F(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={parentEl:i,title:"Q",initValue:1,settings:{min:0,max:10},valChangeCallback:e.onRangeChangeCallbackBound,param:"Q",decimals:0,disable:!1};e.qRangeSlider=new F(r.parentEl,r.title,r.initValue,r.settings,r.valChangeCallback,r.param,r.decimals,r.disable);var s={useAsInput:!0,value:a.initValue,param:"frequency",slider:e.freqRangeSlider,title:"Filter Frequency",helper:R.frequency,disableSliderOnConnection:!1},u={useAsInput:!1,value:r.initValue,param:"Q",slider:e.qRangeSlider,title:"Q"};return e.paramVals={},e.params[s.param]=s,e.params[u.param]=u,e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&he(e,t)}(t,A),n=t,(o=[{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getAudioNode",value:function(){var e=new V.a.Filter;for(var t in this.params)e[t].value=this.params[t].value;return e}}])&&ue(n.prototype,o),i&&ue(n,i),t}();function de(e){return(de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function me(e){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ve(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ye(e,t){return(ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ge=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=me(t).call(this))||"object"!==de(o)&&"function"!=typeof o?ve(n):o).el.classList.add("no-height"),e.isParam=!0,e.isKeyboardListener=!0,e.isEnvelope=!0,e.audioNode=new V.a.Envelope;var i=document.createElement("div");i.className="range-container",e.topPartEl.appendChild(i),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(ve(e));var a={parentEl:i,title:"A",initValue:.25,settings:{min:.01,max:2},valChangeCallback:e.onRangeChangeCallbackBound,param:"attack",decimals:2,disable:!1};e.attackRangeSlider=new F(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={parentEl:i,title:"D",initValue:.77,settings:{min:.01,max:2},valChangeCallback:e.onRangeChangeCallbackBound,param:"decay",decimals:2,disable:!1};e.decayRangeSlider=new F(r.parentEl,r.title,r.initValue,r.settings,r.valChangeCallback,r.param,r.decimals,r.disable);var s={parentEl:i,title:"S",initValue:.11,settings:{min:.01,max:1},valChangeCallback:e.onRangeChangeCallbackBound,param:"sustain",decimals:2,disable:!1};e.sustainRangeSlider=new F(s.parentEl,s.title,s.initValue,s.settings,s.valChangeCallback,s.param,s.decimals,s.disable);var u={parentEl:i,title:"R",initValue:.11,settings:{min:.01,max:2},valChangeCallback:e.onRangeChangeCallbackBound,param:"release",decimals:2,disable:!1};e.releaseRangeSlider=new F(u.parentEl,u.title,u.initValue,u.settings,u.valChangeCallback,u.param,u.decimals,u.disable);var l={useAsInput:!1,value:a.initValue,param:"attack",slider:e.attackRangeSlider,title:"Attack"},c={useAsInput:!1,value:r.initValue,param:"decay",slider:e.decayRangeSlider,title:"Decay"},h={useAsInput:!1,value:s.initValue,param:"sustain",slider:e.sustainRangeSlider,title:"Sustain"},p={useAsInput:!1,value:u.initValue,param:"release",slider:e.releaseRangeSlider,title:"Release"},d={};return d[l.param]=l,d[c.param]=c,d[h.param]=h,d[p.param]=p,e.paramDefaults={ADSR:d},e.params=Object.assign({},e.paramDefaults.ADSR),e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}(t,A),n=t,(o=[{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getAudioNode",value:function(e){var t=new(0,V.a.Envelope);for(var n in this.params)t[n]=this.params[n].value;return t}}])&&fe(n.prototype,o),i&&fe(n,i),t}();function be(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ce=function(){function e(t,n,o,i,a,r,s,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onConnectingCallback=n,this.onInputConnectionCallback=o,this.addCallback=i,this.initData=a,this.onParameterChange=r,this.onNodeActive=s,this.onNodeRemove=u}var t,n,o;return t=e,(n=[{key:"init",value:function(){if(this.initData)for(var e=0;e<this.initData.length;e++)this.initData[e].node.init(this.parentEl,this.onConnectingCallback,this.onInputConnectionCallback,this.initData[e].type,this.initData[e],this.onNodeActive,this.onParameterChange,this.onNodeRemove),this.addCallback(this.initData[e].node)}},{key:"createNode",value:function(e,t){var n=new e.obj;n.init(t,this.parentEl,this.onConnectingCallback,this.onInputConnectionCallback,e.type,void 0,this.onNodeActive,this.onParameterChange,this.onNodeRemove),this.addCallback(n)}}])&&be(t.prototype,n),o&&be(t,o),e}();function we(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ke=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ID=999999999,this.resetConnecting=n,this.startPos={x:0,y:0},this.endPos={x:0,y:0},this.line=document.createElementNS("http://www.w3.org/2000/svg","line"),this.line.setAttribute("id",this.ID),this.line.setAttribute("x1",this.startPos.x),this.line.setAttribute("y1",this.startPos.y),this.line.setAttribute("x2",this.endPos.x),this.line.setAttribute("y2",this.endPos.y),this.line.setAttribute("stroke-width","2"),this.line.setAttribute("stroke","white"),this.line.setAttribute("stroke-linecap","round"),t.appendChild(this.line),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseClickBound=this.onMouseClick.bind(this)}var t,n,o;return t=e,(n=[{key:"onConnectionActive",value:function(e,t,n){var o=e.getOutDotPos(e.output?e.output.el:null,n),i=e.getOutputPos(n),a=e.moveCoords.offset.x+i.x+o.width,r=e.moveCoords.offset.y+i.y+7;this.startPos.x=t.x,this.startPos.y=t.y;var s=this.line,u=e.isParam?"yellow":"red";e.outputs&&e.outputs[n]&&(e.outputs[n].isParamOutput&&(u="yellow"));s.setAttribute("x1",a),s.setAttribute("y1",r),s.setAttribute("x2",a),s.setAttribute("y2",r),s.setAttribute("stroke",u),s.setAttribute("stroke-opacity",.6),window.addEventListener("mousemove",this.onMouseMoveBound),window.addEventListener("click",this.onMouseClickBound)}},{key:"onInputClick",value:function(e,t,n){window.removeEventListener("mousemove",this.onMouseMoveBound),window.removeEventListener("click",this.onMouseClickBound);var o=this.line,i=t.moveCoords.offset.x+200,a=t.moveCoords.offset.y+50,r=n.moveCoords.offset.x+200,s=n.moveCoords.offset.y+50,u=e?i:r,l=e?a:s;o.setAttribute("stroke","white"),o.setAttribute("stroke-opacity",0),o.setAttribute("x1",u),o.setAttribute("y1",l),o.setAttribute("x2",u),o.setAttribute("y2",l)}},{key:"onMouseMove",value:function(e){var t=this.line,n=parseFloat(t.getAttribute("x1")),o=parseFloat(t.getAttribute("y1")),i=n+(e.x-this.startPos.x),a=o+(e.y-this.startPos.y);this.endPos.x=i,this.endPos.y=a,t.setAttribute("x2",i),t.setAttribute("y2",a)}},{key:"onMouseClick",value:function(e){window.removeEventListener("mousemove",this.onMouseMoveBound),window.removeEventListener("click",this.onMouseClickBound),this.resetConnecting();var t=this.line;t.setAttribute("stroke","white"),t.setAttribute("x1",0),t.setAttribute("y1",0),t.setAttribute("x2",0),t.setAttribute("y2",0),t.setAttribute("stroke-opacity",0),console.log("click connection")}},{key:"resetLine",value:function(){window.removeEventListener("mousemove",this.onMouseMoveBound),window.removeEventListener("click",this.onMouseClickBound);var e=this.line;e.setAttribute("stroke","white"),e.setAttribute("x1",0),e.setAttribute("y1",0),e.setAttribute("x2",0),e.setAttribute("y2",0),e.setAttribute("stroke-opacity",0),console.log("reset connection")}}])&&we(t.prototype,n),o&&we(t,o),e}(),Ee=function(e){return e.framebuffer||e.texture},Oe=function(e){return!!e.picker},Pe=function(e,t,n){return!(e.framebuffer||e.texture||e.picker||e.isSequencer)&&(!!n&&(!!n.minMax&&(e.isParam&&!n.isConnected||e.isAnalyser&&!n.isConnected)))},xe=function(e,t,n){e.mesh.position[t.param]=t.defaultVal},_e=function(){},Me={particleColor:{update:function(e,t){e.currentParticleColor=t.currentColor.toArray()},isValid:Oe,disconnect:function(e,t){e.currentParticleColor=t.defaultVal.toArray()}},particleSize:{update:function(e,t){e.currentParticleSize=t.getValue()},isValid:function(e,t,n){return!!n&&!!n.minMax&&(e.returnsSingleNumber&&!n.isConnected||e.isAnalyser&&!n.isConnected)},disconnect:function(e,t){e.currentParticleSize=t.defaultVal}},particleForm:{update:_e,isValid:function(e){return!!e.curve},disconnect:_e},particle:{update:_e,isValid:Pe,disconnect:_e},target:{update:function(e,t){e.targetPosition=t.mesh.position},isValid:function(e){return!!e.mesh},disconnect:function(e,t,n){t.defaultVal=n.mesh.position}},texture:{update:function(e,t){e.material.needsUpdate=!0,e.material.map=t.framebuffer?t.framebuffer.texture:t.texture},isValid:Ee,disconnect:function(e){e.material.needsUpdate=!0,e.material.map=null}},normalMap:{update:function(e,t){e.material.normalMap=t.framebuffer.texture,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0},isValid:Ee,disconnect:function(e){e.material.normalMap=null,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0}},bumpMap:{update:function(e,t){e.material.displacementMap=t.framebuffer.texture,e.material.displacementScale=.1,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0},isValid:Ee,disconnect:function(e){e.material.displacementMap=null,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0}},color:{update:function(e,t){e.material.color=t.currentColor},isValid:Oe,disconnect:xe},position:{update:function(e,t,n){e.mesh.position[n.param]=t.getValue(n)},isValid:Pe,disconnect:xe},rotation:{update:function(e,t,n){e.mesh.rotation[n.param]=t.getValue(n)},isValid:Pe,disconnect:xe},scale:{update:function(e,t,n){var o=t.getValue();e.mesh.scale.set(o,o,o)},isValid:Pe,disconnect:function(e,t,n){e.mesh.scale.set(1,1,1)}},shaderParam:{update:function(e,t,n){e.mesh.material.uniforms[n.param].value=t.getValue()},isValid:Pe,disconnect:xe},light:{update:function(e,t,n){var o=t.getValue(n);e.mesh.position[n.param]=o,e.light.position[n.param]=o},isValid:Pe,disconnect:xe}};function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Re=function(e,t,n){for(var o=function(o){if(function t(o){var i=e.filter(function(e){return e.in.ID===o.ID&&!e.param});return!!i.find(function(e){return e.out.isOscillator&&e.out.ID===n.ID})||i.length>0&&t(i[0].out)}(t[o].in))return{v:!0}},i=0;i<t.length;i++){var a=o(i);if("object"===Te(a))return a.v}return!1},Se={updateOscillators:function(e){for(var t=e.filter(function(e){return e.param&&"gain"===e.param.param&&e.out.isEnvelope}),n=e.filter(function(e){return e.out.isOscillator&&!e.param}),o=0;o<n.length;o++){var i=Re(e,t,n[o].out);n[o].out.hasEnvelopeConnection=i}}};function Le(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ne=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.collectedInputs=[]}var t,n,o;return t=e,(n=[{key:"showAvailable",value:function(e,t,n,o){var i=t.filter(function(t){return!t.isCollapsed&&e.ID!==t.ID});this.collapsedNodes=t.filter(function(t){return t.isCollapsed&&e.ID!==t.ID});for(var a=0;a<this.collapsedNodes.length;a++)this.collapsedNodes[a].setAsDisabled();this.collectedInputs=[];for(var r=0;r<i.length;r++){var s=i[r],u={node:s,inputs:[],params:[]};if(s.input)u.inputs.push(s.input);else if(s.inputs)for(var l in s.inputs)u.inputs.push(s.inputs[l]);for(var c in s.inputParams)u.params.push(s.inputParams[c]);this.collectedInputs.push(u)}for(var h=0;h<this.collectedInputs.length;h++){var p=this.collectedInputs[h].inputs,d=this.collectedInputs[h].params,f=this.collectedInputs[h].node;if(f.isGraphicsNode){for(var m=0;m<p.length;m++){var v=p[m];f.inputHelpersType.isValid(e,f,v.inputType,o)||v.activatePossible()}for(var y=0;y<d.length;y++){var g=d[y];Me[g.param.paramHelpersType].isValid(e,f,g.param)||g.activatePossible()}}else{for(var b=0;b<p.length;b++){var C=p[b];f.inputHelpersType.isValid(e,f,void 0,n,o)||C.activatePossible()}for(var w=0;w<d.length;w++){var k=d[w];k.param.helper.isValid(e,f,k.param,n)||k.activatePossible()}}}}},{key:"resetAvailable",value:function(){for(var e=0;e<this.collapsedNodes.length;e++)this.collapsedNodes[e].setAsEnabled();for(var t=0;t<this.collectedInputs.length;t++){for(var n=this.collectedInputs[t].inputs,o=this.collectedInputs[t].params,i=0;i<n.length;i++){n[i].deactivatePossible()}for(var a=0;a<o.length;a++){o[a].deactivatePossible()}}}}])&&Le(t.prototype,n),o&&Le(t,o),e}();function Ie(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var De=function(){function e(t,n,o,i){var a=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.hasConfig=!!t,this.onNodeActiveCallback=o,this.availableConnections=new Ne,this.constructorIsDone=!1,this.keyboardManager=n,this._nodes=[],this._nodeConnections=[],this._graphicNodes=[],this._graphicNodeLength=0,this.resetConnectingBound=this.resetConnecting.bind(this),this.nodeConnectionRenderer=new f(i,this),this.nodeConnectionLine=new ke(this.nodeConnectionRenderer.el,this.resetConnectingBound),this.isConnecting=!1,this.outputActiveNode=null,this.outputActiveType=void 0,this.onConnectingBound=this.onConnecting.bind(this),this.onInputConnectionBound=this.onInputConnection.bind(this),this.addBound=this.add.bind(this),this.removeBound=this.onNodeRemove.bind(this),this.onAudioNodeParamChangeBound=this.onAudioNodeParamChange.bind(this),this.audioNodeManager=new Ce(i,this.onConnectingBound,this.onInputConnectionBound,this.addBound,this.hasConfig?this.config.nodes:[],this.onAudioNodeParamChangeBound,o,this.removeBound),this.audioNodeManager.init(),this.graphicsNodeManager=new _(i,this.onConnectingBound,this.onInputConnectionBound,this.addBound,o,this.removeBound),this.hasConfig){for(var r=function(e){a.isConnecting=!0;var t=a._nodes.find(function(t){return t.ID===a.config.connections[e].out}),n=a._nodes.find(function(t){return t.ID===a.config.connections[e].in});a.outputActiveNode=t,a.onInputConnection(n)},s=0;s<this.config.connections.length;s++)r(s);this.outputActiveNode=null;var u=this.getAudioConnections(this._nodeConnections);this.keyboardManager.onAudioNodeConnectionUpdate(u);var l=u.filter(function(e){return e.out.isSequencer}),c=[];for(s=0;s<l.length;s++){var h=l[s].out.ID;c.indexOf(h)<0&&(l[s].out.sequencerManager.onAudioNodeConnectionUpdate(u),c.push(h))}c=[]}this.constructorIsDone=!0}var t,n,o;return t=e,(n=[{key:"onNodeAddedFromLibrary",value:function(e,t,n){if("graphics"===e){if(this._graphicNodes.some(function(e){return e.isCanvasNode})&&"Canvas"===t.type)return;this.graphicsNodeManager.createNode(t,n)}else this.audioNodeManager.createNode(t,n)}},{key:"onNodeRemove",value:function(e){for(var t=this._nodeConnections.filter(function(t){return t.out.ID===e.ID||t.in.ID===e.ID}),n=0;n<t.length;n++)this.removeConnection(t[n]);this.remove(e)}},{key:"onAudioNodeParamChange",value:function(e,t){this.keyboardManager.onAudioNodeParamChange(e,t)}},{key:"disconnectAnalyserNodes",value:function(e){for(var t=e.filter(function(e){return e.in.isAnalyser}),n=0;n<t.length;n++)t[n].in.dispose()}},{key:"getAudioConnections",value:function(e){return e.filter(function(e){return!e.out.isGraphicsNode&&!e.in.isGraphicsNode})}},{key:"resetConnecting",value:function(){this.isConnecting=!1,this.outputActiveNode=null,this.outputActiveType=void 0,this.nodeConnectionLine.resetLine(),this.availableConnections.resetAvailable()}},{key:"onConnecting",value:function(e,t,n){if(!this.isConnecting&&!this.outputActiveNode){this._nodeConnections.some(function(t){return t.out.ID===e.ID});this.isConnecting=!0,this.outputActiveNode=e,this.outputActiveType=n,this.nodeConnectionLine.onConnectionActive(e,t,n),this.availableConnections.showAvailable(e,this._nodes,this._nodeConnections,n)}}},{key:"onInputConnection",value:function(e,t,n){if(this.availableConnections.resetAvailable(),this.isConnecting&&this.outputActiveNode){if(e.isGraphicsNode){if(n&&!Me[n.paramHelpersType].isValid(this.outputActiveNode,e,n,this._nodeConnections))return void this.resetConnecting();if(!e.inputHelpersType.isValid(this.outputActiveNode,e,t,this.outputActiveType))return void this.resetConnecting()}else if(n&&n.helper){if(!n.helper.isValid(this.outputActiveNode,e,n,this._nodeConnections))return void this.resetConnecting()}else if(!e.inputHelpersType.isValid(this.outputActiveNode,e,void 0,this._nodeConnections,this.outputActiveType))return void this.resetConnecting();this.nodeConnectionLine.onInputClick(!0,e,this.outputActiveNode),this.isConnecting=!1;var o=n?"".concat(n.parent,"-").concat(n.param):"",i="".concat(e.ID,"---").concat(this.outputActiveNode.ID,"---").concat(o),a={param:n,out:this.outputActiveNode,in:e,lineEl:this.nodeConnectionRenderer.addLine(i),inputType:t,outputType:this.outputActiveType};if(this.outputActiveNode.enableOutput(n||void 0,a),n?e.enableParam(n,a):e.enableInput(this.outputActiveNode,t),this._nodeConnections.push(a),this.constructorIsDone){var r=this.getAudioConnections(this._nodeConnections);Se.updateOscillators(r),this.disconnectAnalyserNodes(r),this.keyboardManager.onAudioNodeConnectionUpdate(r);for(var s=r.filter(function(e){return e.out.isSequencer}),u=[],l=0;l<s.length;l++){var c=s[l].out.ID;u.indexOf(c)<0&&(s[l].out.sequencerManager.onAudioNodeConnectionUpdate(r),u.push(c))}u=[]}this.resetConnecting()}}},{key:"removeConnection",value:function(e){e.param?e.in.disableParam(e.param,e):e.in.disableInput(e.out,e.inputType),e.out.disableOutput(e.in,e.param,e.outputType);var t=this._nodeConnections.filter(function(t){return t.out.ID!==e.out.ID||t.in.ID!==e.in.ID});e.param&&(t=this._nodeConnections.filter(function(t){return!t.param||(t.param.title!==e.param.title||t.in.ID!==e.in.ID)})),this._nodeConnections=t;var n=this.getAudioConnections(this._nodeConnections);Se.updateOscillators(n),this.disconnectAnalyserNodes(n),this.keyboardManager.onAudioNodeConnectionUpdate(n);for(var o=n.filter(function(e){return e.out.isSequencer}),i=[],a=0;a<o.length;a++){var r=o[a].out.ID;i.indexOf(r)<0&&(o[a].out.sequencerManager.onAudioNodeConnectionUpdate(n),i.push(r))}i=[],this.nodeConnectionRenderer.removeLine(e.lineEl)}},{key:"onNodePlaced",value:function(e){console.log("node placed",e)}},{key:"add",value:function(e){if(this._nodes.push(e),(e.isRenderNode||e.isCanvasNode||e.needsUpdate)&&(this._graphicNodes.push(e),this._graphicNodeLength=this._graphicNodes.length),e.isSequencer){var t=this.getAudioConnections(this._nodeConnections);e.sequencerManager.init(t)}}},{key:"remove",value:function(e){if(e.isGraphicsNode||e.needsUpdate){var t=this._graphicNodes.filter(function(t){return t.ID!==e.ID});this._graphicNodes=t,this._graphicNodeLength=this._graphicNodes.length}e.removeFromDom();var n=this._nodes.filter(function(t){return t.ID!==e.ID});this._nodes=n}},{key:"update",value:function(){this.nodeConnectionRenderer.update();for(var e=0;e<this._graphicNodeLength;e++)this._graphicNodes[e].update()}},{key:"render",value:function(){this.nodeConnectionRenderer.render();for(var e=0;e<this._graphicNodeLength;e++)this._graphicNodes[e].render()}}])&&Ie(t.prototype,n),o&&Ie(t,o),e}();function Be(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ae=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.workspaceManager=t,this.parentEl=t.el,this.el=document.createElement("div"),this.el.style.width="200px",this.el.style.height="200px",this.el.style.position="absolute",this.el.style.top="0",this.el.style.left="0",this.el.style.background="rgba(50, 50, 50, .9)",this.el.style.borderRadius="4px",this.parentEl.appendChild(this.el),this.moveCoords={start:{x:0,y:0},offset:{x:n.x,y:n.y}},this.deltaX=0,this.deltaY=0,this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this)}var t,n,o;return t=e,(n=[{key:"getPos",value:function(){var e=Math.abs(this.workspaceManager.moveCoords.offset.x),t=Math.abs(this.workspaceManager.moveCoords.offset.y);return{x:this.moveCoords.offset.x+e,y:this.moveCoords.offset.y+t}}},{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this.deltaX=0,this.deltaY=0,this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y}},{key:"onMouseMove",value:function(e){var t=e.x,n=e.y,o=t-this.moveCoords.start.x,i=n-this.moveCoords.start.y;this.moveCoords.offset.x=o,this.moveCoords.offset.y=i;var a=Math.abs(this.workspaceManager.moveCoords.offset.x),r=Math.abs(this.workspaceManager.moveCoords.offset.y);this.el.style[window.NS.transform]="translate3d(".concat(o+a,"px, ").concat(i+r,"px, 0)"),this.deltaX=o,this.deltaY=i}},{key:"onMouseUp",value:function(e){this.parentEl.removeChild(this.el)}}])&&Be(t.prototype,n),o&&Be(t,o),e}();function je(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ve=function(){function e(t,n,o,i){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onNodeAddedCallback=o,this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.workspaceManager=i,this.nodeToPlaceData={type:void 0,data:void 0},this.el=document.createElement("div"),this.el.className="node-library";var r=document.createElement("div");r.className="inner-scroll",this.el.appendChild(r),this.parentEl.appendChild(this.el);var s=function(e){var t=document.createElement("div");t.className="level-0";var o=document.createElement("h4");o.className="level-title",o.innerHTML=e,t.appendChild(o);var i=function(i){var r=document.createElement("div");r.className="level-1",(o=document.createElement("h4")).className="level-title",o.innerHTML=i,r.appendChild(o),t.appendChild(r);var s=document.createElement("div");s.className="node-container",r.appendChild(s);for(var u=function(t){var o=document.createElement("div");o.className="library-node audio",o.setAttribute("data-type-0",e),o.setAttribute("data-type-1",i);var r=document.createElement("h4");r.className="node-type",r.innerHTML=n[e][i][t].type;var u=document.createElement("img");u.className="node-add",u.src="assets/add.svg",o.appendChild(r),o.appendChild(u),s.appendChild(o),o.addEventListener("mousedown",function(o){a.nodeToPlaceData.type=e,a.nodeToPlaceData.data=n[e][i][t],a.onMouseDown(o)})},l=0;l<n[e][i].length;l++)u(l)};for(var s in n[e])i(s);r.appendChild(t)};for(var u in n)s(u)}var t,n,o;return t=e,(n=[{key:"hide",value:function(){this.el.style.transform="translateX(100%)"}},{key:"show",value:function(){this.el.style.transform="translateX(0)"}},{key:"onMouseDown",value:function(e){this.el.style.opacity=.1,this.nodePlaceHelper=new Ae(this.workspaceManager,{x:e.clientX,y:e.clientY}),this.nodePlaceHelper.onMouseDown(e),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){this.nodePlaceHelper.onMouseMove(e)}},{key:"onMouseUp",value:function(){this.nodePlaceHelper.onMouseUp(),this.el.style.opacity=1,window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound);var e=this.nodePlaceHelper.getPos();Math.abs(this.nodePlaceHelper.deltaX)>4&&this.onNodeAddedCallback(this.nodeToPlaceData.type,this.nodeToPlaceData.data,e),this.nodeToPlaceData={type:void 0,data:void 0}}}])&&je(t.prototype,n),o&&je(t,o),e}();function He(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Fe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nodes={},this.step=t,this.currentConnections=[],this.oscillatorNodes=[],this.synthOscillatorNodes=[],this.triggerNodes=[]}var t,n,o;return t=e,(n=[{key:"reset",value:function(e){for(var t=0;t<this.currentConnections.length;t++){var n=this.currentConnections[t],o=this.nodes[n.out.ID]?this.nodes[n.out.ID].audioNode:void 0,i=this.nodes[n.in.ID]?this.nodes[n.in.ID].audioNode:void 0,a=this.nodes[n.in.ID]?this.nodes[n.in.ID].musicNode:void 0;if(o&&i)if(n.out.isParam);else{if(a&&a.isAnalyser)continue;i.disconnect()}}this.nodes={},this.oscillatorNodes=[],this.currentConnections=e,this.triggerNodes=[],this.synthOscillatorNodes=[]}},{key:"updateConnections",value:function(e){this.reset(e);for(var t=0;t<e.length;t++){var n=e[t];if(!n.out.isSequencer){if(!this.nodes[n.in.ID]){var o={audioNode:n.in.getAudioNode(),musicNode:n.in};this.nodes[n.in.ID]=o}if(!this.nodes[n.out.ID]){var i=n.out.getAudioNode(n.param?n.param.param:void 0),a={audioNode:i,musicNode:n.out};this.nodes[n.out.ID]=a,n.out.isEnvelope&&this.triggerNodes.push(i),(n.out.isOscillator||n.out.isLFO)&&this.oscillatorNodes.push(a),n.out.isSynthOscillator&&this.synthOscillatorNodes.push(a)}}}for(var r=0;r<e.length;r++){var s=e[r],u=this.nodes[s.out.ID]?this.nodes[s.out.ID].audioNode:void 0,l=this.nodes[s.in.ID]?this.nodes[s.in.ID].audioNode:void 0;this.nodes[s.out.ID]&&this.nodes[s.out.ID].musicNode,this.nodes[s.in.ID]&&this.nodes[s.in.ID].musicNode;if(!s.out.isSequencer||u)if(s.out.isParam){var c=s.param.param;u.connect(l[c])}else u.connect(l)}}},{key:"onParamChange",value:function(e){this.nodes[e.ID]&&(e.isOscillator?this._updateOscillatorParams(this.nodes[e.ID].audioNode,e):e.isSynthOscillator||this._updateParams(this.nodes[e.ID].audioNode,e))}},{key:"_updateSynthOscillatorParams",value:function(e,t){for(var n=0;n<t.synthParams.length;n++){var o=t.params[t.synthParams[n]];o.setParam?o.setParam(e,o.value):e[t.synthParams[n]].value=o.value}}},{key:"_updateOscillatorParams",value:function(e,t){e.frequency.value=t.getFrequency(this.step)}},{key:"_updateParams",value:function(e,t){var n=function(e,t){for(var n in e.params)if(e.params[n].param===t)return e.params[n].isConnected};for(var o in t.params)"gain"===o&&n(t,o)||("frequency"===o||"amplitude"===o||"Q"===o||"gain"===o||"threshold"===o||"ratio"===o?e[o].value=t.params[o].value:e[o]=t.params[o].value)}},{key:"play",value:function(e,t){var n=this.triggerNodes.length,o=this.oscillatorNodes.length,i=this.synthOscillatorNodes.length;for(var a in this.nodes){var r=this.nodes[a];r.musicNode.isOscillator?this._updateOscillatorParams(r.audioNode,r.musicNode):r.musicNode.isSynthOscillator?this._updateSynthOscillatorParams(r.audioNode,r.musicNode):this._updateParams(r.audioNode,r.musicNode)}for(var s=0;s<n;s++)this.triggerNodes[s].triggerAttackRelease(V.a.Time("8n"),e);for(var u=0;u<o;u++){var l=this.oscillatorNodes[u];l.musicNode.isOscillator&&l.musicNode.hasConnectedTrigger&&l.musicNode.connectedTriggerID===t?l.musicNode.hasEnvelopeConnection?l.audioNode.start(e).stop(e+V.a.Time(2)):l.audioNode.start(e).stop(e+V.a.Time("8n")):l.musicNode.isLFO&&(l.audioNode.phase=0,l.audioNode.start(e))}for(var c=0;c<i;c++){var h=this.synthOscillatorNodes[c];if(h.musicNode.connectedTriggerID===t){var p=h.musicNode.getFrequency(this.step);h.audioNode.triggerAttackRelease(p,"8n")}}}},{key:"keyDown",value:function(){var e=this.triggerNodes.length,t=this.oscillatorNodes.length,n=this.synthOscillatorNodes.length;for(var o in this.nodes){var i=this.nodes[o];i.musicNode.isOscillator?this._updateOscillatorParams(i.audioNode,i.musicNode):i.musicNode.isSynthOscillator?this._updateSynthOscillatorParams(i.audioNode,i.musicNode):this._updateParams(i.audioNode,i.musicNode)}for(var a=0;a<t;a++){var r=this.oscillatorNodes[a];r.musicNode.isOscillator?r.audioNode.start():r.musicNode.isLFO&&(r.audioNode.phase=0,r.audioNode.start())}for(var s=0;s<e;s++)this.triggerNodes[s].triggerAttack();for(var u=0;u<n;u++){var l=this.synthOscillatorNodes[u],c=l.musicNode.getFrequency(this.step);l.audioNode.triggerAttack(c)}}},{key:"keyUp",value:function(){for(var e=this.triggerNodes.length,t=this.oscillatorNodes.length,n=this.synthOscillatorNodes.length,o=0;o<t;o++){var i=this.oscillatorNodes[o];i.musicNode.isOscillator?i.musicNode.hasEnvelopeConnection||i.audioNode.stop():i.musicNode.isLFO}for(var a=0;a<e;a++)this.triggerNodes[a].triggerRelease();for(var r=0;r<n;r++){var s=this.synthOscillatorNodes[r];s.musicNode.getFrequency(this.step);s.audioNode.triggerRelease()}}}])&&He(t.prototype,n),o&&He(t,o),e}();function Ue(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ze=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),e.KEY_INTS=[65,83,68,70,71,72,74,75,76,186,222,219],this.keys=[];for(var t=0;t<e.KEY_INTS.length;t++){var n={keyNr:e.KEY_INTS[t],step:t,triggered:!1,synth:new Fe(t)};this.keys.push(n)}this.onKeyDownBound=this.onKeyDown.bind(this),this.onKeyUpBound=this.onKeyUp.bind(this),window.addEventListener("keydown",this.onKeyDownBound),window.addEventListener("keyup",this.onKeyUpBound)}var t,n,o;return t=e,(n=[{key:"onKeyDown",value:function(e){var t=e.keyCode,n=this.getKey(t);if(null!==n){if(e.preventDefault(),n.triggered)return;n.triggered=!0,n.synth.keyDown()}}},{key:"onKeyUp",value:function(e){var t=e.keyCode,n=this.getKey(t);if(null!==n){if(!n.triggered)return;n.triggered=!1,n.synth.keyUp()}}},{key:"enable",value:function(){window.addEventListener("keydown",this.onKeyDownBound),window.addEventListener("keyup",this.onKeyUpBound)}},{key:"disable",value:function(){window.removeEventListener("keydown",this.onKeyDownBound),window.removeEventListener("keyup",this.onKeyUpBound)}},{key:"play",value:function(e,t){this.keys[e].synth.play(t)}},{key:"onAudioNodeConnectionUpdate",value:function(e){for(var t=0;t<this.keys.length;t++)this.keys[t].synth.updateConnections(e)}},{key:"onAudioNodeParamChange",value:function(e,t){for(var n=0;n<this.keys.length;n++)this.keys[n].synth.onParamChange(e,t)}},{key:"getKey",value:function(e){for(var t=null,n=0;n<this.keys.length;n++)this.keys[n].keyNr!==e||(t=this.keys[n]);return t}}])&&Ue(t.prototype,n),o&&Ue(t,o),e}();function qe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ge=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=3e3,this.height=2e3,this.containerEl=document.createElement("div"),this.containerEl.className="workspace-container",t.appendChild(this.containerEl),this.el=document.createElement("div"),this.el.className="workspace",this.el.style.width=this.width+"px",this.el.style.height=this.height+"px",this.containerEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.currentScale=1,this.moveCoords={start:{x:0,y:0},offset:{x:-(this.width/2-window.innerWidth/2),y:-(this.height/2-window.innerHeight/2)}},this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0)"),this.el.addEventListener("mousedown",this.onMouseDownBound)}var t,n,o;return t=e,(n=[{key:"disable",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound)}},{key:"enable",value:function(){this.el.addEventListener("mousedown",this.onMouseDownBound)}},{key:"setScale",value:function(e){this.currentScale=e,this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0) scale(").concat(e,")")}},{key:"onMouseDown",value:function(e){"INPUT"===e.target.nodeName||e.target.classList.contains("prevent-drag")||(e.preventDefault(),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,window.addEventListener("mousemove",this.onMouseMoveBound),window.addEventListener("mouseup",this.onMouseUpBound))}},{key:"onMouseMove",value:function(e){e.preventDefault();var t=e.x-this.moveCoords.start.x,n=e.y-this.moveCoords.start.y;this.moveCoords.offset.x=t,this.moveCoords.offset.y=n,this.el.style[window.NS.transform]="translate3d(".concat(t,"px, ").concat(n,"px, 0) scale(").concat(this.currentScale,")")}},{key:"onMouseUp",value:function(e){window.removeEventListener("mousemove",this.onMouseMoveBound),window.removeEventListener("mouseup",this.onMouseUpBound)}},{key:"onResize",value:function(e,t){this.containerEl.style.width="".concat(e,"px"),this.containerEl.style.height="".concat(t,"px")}}])&&qe(t.prototype,n),o&&qe(t,o),e}();function Ye(e){return(Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ke(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Xe(e){return(Xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function We(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ze(e,t){return(Ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qe=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=Xe(t).call(this))||"object"!==Ye(o)&&"function"!=typeof o?We(n):o).isParam=!0,e.isLFO=!0,e.el.classList.add("no-height"),e.audioNode=new V.a.LFO;var i=document.createElement("div");i.className="range-container",e.topPartEl.appendChild(i),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(We(e));var a={parentEl:i,title:"Frekvens",initValue:6,settings:{min:.1,max:17},valChangeCallback:e.onRangeChangeCallbackBound,param:"frequency",decimals:2,disable:!1};e.freqRangeSlider=new F(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={useAsInput:!0,value:a.initValue,param:"frequency",slider:e.freqRangeSlider,title:"LFO Frequency",helper:R.frequency,disableSliderOnConnection:!1},s={parentEl:i,title:"Amplitud",initValue:.25,settings:{min:.1,max:.5},valChangeCallback:e.onRangeChangeCallbackBound,param:"amplitude",decimals:2,disable:!1};e.amplitudeRangeSlider=new F(s.parentEl,s.title,s.initValue,s.settings,s.valChangeCallback,s.param,s.decimals,s.disable);var u={useAsInput:!0,value:s.initValue,param:"amplitude",slider:e.amplitudeRangeSlider,title:"Amplitude",helper:R.frequency,disableSliderOnConnection:!1};return e.params[r.param]=r,e.params[u.param]=u,e.paramVals={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ze(e,t)}(t,A),n=t,(o=[{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getAudioNode",value:function(){var e=new V.a.LFO;return e.min=-22e3,e.max=22e3,e}}])&&Ke(n.prototype,o),i&&Ke(n,i),t}();function Je(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var $e=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.triggerID=o,this.cols=t,this.rows=n,this.synths=[],this.masterSynth=new Fe(0);for(var i=0;i<t;i++){for(var a=[],r=0;r<n;r++)a.push({synth:null,isActive:!1});this.synths.push(a)}}var t,n,o;return t=e,(n=[{key:"init",value:function(e){this.masterSynth.updateConnections(e)}},{key:"removeAllSynths",value:function(){for(var e=this.cols,t=this.rows,n=0;n<e;n++)for(var o=0;o<t;o++)this.synths[n][o].isActive&&(this.synths[n][o].synth.reset(),this.synths[n][o].isActive=!1)}},{key:"addSynth",value:function(e,t){var n=new Fe(t);n.updateConnections(this.masterSynth.currentConnections),this.synths[e][t].synth=n,this.synths[e][t].isActive=!0}},{key:"removeSynth",value:function(e,t){this.synths[e][t].isActive&&(this.synths[e][t].synth.reset(),this.synths[e][t].isActive=!1)}},{key:"play",value:function(e,t,n){this.synths[e][t].synth.play(n,this.triggerID)}},{key:"onAudioNodeConnectionUpdate",value:function(e){for(var t=this.cols,n=this.rows,o=0;o<t;o++)for(var i=0;i<n;i++)this.synths[o][i].isActive&&this.synths[o][i].synth.updateConnections(e);this.masterSynth.updateConnections(e)}},{key:"onAudioNodeParamChange",value:function(e,t){for(var n=this.cols,o=this.rows,i=0;i<n;i++)for(var a=0;a<o;a++)this.synths[i][a].isActive&&this.synths[i][a].synth.onParamChange(e,t);this.masterSynth.onParamChange(e,t)}}])&&Je(t.prototype,n),o&&Je(t,o),e}();function et(e){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function nt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ot(e,t,n){return(ot="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=it(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function it(e){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function at(e,t){return(at=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var rt=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,e=!(o=it(t).call(this))||"object"!==et(o)&&"function"!=typeof o?nt(n):o,t.ROWS=12,t.COLS=16,e.isSequencer=!0,e.loop=null,e.hasAudioInput=!1,e.isParam=!0,e.initAsNotCollapsed=!0,e.data=[];for(var i=t.ROWS,a=t.COLS,r=0;r<a;r++){for(var s=[],u=0;u<i;u++){var l={active:!1,el:null,parentEl:null,step:i-1-u};s.push(l)}e.data.push(s)}return e.outConnections=[],e.outConnectionsLength=0,e.isPlaying=!1,e.onBtnClickBound=e.onBtnClick.bind(nt(e)),e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&at(e,t)}(t,A),n=t,(o=[{key:"init",value:function(e,n,o,i,a,r,s,u,l){ot(it(t.prototype),"init",this).call(this,e,n,o,i,a,r,s,u,l),this.sequencerManager=new $e(t.COLS,t.ROWS,this.ID)}},{key:"removeFromDom",value:function(){this.sequencerManager.removeAllSynths(),ot(it(t.prototype),"removeFromDom",this).call(this)}},{key:"getKey",value:function(e,t){return"col".concat(e,"-row").concat(t)}},{key:"onRemoveClick",value:function(){this.loop.stop(),this.playEl.removeEventListener("click",this.onPlayClickBound),this.pauseEl.removeEventListener("click",this.onPauseClickBound),ot(it(t.prototype),"onRemoveClick",this).call(this)}},{key:"createUI",value:function(){var e=t.ROWS,n=t.COLS,o=document.createElement("div");o.className="sequencer-container";for(var i=0;i<n;i++){var a=document.createElement("div");a.className="sequencer-col",o.appendChild(a);for(var r=0;r<e;r++){var s=document.createElement("div");s.className="sequencer-btn",s.setAttribute("data-col",i),s.setAttribute("data-row",r),a.appendChild(s),s.addEventListener("click",this.onBtnClickBound),this.data[i][r].el=s,this.data[i][r].parentEl=a}}this.topPartEl.appendChild(o);var u=document.createElement("div");u.className="sequencer-controls";var l=document.createElement("div");l.className="inner-controls",this.playEl=document.createElement("h5"),this.playEl.innerHTML="Spela",this.pauseEl=document.createElement("h5"),this.pauseEl.innerHTML="Nollställ",this.onPlayClickBound=this.onPlayClick.bind(this),this.onPauseClickBound=this.onPauseClick.bind(this),this.playEl.addEventListener("click",this.onPlayClickBound),this.pauseEl.addEventListener("click",this.onPauseClickBound),l.appendChild(this.playEl),l.appendChild(this.pauseEl),u.appendChild(l),this.topPartEl.appendChild(u)}},{key:"onPlayClick",value:function(){this.isPlaying||(this.isPlaying=!0,this.loop.start())}},{key:"onPauseClick",value:function(){this.isPlaying=!1,this.loop.stop(),this.reset()}},{key:"reset",value:function(){for(var e=t.ROWS,n=t.COLS,o=0;o<n;o++){this.data[o][0].parentEl.classList.remove("active");for(var i=0;i<e;i++)this.data[o][i].active=!1}this.sequencerManager.removeAllSynths(),this.update()}},{key:"setup",value:function(){var e=this;this.loop=new V.a.Sequence(function(n,o){for(var i=0;i<t.COLS;i++){e.data[i][0].parentEl.classList.remove("active")}var a=e.data[o];e.data[o][0].parentEl.classList.add("active");for(var r=0;r<t.ROWS;r++)a[r].active&&e.outConnectionsLength>0&&e.sequencerManager.play(o,a[r].step,n)},[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],"8n")}},{key:"onBtnClick",value:function(e){e.stopPropagation(),e.preventDefault();var t=parseInt(e.target.getAttribute("data-col")),n=parseInt(e.target.getAttribute("data-row")),o=this.data[t][n];o.active=!o.active,o.active?this.sequencerManager.addSynth(t,o.step):this.sequencerManager.removeSynth(t,o.step),this.update()}},{key:"onOutputClick",value:function(e){0===this.outConnectionsLength&&this.onConnectingCallback(this,e)}},{key:"enableOutput",value:function(e,t){this.output.enable(),this.outConnections.push(t.in),this.outConnectionsLength=this.outConnections.length}},{key:"disableOutput",value:function(e,t){this.outConnections=this.outConnections.filter(function(t){return t.ID!==e.ID}),this.outConnectionsLength=this.outConnections.length,0===this.outConnections.length&&(this.output.disable(),this.sequencerManager.removeAllSynths(),this.onPauseClick())}},{key:"update",value:function(){for(var e=t.ROWS,n=t.COLS,o=0;o<n;o++)for(var i=0;i<e;i++){var a=this.data[o][i];a.active?a.el.classList.add("active"):a.el.classList.remove("active")}}}])&&tt(n.prototype,o),i&&tt(n,i),t}();function st(e){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ut(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function lt(e,t){return!t||"object"!==st(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ct(e,t,n){return(ct="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ht(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function ht(e){return(ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pt(e,t){return(pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var dt=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=lt(this,ht(t).call(this))).el.classList.add("no-height"),e.el.classList.add("waveform-node"),e.needsUpdate=!0,e.isAnalyser=!0,e.isDisposed=!1,e.hasMultipleOutputs=!0,e.initAsNotCollapsed=!0,e.arrSize=256,e.audioValue=0,e.isConnected=!1,e.audioConnections=[],e.audioNode=V.a.context.createAnalyser(),e.audioNode.fftSize=e.arrSize,e.canvas=document.createElement("canvas"),e.canvas.className="waveform-canvas",e.canvas.width="200",e.canvas.height="100",e.ctx=e.canvas.getContext("2d"),e.value=new Uint8Array(e.arrSize),e.topPartEl.appendChild(e.canvas),e.params={},e}var n,o,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pt(e,t)}(t,A),n=t,(o=[{key:"init",value:function(e,n,o,a,r,s,u,l,c){ct(ht(t.prototype),"init",this).call(this,e,n,o,a,r,s,u,l,c),this.onOutputClickAudioBound=this.onOutputClickAudio.bind(this),this.onOutputClickDataBound=this.onOutputClickData.bind(this);var h=document.createElement("div");h.className="multiple-outputs",this.bottomPartEl.appendChild(h),this.outputAudio=new i(h,this.onOutputClickAudioBound,!1,!1,!1,!1),this.outputData=new i(h,this.onOutputClickDataBound,!0,!1,!1,!1),this.outputDataConnections=[],this.outputDataConnectionsLength=0,this.outputs={"analyser-audio":this.outputAudio,"analyser-data":this.outputData},this.inDotPos={"analyser-audio":null,"analyser-data":null}}},{key:"onOutputClickAudio",value:function(e){this.onConnectingCallback(this,e,"analyser-audio")}},{key:"onOutputClickData",value:function(e){this.onConnectingCallback(this,e,"analyser-data")}},{key:"getOutputPos",value:function(e){return{x:this.outputs[e].el.offsetLeft,y:this.outputs[e].el.offsetTop}}},{key:"getOutDotPos",value:function(e,t){return this.inDotPos[t]||(this.inDotPos[t]=this.outputs[t].el.getBoundingClientRect()),this.inDotPos[t]}},{key:"getOutputEl",value:function(e){return this.outputs[e]}},{key:"dispose",value:function(){this.isDisposed||(this.audioNode.disconnect(),this.isDisposed=!0)}},{key:"enableInput",value:function(e){ct(ht(t.prototype),"enableInput",this).call(this,e),this.isConnected=!0}},{key:"disableInput",value:function(e){ct(ht(t.prototype),"disableInput",this).call(this,e),this.isConnected=!1}},{key:"enableOutput",value:function(e,t){var n=t.outputType;this.outputs[n].enable(),"analyser-data"===n&&(this.outputDataConnections.push(t),this.outputDataConnectionsLength=this.outputDataConnections.length)}},{key:"disableOutput",value:function(e,t,n){"analyser-data"===n?(this.outputDataConnections=this.outputDataConnections.filter(function(e){return e.param.title!==t.title}),this.outputDataConnectionsLength=this.outputDataConnections.length,0===this.outputDataConnectionsLength&&(this.audioValue=0,this.outputs[n].disable())):this.outputs[n].disable()}},{key:"getAudioNode",value:function(){return this.isDisposed&&(this.audioNode=V.a.context.createAnalyser(),this.audioNode.fftSize=this.arrSize,this.isDisposed=!1),this.audioNode}},{key:"getValue",value:function(){return this.isConnected?this.audioValue:0}},{key:"update",value:function(){this.isConnected&&this.audioNode.getByteTimeDomainData(this.value)}},{key:"render",value:function(){var e=this.canvas.width,t=this.canvas.height;this.ctx.clearRect(0,0,e,t),this.ctx.fillStyle="black",this.ctx.strokeStyle="red";var n=0;this.ctx.beginPath();for(var o=0;o<this.arrSize;o++){var i=o/this.arrSize*e,a=(1-this.value[o]/256)*t;n+=1-this.value[o]/256,this.ctx.lineTo(i,a)}if(this.audioValue=100*(n/this.arrSize-.5),this.ctx.stroke(),0!==!this.outputDataConnectionsLength)for(var r=0;r<this.outputDataConnectionsLength;r++){var s=this.outputDataConnections[r].param;this.outputDataConnections[r].in.updateParam(s,this)}}}])&&ut(n.prototype,o),a&&ut(n,a),t}();function ft(e){return(ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yt(e,t,n){return(yt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=gt(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function gt(e){return(gt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bt(e,t){return(bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ct=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=gt(t).call(this))||"object"!==ft(o)&&"function"!=typeof o?vt(n):o).el.classList.add("no-height"),e.hasConnectedTrigger=!1,e.connectedTriggerID=-1,e.synthParams=[],t.BASE_FREQ=440,t.ROOT=Math.pow(2,1/12),e.isKeyboardListener=!0,e.isSynthOscillator=!0,e.hasAudioInput=!1,e.hasEnvelopeConnection=!1;var i=document.createElement("div");i.className="range-container",e.topPartEl.appendChild(i),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(vt(e));var a={parentEl:i,title:"Oktav",initValue:-2,settings:{min:-4,max:0},valChangeCallback:e.onRangeChangeCallbackBound,param:"octave",decimals:0,disable:!1};e.octaveRangeSlider=new F(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={useAsInput:!1,value:a.initValue,param:"octave",slider:e.octaveRangeSlider,title:"Octave"},s={useAsInput:!0,param:"trigger",title:"Trigger",helper:R.oscillatorTrigger};return e.params[r.param]=r,e.params[s.param]=s,e.paramVals={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bt(e,t)}(t,A),n=t,(o=[{key:"enableParam",value:function(e,n){yt(gt(t.prototype),"enableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!0,this.connectedTriggerID=n.out.ID)}},{key:"disableParam",value:function(e){yt(gt(t.prototype),"disableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!1,this.connectedTriggerID=-1)}},{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getParams",value:function(e){e||(e=0);return{}}},{key:"getAudioNode",value:function(){return new V.a.MembraneSynth}},{key:"getFrequency",value:function(e){var n=12*parseInt(this.params.octave.value)+e;return t.BASE_FREQ*Math.pow(t.ROOT,n)}}])&&mt(n.prototype,o),i&&mt(n,i),t}();function wt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var kt=function(){function e(t,n,o,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.waves=["sine","sawtooth","square","triangle"],this.parentEl=t,this.onChange=n,this.param=i,this.partialCount=0;var r=document.createElement("h4");r.className="wave-type-label",r.innerHTML=a;var s=document.createElement("div");s.className="wave-type-selector-container",s.appendChild(r);var u=document.createElement("div");u.className="wave-types-container",s.appendChild(u),this.onWaveClickBound=this.onWaveClick.bind(this),this.waveTypeEls=[];for(var l=0;l<this.waves.length;l++){var c=document.createElement("h4");c.className="wave-type",c.innerHTML=this.waves[l],c.setAttribute("data-wave",this.waves[l]),c.addEventListener("click",this.onWaveClickBound),this.waveTypeEls.push(c),u.appendChild(c)}t.appendChild(s)}var t,n,o;return t=e,(n=[{key:"onWaveClick",value:function(e){for(var t=0;t<this.waveTypeEls.length;t++)this.waveTypeEls[t].classList.remove("active");var n=e.target.getAttribute("data-wave");e.target.classList.add("active"),this.onChange(n,this.param)}},{key:"remove",value:function(){for(var e=0;e<this.waveTypeEls.length;e++)this.waveTypeEls[e].removeEventListener("click",this.onWaveClickBound);this.parentEl.removeChild(this.el)}}])&&wt(t.prototype,n),o&&wt(t,o),e}();function Et(e){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ot(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xt(e,t,n){return(xt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_t(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function _t(e){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mt(e,t){return(Mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Tt=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=_t(t).call(this))||"object"!==Et(o)&&"function"!=typeof o?Pt(n):o).el.classList.add("no-height"),e.hasConnectedTrigger=!1,e.connectedTriggerID=-1,e.synthParams=[],t.BASE_FREQ=440,t.ROOT=Math.pow(2,1/12),e.isKeyboardListener=!0,e.isSynthOscillator=!0,e.hasAudioInput=!1,e.hasEnvelopeConnection=!1;var i=document.createElement("div");i.className="range-container";var a=document.createElement("div");a.className="wave-type-container",e.topPartEl.appendChild(a),e.onWaveChangeCallbackBound=e.onWaveChangeCallback.bind(Pt(e)),e.waveTypeSelector=new kt(a,e.onWaveChangeCallbackBound,"sine","oscillator-type","Oscillator vågtyp"),e.topPartEl.appendChild(i),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(Pt(e));var r={parentEl:i,title:"Oktav",initValue:0,settings:{min:-4,max:4},valChangeCallback:e.onRangeChangeCallbackBound,param:"octave",decimals:0,disable:!1};e.octaveRangeSlider=new F(r.parentEl,r.title,r.initValue,r.settings,r.valChangeCallback,r.param,r.decimals,r.disable);var s={useAsInput:!1,value:r.initValue,param:"octave",slider:e.octaveRangeSlider,title:"Octave"},u={useAsInput:!1,value:"sine",param:"oscillator-type",title:"oscillator type",setParam:function(e,t){e.oscillator.type=t}},l={useAsInput:!0,param:"trigger",title:"Trigger",helper:R.oscillatorTrigger};return e.params[s.param]=s,e.params[l.param]=l,e.params[u.param]=u,e.synthParams.push(u.param),e.paramVals={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mt(e,t)}(t,A),n=t,(o=[{key:"enableParam",value:function(e,n){xt(_t(t.prototype),"enableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!0,this.connectedTriggerID=n.out.ID)}},{key:"disableParam",value:function(e){xt(_t(t.prototype),"disableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!1,this.connectedTriggerID=-1)}},{key:"onWaveChangeCallback",value:function(e,t){this.params[t].value=e}},{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getParams",value:function(e){e||(e=0);return{}}},{key:"getAudioNode",value:function(){return new V.a.FMSynth}},{key:"getFrequency",value:function(e){var n=12*parseInt(this.params.octave.value)+e;return t.BASE_FREQ*Math.pow(t.ROOT,n)}}])&&Ot(n.prototype,o),i&&Ot(n,i),t}();n(7),n(11),n(13),n(8),n(14),n(9),n(15),n(16),n(17),n(10),n(18),n(19),n(20),n(21),n(22),n(23),n(24),n(25);var Rt=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="node-param-header node-component",o&&(this.el.style.marginTop="10px");var i=document.createElement("h2");i.innerHTML=n,this.el.appendChild(i),t.appendChild(this.el)},St={general:{isValid:function(e){return!0}},needsFramebuffer:{isValid:function(e){return e.framebuffer||e.isForegroundNode}},sceneNode:{isValid:function(e,t,n,o){return!(t.enabledInputs.some(function(t){return t.out.ID===e.ID})||!n)&&{background:function(){return e.isBackgroundNode},foreground:function(){return o&&e.outputs[o]?e.isForegroundNode&&!e.outputs[o].isParamOutput:e.isForegroundNode},light:function(){return e.isLightNode&&!t.foregroundRender.hasConnectedLight}}[n]()}}};function Lt(e){return(Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Nt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function It(e,t){return!t||"object"!==Lt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Dt(e,t,n){return(Dt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Bt(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Bt(e){return(Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function At(e,t){return(At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var jt=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=It(this,Bt(t).call(this))).params={},e.inputParams={},e.isForegroundNode=!1,e.isBackgroundNode=!1,e.needsMinMax=!1,e.currentOutConnections=[],e.currentOutConnectionsLength=0,e.el=document.createElement("div"),e.el.className="node",e.topPartEl=document.createElement("div"),e.topPartEl.className="top-part",e.el.appendChild(e.topPartEl),e.bottomPartEl=document.createElement("div"),e.bottomPartEl.className="bottom-part",e.el.appendChild(e.bottomPartEl),e.inputHelpersType=St.general,e.isGraphicsNode=!0,e.isRenderNode=!1,e.canConnectToMaterial=!1,e.isCanvasNode=!1,e.dotPos=void 0,e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(t,p),n=t,(o=[{key:"init",value:function(e,n,o,i,a,r,s,u){var l=this;Dt(Bt(t.prototype),"init",this).call(this,e,n,o,i,a,r,s,u);var c=[];for(var h in this.params)this.params[h].useAsInput&&this.params[h].parent&&function(){var e=l.params[h].parent;if(c.some(function(t){return t.parent===e})){c.find(function(t){return t.parent===e}).children.push(l.params[h])}else{var t={parent:e,children:[]};c.push(t),t.children.push(l.params[h])}}();if(c.length>0)for(var p=0;p<c.length;p++)for(var d=c[p],f=(new Rt(this.topPartEl,d.parent,p>0),0);f<d.children.length;f++){var m=new T(this.topPartEl,d.children[f],this.onInputClickBound);this.inputParams[d.children[f].title]=m}else for(var v in this.params)if(this.params[v].useAsInput){var y=new T(this.topPartEl,this.params[v],this.onInputClickBound);this.inputParams[this.params[v].title]=y}this.activateDrag(),this.postInit()}},{key:"enableParam",value:function(e,t){var n=this.inputParams[e.title];e.isConnected=!0,n.enable(),Me[e.paramHelpersType].update(this,t.out,e)}},{key:"updateParam",value:function(e,t){Me[e.paramHelpersType].update(this,t,e)}},{key:"disableParam",value:function(e,t){var n=this.inputParams[e.title];e.isConnected=!1,n.disable(),Me[e.paramHelpersType].disconnect(this,e,t.out)}},{key:"getDotPos",value:function(e){return this.dotPos||(this.dotPos=e.getBoundingClientRect()),this.dotPos}},{key:"setParamVal",value:function(e,t){this.paramVals[t]=e}},{key:"onParameterUpdate",value:function(){this.getParams()}},{key:"getParams",value:function(){var e={};for(var t in this.params){var n=this.params[t];e[n.objSettings.param]=this.paramVals[n.objSettings.param]}return e}},{key:"onResize",value:function(){}}])&&Nt(n.prototype,o),i&&Nt(n,i),t}();function Vt(e){return(Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ht(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ft(e,t){return!t||"object"!==Vt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ut(e){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zt(e,t){return(zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qt=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Ft(this,Ut(t).call(this))).isRenderNode=!0,n.canConnectToMaterial=!0,n.scene=new THREE.Scene,n.renderer=e.renderer,n.framebuffer=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter}),n}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zt(e,t)}(t,jt),n=t,(o=[{key:"update",value:function(){}},{key:"render",value:function(){this.renderer.setRenderTarget(this.framebuffer),this.renderer.render(this.scene,this.camera),this.renderer.setRenderTarget(null)}},{key:"onResize",value:function(e){var t=e.w,n=e.h;this.framebuffer.setSize(t,n),this.camera.aspect?this.camera.aspect=t/n:(this.camera.left=t/-2,this.camera.right=t/2,this.camera.top=n/-2,this.camera.bottom=n/2),this.camera.updateProjectionMatrix()}}])&&Ht(n.prototype,o),i&&Ht(n,i),t}();function Gt(e){return(Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Kt(e,t){return!t||"object"!==Gt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Xt(e,t,n){return(Xt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Wt(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Wt(e){return(Wt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zt(e,t){return(Zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qt=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Kt(this,Wt(t).call(this,e))).isBackgroundNode=!0,n.el.classList.add("no-height"),n.shader="".concat(O).concat(b).concat(k).concat(C);var o=window.innerWidth,i=window.innerHeight;n.camera=new THREE.OrthographicCamera(o/-2,o/2,i/2,i/-2,1,1e3),n.startTime=Date.now();var a=new THREE.PlaneGeometry(2,2),r={};r.u_resolution={value:new THREE.Vector2(window.innerWidth,window.innerHeight)},r.u_time={value:0};var s={u_user_speed3:{value:.5},u_user_pattern_scale:{value:-.358},u_user_scale:{value:7.032},u_user_rotation:{value:.804},u_user_speed2:{value:.028},u_user_blur:{value:.7}};s.u_user_color1={value:new THREE.Color(.256,.351,.62)},s.u_user_color2={value:new THREE.Color(1,.42,.42)};var u=Object.assign({},r,s);n.material=new THREE.ShaderMaterial({uniforms:u,vertexShader:y,fragmentShader:n.shader}),n.mesh=new THREE.Mesh(a,n.material),n.scene.add(n.mesh),n.paramVals={};return n.params={blurParam:{title:"Blur",param:"u_user_blur",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:.01,max:10},defaultVal:.7,decimals:2},distortionParam:{title:"Distortion",param:"u_user_speed2",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:.001,max:10},defaultVal:.02,decimals:2},rotationParam:{title:"Rotation",param:"u_user_rotation",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:.01,max:2},defaultVal:.8,decimals:2},patternScaleParam:{title:"Pattern Scale",param:"u_user_pattern_scale",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,decimals:2},scaleParam:{title:"Scale",param:"u_user_scale",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:1,max:20},defaultVal:7,decimals:2},speed3Param:{title:"Speed3",param:"u_user_speed3",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:0,max:2},value:.5,decimals:2}},n}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zt(e,t)}(t,qt),n=t,(o=[{key:"enableOutput",value:function(e,n){Xt(Wt(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&Xt(Wt(t.prototype),"disableOutput",this).call(this)}},{key:"update",value:function(){Xt(Wt(t.prototype),"update",this).call(this);var e=Date.now()-this.startTime;this.mesh.material.uniforms.u_time.value=.005*e}},{key:"onResize",value:function(e){Xt(Wt(t.prototype),"onResize",this).call(this,e);var n=e.w,o=e.h;this.mesh.material.uniforms.u_resolution.value=new THREE.Vector2(n,o)}}])&&Yt(n.prototype,o),i&&Yt(n,i),t}();function Jt(e){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $t(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function en(e,t){return!t||"object"!==Jt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function tn(e,t,n){return(tn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=nn(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function nn(e){return(nn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function on(e,t){return(on=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var an=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=en(this,nn(t).call(this,e))).isBackgroundNode=!0,n.el.classList.add("no-height"),n.shader="".concat(O).concat(b).concat(E).concat(C);var o=window.innerWidth,i=window.innerHeight;n.camera=new THREE.OrthographicCamera(o/-2,o/2,i/2,i/-2,1,1e3),n.startTime=Date.now();var a=new THREE.PlaneGeometry(2,2),r={};r.u_resolution={value:new THREE.Vector2(window.innerWidth,window.innerHeight)},r.u_time={value:0};var s={};s.u_user_fgColor={value:new THREE.Color(1,1,1)},s.u_user_bgColor={value:new THREE.Color(0,0,0)};var u=Object.assign({},r,s);n.material=new THREE.ShaderMaterial({uniforms:u,vertexShader:y,fragmentShader:n.shader}),n.mesh=new THREE.Mesh(a,n.material),n.scene.add(n.mesh),n.paramVals={};var l={title:"FG Color",param:"u_user_fgColor",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,defaultVal:n.material.uniforms.u_user_fgColor.value},c={title:"BG Color",param:"u_user_bgColor",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,defaultVal:n.material.uniforms.u_user_bgColor.value};return n.params={fgColorParam:l,bgColorParam:c},n}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&on(e,t)}(t,qt),n=t,(o=[{key:"enableOutput",value:function(e,n){tn(nn(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&tn(nn(t.prototype),"disableOutput",this).call(this)}},{key:"update",value:function(){tn(nn(t.prototype),"update",this).call(this);var e=Date.now()-this.startTime;this.mesh.material.uniforms.u_time.value=.005*e}},{key:"onResize",value:function(e){tn(nn(t.prototype),"onResize",this).call(this,e);var n=e.w,o=e.h;this.mesh.material.uniforms.u_resolution.value=new THREE.Vector2(n,o)}}])&&$t(n.prototype,o),i&&$t(n,i),t}();function rn(e){return(rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function un(e,t){return!t||"object"!==rn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ln(e,t,n){return(ln="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=cn(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function cn(e){return(cn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hn(e,t){return(hn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pn=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=un(this,cn(t).call(this,e))).isBackgroundNode=!0,n.shader="".concat(O).concat(b).concat(w).concat(C);var o=window.innerWidth,i=window.innerHeight;n.camera=new THREE.OrthographicCamera(o/-2,o/2,i/2,i/-2,1,1e3),n.startTime=Date.now();var a=new THREE.PlaneGeometry(2,2),r={};r.u_resolution={value:new THREE.Vector2(window.innerWidth,window.innerHeight)},r.u_time={value:0};var s={u_noise_amount:{value:.5}},u=Object.assign({},r,s);n.material=new THREE.ShaderMaterial({uniforms:u,vertexShader:y,fragmentShader:n.shader}),n.mesh=new THREE.Mesh(a,n.material),n.scene.add(n.mesh),n.paramVals={};return n.params={amountParam:{title:"Amount",param:"u_noise_amount",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0}},n}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hn(e,t)}(t,qt),n=t,(o=[{key:"enableOutput",value:function(e,n){ln(cn(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&ln(cn(t.prototype),"disableOutput",this).call(this)}},{key:"update",value:function(){ln(cn(t.prototype),"update",this).call(this);var e=Date.now()-this.startTime;this.mesh.material.uniforms.u_time.value=.005*e}},{key:"onResize",value:function(e){ln(cn(t.prototype),"onResize",this).call(this,e);var n=e.w,o=e.h;this.mesh.material.uniforms.u_resolution.value=new THREE.Vector2(n,o)}}])&&sn(n.prototype,o),i&&sn(n,i),t}();function dn(e){return(dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function mn(e,t){return!t||"object"!==dn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vn(e,t,n){return(vn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=yn(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function yn(e){return(yn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function gn(e,t){return(gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var bn=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=mn(this,yn(t).call(this))).isForegroundNode=!0,e.el.classList.add("no-height");window.innerWidth,window.innerHeight;e.geometry=new THREE.BoxGeometry(3,3,3,10,10,10),e.material=new THREE.MeshPhongMaterial({}),e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Material",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Material",paramHelpersType:"texture",needsFrameUpdate:!1},colorParam:n,bumpMapParam:{title:"Displacement",param:"normalMap",useAsInput:!0,parent:"Material",paramHelpersType:"normalMap",needsFrameUpdate:!1},positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},rotationXParam:{title:"Rotation x",param:"x",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},scaleParam:{title:"Scale",param:"scale",useAsInput:!0,parent:"Scale",paramHelpersType:"scale",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:0}},e.paramVals={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gn(e,t)}(t,jt),n=t,(o=[{key:"getMesh",value:function(){return this.mesh}},{key:"enableOutput",value:function(e,n){vn(yn(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&vn(yn(t.prototype),"disableOutput",this).call(this)}},{key:"update",value:function(){vn(yn(t.prototype),"update",this).call(this)}}])&&fn(n.prototype,o),i&&fn(n,i),t}();function Cn(e){return(Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function kn(e,t){return!t||"object"!==Cn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function En(e,t,n){return(En="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=On(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function On(e){return(On=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pn(e,t){return(Pn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var xn=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=kn(this,On(t).call(this))).isForegroundNode=!0,e.hasMultipleOutputs=!0,e.el.classList.add("no-height"),e.el.classList.add("no-input-multiple-outputs");window.innerWidth,window.innerHeight;e.geometry=new THREE.SphereGeometry(2,32,32),e.material=new THREE.MeshPhongMaterial({}),e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Material",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Material",paramHelpersType:"texture",needsFrameUpdate:!1},colorParam:n,bumpMapParam:{title:"Displacement",param:"normalMap",useAsInput:!0,parent:"Material",paramHelpersType:"normalMap",needsFrameUpdate:!1},positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},rotationXParam:{title:"Rotation x",param:"x",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},scaleParam:{title:"Scale",param:"scale",useAsInput:!0,parent:"Scale",paramHelpersType:"scale",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:1}},e.paramVals={},e}var n,o,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pn(e,t)}(t,jt),n=t,(o=[{key:"init",value:function(e,n,o,a,r,s,u,l){En(On(t.prototype),"init",this).call(this,e,n,o,a,r,s,u,l),this.onOutputClickGraphicsBound=this.onOutputClickGraphics.bind(this),this.onOutputClickTargetBound=this.onOutputClickTarget.bind(this);var c=document.createElement("div");c.className="multiple-outputs",this.bottomPartEl.appendChild(c),this.outputGraphics=new i(c,this.onOutputClickGraphicsBound,!1,!1,!1,!0),this.outputTarget=new i(c,this.onOutputClickTargetBound,!0,!1,!1,!0),this.outputDataConnection=null,this.outputs={"sphere-graphics":this.outputGraphics,"sphere-target":this.outputTarget},this.inDotPos={"sphere-graphics":null,"sphere-target":null},this.enabledOutputs=[]}},{key:"onOutputClickGraphics",value:function(e){this.onConnectingCallback(this,e,"sphere-graphics")}},{key:"onOutputClickTarget",value:function(e){this.onConnectingCallback(this,e,"sphere-target")}},{key:"getOutputPos",value:function(e){return{x:this.outputs[e].el.offsetLeft,y:this.outputs[e].el.offsetTop}}},{key:"getOutDotPos",value:function(e,t){return this.inDotPos[t]||(this.inDotPos[t]=this.outputs[t].el.getBoundingClientRect()),this.inDotPos[t]}},{key:"getOutputEl",value:function(e){return this.outputs[e]}},{key:"enableOutput",value:function(e,t){var n=t.outputType;this.outputs[n].enable(),this.enabledOutputs.push(n)}},{key:"disableOutput",value:function(e,t,n){this.outputs[n].disable(),this.enabledOutputs=this.enabledOutputs.filter(function(e){return e!==n})}},{key:"getMesh",value:function(){return this.mesh}}])&&wn(n.prototype,o),a&&wn(n,a),t}();function _n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Mn=function(){function e(t,n,o,i,a){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=o,this.onInputChangeCallback=a,this.decimals=i,this.onInputChangeBound=this.onInputChange.bind(this),this.el=document.createElement("div"),this.el.className="horizontal-range-slider";var s=document.createElement("div");s.className="input-container";var u=document.createElement("p");u.innerHTML="Min",s.appendChild(u),this.inputLowEl=document.createElement("input"),this.inputLowEl.type="number",this.inputLowEl.value=-2,this.inputLowEl.step=1,this.inputLowEl.min=-10,this.inputLowEl.max=1,this.inputLowEl.addEventListener("change",this.onInputChangeBound),s.appendChild(this.inputLowEl);var l=document.createElement("div");l.className="input-container";var c=document.createElement("p");c.innerHTML="Max",l.appendChild(c),this.inputHighEl=document.createElement("input"),this.inputHighEl.type="number",this.inputHighEl.value=2,this.inputHighEl.step=.1,this.inputHighEl.min=2,this.inputHighEl.max=10,this.inputHighEl.addEventListener("change",this.onInputChangeBound),l.appendChild(this.inputHighEl),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var h=document.createElement("div");h.appendChild(s),h.appendChild(this.rangeInnerContainer),h.appendChild(l),h.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=this.inputLowEl.value;var p=document.createElement("div");p.className="value-container";var d=document.createElement("p");d.innerHTML="Value",p.appendChild(d),p.appendChild(this.valueEl),this.el.appendChild(h),this.el.appendChild(p),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),this.value=0,setTimeout(function(){r.setPos(100)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,o;return t=e,(n=[{key:"onInputChange",value:function(e){this.onInputChangeCallback()}},{key:"setDefaultValues",value:function(e){var t=e.minMax;this.inputLowEl.value=t.min,this.inputLowEl.min=t.min-20,this.inputLowEl.max=t.max+20,this.inputHighEl.value=t.max,this.inputHighEl.min=t.max-20,this.inputHighEl.max=t.max+20;var n=e.defaultVal;this.value=(n-t.min)/(t.max-t.min),this.valueEl.innerHTML=n,this.setPos(100),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)))}},{key:"getMinMaxValue",value:function(){return{min:parseFloat(this.inputLowEl.value),max:parseFloat(this.inputHighEl.value)}}},{key:"remove",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e){this.value=e,this.setPos(100);var t=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=t,this.valChangeCallback&&this.valChangeCallback(t)}},{key:"getValue",value:function(){var e=this.getMinMaxValue();return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.setPos(100),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.setPos(100),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.setPos(100),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=e-this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(0px, ".concat(t,"px, 0)")}}])&&_n(t.prototype,n),o&&_n(t,o),e}(),Tn={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}};function Rn(e){return(Rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ln(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Nn(e,t,n){return(Nn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=In(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function In(e){return(In=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dn(e,t){return(Dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Bn=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=In(t).call(this))||"object"!==Rn(o)&&"function"!=typeof o?Ln(n):o).el.classList.add("no-height"),e.el.classList.add("left-padding"),e.el.classList.add("param-driver-node"),e.isParam=!0,e.returnsSingleNumber=!0,e.animateValues={isRunning:!1,timestamp:0,duration:0,reqAnimFrame:-1,firstRunOffset:0},e.onRangeValChangeBound=e.onRangeValChange.bind(Ln(e)),e.onInputChangeBound=e.onInputChange.bind(Ln(e)),e.horizontalRangeSlider=new Mn(e.topPartEl,0,e.onRangeValChangeBound,2,e.onInputChangeBound),e.durationEl=document.createElement("input"),e.durationEl.type="number",e.durationEl.value=2e3,e.durationEl.step=1,e.durationEl.min=400,e.durationEl.max=1e4,e.durationEl.addEventListener("change",e.onInputChangeBound);var i=document.createElement("div");i.className="duration-container (ms)";var a=document.createElement("p");a.innerHTML="Duration",i.appendChild(a),i.appendChild(e.durationEl);var r=document.createElement("div");return r.className="top-bottom-container",r.appendChild(i),e.onToggleStartClickBound=e.onToggleStartClick.bind(Ln(e)),e.toggleStartBtn=document.createElement("div"),e.toggleStartBtn.className="toggle-start",e.toggleStartBtn.addEventListener("click",e.onToggleStartClickBound),e.toggleBtnText=document.createElement("p"),e.toggleBtnText.innerHTML="Start",e.toggleStartBtn.appendChild(e.toggleBtnText),r.appendChild(e.toggleStartBtn),e.topPartEl.appendChild(r),e.modifier={},e.paramVals={},e.params={},e.updateBound=e.update.bind(Ln(e)),e.update(),e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Dn(e,t)}(t,jt),n=t,(o=[{key:"onInputChange",value:function(e){this.reset()}},{key:"reset",value:function(){this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"}},{key:"onToggleStartClick",value:function(){this.animateValues.isRunning?(this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"):(this.toggleBtnText.innerHTML="Stop",this.animateValues.timestamp=Date.now(),this.animateValues.duration=parseInt(this.durationEl.value),this.animateValues.firstRunOffset=Math.floor(this.horizontalRangeSlider.value*this.animateValues.duration),this.animateValues.isReverse=!1,this.animateValues.easing=Tn.linear,this.animateValues.isRunning=!0)}},{key:"getValue",value:function(){return this.horizontalRangeSlider.getReadyValue()}},{key:"update",value:function(){if(this.animateValues.reqAnimFrame=requestAnimationFrame(this.updateBound),this.animateValues.isRunning){var e=Date.now(),t=e-this.animateValues.timestamp+this.animateValues.firstRunOffset,n=this.animateValues.easing(Math.min(t/this.animateValues.duration,1)),o=this.animateValues.isReverse?1-n:n;o>=1?(this.animateValues.timestamp=e,this.animateValues.isReverse=!0,this.animateValues.firstRunOffset=0):o<=0&&(this.animateValues.timestamp=e,this.animateValues.isReverse=!1),this.horizontalRangeSlider.setValue(o)}}},{key:"onRangeValChange",value:function(e){for(var t=0;t<this.currentOutConnectionsLength;t++){var n=this.currentOutConnections[t].param;this.currentOutConnections[t].in.updateParam(n,this)}}},{key:"enableOutput",value:function(e,n){Nn(In(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length,1===this.currentOutConnectionsLength&&this.horizontalRangeSlider.setDefaultValues(e)}},{key:"enableInput",value:function(e){Nn(In(t.prototype),"enableInput",this).call(this)}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(e){return e.in.ID!==nodeIn.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&Nn(In(t.prototype),"disableOutput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),window.cancelAnimationFrame(this.animateValues.reqAnimFrame),Nn(In(t.prototype),"removeFromDom",this).call(this)}}])&&Sn(n.prototype,o),i&&Sn(n,i),t}();function An(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var jn=function(){function e(t,n,o,i,a,r,s,u){var l=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=o,this.height=s||60,this.decimals=i,this.value=(n-a.min)/(a.max-a.min),this.settings=a,this.el=document.createElement("div"),this.el.className="vertical-slider prevent-drag",this.disabledLayer=document.createElement("div"),this.disabledLayer.className="disabled-layer",u&&this.hide(),this.el.appendChild(this.disabledLayer);var c=document.createElement("h4");c.className="vertical-slider-label",c.innerHTML=r,this.el.appendChild(c),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeInnerContainer.style.height="".concat(this.height,"px"),this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var h=document.createElement("div");h.appendChild(this.rangeInnerContainer),h.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=n;var p=document.createElement("div");p.className="value-container",p.appendChild(this.valueEl),this.el.appendChild(h),this.el.appendChild(p),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),setTimeout(function(){l.setPos(l.height)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,o;return t=e,(n=[{key:"hide",value:function(){this.disabledLayer.classList.add("visible")}},{key:"show",value:function(){this.disabledLayer.classList.remove("visible")}},{key:"remove",value:function(){this.rangeInnerContainer.removeEventListener("click",this.onRangeClickBound),this.rangeKnob.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e){this.value=e,this.setPos(this.height);var t=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=t,this.valChangeCallback&&this.valChangeCallback(t)}},{key:"getValue",value:function(){var e=this.settings;return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),o=1-Math.round(100*(e.y-n.top))/100/t;this.value=o>1?1:o<0?0:o,this.setPos(t),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),o=1-Math.round(100*(e.y-n.top))/100/t;this.value=o>1?1:o<0?0:o,this.setPos(t),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),o=1-Math.round(100*(e.y-n.top))/100/t;this.value=o>1?1:o<0?0:o,this.setPos(t),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=e-this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(0px, ".concat(t,"px, 0)")}}])&&An(t.prototype,n),o&&An(t,o),e}();function Vn(e){return(Vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Fn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Un(e,t,n){return(Un="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=zn(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function zn(e){return(zn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qn(e,t){return(qn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Gn=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=zn(t).call(this))||"object"!==Vn(o)&&"function"!=typeof o?Fn(n):o).needsUpdate=!0,e.el.classList.add("no-height"),e.el.classList.add("orbit-driver-node"),e.isParam=!0,e.animateValues={isRunning:!1,reqAnimFrame:-1,counter:1552337385540},e.currentT=0,e.currentSpeed=0,e.currentRotationY=0,e.currentRotationX=0,e.outValues={Position:{x:0,y:0,z:0},Rotation:{x:0,y:0}};var i={title:"Center Point",param:"center",useAsInput:!0,defaultVal:new THREE.Vector3,paramHelpersType:"target",needsFrameUpdate:!1};e.targetPosition=new THREE.Vector3,e.params={targetParam:i},e.paramVals={},e.onSpeedChangeBound=e.onSpeedChange.bind(Fn(e)),e.onOrbitXChangeBound=e.onOrbitXChange.bind(Fn(e)),e.onOrbitYChangeBound=e.onOrbitYChange.bind(Fn(e)),e.onOrbitZChangeBound=e.onOrbitZChange.bind(Fn(e)),e.onRotationChangeYBound=e.onRotationChangeY.bind(Fn(e)),e.onRotationChangeXBound=e.onRotationChangeX.bind(Fn(e));var a=document.createElement("div");return a.className="settings-container-outer",e.topPartEl.appendChild(a),e.orbitXSlider=new jn(a,10,e.onOrbitXChangeBound,0,{min:0,max:40},"Radie X",60,!0),e.orbitYSlider=new jn(a,10,e.onOrbitYChangeBound,0,{min:0,max:40},"Radie Y",60,!0),e.orbitZSlider=new jn(a,10,e.onOrbitZChangeBound,0,{min:0,max:40},"Radie Z",60,!0),e.speedSlider=new jn(a,0,e.onSpeedChangeBound,4,{min:0,max:10},"Orbit speed"),e.rotationXSlider=new jn(a,0,e.onRotationChangeXBound,3,{min:-.1,max:.1},"Rotation X",60,!0),e.rotationYSlider=new jn(a,0,e.onRotationChangeYBound,3,{min:-.1,max:.1},"Rotation Y",60,!0),e.orbitSliders={Position:{x:e.orbitXSlider,y:e.orbitYSlider,z:e.orbitZSlider},Rotation:{x:e.rotationXSlider,y:e.rotationYSlider},Form:{x:e.orbitXSlider,y:e.orbitYSlider,z:e.orbitZSlider}},e.curve=new THREE.EllipseCurve(0,0,10,10,0,2*Math.PI,!1,0),e.topPartEl.appendChild(a),e.onToggleStartClickBound=e.onToggleStartClick.bind(Fn(e)),e.toggleStartBtn=document.createElement("div"),e.toggleStartBtn.className="toggle-start",e.toggleStartBtn.addEventListener("click",e.onToggleStartClickBound),e.toggleBtnText=document.createElement("p"),e.toggleBtnText.innerHTML="Start",e.toggleStartBtn.appendChild(e.toggleBtnText),e.topPartEl.appendChild(e.toggleStartBtn),e.updateBound=e.update.bind(Fn(e)),e.update(),e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qn(e,t)}(t,jt),n=t,(o=[{key:"onRotationChangeX",value:function(e){this.currentRotationX=e}},{key:"onRotationChangeY",value:function(e){this.currentRotationY=e}},{key:"onOrbitXChange",value:function(e){this.curve.xRadius=e}},{key:"onOrbitYChange",value:function(e){this.curve.yRadius=e}},{key:"onOrbitZChange",value:function(e){this.curve.yRadius=e}},{key:"onSpeedChange",value:function(e){this.currentSpeed=.001*e}},{key:"reset",value:function(){this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"}},{key:"onToggleStartClick",value:function(){this.animateValues.isRunning?(this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"):(this.toggleBtnText.innerHTML="Stop",this.animateValues.isRunning=!0)}},{key:"getValue",value:function(e){return this.outValues[e.parent][e.param]}},{key:"update",value:function(){var e=this.curve.getPoint(this.currentT);this.curve.aX=this.targetPosition.x,this.curve.aY=this.targetPosition.z,this.outValues.Position.x=e.x,this.outValues.Position.y=e.y,this.outValues.Position.z=e.y,this.outValues.Rotation.y+=this.currentRotationY,this.outValues.Rotation.x+=this.currentRotationX;for(var t=0;t<this.currentOutConnectionsLength;t++){var n=this.currentOutConnections[t].param;this.currentOutConnections[t].in.updateParam(n,this)}this.animateValues.isRunning&&(this.currentT+=this.currentSpeed,this.currentT>1&&(this.currentT=0))}},{key:"render",value:function(){}},{key:"enableOutput",value:function(e,n){Un(zn(t.prototype),"enableOutput",this).call(this),e&&this.orbitSliders[e.parent][e.param].show(),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"enableInput",value:function(e){Un(zn(t.prototype),"enableInput",this).call(this)}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(e){return e.in.ID!==nodeIn.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,n&&this.orbitSliders[n.parent][n.param].hide(),this.currentOutConnectionsLength<=0&&(Un(zn(t.prototype),"disableOutput",this).call(this),this.onToggleStartClick())}},{key:"removeFromDom",value:function(){this.reset(),window.cancelAnimationFrame(this.animateValues.reqAnimFrame),this.speedSlider.remove(),this.orbitXSlider.remove(),this.orbitYSlider.remove(),this.orbitZSlider.remove(),this.rotationXSlider.remove(),this.rotationYSlider.remove(),Un(zn(t.prototype),"removeFromDom",this).call(this)}}])&&Hn(n.prototype,o),i&&Hn(n,i),t}();function Yn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Kn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=window.innerWidth,i=window.innerHeight;this.camera=new THREE.PerspectiveCamera(75,o/i,.1,1e3),this.camera.position.z=10,this.cameraControls=new THREE.OrbitControls(this.camera,n),this.cameraControls.enabled=!1,this.scene=new THREE.Scene,this.renderer=t.renderer,this.axesHelper=new THREE.AxesHelper(5),this.axesHelper.name="AxesHelper",this.ambientLight=new THREE.AmbientLight,this.scene.add(this.ambientLight),this.connectedNodes=[],this.hasConnectedLight=!1,this.framebuffer=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter})}var t,n,o;return t=e,(n=[{key:"toggleAxesHelper",value:function(e){if(e)this.scene.add(this.axesHelper);else{this.scene.getObjectByName(this.axesHelper.name);this.scene.remove(this.axesHelper)}}},{key:"toggleCameraControl",value:function(e){e?(this.cameraControls.enabled=!0,this.renderer.domElement.classList.add("prevent-drag")):(this.cameraControls.enabled=!1,this.renderer.domElement.classList.remove("prevent-drag"))}},{key:"addLight",value:function(e){var t="".concat(e.ID,"-light");e.light.name=t;var n="".concat(e.ID,"-mesh");e.mesh.name=n,this.scene.add(e.light),this.scene.add(e.mesh),this.hasConnectedLight=!0}},{key:"removeLight",value:function(e){var t="".concat(e.ID,"-light"),n=this.scene.getObjectByName(t);this.scene.remove(n);var o="".concat(e.ID,"-mesh"),i=this.scene.getObjectByName(o);this.scene.remove(i),this.hasConnectedLight=!1}},{key:"addNode",value:function(e){this.connectedNodes.push(e);var t="".concat(e.ID,"-mesh");e.mesh.name=t,this.scene.add(e.mesh)}},{key:"removeNode",value:function(e){this.connectedNodes=this.connectedNodes.filter(function(t){return t.ID!==e.ID});var t="".concat(e.ID,"-mesh"),n=this.scene.getObjectByName(t);this.scene.remove(n)}},{key:"update",value:function(){}},{key:"render",value:function(){this.renderer.setRenderTarget(this.framebuffer),this.renderer.render(this.scene,this.camera)}},{key:"onResize",value:function(e){var t=e.w,n=e.h;this.framebuffer.setSize(t,n),this.camera.aspect?this.camera.aspect=t/n:(this.camera.left=t/-2,this.camera.right=t/2,this.camera.top=n/-2,this.camera.bottom=n/2),this.camera.updateProjectionMatrix()}}])&&Yn(t.prototype,n),o&&Yn(t,o),e}();function Xn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Wn=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onResizeCallback=n,this.onNodeResizerDown=o,this.el=document.createElement("div"),this.el.className="node-resizer",this.innerEl=document.createElement("div"),this.innerEl.className="node-resizer-inner",this.el.appendChild(this.innerEl),t.appendChild(this.el),this.currentDims={w:0,h:0},this.currentNodeDims={w:0,h:0},this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.moveCoords={start:{x:0,y:0},offset:{x:0,y:0}},this.innerEl.addEventListener("mousedown",this.onMouseDownBound)}var t,n,o;return t=e,(n=[{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this.onNodeResizerDown(),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){e.stopPropagation(),e.preventDefault();var t=e.x-this.moveCoords.start.x,n=e.y-this.moveCoords.start.y;this.onResizeCallback({x:t,y:n})}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"remove",value:function(){this.innerEl.removeEventListener("mousedown",this.onMouseDownBound)}}])&&Xn(t.prototype,n),o&&Xn(t,o),e}();function Zn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Qn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="camera-control-setting",this.foregroundController=n,this.label=document.createElement("h4"),this.label.innerHTML="Kamera kontroll (inaktiv)",this.el.appendChild(this.label),this.toggleEl=document.createElement("div"),this.toggleEl.className="toggle-el",this.isEnabled=!1,this.el.appendChild(this.toggleEl),this.onClickBound=this.onClick.bind(this),this.toggleEl.addEventListener("click",this.onClickBound),t.appendChild(this.el)}var t,n,o;return t=e,(n=[{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.isEnabled=!this.isEnabled,this.isEnabled?(this.toggleEl.classList.add("enabled"),this.label.innerHTML="Kamera kontroll (aktiv)"):(this.toggleEl.classList.remove("enabled"),this.label.innerHTML="Kamera kontroll (inaktiv)"),this.foregroundController.toggleCameraControl(this.isEnabled)}}])&&Zn(t.prototype,n),o&&Zn(t,o),e}();function Jn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var $n=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="axes-helper-setting",this.foregroundController=n,this.label=document.createElement("h4"),this.label.innerHTML="Visa x y z axlar (inaktiv)",this.el.appendChild(this.label),this.toggleEl=document.createElement("div"),this.toggleEl.className="toggle-el",this.isEnabled=!1,this.el.appendChild(this.toggleEl),this.onClickBound=this.onClick.bind(this),this.toggleEl.addEventListener("click",this.onClickBound),t.appendChild(this.el)}var t,n,o;return t=e,(n=[{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.isEnabled=!this.isEnabled,this.isEnabled?(this.toggleEl.classList.add("enabled"),this.label.innerHTML="Visa x y z axlar (aktiv)"):(this.toggleEl.classList.remove("enabled"),this.label.innerHTML="Visa x y z axlar (inaktiv)"),this.foregroundController.toggleAxesHelper(this.isEnabled)}}])&&Jn(t.prototype,n),o&&Jn(t,o),e}();function eo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var to=function(){function e(t,n,o,i,a,r,s){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=o,this.decimals=i,this.value=(n-a.min)/(a.max-a.min),this.settings=a,this.el=document.createElement("div"),this.el.className="horizontal-slider prevent-drag "+r;var l=document.createElement("h4");l.className="horizontal-slider-label",l.innerHTML=s,this.el.appendChild(l),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var c=document.createElement("div");c.appendChild(this.rangeInnerContainer),c.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=n;var h=document.createElement("div");h.className="value-container",h.appendChild(this.valueEl),this.el.appendChild(c),this.el.appendChild(h),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),setTimeout(function(){u.setPos(120)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,o;return t=e,(n=[{key:"remove",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e){this.value=e,this.setPos(120);var t=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=t,this.valChangeCallback&&this.valChangeCallback(t)}},{key:"getValue",value:function(){var e=this.settings;return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(".concat(t,"px, 0px, 0)")}}])&&eo(t.prototype,n),o&&eo(t,o),e}();function no(e){return(no="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function io(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ao(e,t,n){return(ao="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ro(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function ro(e){return(ro=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function so(e,t){return(so=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var uo=function(e){function t(e){var n,o,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(i=ro(t).call(this))||"object"!==no(i)&&"function"!=typeof i?io(o):i).mainRender=e,n.hasOutput=!1,n.isGraphicsNode=!0,n.hasGraphicsInput=!0,n.isCanvasNode=!0,n.initAsNotCollapsed=!0,n.inputHelpersType=St.sceneNode,n.enabledInputs=[],n.el=document.createElement("div"),n.el.className="node canvas",n.topPartEl=document.createElement("div"),n.topPartEl.className="top-part",n.el.appendChild(n.topPartEl),n.bottomPartEl=document.createElement("div"),n.bottomPartEl.className="bottom-part",n.bottomPartSettings=document.createElement("div"),n.bottomPartSettings.className="bottom-part-settings",n.bottomPartEl.appendChild(n.bottomPartSettings),n.onNodeResizerDownBound=n.onNodeResizerDown.bind(io(n)),n.onResizeFromNodeResizerBound=n.onResizeFromNodeResizer.bind(io(n)),n.nodeResizer=new Wn(n.bottomPartEl,n.onResizeFromNodeResizerBound,n.onNodeResizerDownBound),n.el.appendChild(n.bottomPartEl),n.foregroundRender=new Kn(n.mainRender,n.topPartEl),n.cameraControlSetting=new Qn(n.bottomPartSettings,n.foregroundRender),n.onAmbientLightSettingChangeBound=n.onAmbientLightSettingChange.bind(io(n)),n.ambientLightSetting=new to(n.bottomPartSettings,1,n.onAmbientLightSettingChangeBound,2,{min:0,max:1},"ambient-light","Ambient light"),n.axesHelper=new $n(n.bottomPartSettings,n.foregroundRender),n.scene=new THREE.Scene,n.renderer=n.mainRender.renderer,n.renderer.setSize(n.topPartEl.clientWidth,n.topPartEl.clientHeight),n.topPartEl.appendChild(n.renderer.domElement);var a=new THREE.PlaneGeometry(2,2),r={};r.u_res={value:new THREE.Vector2(window.innerWidth,window.innerHeight)};var s={u_connection0:{value:0}};s.u_texture0={value:new Image},s.u_connection1={value:0},s.u_texture1={value:new Image},s.u_finalConnection={value:0},s.u_multiConnection={value:0};var u=Object.assign({},r,s);return n.material=new THREE.ShaderMaterial({uniforms:u,vertexShader:y,fragmentShader:g}),n.mesh=new THREE.Mesh(a,n.material),n.scene.add(n.mesh),n}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&so(e,t)}(t,p),n=t,(o=[{key:"init",value:function(e,n,o,i,a,s,u,l){var c=this;ao(ro(t.prototype),"init",this).call(this,e,n,o,i,a,s,u,l);var h=window.innerWidth,p=window.innerHeight;this.orthoCamera=new THREE.OrthographicCamera(h/-2,h/2,p/2,p/-2,1,1e3),this.bottomPartEl.classList.add("multiple-inputs"),this.onInputClickBackgroundBound=this.onInputClickBackground.bind(this),this.onInputClickForegroundBound=this.onInputClickForeground.bind(this),this.onInputClickLightBound=this.onInputClickLight.bind(this),this.inputBackground=new r(this.bottomPartEl,this.onInputClickBackgroundBound,this.isGraphicsNode,"Bakgrund In","background"),this.inputForeground=new r(this.bottomPartEl,this.onInputClickForegroundBound,this.isGraphicsNode,"Förgrund In","foreground"),this.inputLight=new r(this.bottomPartEl,this.onInputClickLightBound,this.isGraphicsNode,"Ljus In","light"),this.inputs={background:this.inputBackground,foreground:this.inputForeground,light:this.inputLight},setTimeout(function(){c.onResize()},100),this.activateDrag()}},{key:"onAmbientLightSettingChange",value:function(e){this.foregroundRender.ambientLight.intensity=e}},{key:"onNodeResizerDown",value:function(){this.nodeResizer.currentDims.w=this.topPartEl.clientWidth,this.nodeResizer.currentDims.h=this.topPartEl.clientHeight,this.nodeResizer.currentNodeDims.w=this.el.clientWidth,this.nodeResizer.currentNodeDims.h=this.el.clientHeight}},{key:"onResizeFromNodeResizer",value:function(e){this.el.style.width=this.nodeResizer.currentNodeDims.w+e.x+"px",this.el.style.height=this.nodeResizer.currentNodeDims.h+e.y+"px",this.topPartEl.style.width=this.nodeResizer.currentDims.w+e.x+"px",this.topPartEl.style.height=this.nodeResizer.currentDims.h+e.y+"px",this.inputBackground.offsetLeft=this.inputBackground.el.offsetLeft,this.inputBackground.offsetTop=this.inputBackground.el.offsetTop,this.inputForeground.offsetLeft=this.inputForeground.el.offsetLeft,this.inputForeground.offsetTop=this.inputForeground.el.offsetTop,this.inputLight.offsetLeft=this.inputLight.el.offsetLeft,this.inputLight.offsetTop=this.inputLight.el.offsetTop,this.onResize()}},{key:"onInputClickBackground",value:function(e){this.onInputConnectionCallback(this,"background",e)}},{key:"onInputClickForeground",value:function(e){this.onInputConnectionCallback(this,"foreground",e)}},{key:"onInputClickLight",value:function(e){this.onInputConnectionCallback(this,"light",e)}},{key:"getInputEl",value:function(e){return this.inputs[e]}},{key:"getDotPos",value:function(e){return e.getBoundingClientRect()}},{key:"setBackgroundTexture",value:function(e){this.mesh.material.uniforms.u_texture0.value=e}},{key:"enableInput",value:function(e,t){if(this.inputs[t].enable(),e.isBackgroundNode){var n=e.framebuffer?e.framebuffer.texture:e.texture;this.mesh.material.uniforms.u_texture0.value=n,this.mesh.material.uniforms.u_connection0.value=1}else if(e.isForegroundNode){if(this.foregroundRender.addNode(e),1===this.foregroundRender.connectedNodes.length){var o=this.foregroundRender.framebuffer.texture;this.mesh.material.uniforms.u_texture1.value=o,this.mesh.material.uniforms.u_connection1.value=1}}else e.isLightNode&&this.foregroundRender.addLight(e);var i={out:e,type:t};this.enabledInputs.push(i),e.isLightNode||(this.mesh.material.uniforms.u_finalConnection.value=1,this.inputs.background.isActive&&this.inputs.foreground.isActive&&(this.mesh.material.uniforms.u_multiConnection.value=1))}},{key:"disableInput",value:function(e,t){"background"===t?(this.inputs[t].disable(),this.mesh.material.uniforms.u_texture0.value=null,this.mesh.material.uniforms.u_connection0.value=0,this.mesh.material.uniforms.u_multiConnection.value=0):"foreground"===t?(this.foregroundRender.removeNode(e),0===this.foregroundRender.connectedNodes.length&&(this.inputs[t].disable(),this.mesh.material.uniforms.u_texture1.value=null,this.mesh.material.uniforms.u_connection1.value=0)):"light"===t&&(this.inputs[t].disable(),this.foregroundRender.removeLight(e)),this.enabledInputs=this.enabledInputs.filter(function(t){return t.out.ID!==e.ID}),0===this.enabledInputs.filter(function(e){return!e.out.isLightNode}).length?this.mesh.material.uniforms.u_finalConnection.value=0:this.inputs.foreground.isActive||(this.mesh.material.uniforms.u_multiConnection.value=0)}},{key:"update",value:function(){this.foregroundRender.update()}},{key:"render",value:function(){this.renderer.clear(),this.foregroundRender.render(),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.orthoCamera)}},{key:"onResize",value:function(){var e=this.topPartEl.clientWidth,t=this.topPartEl.clientHeight;this.foregroundRender.onResize({w:e,h:t}),this.mesh.material.uniforms.u_res.value=new THREE.Vector2(e,t),this.orthoCamera.left=e/-2,this.orthoCamera.right=e/2,this.orthoCamera.top=t/-2,this.orthoCamera.bottom=t/2,this.orthoCamera.updateProjectionMatrix(),this.renderer.setSize(e,t)}}])&&oo(n.prototype,o),i&&oo(n,i),t}(),lo=n(27);function co(e){return(co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ho(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function po(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fo(e,t,n){return(fo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=mo(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function mo(e){return(mo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vo(e,t){return(vo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var yo=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=mo(t).call(this))||"object"!==co(o)&&"function"!=typeof o?po(n):o).el.classList.add("no-height"),e.el.classList.add("color-node"),e.isParam=!0,e.paramVals={},e.params={};var i=document.createElement("div");i.className="color-picker-parent prevent-drag";var a=document.createElement("h4");a.innerHTML="Välj färg",e.colorPreview=document.createElement("div"),e.colorPreview.className="color-preview",i.appendChild(a),i.appendChild(e.colorPreview),e.topPartEl.appendChild(i);var r={parent:i,color:"#FFFFFF",alpha:!1};return e.currentColor=void 0,e.picker=new lo.a(r),e.onPickerChangeBound=e.onPickerChange.bind(po(e)),e.picker.onChange=e.onPickerChangeBound,e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vo(e,t)}(t,jt),n=t,(o=[{key:"onPickerChange",value:function(e){var t="rgb(".concat(e._rgba[0],",").concat(e._rgba[1],",").concat(e._rgba[2],")");this.setColor(t),this.currentColor=new THREE.Color(e.rgbString);for(var n=0;n<this.currentOutConnectionsLength;n++){var o=this.currentOutConnections[n].param;this.currentOutConnections[n].in.updateParam(o,this)}}},{key:"getValue",value:function(){return this.currentColor}},{key:"setColor",value:function(e){this.colorPreview.style.background=e}},{key:"enableOutput",value:function(e,n){if(fo(mo(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length,1===this.currentOutConnectionsLength){var o="#".concat(e.defaultVal.getHexString());this.picker.color=o,this.currentColor=e.defaultVal,this.setColor(o)}}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(e){return e.in.ID!==nodeIn.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&fo(mo(t.prototype),"disableOutput",this).call(this)}}])&&ho(n.prototype,o),i&&ho(n,i),t}();function go(e){return(go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bo(e,t){return!t||"object"!==go(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Co(e){return(Co=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wo(e,t){return(wo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ko=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=bo(this,Co(t).call(this))).isLightNode=!0,e.el.classList.add("no-height"),e.light=new THREE.DirectionalLight(16777215,1),e.light.position.set(0,0,0),e.geometry=new THREE.SphereGeometry(1,10,10),e.material=new THREE.MeshBasicMaterial,e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Material",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={colorParam:n,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:4}},e.paramVals={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wo(e,t)}(t,jt),t}();function Eo(e){return(Eo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oo(e,t){return!t||"object"!==Eo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Po(e){return(Po=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xo(e,t){return(xo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _o=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Oo(this,Po(t).call(this))).isLightNode=!0,e.el.classList.add("no-height"),e.light=new THREE.PointLight(16777215,1,100),e.light.position.set(0,0,0),e.geometry=new THREE.SphereGeometry(1,20,20),e.material=new THREE.MeshBasicMaterial,e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Material",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Material",paramHelpersType:"texture",needsFrameUpdate:!1},colorParam:n,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:4},scaleParam:{title:"Scale",param:"scale",useAsInput:!0,parent:"Scale",paramHelpersType:"scale",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:1}},e.paramVals={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xo(e,t)}(t,jt),t}();function Mo(e){return(Mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function To(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ro(e,t){return!t||"object"!==Mo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function So(e,t,n){return(So="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Lo(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Lo(e){return(Lo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function No(e,t){return(No=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Io=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Ro(this,Lo(t).call(this))).isGraphicsNode=!0,e.isBackgroundNode=!0,e.currentOutConnections=[],e.el.classList.add("no-height"),e.el.classList.add("texture-selector-node"),e.texture=(new THREE.TextureLoader).load("assets/textures/blank.jpg"),e.texture.magFilter=THREE.LinearFilter,e.texture.minFilter=THREE.LinearFilter;var n=[{Rymden:[{title:"Jorden",name:"space/2k_earth_daymap.jpg"},{title:"Solen",name:"space/2k_sun.jpg"},{title:"Mars",name:"space/2k_mars.jpg"},{title:"Månen",name:"space/2k_moon.jpg"}]}];e.wrapper=document.createElement("div"),e.wrapper.className="wrapper";for(var o=0;o<n.length;o++){var i=n[o],a=function(t){var n=i[t],o=document.createElement("h4");o.innerHTML=t;var a=document.createElement("div");a.className="children-container",a.appendChild(o);for(var r=function(t){var o=document.createElement("div");o.className="child-wrapper";var i=document.createElement("h4");i.innerHTML=n[t].title,o.onclick=function(i){i.preventDefault(),i.stopPropagation(),e.onTextureSelected(n[t],o)},o.appendChild(i),a.appendChild(o)},s=0;s<n.length;s++)r(s);e.wrapper.appendChild(a)};for(var r in i)a(r)}return e.topPartEl.appendChild(e.wrapper),e.params={},e.paramVals={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&No(e,t)}(t,jt),n=t,(o=[{key:"onTextureSelected",value:function(e,t){var n="assets/textures/".concat(e.name);this.texture=(new THREE.TextureLoader).load(n);for(var o=0;o<this.currentOutConnectionsLength;o++){var i=this.currentOutConnections[o].param;this.currentOutConnections[o].in.isCanvasNode?this.currentOutConnections[o].in.setBackgroundTexture(this.texture):i&&this.currentOutConnections[o].in.updateParam(i,this)}for(var a=this.wrapper.querySelectorAll(".child-wrapper"),r=0;r<a.length;r++)a[r].classList.remove("active");t.classList.add("active")}},{key:"enableOutput",value:function(e,n){So(Lo(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&So(Lo(t.prototype),"disableOutput",this).call(this)}}])&&To(n.prototype,o),i&&To(n,i),t}();function Do(e){return(Do="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ao(e,t){return!t||"object"!==Do(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function jo(e,t,n){return(jo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Vo(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Vo(e){return(Vo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ho(e,t){return(Ho=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fo=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Ao(this,Vo(t).call(this))).isForegroundNode=!0,e.needsUpdate=!0,e.el.classList.add("no-height");window.innerWidth,window.innerHeight;e.particles=600;var n=THREE.UniformsUtils.merge([THREE.UniformsLib.lights,{diffuse:{type:"c",value:new THREE.Color(255)}}]);e.material=new THREE.ShaderMaterial({uniforms:n,vertexShader:m,fragmentShader:v,depthTest:!0,transparent:!0,vertexColors:!0}),e.geometry=new THREE.BufferGeometry;var o=[],i=[],a=[];e.currentParticleSize=2,e.currentParticleColor=[1,1,1],e.offsets=[];for(var r=0;r<e.particles;r++)o.push(2*Math.random()-1),o.push(2*Math.random()-1),o.push(2*Math.random()-1),i.push(1,1,1),a.push(e.currentParticleSize),e.offsets.push(2*Math.random()-1),e.offsets.push(2*Math.random()-1),e.offsets.push(2*Math.random()-1);e.geometry.addAttribute("position",new THREE.Float32BufferAttribute(o,3).setDynamic(!0)),e.geometry.addAttribute("color",new THREE.Float32BufferAttribute(i,3).setDynamic(!0)),e.geometry.addAttribute("size",new THREE.Float32BufferAttribute(a,1).setDynamic(!0)),e.mesh=new THREE.Points(e.geometry,e.material);var s={title:"Color",param:"color",useAsInput:!0,parent:"Material",paramHelpersType:"particleColor",needsFrameUpdate:!1,defaultVal:new THREE.Color(e.currentParticleColor[0],e.currentParticleColor[1],e.currentParticleColor[2])},u={title:"Form X",param:"x",useAsInput:!0,parent:"Form",paramHelpersType:"particleForm",needsFrameUpdate:!1,defaultVal:2*Math.random()-1},l={title:"Form Y",param:"y",useAsInput:!0,parent:"Form",paramHelpersType:"particleForm",needsFrameUpdate:!1,defaultVal:2*Math.random()-1},c={title:"Form Z",param:"z",useAsInput:!0,parent:"Form",paramHelpersType:"particleForm",needsFrameUpdate:!1,defaultVal:2*Math.random()-1},h={title:"Size",param:"storlek",useAsInput:!0,parent:"Storlek",paramHelpersType:"particleSize",needsFrameUpdate:!1,defaultVal:e.currentParticleSize,minMax:{min:1,max:10}};return e.params={colorParam:s,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},rotationXParam:{title:"Rotation x",param:"x",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},formXParam:u,formYParam:l,formZParam:c,sizeParam:h},e.paramVals={},e.curve=null,e.connectedFormParams={x:0,y:0,z:0},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ho(e,t)}(t,jt),n=t,(o=[{key:"getMesh",value:function(){return this.mesh}},{key:"enableParam",value:function(e,t){var n=this.inputParams[e.title];e.isConnected=!0,n.enable(),"Form"===e.parent&&(this.connectedFormParams[e.param]=1,this.curve=t.out.curve)}},{key:"updateParam",value:function(e,t){Me[e.paramHelpersType].update(this,t,e)}},{key:"disableParam",value:function(e,t){var n=this,o=this.inputParams[e.title];(e.isConnected=!1,o.disable(),"Form"===e.parent)&&(this.connectedFormParams[e.param]=0,Object.keys(this.connectedFormParams).some(function(e){return n.connectedFormParams[e]>0})||(this.curve=null));Me[e.paramHelpersType].disconnect(this,e,t.out)}},{key:"enableOutput",value:function(e,n){jo(Vo(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&jo(Vo(t.prototype),"disableOutput",this).call(this)}},{key:"update",value:function(){}},{key:"render",value:function(){for(var e=this.geometry.attributes.position.array,t=this.geometry.attributes.size.array,n=this.geometry.attributes.color.array,o=1===this.connectedFormParams.x,i=1===this.connectedFormParams.y,a=1===this.connectedFormParams.z,r=!!this.curve,s=this.params.formXParam.defaultVal,u=this.params.formYParam.defaultVal,l=this.params.formZParam.defaultVal,c=this.currentParticleColor[0],h=this.currentParticleColor[1],p=this.currentParticleColor[2],d=0;d<this.particles;d++){var f=d/this.particles,m=r?this.curve.getPoint(f):void 0,v=3*d;e[v]=o?m.x+this.offsets[v]:s+this.offsets[v],e[v+1]=i?m.y+this.offsets[v+1]:u+this.offsets[v+1],e[v+2]=a?m.y+this.offsets[v+2]:l+this.offsets[v+2],t[d]=this.currentParticleSize,n[v]=c,n[v+1]=h,n[v+2]=p}this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.size.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0}}])&&Bo(n.prototype,o),i&&Bo(n,i),t}();function Uo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var zo=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),V.a.Transport.bpm.value=140,V.a.Transport.start(),this.historyState={id:window.location.pathname},window.addEventListener("popstate",this.onPopStateChange.bind(this)),window.addEventListener("resize",function(){t.onResize()}),this.nodeTypes={audio:{audio:[{type:"Oscillator",obj:X},{type:"Gain",obj:ee},{type:"Filter",obj:pe},{type:"Speaker",obj:re}],synthar:[{type:"Kick",obj:Ct},{type:"FM Synth",obj:Tt}],data:[{type:"LFO",obj:Qe},{type:"Envelope",obj:ge}],triggers:[{type:"SequencerNode",obj:rt}],"Ljud analys":[{type:"Ljudvåg",obj:dt}]},graphics:{Canvas:[{type:"Canvas",obj:uo}],"3D - Shapes":[{type:"Cube",obj:bn},{type:"Sphere",obj:xn},{type:"Particles",obj:Fo}],"Procedural Texture (Material)":[{type:"Circle",obj:pn},{type:"Voronoi",obj:an},{type:"LavaNoise",obj:Qt}],Modifiers:[{type:"Color",obj:yo},{type:"ParamDriver",obj:Bn},{type:"OrbitDriver",obj:Gn}],Ljus:[{type:"Directional Light",obj:ko},{type:"Point Light",obj:_o}],Textures:[{type:"Välj Textur",obj:Io}]}},this.onNodeAddedFromLibraryBound=this.onNodeAddedFromLibrary.bind(this),this.workspaceManager=new Ge(document.body),this.onScaleChangeBound=this.onScaleChange.bind(this),this.onResize(),this.nodeLibrary=new Ve(document.body,this.nodeTypes,this.onNodeAddedFromLibraryBound,this.workspaceManager);new pe,new re,new X,new ee,new ge,new Qe;this.keyboardManager=new ze,this.onNodeActiveBound=this.onNodeActive.bind(this),this.nodeManager=new De(null,this.keyboardManager,this.onNodeActiveBound,this.workspaceManager.el)}var t,n,o;return t=e,(n=[{key:"onLogout",value:function(){this.nodeLibrary.hide(),this.workspaceManager.disable(),this.keyboardManager.disable();for(var e=this.nodeManager._nodes,t=0;t<e.length;t++)this.nodeManager.onNodeRemove(e[t])}},{key:"onLogin",value:function(){this.nodeLibrary.show(),this.workspaceManager.enable(),this.keyboardManager.enable()}},{key:"onScaleChange",value:function(e){console.log(e)}},{key:"onNodeActive",value:function(e){this.nodeSettings.show(e)}},{key:"onNodeAddedFromLibrary",value:function(e,t,n){this.nodeManager.onNodeAddedFromLibrary(e,t,n)}},{key:"onPopStateChange",value:function(e){console.log("hash change: ",e)}},{key:"pushState",value:function(e,t){window.history.pushState({id:e},"",t)}},{key:"update",value:function(){this.nodeManager.update()}},{key:"render",value:function(){this.nodeManager.render()}},{key:"onResize",value:function(e,t){this.workspaceManager.onResize(e,t)}}])&&Uo(t.prototype,n),o&&Uo(t,o),e}();function qo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}n.d(t,"default",function(){return Go});var Go=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),window.NS={},window.NS.transform=function(){var e=document.createElement("div");if(null==e.style.transform){var t=["Webkit","Moz","ms"];for(var n in t)if(void 0!==e.style[t[n]+"Transform"])return t[n]+"Transform"}return"transform"}(),window.NS.iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,this.main=new zo,this.onResize(),window.addEventListener("resize",function(){t.onResize()}),this.reqFrame()}var t,n,o;return t=e,(n=[{key:"init",value:function(){console.log("test")}},{key:"onLogout",value:function(){console.log("starter logout"),this.main.onLogout()}},{key:"onLogin",value:function(){this.main.onLogin()}},{key:"reqFrame",value:function(){var e=this;this.main.update(),this.main.render(),requestAnimationFrame(function(){e.reqFrame()})}},{key:"onResize",value:function(){var e=window.innerWidth,t=window.innerHeight;this.main.onResize(e,t)}}])&&qo(t.prototype,n),o&&qo(t,o),e}()}}]);