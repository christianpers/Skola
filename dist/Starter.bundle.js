(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,,function(e,t,n){var i=n(12);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-title {\n  width: 100%;\n  display: flex;\n  justify-content: center; }\n  .node-title .node-inner-title {\n    background: black;\n    padding: 4px;\n    display: inline-block; }\n    .node-title .node-inner-title > input {\n      text-align: center;\n      background: transparent;\n      border: 0;\n      color: yellow; }\n",""])},function(e,t,n){var i=n(14);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".canvas {\n  width: 640px;\n  height: 600px;\n  right: 0;\n  z-index: 2;\n  transform: translateY(-100%);\n  position: absolute;\n  transition: transform 0.4s; }\n  .canvas .top-part {\n    padding: 0;\n    position: relative;\n    height: 84%; }\n  .canvas .bottom-part {\n    height: 16%;\n    background: rgba(0, 0, 0, 0.7); }\n    .canvas .bottom-part .bottom-part-settings {\n      position: absolute;\n      left: 16%;\n      z-index: 1;\n      display: flex;\n      justify-content: space-between;\n      padding: 10px 5px; }\n  .canvas.visible {\n    transform: translateY(0); }\n  .canvas .bottom-label {\n    position: absolute;\n    bottom: -20px;\n    left: 0;\n    background: #0a0a0a;\n    /* color: black; */\n    /* padding: 10px; */\n    height: 20px;\n    width: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer; }\n    .canvas .bottom-label > h5 {\n      color: yellow; }\n  .canvas .camera-control-setting {\n    margin-right: 40px;\n    color: white;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n    width: 148px;\n    text-align: center; }\n    .canvas .camera-control-setting .toggle-el {\n      width: 20px;\n      height: 20px;\n      background: #323232;\n      cursor: pointer;\n      border-radius: 3px;\n      margin-top: 8px;\n      position: absolute;\n      left: 50%;\n      margin-left: -10px; }\n      .canvas .camera-control-setting .toggle-el.enabled {\n        background: yellow; }\n  .canvas .axes-helper-setting {\n    margin-left: 40px;\n    color: white;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n    width: 148px; }\n    .canvas .axes-helper-setting .toggle-el {\n      width: 20px;\n      height: 20px;\n      background: #323232;\n      cursor: pointer;\n      border-radius: 3px;\n      margin-top: 8px;\n      position: absolute;\n      left: 50%;\n      margin-left: -10px; }\n      .canvas .axes-helper-setting .toggle-el.enabled {\n        background: yellow; }\n",""])},,,,,,,,,,,,,,,,,function(e,t,n){var i=n(32);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".vertical-range-slider {\n  text-align: center; }\n  .vertical-range-slider .range-container {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding-left: 0 !important;\n    height: 120px !important; }\n    .vertical-range-slider .range-container .input-container {\n      width: 40%; }\n      .vertical-range-slider .range-container .input-container > p {\n        color: yellow;\n        font-size: 10px;\n        margin-top: 0;\n        margin-bottom: 4px;\n        text-align: left; }\n      .vertical-range-slider .range-container .input-container > input {\n        width: 100%;\n        height: 20px;\n        padding: 5px;\n        background: yellow;\n        color: black;\n        border: 0; }\n    .vertical-range-slider .range-container .range-inner-container {\n      width: 10px;\n      margin-left: 5%;\n      margin-right: 5%;\n      height: 100px;\n      background: black;\n      border: 1px solid yellow;\n      position: relative; }\n      .vertical-range-slider .range-container .range-inner-container .range-knob {\n        position: absolute;\n        top: 0;\n        left: 50%;\n        width: 20px;\n        height: 8px;\n        background: yellow;\n        margin-left: -10px; }\n  .vertical-range-slider .value-container {\n    margin-top: 18px;\n    display: inline-block; }\n    .vertical-range-slider .value-container > p {\n      color: yellow;\n      margin-bottom: 4px; }\n    .vertical-range-slider .value-container .value-display {\n      background: black;\n      color: yellow;\n      padding: 5px 10px;\n      width: 70px;\n      font-family: Arial; }\n",""])},function(e,t,n){var i=n(34);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".vertical-slider {\n  text-align: center;\n  margin-bottom: 16px;\n  border-radius: 3px;\n  color: white;\n  padding: 5px;\n  position: relative;\n  max-width: 80px; }\n  .vertical-slider .disabled-layer {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    border-radius: 8px;\n    background: black;\n    opacity: 0.8;\n    display: none;\n    z-index: 1; }\n    .vertical-slider .disabled-layer.visible {\n      display: block; }\n  .vertical-slider .vertical-slider-label {\n    position: relative;\n    z-index: 1; }\n  .vertical-slider .range-container {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding-left: 0 !important;\n    height: 80px !important; }\n    .vertical-slider .range-container .range-inner-container {\n      width: 10px;\n      margin-left: 5%;\n      margin-right: 5%;\n      height: 60px;\n      background: black;\n      position: relative;\n      border: 1px solid yellow; }\n      .vertical-slider .range-container .range-inner-container .range-knob {\n        position: absolute;\n        top: -8px;\n        left: 50%;\n        width: 32px;\n        height: 16px;\n        background: black;\n        margin-left: -16px;\n        border: 1px solid yellow; }\n  .vertical-slider .value-container {\n    display: inline-block;\n    text-align: center; }\n    .vertical-slider .value-container > p {\n      color: yellow;\n      margin-bottom: 4px;\n      text-align: left; }\n    .vertical-slider .value-container .value-display {\n      color: yellow;\n      padding: 5px 10px;\n      width: 70px;\n      font-family: Arial; }\n",""])},function(e,t,n){var i=n(36);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".dropdown {\n  width: 140px;\n  height: 70px;\n  position: relative;\n  overflow: hidden; }\n  .dropdown > h4 {\n    padding-left: 3px;\n    margin-bottom: 10px; }\n  .dropdown > .upper-row-container {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 0px;\n    border-bottom: 2px solid yellow;\n    padding-bottom: 6px;\n    align-items: flex-end;\n    padding-left: 3px;\n    padding-right: 3px; }\n    .dropdown > .upper-row-container > .reset-btn {\n      background: yellow;\n      padding: 4px;\n      border-radius: 3px;\n      cursor: pointer; }\n      .dropdown > .upper-row-container > .reset-btn > h5 {\n        color: black; }\n  .dropdown .selected-container {\n    margin-top: 10px;\n    margin-bottom: 13px; }\n    .dropdown .selected-container > h4 {\n      padding: 3px 4px; }\n  .dropdown .list-container {\n    width: calc(100% - 30px);\n    height: auto;\n    background: yellow; }\n    .dropdown .list-container .list-item {\n      padding: 4px 4px;\n      cursor: pointer;\n      position: relative; }\n      .dropdown .list-container .list-item > h4 {\n        color: black; }\n      .dropdown .list-container .list-item > .touch-layer {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%; }\n      .dropdown .list-container .list-item.selected {\n        background: black; }\n        .dropdown .list-container .list-item.selected > h4 {\n          color: yellow; }\n      .dropdown .list-container .list-item:hover {\n        background: black; }\n        .dropdown .list-container .list-item:hover > h4 {\n          color: yellow; }\n  .dropdown .arrow-toggle-container {\n    width: 20px;\n    height: 20px;\n    position: absolute;\n    right: 9px;\n    bottom: 12px;\n    background: black;\n    cursor: pointer; }\n    .dropdown .arrow-toggle-container > img {\n      transition: transform .2s; }\n  .dropdown.open {\n    overflow: initial; }\n    .dropdown.open .arrow-toggle-container > img {\n      transform: rotate(180deg); }\n",""])},function(e,t,n){var i=n(38);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-settings.orbit-driver-node {\n  flex-direction: column; }\n  .node-settings.orbit-driver-node .slider-row {\n    width: 100%;\n    display: flex;\n    justify-content: center; }\n    .node-settings.orbit-driver-node .slider-row .vertical-slider {\n      margin-right: 10px; }\n      .node-settings.orbit-driver-node .slider-row .vertical-slider:last-child {\n        margin-right: 0; }\n  .node-settings.orbit-driver-node .visual-helper-settings {\n    padding: 5px; }\n    .node-settings.orbit-driver-node .visual-helper-settings .toggle-visibility {\n      width: 20px;\n      height: 20px;\n      background: yellow;\n      margin-top: 10px;\n      cursor: pointer;\n      opacity: 0.4;\n      border-radius: 4px; }\n      .node-settings.orbit-driver-node .visual-helper-settings .toggle-visibility.enabled {\n        opacity: 1; }\n  .node-settings.orbit-driver-node .center-point-settings {\n    padding: 5px;\n    margin-left: 40px; }\n  .node-settings.orbit-driver-node .toggle-start {\n    color: black;\n    display: block;\n    background: yellow;\n    padding: 6px 20px;\n    border-radius: 4px;\n    margin-top: 50px; }\n    .node-settings.orbit-driver-node .toggle-start > h4 {\n      color: black; }\n",""])},function(e,t,n){var i=n(40);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-settings.rotation-driver-node {\n  flex-direction: column; }\n  .node-settings.rotation-driver-node .slider-row {\n    width: 100%;\n    display: flex;\n    justify-content: center; }\n    .node-settings.rotation-driver-node .slider-row .vertical-slider {\n      margin-right: 10px; }\n      .node-settings.rotation-driver-node .slider-row .vertical-slider:last-child {\n        margin-right: 0; }\n  .node-settings.rotation-driver-node .toggle-start {\n    color: black;\n    display: block;\n    background: yellow;\n    padding: 6px 20px;\n    border-radius: 4px; }\n    .node-settings.rotation-driver-node .toggle-start > h4 {\n      color: black; }\n",""])},,,,function(e,t,n){var i=n(45);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-settings.shape-modifier-node {\n  flex-direction: column; }\n  .node-settings.shape-modifier-node .slider-row {\n    width: 100%;\n    display: flex;\n    justify-content: center; }\n    .node-settings.shape-modifier-node .slider-row .vertical-slider {\n      margin-right: 10px; }\n      .node-settings.shape-modifier-node .slider-row .vertical-slider:last-child {\n        margin-right: 0; }\n  .node-settings.shape-modifier-node .visual-helper-settings {\n    padding: 5px; }\n    .node-settings.shape-modifier-node .visual-helper-settings .toggle-visibility {\n      width: 20px;\n      height: 20px;\n      background: yellow;\n      margin-top: 10px;\n      cursor: pointer;\n      opacity: 0.4;\n      border-radius: 4px; }\n      .node-settings.shape-modifier-node .visual-helper-settings .toggle-visibility.enabled {\n        opacity: 1; }\n  .node-settings.shape-modifier-node .center-point-settings {\n    padding: 5px;\n    margin-left: 40px; }\n  .node-settings.shape-modifier-node .toggle-start {\n    color: black;\n    display: block;\n    background: yellow;\n    padding: 6px 20px;\n    border-radius: 4px;\n    margin-top: 50px; }\n    .node-settings.shape-modifier-node .toggle-start > h4 {\n      color: black; }\n",""])},function(e,t,n){var i=n(47);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".connection-window {\n  position: absolute;\n  top: 300px;\n  left: 0;\n  height: 146px;\n  width: 30px;\n  opacity: .2;\n  z-index: 2; }\n  .connection-window.visible {\n    width: auto;\n    z-index: 3; }\n    .connection-window.visible .content-container {\n      display: flex; }\n    .connection-window.visible .close-btn {\n      display: block; }\n  .connection-window.has-params {\n    opacity: 1; }\n  .connection-window .close-btn {\n    display: none;\n    position: absolute;\n    right: 10px;\n    top: -16px;\n    color: white;\n    cursor: pointer; }\n  .connection-window .title {\n    transform: rotate(90deg);\n    transform-origin: left center;\n    position: absolute;\n    top: -8px;\n    left: 13px;\n    white-space: nowrap;\n    padding: 0 0px 4px 13px; }\n  .connection-window .content-container {\n    display: none;\n    align-items: center;\n    padding-top: 30px;\n    padding-bottom: 30px;\n    padding-left: 40px;\n    padding-right: 40px;\n    background: black; }\n  .connection-window .param-item-container {\n    margin-right: 20px; }\n    .connection-window .param-item-container p {\n      color: yellow;\n      margin-bottom: 4px; }\n    .connection-window .param-item-container:last-child {\n      margin-right: 0; }\n    .connection-window .param-item-container .connect-btn {\n      background: yellow;\n      margin-top: 10px;\n      display: inline-block;\n      padding: 4px 6px;\n      cursor: pointer; }\n      .connection-window .param-item-container .connect-btn > h5 {\n        color: black; }\n      .connection-window .param-item-container .connect-btn.not-allowed {\n        opacity: 0.2;\n        cursor: default; }\n  .connection-window .connected-nodes-container {\n    margin-top: 20px; }\n",""])},function(e,t,n){var i=n(49);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-remove {\n  cursor: pointer;\n  background: yellow;\n  padding: 4px 10px;\n  position: absolute;\n  transform: translateY(22px);\n  right: 43px;\n  top: -22px;\n  transition: transform .3s; }\n  .node-remove > h5 {\n    color: black; }\n  .node-remove.visible {\n    transform: translateY(0); }\n",""])},function(e,t,n){var i=n(51);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-settings-window {\n  position: absolute;\n  top: 100px;\n  left: 0;\n  height: 110px;\n  width: 30px;\n  opacity: .2;\n  z-index: 2; }\n  .node-settings-window.has-settings {\n    opacity: 1; }\n  .node-settings-window.visible {\n    width: auto;\n    z-index: 3; }\n    .node-settings-window.visible .node-settings {\n      display: flex; }\n    .node-settings-window.visible .close-btn {\n      display: block; }\n  .node-settings-window .close-btn {\n    display: none;\n    position: absolute;\n    right: 10px;\n    top: -16px;\n    color: white;\n    cursor: pointer; }\n  .node-settings-window .title {\n    transform: rotate(90deg);\n    transform-origin: left center;\n    position: absolute;\n    top: -8px;\n    left: 13px;\n    white-space: nowrap;\n    padding: 0 0px 4px 13px;\n    z-index: 2; }\n  .node-settings-window .node-settings {\n    display: none;\n    align-items: center;\n    padding-top: 30px;\n    padding-bottom: 30px;\n    padding-left: 40px;\n    padding-right: 40px;\n    background: black;\n    min-width: 160px;\n    position: relative; }\n    .node-settings-window .node-settings.color-node {\n      margin-left: 30px; }\n      .node-settings-window .node-settings.color-node .color-preview {\n        width: 10px;\n        height: 10px;\n        background: white;\n        margin-left: 10px;\n        cursor: pointer; }\n    .node-settings-window .node-settings.param-driver-node {\n      flex-direction: column; }\n      .node-settings-window .node-settings.param-driver-node .top-bottom-container {\n        display: flex;\n        justify-content: space-between;\n        margin-top: 14px;\n        align-items: flex-end; }\n      .node-settings-window .node-settings.param-driver-node .duration-container > p {\n        color: yellow;\n        font-size: 10px;\n        margin-top: 0;\n        margin-bottom: 4px;\n        text-align: left; }\n      .node-settings-window .node-settings.param-driver-node .duration-container > input {\n        width: 100%;\n        height: 20px;\n        padding: 12px 3px;\n        background: yellow;\n        color: black;\n        border: 0; }\n      .node-settings-window .node-settings.param-driver-node .toggle-start {\n        padding: 5px;\n        color: yellow;\n        background: black;\n        border: 1px solid yellow;\n        cursor: pointer;\n        margin-left: 10px; }\n        .node-settings-window .node-settings.param-driver-node .toggle-start > p {\n          text-align: center;\n          color: yellow; }\n        .node-settings-window .node-settings.param-driver-node .toggle-start:hover {\n          background: yellow; }\n          .node-settings-window .node-settings.param-driver-node .toggle-start:hover > p {\n            color: black; }\n",""])},function(e,t,n){var i=n(53);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".tab-item {\n  background: yellow;\n  margin-right: 2px;\n  padding: 4px 10px;\n  position: relative; }\n  .tab-item.selected .touch-layer {\n    background: transparent; }\n  .tab-item .tab-title {\n    color: black; }\n  .tab-item .touch-layer {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.6); }\n",""])},function(e,t,n){var i=n(55);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-selection {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  display: flex;\n  z-index: 3; }\n",""])},function(e,t,n){var i=n(57);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".group-container {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 400px;\n  height: 400px;\n  background: black; }\n",""])},function(e,t,n){var i=n(59);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-library {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 260px;\n  height: 100vh;\n  padding-left: 20px;\n  padding-right: 10px;\n  background: #0a0a0a;\n  z-index: 2;\n  transform: translateX(240px);\n  transition: transform .4s; }\n  .node-library .outer-scroll {\n    height: 100vh;\n    overflow: scroll; }\n  .node-library .title-bar {\n    position: fixed;\n    top: 50%;\n    left: -35px;\n    transform: rotate(90deg);\n    color: white; }\n  .node-library.showing {\n    transform: translateX(0); }\n  .node-library .inner-scroll {\n    height: 100%; }\n  .node-library .level-title {\n    border-bottom: 1px solid #3c3c3c;\n    margin-top: 10px;\n    color: #d2d2d2;\n    text-transform: capitalize; }\n  .node-library .level-1 {\n    margin-left: 10px; }\n  .node-library .node-container {\n    display: flex;\n    margin-top: 24px;\n    flex-wrap: wrap; }\n  .node-library .library-node {\n    margin-right: 2%;\n    padding: 5px;\n    display: flex;\n    flex-direction: column;\n    position: relative;\n    cursor: pointer;\n    margin-bottom: 30px; }\n    .node-library .library-node.modifier {\n      padding-bottom: 10px; }\n    .node-library .library-node .node-type {\n      color: #d2d2d2;\n      position: absolute;\n      top: -15px;\n      left: 0;\n      font-size: 8px; }\n    .node-library .library-node > img {\n      width: 20px;\n      height: 20px;\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      opacity: 0.6; }\n    .node-library .library-node .node-add {\n      width: 30px;\n      align-self: center;\n      margin-top: 5px; }\n",""])},function(e,t,n){var i=n(61);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".status-window {\n  position: absolute;\n  top: 0;\n  left: 300px;\n  padding: 10px 14px;\n  background: black;\n  color: yellow;\n  cursor: pointer;\n  z-index: 2; }\n  .status-window > h4 {\n    color: yellow; }\n  .status-window > p > span {\n    font-style: italic;\n    color: yellow; }\n  .status-window.unsaved > p > span {\n    color: red; }\n",""])},function(e,t,n){var i=n(63);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".delete-view {\n  position: absolute;\n  bottom: 50px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 48px;\n  opacity: 0;\n  transition: opacity 0.2s;\n  z-index: 2; }\n  .delete-view > img {\n    width: 100%; }\n  .delete-view.visible {\n    opacity: 1; }\n",""])},function(e,t,n){var i=n(65);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".verification-dialog {\n  position: fixed;\n  height: 100vh;\n  width: 100vw;\n  background: rgba(0, 0, 0, 0.8);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 4;\n  top: 0;\n  left: 0; }\n  .verification-dialog.hidden {\n    display: none; }\n  .verification-dialog .inner-content {\n    padding: 30px 60px;\n    background: black; }\n    .verification-dialog .inner-content > h4 {\n      margin-bottom: 20px; }\n    .verification-dialog .inner-content > button {\n      background: yellow;\n      border: 0;\n      padding: 10px 16px;\n      margin-right: 10px;\n      cursor: pointer; }\n      .verification-dialog .inner-content > button:last-child {\n        margin-right: 0; }\n      .verification-dialog .inner-content > button > h5 {\n        color: black; }\n",""])},function(e,t,n){var i=n(67);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".drawings-window {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  background: rgba(0, 0, 0, 0.8);\n  z-index: 3;\n  display: flex;\n  justify-content: center;\n  align-items: center; }\n  .drawings-window.hide {\n    display: none; }\n  .drawings-window .drawings-outer-content {\n    padding-top: 40px;\n    min-width: 400px; }\n    .drawings-window .drawings-outer-content > h4 {\n      margin-bottom: 4px;\n      background: white;\n      color: black;\n      padding: 2px 4px;\n      display: inline-block; }\n    .drawings-window .drawings-outer-content .new-drawing {\n      padding: 20px;\n      background: white;\n      margin-top: 4px;\n      cursor: pointer;\n      position: relative; }\n      .drawings-window .drawings-outer-content .new-drawing:hover {\n        background: rgba(255, 255, 255, 0.94); }\n      .drawings-window .drawings-outer-content .new-drawing .init-container > h4 {\n        text-align: center;\n        color: black; }\n      .drawings-window .drawings-outer-content .new-drawing > .data-container {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: white;\n        display: none;\n        justify-content: center;\n        align-items: center; }\n        .drawings-window .drawings-outer-content .new-drawing > .data-container.visible {\n          display: flex; }\n        .drawings-window .drawings-outer-content .new-drawing > .data-container .input-title-container {\n          display: flex; }\n          .drawings-window .drawings-outer-content .new-drawing > .data-container .input-title-container > input {\n            border: none;\n            background: black;\n            color: white;\n            padding: 4px 6px;\n            font-size: 14px;\n            margin-right: 4px; }\n          .drawings-window .drawings-outer-content .new-drawing > .data-container .input-title-container > button {\n            margin-left: 4px;\n            background: black;\n            border: 0;\n            border-radius: 0;\n            color: white; }\n  .drawings-window .drawings-window-content-wrapper {\n    padding: 20px;\n    background: white; }\n    .drawings-window .drawings-window-content-wrapper > h4 {\n      color: black;\n      text-align: center; }\n    .drawings-window .drawings-window-content-wrapper .drawings-item {\n      padding: 20px;\n      margin-bottom: 10px;\n      background: rgba(0, 0, 0, 0.03);\n      cursor: pointer;\n      position: relative; }\n      .drawings-window .drawings-window-content-wrapper .drawings-item:hover {\n        background: rgba(0, 0, 0, 0.08); }\n      .drawings-window .drawings-window-content-wrapper .drawings-item:last-child {\n        margin-bottom: 0; }\n      .drawings-window .drawings-window-content-wrapper .drawings-item > h4 {\n        margin-bottom: 6px;\n        background: black;\n        padding: 2px 4px;\n        display: inline-block; }\n      .drawings-window .drawings-window-content-wrapper .drawings-item > h5 {\n        color: black;\n        margin-bottom: 2px; }\n      .drawings-window .drawings-window-content-wrapper .drawings-item > .click-cover {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%; }\n      .drawings-window .drawings-window-content-wrapper .drawings-item .delete-btn {\n        position: absolute;\n        top: 10px;\n        right: 10px;\n        background: red;\n        color: white;\n        padding: 6px 8px;\n        cursor: pointer; }\n",""])},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t);var o=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="node-param node-component",this.ID=o,this.param=n,this.isConnected=!1,this.connectionAllowed=!0,this.paramContainer=i,this.labelEl=document.createElement("p"),this.labelEl.className="label",this.labelEl.innerHTML=n.param,this.el.appendChild(this.labelEl),t.appendChild(this.el),window.NS.singletons.ConnectionsManager.addParam(this)}var t,n,o;return t=e,(n=[{key:"enable",value:function(){this.el.classList.add("active"),this.isConnected=!0}},{key:"disable",value:function(){this.el.classList.remove("active"),this.isConnected=!1}},{key:"activateNotPossible",value:function(){this.el.classList.add("not-possible")}},{key:"deactivateNotPossible",value:function(){this.el.classList.remove("not-possible")}},{key:"setConnectionAllowed",value:function(e){this.connectionAllowed=e}}])&&i(t.prototype,n),o&&i(t,o),e}(),a=function(e){return e.framebuffer||e.texture},s=function(e){return!!e.picker},r=function(e,t,n){return!(e.framebuffer||e.texture||e.picker||e.isSequencer)&&(!e.isShapeNode&&(!!n&&(!!n.minMax&&(e.isParam&&!n.isConnected||e.isAnalyser&&!n.isConnected))))},l=function(e,t,n){e.mesh.position[t.param]=t.defaultVal},u=function(){},c={particleColor:{update:function(e,t){e.currentParticleColor=t.currentColor.toArray()},isValid:s,disconnect:function(e,t){e.currentParticleColor=t.defaultVal.toArray()}},particleSize:{update:function(e,t){e.currentParticleSize=t.getValue()},isValid:function(e,t,n){return!!n&&!!n.minMax&&(e.returnsSingleNumber&&!n.isConnected||e.isAnalyser&&!n.isConnected)},disconnect:function(e,t){e.currentParticleSize=t.defaultVal}},particleForm:{update:u,isValid:function(e){return e.isShapeNode},disconnect:u},particle:{update:u,isValid:r,disconnect:u},target:{update:function(e,t){e.targetPosition=t.mesh.position},isValid:function(e){return!!e.mesh},disconnect:function(e,t,n){t.defaultVal=n.mesh.position}},texture:{update:function(e,t){e.material.needsUpdate=!0,e.material.map=t.framebuffer?t.framebuffer.texture:t.texture},isValid:a,disconnect:function(e){e.material.needsUpdate=!0,e.material.map=null}},normalMap:{update:function(e,t){e.material.normalMap=t.framebuffer.texture,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0},isValid:a,disconnect:function(e){e.material.normalMap=null,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0}},bumpMap:{update:function(e,t){e.material.displacementMap=t.framebuffer.texture,e.material.displacementScale=.1,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0},isValid:a,disconnect:function(e){e.material.displacementMap=null,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0}},color:{update:function(e,t){e.material.color=t.currentColor},isValid:s,disconnect:l},position:{update:function(e,t,n){e.mesh.position[n.param]=t.getValue(n)},isValid:r,disconnect:l},rotation:{update:function(e,t,n){e.mainMesh.rotation[n.param]=t.getValue(n)},isValid:r,disconnect:l},scale:{update:function(e,t,n){var i=t.getValue();e.mesh.scale.set(i,i,i)},isValid:r,disconnect:function(e,t,n){e.mesh.scale.set(1,1,1)}},shaderParam:{update:function(e,t,n){e.mesh.material.uniforms[n.param].value=t.getValue()},isValid:r,disconnect:l},light:{update:function(e,t,n){var i=t.getValue(n);e.mesh.position[n.param]=i,e.light.position[n.param]=i},isValid:r,disconnect:l}};function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var h=function(){function e(t,n,i,a,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="node-param-container",this.pos=new THREE.Vector2,this.ID=s?s.paramContainerID:a,this.onConnectionUpdateBound=this.onConnectionUpdate.bind(this),document.documentElement.addEventListener("node-connections-update",this.onConnectionUpdateBound),this.rotation=0,this.node=i,this.nodeID=i.ID,this.paramObj=n,this.inputParams=[],this.isDisabledForConnection=!1,this.connectedNodes=[];var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("width","40px"),r.setAttribute("height","40px"),r.setAttribute("viewBox","0 0 24 24");var l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","M23.677 18.52c.914 1.523-.183 3.472-1.967 3.472h-19.414c-1.784 0-2.881-1.949-1.967-3.472l9.709-16.18c.891-1.483 3.041-1.48 3.93 0l9.709 16.18z"),r.appendChild(l),this.connectionPlaceHolder=r,this.el.appendChild(this.connectionPlaceHolder),this.paramContainer=document.createElement("div"),this.paramContainer.className="inner-param-container",this.parentLabel=document.createElement("h5"),this.parentLabel.innerHTML=n.parent,this.parentTitle=n.parent,this.paramContainer.appendChild(this.parentLabel),this.detailParamContainer=document.createElement("div"),this.detailParamContainer.className="detail-param-container",this.el.appendChild(this.paramContainer),this.el.appendChild(this.detailParamContainer),t.appendChild(this.el),this.currentModifierChildren=[];for(var u=0;u<n.children.length;u++){var c=s?s.inputParams[u]:"param-"+Math.random().toString(36).substr(2,9),d=new o(this.detailParamContainer,n.children[u],this,c);this.inputParams[n.children[u].title]=d}}var t,n,i;return t=e,(n=[{key:"setRotation",value:function(e,t){this.el.style.transform="rotate(".concat(e,"deg)"),this.el.classList.add("angle-".concat(t)),this.rotation=e}},{key:"setTextRotation",value:function(e,t){var n=(e.x+t.x)/2,i=(e.y+t.y)/2;Math.abs(Math.atan2(i,n))>1.8&&(this.parentLabel.style.transform="rotate(180deg)",this.detailParamContainer.style.transform="rotate(180deg)")}},{key:"getPos",value:function(){var e=this.connectionPlaceHolder.getBoundingClientRect();return this.pos.set(e.x+e.width/2,e.y+e.height/2),this.pos}},{key:"getCleanPos",value:function(){return this.connectionPlaceHolder.getBoundingClientRect()}},{key:"addModifierAsChild",value:function(e){this.currentModifierChildren.push({id:e.node.ID,modifier:e})}},{key:"removeModifierAsChild",value:function(e){this.currentModifierChildren.find(function(t){return t.id===e}).modifier&&this.currentModifierChildren.filter(function(t){return t.id!==e})}},{key:"isAvailableForConnection",value:function(e,t){for(var n=Object.keys(this.inputParams),i=0;i<n.length;i++){var o=n[i],a=this.inputParams[o];if(c[a.param.paramHelpersType].isValid(e,t,a.param))return!0}return!1}},{key:"setAsEnabled",value:function(){this.el.style.opacity=1,this.isDisabledForConnection=!1}},{key:"setAsDisabled",value:function(){this.el.style.opacity=.1,this.isDisabledForConnection=!0}},{key:"onConnectionUpdate",value:function(e){var t=this,n=e.detail,i=(this.node.ID in n?n[this.node.ID]:[]).filter(function(e){return e.paramContainerID===t.ID});this.connectedNodes=[];for(var o=0;o<i.length;o++){var a=i[o].outNodeID,s=window.NS.singletons.ConnectionsManager.nodes[a];this.connectedNodes.push(s)}}}])&&d(t.prototype,n),i&&d(t,i),e}();function p(e){throw new Error('"'+e+'" is read-only')}function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var v=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.params=n,this.paramContainers=[],this.inputParams=[],this.node=i,this.nodeConfig=o,this.parentEl.classList.add("nonagon-node"),this.size=200;var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("width","".concat(this.size,"px")),a.setAttribute("height","".concat(this.size,"px")),a.setAttribute("viewBox","0 0 ".concat(this.size," ").concat(this.size)),this.nonagonSvg=a,t.appendChild(a),this.initParams()}var t,n,i;return t=e,(n=[{key:"initParams",value:function(){var e=this,t=[];for(var n in this.params)this.params[n].useAsInput&&this.params[n].parent&&function(){var i=e.params[n].parent;if(t.some(function(e){return e.parent===i})){t.find(function(e){return e.parent===i}).children.push(e.params[n])}else{var o={parent:i,children:[]};t.push(o),o.children.push(e.params[n])}}();if(t.length>0)for(var i=0;i<t.length;i++){var o=t[i],a=Math.random().toString(36).substr(2,9),s=this.nodeConfig?this.nodeConfig.data.paramContainers[i]:null,r=new h(this.parentEl,o,this.node,a,s);this.paramContainers.push(r)}else{var l=0;for(var u in this.params){new h(this.parentEl,l);p("index"),l++}}for(var c=360/t.length,d=t.length,f=this.size/2,v=2*Math.PI/d,m=[],g=0;g<d;g++){var y={x:f*Math.cos(v*g),y:f*Math.sin(v*g)};m.push(y);var b=g*c+c/2;this.paramContainers[g].setRotation(b,g)}for(var w="M ".concat(m[0].x," ").concat(m[0].y),C=1;C<m.length;C++)w+=" L ".concat(m[C].x," ").concat(m[C].y);w+="Z";var k=document.createElementNS("http://www.w3.org/2000/svg","g");k.setAttribute("transform","translate(".concat(this.size/2,", ").concat(this.size/2,") rotate(-90)")),k.setAttribute("width","".concat(this.size)),k.setAttribute("height","".concat(this.size));var E=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttribute("d",w),E.setAttribute("stroke","black"),k.appendChild(E);for(var N=["rgb(61, 63, 67)","rgb(48, 50, 54)","rgb(36, 37, 41)","rgb(84, 86, 95)","rgb(72, 74, 81)"],x=0;x<m.length;x++){var S=document.createElementNS("http://www.w3.org/2000/svg","path"),M=x,D=x+1<m.length?x+1:0,P=m[M],T=m[D];this.paramContainers[x].setTextRotation(P,T);var O="M ".concat(P.x," ").concat(P.y," L 0 0 L ").concat(T.x," ").concat(T.y);S.setAttribute("fill",N[x%5]),S.setAttribute("d",O),k.appendChild(S);var I=document.createElementNS("http://www.w3.org/2000/svg","path"),L="M ".concat(P.x," ").concat(P.y," ").concat(T.x," ").concat(T.y);I.setAttribute("class","outline"),I.setAttribute("d",L),k.appendChild(I)}this.nonagonSvg.appendChild(k)}},{key:"setActive",value:function(){this.parentEl.style.transform="scale(1)"}},{key:"setInactive",value:function(){this.parentEl.style.transform="scale(.6)"}},{key:"getEnabledParamsForType",value:function(e,t){for(var n=t,i=this.paramContainers.find(function(t){return t.parentTitle===e}),o=Object.keys(i.inputParams),a=o.length,s=0;s<a;s++)i.inputParams[o[s]].isConnected&&(n[i.inputParams[o[s]].param.param]={enabled:!0,paramID:i.inputParams[o[s]].ID});return n}}])&&f(t.prototype,n),i&&f(t,i),e}();function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.paramContainers=[],this.triangleSvg=null,this.node=o,this.containerEl=n,this.isConnected=!1,this.assignedParamContainer=null,this.pos=new THREE.Vector2,this.parentEl.classList.add("triangle-node");var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.classList.add("modifier"),a.setAttribute("width","40px"),a.setAttribute("height","40px"),a.setAttribute("viewBox","0 0 24 24");var s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d","M23.677 18.52c.914 1.523-.183 3.472-1.967 3.472h-19.414c-1.784 0-2.881-1.949-1.967-3.472l9.709-16.18c.891-1.483 3.041-1.48 3.93 0l9.709 16.18z"),a.appendChild(s),this.triangleSvg=a,n.appendChild(a),this.latestAngle=0}var t,n,i;return t=e,(n=[{key:"getPos",value:function(){var e=this.parentEl.getBoundingClientRect();return this.pos.set(e.x+e.width/2,e.y+e.height/2),this.pos}},{key:"setAngle",value:function(e){this.containerEl.style.transform="rotate(".concat(e,"deg)"),this.latestAngle=e}},{key:"activateAsChild",value:function(e,t){this.containerEl.style.transform="rotate(0deg)",this.isConnected=!0,this.assignedParamContainer=e,e.addModifierAsChild(this),this.node.setAsChildToParamContainer(e,t)}},{key:"deactivateAsChild",value:function(e,t){this.setAngle(this.latestAngle),this.isConnected=!1,this.assignedParamContainer.removeModifierAsChild(this.node.ID),this.node.setAsNotChildToParamContainer(this.assignedParamContainer,e,t),this.assignedParamContainer=null}},{key:"hide",value:function(){this.containerEl.style.opacity=0}},{key:"show",value:function(){this.containerEl.style.opacity=1}},{key:"removeNodeFromDom",value:function(){this.assignedParamContainer.el.removeChild(this.node.el)}}])&&m(t.prototype,n),i&&m(t,i),e}();n(11);function y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var b=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.node=n;var i=document.createElement("div");i.className="node-title prevent-drag";var o=document.createElement("div");o.className="node-inner-title",i.appendChild(o),document.createElement("h4").innerHTML="Node Title",this.onChangeBound=this.onChange.bind(this),this.onMouseDownBound=this.mouseDown.bind(this),this.el=document.createElement("input"),this.el.type="text",this.el.value=n.title,this.el.addEventListener("change",this.onChangeBound),this.el.addEventListener("click",this.onMouseDownBound),o.appendChild(this.el),t.appendChild(i)}var t,n,i;return t=e,(n=[{key:"mouseDown",value:function(e){console.log("sdfsdf"),e.stopPropagation()}},{key:"blurInput",value:function(){this.el.blur()}},{key:"isValidInput",value:function(e){return!0}},{key:"onChange",value:function(e){var t=this.el.value;console.log("on change: ",t),this.isValidInput(t)?this.node.setTitle(t):this.el.value=this.node.title}}])&&y(t.prototype,n),i&&y(t,i),e}(),w=(firebase.firestore(),function(e,t,n){var i=Object.assign({},e,{timestamp:firebase.firestore.FieldValue.serverTimestamp()});return n?window.NS.singletons.refs.getNodeRef(t).update(i):(window.NS.singletons.StatusWindow.addEvent({id:t,saveData:i}),new Promise(function(e){e()}))}),C=firebase.firestore(),k=function(e){return window.NS.singletons.refs.getDrawingRef().collection("Nodes").doc(e)},E=function(e){return new Promise(function(t,n){window.NS.singletons.refs.getUserRef().collection("Drawings").doc(e).collection("Nodes").get().then(function(n){var i={};i[e]=[],n.forEach(function(t){i[e].push({id:t.id,data:t.data()})}),t(i)}).catch(function(e){n(e)})})};function N(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var x=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hasOutput=!0,this.isGraphicsNode=!1,this.isLightNode=!1,this.hasGraphicsInput=!1,this.needsUpdate=!1,this.hasMultipleOutputs=!1,this.returnsSingleNumber=!1,this.isShapeNode=!1,this.title="Enter node title",this.onConnectionAddBound=this.onConnectionAdd.bind(this),this.onConnectionRemoveBound=this.onConnectionRemove.bind(this),document.documentElement.addEventListener("param-connections-add",this.onConnectionAddBound),document.documentElement.addEventListener("param-connections-remove",this.onConnectionRemoveBound)}var t,n,i;return t=e,(n=[{key:"init",value:function(e,t,n,i,o,a,s,r,l,u,c,d){var h,p,f=this;if(this.initNodeConfig=!!a,this.ID=this.initNodeConfig?a.id:"temp__"+Math.random().toString(36).substr(2,9),this.onDisconnectCallback=n,this.onInputConnectionCallback=i,this.hasActiveInput=!1,this.type=o,this.onNodeRemove=s,this.isModifier=r,this.onNodeDragStart=l,this.onNodeDragMove=u,this.onNodeDragRelease=c,this.addCallback=d,this.groupState={isInGroup:!1,isShowing:!1},this.parentEl=t,this.connectedNodes=[],this.visualSettings=null,this.innerContainer=document.createElement("div"),this.innerContainer.className="node-inner",this.el.appendChild(this.innerContainer),this.groupHideLayer=document.createElement("div"),this.groupHideLayer.classList.add("group-hide-layer"),this.el.appendChild(this.groupHideLayer),this.isModifier||(this.upperContainer=document.createElement("div"),this.upperContainer.className="node-upper",this.el.appendChild(this.upperContainer)),this.lastDelta={x:0,y:0},this.localDelta={x:0,y:0},this.parentEl.appendChild(this.el),this.onRemoveClickBound=this.onRemoveClick.bind(this),this.isCanvasNode||(this.isModifier?this.el.classList.add("modifier-node"):(this.initNodeConfig&&(this.title=a.data.title),this.nodeTitle=new b(this.upperContainer,this)),this.nodeType=this.isModifier?new g(this.el,this.innerContainer,this.params,this):new v(this.innerContainer,this.params,this,a)),this.moveCoords={start:{x:0,y:0},offset:{x:e.x,y:e.y}},this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0)"),this.initNodeConfig){var m=k(this.ID);window.NS.singletons.refs.addNodeRef(m),window.NS.singletons.ConnectionsManager.addNode(this),this.nodeCreated(a)}else{var y={type:o,title:this.title,pos:e};y=this.isModifier?Object.assign({},y,{paramConnections:[]}):Object.assign({},y),(h=y,p=Object.assign({},h,{timestamp:firebase.firestore.FieldValue.serverTimestamp()}),window.NS.singletons.refs.getDrawingRef().collection("Nodes").add(p)).then(function(e){if(f.ID=e.id,window.NS.singletons.ConnectionsManager.addNode(f),e)window.NS.singletons.refs.addNodeRef(e);else{var t=k(f.ID);window.NS.singletons.refs.addNodeRef(t)}f.nodeCreated()}).catch(function(){console.log("err creating node in db")})}this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.activateDrag()}},{key:"onNodeDisconnectFromNonagonDelete",value:function(){this.nodeType.deactivateAsChild({x:0,y:0},!0)}},{key:"nodeCreated",value:function(e){if(!this.isCanvasNode){var t=this.type,n=this.isModifier?"".concat(t,"-modifier"):"".concat(t,"-node"),i="".concat(n.replace(" ","-").toLowerCase(),"-icon"),o=document.createElement("img");o.src="./assets/icons/".concat(i,".svg"),this.innerContainer.appendChild(o)}if(this.nodeType.paramContainers.length>0&&!this.initNodeConfig){for(var a=[],s=0;s<this.nodeType.paramContainers.length;s++){var r={},l=this.nodeType.paramContainers[s],u=Object.keys(l.inputParams);r.inputParams=[];for(var c=0;c<u.length;c++){var d=l.inputParams[u[c]];r.inputParams.push(d.ID)}r.paramContainerID=l.ID,a.push(r)}w({paramContainers:a},this.ID,!0).then(function(){console.log("paramcontainers updated")}).catch(function(){console.log("error updating node")})}this.addCallback(this)}},{key:"getSettings",value:function(){return this.settingsContainer||(this.settingsContainer=document.createElement("div"),this.settingsContainer.className="node-settings"),this.settingsContainer}},{key:"setTitle",value:function(e){this.title=e,window.NS.singletons.NodeGroupManager.updateGroupNodeTabTitle(this.ID,e),w({title:this.title},this.ID).then(function(){console.log("updated node")}).catch(function(){console.log("error updating node")})}},{key:"onConnectionAdd",value:function(e){console.log("node on param connection add: ",e.detail,e.type,this.ID)}},{key:"onConnectionRemove",value:function(e){console.log("node on param connection remove: ",e.detail,e.type,this.ID)}},{key:"syncVisualSettings",value:function(e){this.visualSettings=Object.assign({},this.visualSettings,e),w({visualSettings:e},this.ID).then(function(){}).catch(function(){})}},{key:"addToGroup",value:function(e,t){e.appendChild(this.el),this.el.style[window.NS.transform]="translate(-50%, -50%)",this.el.classList.add("center-group"),this.groupState.isInGroup=!0,this.nodeType.setActive&&this.nodeType.setActive(),w({group:{Id:t}},this.ID,!0).then(function(){}).catch(function(){})}},{key:"removeFromGroup",value:function(e,t){this.parentEl.appendChild(this.el),this.el.classList.remove("center-group"),this.groupState.isInGroup=!1;this.moveCoords.start.x=e.x-(t.moveCoords.offset.x+100),this.moveCoords.start.y=e.y-(t.moveCoords.offset.y+100),w({group:firebase.firestore.FieldValue.delete()},this.ID,!0).then(function(){}).catch(function(){})}},{key:"setAsChildToParamContainer",value:function(e,t){e.el.appendChild(this.el),this.el.style[window.NS.transform]="initial",this.onInputConnectionCallback(this,e),t&&w({connectionData:{paramContainer:e.ID,node:e.node.ID}},this.ID,!0).then(function(){}).catch(function(){})}},{key:"setAsNotChildToParamContainer",value:function(e,t,n){this.onDisconnectCallback(this,e);var i=e.getCleanPos();this.parentEl.appendChild(this.el);var o=e.node,a=function(){return o.groupState.isInGroup?window.NS.singletons.NodeGroupManager.getGroupFromNonagon(o).el.getBoundingClientRect():e.node.el.getBoundingClientRect()},s=function(){return o.groupState.isInGroup?window.NS.singletons.NodeGroupManager.getGroupFromNonagon(o).moveCoords.offset.x:o.moveCoords.offset.x},r=function(){return o.groupState.isInGroup?window.NS.singletons.NodeGroupManager.getGroupFromNonagon(o).moveCoords.offset.y:o.moveCoords.offset.y};if(n){var l=a(),u=i.x-l.x,c=i.y-l.y;this.moveCoords.start.x=s()+u,this.moveCoords.start.y=r()+c;var d=this.moveCoords.start,h=d.x,p=d.y;this.el.style[window.NS.transform]="translate3d(".concat(h,"px, ").concat(p,"px, 0)")}else{var f=a(),v=i.x-f.x,m=i.y-f.y;this.moveCoords.start.x=t.x-(s()+v),this.moveCoords.start.y=t.y-(r()+m)}w({connectionData:firebase.firestore.FieldValue.delete()},this.ID,!0).then(function(){}).catch(function(){})}},{key:"getParamContainers",value:function(){return this.nodeType.paramContainers}},{key:"enableOutput",value:function(e,t){this.currentOutConnections.push(t),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e){var t=this.currentOutConnections.map(function(e){return e}),n=t.filter(function(e){return e.paramID}),i=t.filter(function(e){return!e.paramID});e?n=n.filter(function(t){return t.paramID&&t.paramID!==e}):i=i.filter(function(e){return e.in.ID!==nodeIn.ID});var o=n.concat(i);this.currentOutConnections=o,this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"onRemoveClick",value:function(){this.onNodeRemove(this)}},{key:"activateDrag",value:function(){this.innerContainer.addEventListener("mousedown",this.onMouseDownBound)}},{key:"getConnectNode",value:function(){return this}},{key:"setNotSelected",value:function(){this.el.classList.contains("center-group")||(this.el.classList.remove("selected"),this.nodeTitle&&this.nodeTitle.blurInput(),this.nodeType.setInactive&&this.nodeType.setInactive(),window.NS.singletons.CanvasNode.foregroundRender.hideActive(this.ID))}},{key:"setSelected",value:function(){this.el.classList.add("selected"),this.isRendered&&window.NS.singletons.CanvasNode.foregroundRender.showActive(this.ID),this.nodeType.setActive&&this.nodeType.setActive()}},{key:"getPos",value:function(){var e=new THREE.Vector2,t=this.innerContainer.getBoundingClientRect();return e.set(t.x+t.width/2,t.y+t.height/2),e}},{key:"removeFromDom",value:function(){this.innerContainer.removeEventListener("mousedown",this.onMouseDownBound),this.isModifier&&this.nodeType.isConnected?this.nodeType.removeNodeFromDom():this.parentEl.removeChild(this.el)}},{key:"groupShow",value:function(){this.el.style.zIndex="1",this.groupHideLayer.classList.remove("visible"),this.groupState.isShowing=!0}},{key:"groupHide",value:function(){this.el.style.zIndex="0",this.groupHideLayer.classList.add("visible"),this.groupState.isShowing=!1}},{key:"onMouseDown",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("INPUT"!==e.target.nodeName&&!e.target.classList.contains("prevent-drag")){this.nodeTitle&&this.nodeTitle.blurInput(),e.stopPropagation(),e.preventDefault();var n=new CustomEvent("node-selected",{detail:this});document.documentElement.dispatchEvent(n),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,this.lastDelta.x=0,this.lastDelta.y=0,this.localDelta.x=e.x,this.localDelta.y=e.y,this.isModifier?this.onNodeDragStart(this,e):window.NS.singletons.NodeGroupManager.onNodeDragStart(this),window.NS.singletons.DeleteView.onNodeMoveStart(),t&&(window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound))}}},{key:"onMouseMove",value:function(e){var t={x:e.x-this.localDelta.x,y:e.y-this.localDelta.y};this.isModifier?this.onNodeDragMove(e,t):window.NS.singletons.NodeGroupManager.onNodeDragMove(e,this,t);var n=e.x-this.moveCoords.start.x,i=e.y-this.moveCoords.start.y;if(this.moveCoords.offset.x=n,this.moveCoords.offset.y=i,this.lastDelta.x=n,this.lastDelta.y=i,!this.isModifier||!this.nodeType.isConnected){this.el.style[window.NS.transform]="translate3d(".concat(n,"px, ").concat(i,"px, 0)");var o=this.getPos();window.NS.singletons.DeleteView.onNodeMove(o.x,o.y)}}},{key:"onMouseUp",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(window.NS.singletons.DeleteView.deleteOnNodeRelease())return this.isModifier&&this.onNodeDragRelease(),window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound),void this.onRemoveClick();this.isModifier?this.onNodeDragRelease():window.NS.singletons.NodeGroupManager.onNodeDragEnd(this),t&&(window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)),0===this.lastDelta.x&&0===this.lastDelta.y||w({pos:this.lastDelta},this.ID,!0).then(function(){console.log("updated node")}).catch(function(){console.log("error updating node")})}}])&&N(t.prototype,n),i&&N(t,i),e}(),S="\n    attribute float size;\n    varying vec3 vColor;\n    void main() {\n        vColor = color;\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        // gl_PointSize = size * ( 3.0 / -mvPosition.z );\n        gl_PointSize = size;\n        gl_Position = projectionMatrix * mvPosition;\n    }\n",M='\n    // uniform sampler2D texture;\n    varying vec3 vColor;\n    // struct PointLight {\n    //     vec3 color;\n    //     vec3 position; // light position, in camera coordinates\n    //     float distance; // used for attenuation purposes. Since\n    //                     // we\'re writing our own shader, it can\n    //                     // really be anything we want (as long\n    //                     // as we assign it to our light in its\n    //                     // "distance" field\n    // };\n    \n    // uniform PointLight pointLights[NUM_POINT_LIGHTS];\n    void main() {\n        gl_FragColor = vec4( vColor, 1.0 );\n        // gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );\n    }\n',D="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\tuniform float time;\n\tuniform vec2 resolution;\n\tvoid main()\t{\n\t\tgl_Position = vec4( position, 1.0 );\n\t}\n",P="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\tuniform float time;\n\tuniform vec2 resolution;\n\tuniform sampler2D u_texture0;\n    uniform sampler2D u_texture1;\n\tuniform vec2 u_res;\n\tuniform float u_connection0;\n    uniform float u_connection1;\n    uniform float u_finalConnection;\n    uniform float u_multiConnection;\n\tvoid main()\t{\n\t\tvec2 st = gl_FragCoord.xy/u_res.xy;\n\t\tvec4 bgColor = texture2D(u_texture0, st);\n        vec4 fgColor = texture2D(u_texture1, st);\n\t\tvec4 whiteColor = vec4(1., 1., 1., 1.);\n        vec4 transparentColor = vec4(1.0, 1.0, 1.0, 0.0);\n        vec4 finalFgColor = mix(transparentColor, fgColor, u_connection1);\n        vec4 finalBgColor = mix(transparentColor, bgColor, u_connection0);\n        \n        float ra = (finalFgColor.a) * finalFgColor.r + (1.0 - finalFgColor.a) * finalBgColor.r;\n        float ga = (finalFgColor.a) * finalFgColor.g + (1.0 - finalFgColor.a) * finalBgColor.g;\n        float ba = (finalFgColor.a) * finalFgColor.b + (1.0 - finalFgColor.a) * finalBgColor.b;\n\n        vec4 overlayColor = vec4(ra, ga, ba, 1.0);\n\n        vec4 finalColor = mix(fgColor + bgColor, overlayColor, u_multiConnection);\n\n        gl_FragColor = mix(whiteColor, finalColor, u_finalConnection);\n\t} \n\n";var T=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=new THREE.WebGLRenderer({alpha:!0})};function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var I=function(){function e(t,n,i,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isActive=!1,this.onClickCallback=n,this.parentEl=t,this.inputType=a,this.offsetLeft=void 0,this.offsetTop=void 0}var t,n,i;return t=e,(n=[{key:"enable",value:function(){this.isActive=!0,this.deactivatePossible()}},{key:"disable",value:function(){this.isActive=!1}},{key:"activatePossible",value:function(){}},{key:"deactivatePossible",value:function(){}}])&&O(t.prototype,n),i&&O(t,i),e}(),L={general:{isValid:function(e){return!0}},needsFramebuffer:{isValid:function(e){return e.framebuffer||e.isForegroundNode}},sceneNode:{isValid:function(e,t,n,i){return!(t.enabledInputs.some(function(t){return t.out.ID===e.ID})||!n)&&{background:function(){return e.isBackgroundNode},foreground:function(){return i&&e.outputs[i]?e.isForegroundNode&&!e.outputs[i].isParamOutput:e.isForegroundNode},light:function(){return e.isLightNode&&!t.foregroundRender.hasConnectedLight}}[n]()}}};function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var B=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=window.innerWidth,o=window.innerHeight;this.camera=new THREE.PerspectiveCamera(75,i/o,.1,1e3),this.camera.position.z=10,this.cameraControls=new THREE.OrbitControls(this.camera,n),this.cameraControls.enabled=!1,this.currentActiveKey,this.activeHelperMeshes={},this.scene=new THREE.Scene,this.renderer=t.renderer,this.axesHelper=new THREE.AxesHelper(5),this.axesHelper.name="AxesHelper",this.ambientLight=new THREE.AmbientLight,this.scene.add(this.ambientLight),this.connectedNodes=[],this.hasConnectedLight=!1,this.framebuffer=new THREE.WebGLRenderTarget(640,600,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter})}var t,n,i;return t=e,(n=[{key:"toggleAxesHelper",value:function(e){if(e)this.scene.add(this.axesHelper);else{this.scene.getObjectByName(this.axesHelper.name);this.scene.remove(this.axesHelper)}}},{key:"toggleCameraControl",value:function(e){e?(this.cameraControls.enabled=!0,this.renderer.domElement.classList.add("prevent-drag")):(this.cameraControls.enabled=!1,this.renderer.domElement.classList.remove("prevent-drag"))}},{key:"addLight",value:function(e){var t="".concat(e.ID,"-light");e.light.name=t;var n="".concat(e.ID,"-mesh");e.mesh.name=n,this.scene.add(e.light),this.scene.add(e.mesh),this.hasConnectedLight=!0,this.createPlaneMesh(e,n)}},{key:"removeLight",value:function(e){var t="".concat(e.ID,"-light"),n=this.scene.getObjectByName(t);this.scene.remove(n);var i="".concat(e.ID,"-mesh"),o=this.scene.getObjectByName(i);this.scene.remove(o),this.hasConnectedLight=!1;var a="".concat(i,"-active");this.activeHelperMeshes[a]&&delete this.activeHelperMeshes[a]}},{key:"addNode",value:function(e){this.connectedNodes.push(e);var t="".concat(e.ID,"-mesh");e.mesh.name=t,this.scene.add(e.mesh),e.isRendered&&this.createPlaneMesh(e,t)}},{key:"removeNode",value:function(e){this.connectedNodes=this.connectedNodes.filter(function(t){return t.ID!==e.ID});var t="".concat(e.ID,"-mesh"),n=this.scene.getObjectByName(t);this.scene.remove(n);var i="".concat(t,"-active");this.activeHelperMeshes[i]&&delete this.activeHelperMeshes[i]}},{key:"createPlaneMesh",value:function(e,t){var n=new THREE.PlaneBufferGeometry(5,5,1,1),i=new THREE.ShaderMaterial({uniforms:{},vertexShader:"\n    varying vec3 vUv; \n\n    void main() {\n      vUv = position; \n\n      vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n      gl_Position = projectionMatrix * modelViewPosition; \n    }\n",fragmentShader:"\n    uniform vec3 colorA; \n    uniform vec3 colorB; \n    varying vec3 vUv;\n\n    float circle(vec2 _st, float _radius){\n        vec2 dist = _st-vec2(0.5);\n        return 1.-smoothstep(_radius-(_radius*0.01),\n                _radius+(_radius*0.01),\n                dot(dist,dist)*4.352);\n    }\n\n    void main() {\n        float x = (vUv.x + 2.0 - 1.0) / 2.0;\n        float y = (vUv.y + 2.0 - 1.0) / 2.0;\n        vec2 st = vec2(x, y);\n        vec3 color = vec3(circle(st, 4.8)) - vec3(circle(st, 4.0));\n        gl_FragColor = vec4(color, color.r);\n    }\n"});i.transparent=!0;var o=new THREE.Mesh(n,i);o.position.y=0,o.scale.set(1.4,1.4,1),o.visible=!1,e.mesh.add(o),this.activeHelperMeshes["".concat(t,"-active")]=o}},{key:"showActive",value:function(e){var t="".concat(e,"-mesh-active");this.activeHelperMeshes[t]&&(this.currentActiveKey=t,this.activeHelperMeshes[t].visible=!0)}},{key:"hideActive",value:function(e){var t="".concat(e,"-mesh-active");this.activeHelperMeshes[this.currentActiveKey]&&this.currentActiveKey===t&&(this.activeHelperMeshes[this.currentActiveKey].visible=!1,this.currentActiveKey=null)}},{key:"update",value:function(){this.currentActiveKey&&this.activeHelperMeshes[this.currentActiveKey]&&this.activeHelperMeshes[this.currentActiveKey].lookAt(this.camera.position)}},{key:"render",value:function(){this.renderer.setRenderTarget(this.framebuffer),this.renderer.render(this.scene,this.camera)}},{key:"onResize",value:function(e){var t=e.w,n=e.h;this.framebuffer.setSize(t,n),this.camera.aspect?this.camera.aspect=t/n:(this.camera.left=t/-2,this.camera.right=t/2,this.camera.top=n/-2,this.camera.bottom=n/2),this.camera.updateProjectionMatrix()}}])&&R(t.prototype,n),i&&R(t,i),e}();function V(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var A=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onResizeCallback=n,this.onNodeResizerDown=i,this.el=document.createElement("div"),this.el.className="node-resizer",this.innerEl=document.createElement("div"),this.innerEl.className="node-resizer-inner",this.el.appendChild(this.innerEl),t.appendChild(this.el),this.currentDims={w:0,h:0},this.currentNodeDims={w:0,h:0},this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.moveCoords={start:{x:0,y:0},offset:{x:0,y:0}},this.innerEl.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this.onNodeResizerDown(),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){e.stopPropagation(),e.preventDefault();var t=e.x-this.moveCoords.start.x,n=e.y-this.moveCoords.start.y;this.onResizeCallback({x:t,y:n})}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"remove",value:function(){this.innerEl.removeEventListener("mousedown",this.onMouseDownBound)}}])&&V(t.prototype,n),i&&V(t,i),e}();function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var H=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="camera-control-setting",this.foregroundController=n,this.label=document.createElement("h4"),this.label.innerHTML="Kamera kontroll (inaktiv)",this.el.appendChild(this.label),this.toggleEl=document.createElement("div"),this.toggleEl.className="toggle-el",this.isEnabled=!1,this.el.appendChild(this.toggleEl),this.onClickBound=this.onClick.bind(this),this.toggleEl.addEventListener("click",this.onClickBound),t.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.isEnabled=!this.isEnabled,this.isEnabled?(this.toggleEl.classList.add("enabled"),this.label.innerHTML="Kamera kontroll (aktiv)"):(this.toggleEl.classList.remove("enabled"),this.label.innerHTML="Kamera kontroll (inaktiv)"),this.foregroundController.toggleCameraControl(this.isEnabled)}}])&&j(t.prototype,n),i&&j(t,i),e}();function F(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="axes-helper-setting",this.foregroundController=n,this.label=document.createElement("h4"),this.label.innerHTML="Visa x y z axlar (inaktiv)",this.el.appendChild(this.label),this.toggleEl=document.createElement("div"),this.toggleEl.className="toggle-el",this.isEnabled=!1,this.el.appendChild(this.toggleEl),this.onClickBound=this.onClick.bind(this),this.toggleEl.addEventListener("click",this.onClickBound),t.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.isEnabled=!this.isEnabled,this.isEnabled?(this.toggleEl.classList.add("enabled"),this.label.innerHTML="Visa x y z axlar (aktiv)"):(this.toggleEl.classList.remove("enabled"),this.label.innerHTML="Visa x y z axlar (inaktiv)"),this.foregroundController.toggleAxesHelper(this.isEnabled)}}])&&F(t.prototype,n),i&&F(t,i),e}();function U(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var z=function(){function e(t,n,i,o,a,s,r){var l=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=i,this.decimals=o,this.value=(n-a.min)/(a.max-a.min),this.settings=a,this.el=document.createElement("div"),this.el.className="horizontal-slider prevent-drag "+s;var u=document.createElement("h4");u.className="horizontal-slider-label",u.innerHTML=r,this.el.appendChild(u),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var c=document.createElement("div");c.appendChild(this.rangeInnerContainer),c.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=n;var d=document.createElement("div");d.className="value-container",d.appendChild(this.valueEl),this.el.appendChild(c),this.el.appendChild(d),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),setTimeout(function(){l.setPos(120)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"remove",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e){this.value=e,this.setPos(120);var t=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=t,this.valChangeCallback&&this.valChangeCallback(t)}},{key:"getValue",value:function(){var e=this.settings;return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(".concat(t,"px, 0px, 0)")}}])&&U(t.prototype,n),i&&U(t,i),e}();n(13);function G(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mainRender=t,this.ID="_"+Math.random().toString(36).substr(2,9),this.isVisible=!1,this.hasOutput=!1,this.isGraphicsNode=!0,this.hasGraphicsInput=!0,this.isCanvasNode=!0,this.initAsNotCollapsed=!0,this.inputHelpersType=L.sceneNode,this.enabledInputs=[],this.el=document.createElement("div"),this.el.className="canvas",this.topPartEl=document.createElement("div"),this.topPartEl.className="top-part",this.el.appendChild(this.topPartEl),this.bottomPartEl=document.createElement("div"),this.bottomPartEl.className="bottom-part",this.bottomPartSettings=document.createElement("div"),this.bottomPartSettings.className="bottom-part-settings",this.bottomPartEl.appendChild(this.bottomPartSettings),this.bottomLabelContainer=document.createElement("div"),this.bottomLabelContainer.className="bottom-label";var n=document.createElement("h5");n.className="canvas-label",n.innerHTML="CANVAS WINDOW",this.bottomLabelContainer.appendChild(n),this.el.appendChild(this.bottomLabelContainer),this.onToggleVisibleClickBound=this.onToggleVisibleClick.bind(this),this.bottomLabelContainer.addEventListener("click",this.onToggleVisibleClickBound),this.onNodeResizerDownBound=this.onNodeResizerDown.bind(this),this.onResizeFromNodeResizerBound=this.onResizeFromNodeResizer.bind(this),this.nodeResizer=new A(this.bottomPartEl,this.onResizeFromNodeResizerBound,this.onNodeResizerDownBound),this.el.appendChild(this.bottomPartEl),this.foregroundRender=new B(this.mainRender,this.topPartEl),this.cameraControlSetting=new H(this.bottomPartSettings,this.foregroundRender),this.onAmbientLightSettingChangeBound=this.onAmbientLightSettingChange.bind(this),this.ambientLightSetting=new z(this.bottomPartSettings,1,this.onAmbientLightSettingChangeBound,2,{min:0,max:1},"ambient-light","Ambient light"),this.axesHelper=new _(this.bottomPartSettings,this.foregroundRender),this.scene=new THREE.Scene,this.renderer=this.mainRender.renderer,this.renderer.setSize(this.topPartEl.clientWidth,this.topPartEl.clientHeight),this.topPartEl.appendChild(this.renderer.domElement);var i=new THREE.PlaneGeometry(2,2),o={};o.u_res={value:new THREE.Vector2(window.innerWidth,window.innerHeight)};var a={u_connection0:{value:0}};a.u_texture0={value:new Image},a.u_connection1={value:0},a.u_texture1={value:new Image},a.u_finalConnection={value:0},a.u_multiConnection={value:0};var s=Object.assign({},o,a);this.material=new THREE.ShaderMaterial({uniforms:s,vertexShader:D,fragmentShader:P}),this.mesh=new THREE.Mesh(i,this.material),this.scene.add(this.mesh)}var t,n,i;return t=e,(n=[{key:"init",value:function(e){var t=this,n=window.innerWidth,i=window.innerHeight;this.parentEl=e,this.orthoCamera=new THREE.OrthographicCamera(n/-2,n/2,i/2,i/-2,1,1e3),this.bottomPartEl.classList.add("multiple-inputs"),this.onInputClickBackgroundBound=this.onInputClickBackground.bind(this),this.onInputClickForegroundBound=this.onInputClickForeground.bind(this),this.onInputClickLightBound=this.onInputClickLight.bind(this),this.inputBackground=new I(this.bottomPartEl,this.onInputClickBackgroundBound,this.isGraphicsNode,"Bakgrund In","background"),this.inputForeground=new I(this.bottomPartEl,this.onInputClickForegroundBound,this.isGraphicsNode,"Förgrund In","foreground"),this.inputLight=new I(this.bottomPartEl,this.onInputClickLightBound,this.isGraphicsNode,"Ljus In","light"),this.inputs={background:this.inputBackground,foreground:this.inputForeground,light:this.inputLight},setTimeout(function(){t.onResize()},100),this.parentEl.appendChild(this.el)}},{key:"onToggleVisibleClick",value:function(){this.isVisible?(this.isVisible=!1,this.el.classList.remove("visible")):(this.isVisible=!0,this.el.classList.add("visible"))}},{key:"onAmbientLightSettingChange",value:function(e){this.foregroundRender.ambientLight.intensity=e}},{key:"onNodeResizerDown",value:function(){this.nodeResizer.currentDims.w=this.topPartEl.clientWidth,this.nodeResizer.currentDims.h=this.topPartEl.clientHeight,this.nodeResizer.currentNodeDims.w=this.el.clientWidth,this.nodeResizer.currentNodeDims.h=this.el.clientHeight}},{key:"onResizeFromNodeResizer",value:function(e){this.el.style.width=this.nodeResizer.currentNodeDims.w+e.x+"px",this.el.style.height=this.nodeResizer.currentNodeDims.h+e.y+"px",this.topPartEl.style.width=this.nodeResizer.currentDims.w+e.x+"px",this.topPartEl.style.height=this.nodeResizer.currentDims.h+e.y+"px",this.inputBackground.offsetLeft=this.inputBackground.el.offsetLeft,this.inputBackground.offsetTop=this.inputBackground.el.offsetTop,this.inputForeground.offsetLeft=this.inputForeground.el.offsetLeft,this.inputForeground.offsetTop=this.inputForeground.el.offsetTop,this.inputLight.offsetLeft=this.inputLight.el.offsetLeft,this.inputLight.offsetTop=this.inputLight.el.offsetTop,this.onResize()}},{key:"onInputClickBackground",value:function(e){this.onInputConnectionCallback(this,"background",e)}},{key:"onInputClickForeground",value:function(e){this.onInputConnectionCallback(this,"foreground",e)}},{key:"onInputClickLight",value:function(e){this.onInputConnectionCallback(this,"light",e)}},{key:"getInputEl",value:function(e){return this.inputs[e]}},{key:"getDotPos",value:function(e){return e.getBoundingClientRect()}},{key:"setBackgroundTexture",value:function(e){this.mesh.material.uniforms.u_texture0.value=e}},{key:"enableInput",value:function(e,t){if(this.inputs[t].enable(),e.isBackgroundNode){var n=e.framebuffer?e.framebuffer.texture:e.texture;this.mesh.material.uniforms.u_texture0.value=n,this.mesh.material.uniforms.u_connection0.value=1}else if(e.isForegroundNode){if(this.foregroundRender.addNode(e),1===this.foregroundRender.connectedNodes.length){var i=this.foregroundRender.framebuffer.texture;this.mesh.material.uniforms.u_texture1.value=i,this.mesh.material.uniforms.u_connection1.value=1}}else e.isLightNode&&this.foregroundRender.addLight(e);var o={out:e,type:t};this.enabledInputs.push(o),e.isLightNode||(this.mesh.material.uniforms.u_finalConnection.value=1,this.inputs.background.isActive&&this.inputs.foreground.isActive&&(this.mesh.material.uniforms.u_multiConnection.value=1))}},{key:"disableInput",value:function(e,t){e.isBackgroundNode?(this.inputs[t].disable(),this.mesh.material.uniforms.u_texture0.value=null,this.mesh.material.uniforms.u_connection0.value=0,this.mesh.material.uniforms.u_multiConnection.value=0):e.isForegroundNode?(this.foregroundRender.removeNode(e),0===this.foregroundRender.connectedNodes.length&&(this.inputs[t]&&this.inputs[t].disable(),this.mesh.material.uniforms.u_texture1.value=null,this.mesh.material.uniforms.u_connection1.value=0)):e.isLightNode&&(this.inputs[t].disable(),this.foregroundRender.removeLight(e)),this.enabledInputs=this.enabledInputs.filter(function(t){return t.out.ID!==e.ID}),0===this.enabledInputs.filter(function(e){return!e.out.isLightNode}).length?this.mesh.material.uniforms.u_finalConnection.value=0:this.inputs.foreground.isActive||(this.mesh.material.uniforms.u_multiConnection.value=0)}},{key:"update",value:function(){this.foregroundRender.update()}},{key:"render",value:function(){this.renderer.clear(),this.foregroundRender.render(),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.orthoCamera)}},{key:"onResize",value:function(){var e=this.topPartEl.clientWidth,t=this.topPartEl.clientHeight;this.foregroundRender.onResize({w:e,h:t}),this.mesh.material.uniforms.u_res.value=new THREE.Vector2(e,t),this.orthoCamera.left=e/-2,this.orthoCamera.right=e/2,this.orthoCamera.top=t/-2,this.orthoCamera.bottom=t/2,this.orthoCamera.updateProjectionMatrix(),this.renderer.setSize(e,t)}}])&&G(t.prototype,n),i&&G(t,i),e}(),W={single:{isValid:function(e,t,n,i){var o=!0;return i.some(function(e){return e.in.ID===t.ID&&!e.param})&&(o=!1),o}},multiple:{isValid:function(e,t,n,i,o){if(e.outputs&&e.outputs[o]&&e.outputs[o].isParamOutput&&!t.isParam)return!1;return!0}},oscillatorTrigger:{isValid:function(e,t,n,i){var o=!0;return i.some(function(n){return n.out.ID===e.ID&&n.in.ID===t.ID})&&(o=!1),e.isSequencer||(o=!1),o}},gain:{isValid:function(e,t,n,i){var o=!0;return i.some(function(n){return n.in.ID===t.ID&&n.out.ID===e.ID})&&(o=!1),e.isEnvelope||(o=!1),o}},frequency:{isValid:function(e,t,n,i){var o=!0;return i.some(function(n){return n.in.ID===t.ID&&n.out.ID===e.ID})&&(o=!1),e.isEnvelope||e.isLFO||(o=!1),o}}};function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function K(e,t){return!t||"object"!==X(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Z(e,t,n){return(Z="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Q(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var $=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=K(this,Q(t).call(this))).audioNode=null,e.isParam=!1,e.isKeyboardListener=!1,e.isOscillator=!1,e.isEnvelope=!1,e.isSpeaker=!1,e.isSignalMath=!1,e.hasAudioInput=!0,e.isSequencer=!1,e.isLFO=!1,e.isAnalyser=!1,e.isSynthOscillator=!1,e.inputHelpersType=W.single,e.params={},e.canBeConnected=!1,e.el=document.createElement("div"),e.el.className="node",e.topPartEl=document.createElement("div"),e.topPartEl.className="top-part",e.el.appendChild(e.topPartEl),e.bottomPartEl=document.createElement("div"),e.bottomPartEl.className="bottom-part",e.el.appendChild(e.bottomPartEl),e.inputParams={},e}var n,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(t,x),n=t,(i=[{key:"init",value:function(e,n,i,a,s,r,l,u,c){for(var d in Z(Q(t.prototype),"init",this).call(this,e,n,i,a,s,r,l,c),this.onParameterChange=u,this.connectedInputs=[],this.connectedOutputs=[],this.params)if(this.params[d].useAsInput){var h=new o(this.topPartEl,this.params[d],this.onInputClickBound);this.inputParams[this.params[d].title]=h}this.isSequencer&&(this.el.classList.add("sequencer"),this.createUI(),this.setup()),this.activateDrag(),this.postInit()}},{key:"enableParam",value:function(e){var t=this.inputParams[e.title];e.isConnected=!0,t.enable(),e.slider&&e.disableSliderOnConnection&&e.slider.disableSlider()}},{key:"disableParam",value:function(e){var t=this.inputParams[e.title];e.isConnected=!1,t.disable(),e.slider&&e.slider.enableSlider()}},{key:"onParameterUpdate",value:function(){var e=this.getParams();this.onParameterChange(this,e)}},{key:"getParams",value:function(){var e={};for(var t in this.params){var n=this.params[t];e[n.param]=this.params[n.param].value}return e}},{key:"enableOutput",value:function(e,n){Z(Q(t.prototype),"enableOutput",this).call(this),this.connectedOutputs.push(n.in.ID)}},{key:"disableOutput",value:function(e,n){var i=this.connectedOutputs.filter(function(t){return t!==e.ID});this.connectedOutputs=i,0===this.connectedOutputs.length&&Z(Q(t.prototype),"disableOutput",this).call(this)}},{key:"enableInput",value:function(e){Z(Q(t.prototype),"enableInput",this).call(this),this.connectedInputs.push("".concat(e.ID,"-").concat(this.ID))}},{key:"disableInput",value:function(e){var n="".concat(e.ID,"-").concat(this.ID),i=this.connectedInputs.filter(function(e){return e!==n});this.connectedInputs=i,0===this.connectedInputs.length&&Z(Q(t.prototype),"disableInput",this).call(this)}}])&&q(n.prototype,i),a&&q(n,a),t}(),ee=n(7),te=n.n(ee);function ne(e){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ie(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function oe(e,t){return!t||"object"!==ne(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ae(e){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var re=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=oe(this,ae(t).call(this))).inputHelpersType=W.multiple,e.audioNode=te.a.context.destination,e.isSpeaker=!0,e.initAsNotCollapsed=!0,e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&se(e,t)}(t,$),n=t,(i=[{key:"getAudioNode",value:function(){var e=new te.a.Limiter;return e.connect(te.a.context.destination),e}}])&&ie(n.prototype,i),o&&ie(n,o),t}();function le(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ue=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nodes={},this.step=t,this.currentConnections=[],this.oscillatorNodes=[],this.synthOscillatorNodes=[],this.triggerNodes=[]}var t,n,i;return t=e,(n=[{key:"reset",value:function(e){for(var t=0;t<this.currentConnections.length;t++){var n=this.currentConnections[t],i=this.nodes[n.out.ID]?this.nodes[n.out.ID].audioNode:void 0,o=this.nodes[n.in.ID]?this.nodes[n.in.ID].audioNode:void 0,a=this.nodes[n.in.ID]?this.nodes[n.in.ID].musicNode:void 0;if(i&&o)if(n.out.isParam);else{if(a&&a.isAnalyser)continue;o.disconnect()}}this.nodes={},this.oscillatorNodes=[],this.currentConnections=e,this.triggerNodes=[],this.synthOscillatorNodes=[]}},{key:"updateConnections",value:function(e){this.reset(e);for(var t=0;t<e.length;t++){var n=e[t];if(!n.out.isSequencer){if(!this.nodes[n.in.ID]){var i={audioNode:n.in.getAudioNode(),musicNode:n.in};this.nodes[n.in.ID]=i}if(!this.nodes[n.out.ID]){var o=n.out.getAudioNode(n.param?n.param.param:void 0),a={audioNode:o,musicNode:n.out};this.nodes[n.out.ID]=a,n.out.isEnvelope&&this.triggerNodes.push(o),(n.out.isOscillator||n.out.isLFO)&&this.oscillatorNodes.push(a),n.out.isSynthOscillator&&this.synthOscillatorNodes.push(a)}}}for(var s=0;s<e.length;s++){var r=e[s],l=this.nodes[r.out.ID]?this.nodes[r.out.ID].audioNode:void 0,u=this.nodes[r.in.ID]?this.nodes[r.in.ID].audioNode:void 0;this.nodes[r.out.ID]&&this.nodes[r.out.ID].musicNode,this.nodes[r.in.ID]&&this.nodes[r.in.ID].musicNode;if(!r.out.isSequencer||l)if(r.out.isParam){var c=r.param.param;l.connect(u[c])}else l.connect(u)}}},{key:"onParamChange",value:function(e){this.nodes[e.ID]&&(e.isOscillator?this._updateOscillatorParams(this.nodes[e.ID].audioNode,e):e.isSynthOscillator||this._updateParams(this.nodes[e.ID].audioNode,e))}},{key:"_updateSynthOscillatorParams",value:function(e,t){for(var n=0;n<t.synthParams.length;n++){var i=t.params[t.synthParams[n]];i.setParam?i.setParam(e,i.value):e[t.synthParams[n]].value=i.value}}},{key:"_updateOscillatorParams",value:function(e,t){e.frequency.value=t.getFrequency(this.step)}},{key:"_updateParams",value:function(e,t){var n=function(e,t){for(var n in e.params)if(e.params[n].param===t)return e.params[n].isConnected};for(var i in t.params)"gain"===i&&n(t,i)||("frequency"===i||"amplitude"===i||"Q"===i||"gain"===i||"threshold"===i||"ratio"===i?e[i].value=t.params[i].value:e[i]=t.params[i].value)}},{key:"play",value:function(e,t){var n=this.triggerNodes.length,i=this.oscillatorNodes.length,o=this.synthOscillatorNodes.length;for(var a in this.nodes){var s=this.nodes[a];s.musicNode.isOscillator?this._updateOscillatorParams(s.audioNode,s.musicNode):s.musicNode.isSynthOscillator?this._updateSynthOscillatorParams(s.audioNode,s.musicNode):this._updateParams(s.audioNode,s.musicNode)}for(var r=0;r<n;r++)this.triggerNodes[r].triggerAttackRelease(te.a.Time("8n"),e);for(var l=0;l<i;l++){var u=this.oscillatorNodes[l];u.musicNode.isOscillator&&u.musicNode.hasConnectedTrigger&&u.musicNode.connectedTriggerID===t?u.musicNode.hasEnvelopeConnection?u.audioNode.start(e).stop(e+te.a.Time(2)):u.audioNode.start(e).stop(e+te.a.Time("8n")):u.musicNode.isLFO&&(u.audioNode.phase=0,u.audioNode.start(e))}for(var c=0;c<o;c++){var d=this.synthOscillatorNodes[c];if(d.musicNode.connectedTriggerID===t){var h=d.musicNode.getFrequency(this.step);d.audioNode.triggerAttackRelease(h,"8n")}}}},{key:"keyDown",value:function(){var e=this.triggerNodes.length,t=this.oscillatorNodes.length,n=this.synthOscillatorNodes.length;for(var i in this.nodes){var o=this.nodes[i];o.musicNode.isOscillator?this._updateOscillatorParams(o.audioNode,o.musicNode):o.musicNode.isSynthOscillator?this._updateSynthOscillatorParams(o.audioNode,o.musicNode):this._updateParams(o.audioNode,o.musicNode)}for(var a=0;a<t;a++){var s=this.oscillatorNodes[a];s.musicNode.isOscillator?s.audioNode.start():s.musicNode.isLFO&&(s.audioNode.phase=0,s.audioNode.start())}for(var r=0;r<e;r++)this.triggerNodes[r].triggerAttack();for(var l=0;l<n;l++){var u=this.synthOscillatorNodes[l],c=u.musicNode.getFrequency(this.step);u.audioNode.triggerAttack(c)}}},{key:"keyUp",value:function(){for(var e=this.triggerNodes.length,t=this.oscillatorNodes.length,n=this.synthOscillatorNodes.length,i=0;i<t;i++){var o=this.oscillatorNodes[i];o.musicNode.isOscillator?o.musicNode.hasEnvelopeConnection||o.audioNode.stop():o.musicNode.isLFO}for(var a=0;a<e;a++)this.triggerNodes[a].triggerRelease();for(var s=0;s<n;s++){var r=this.synthOscillatorNodes[s];r.musicNode.getFrequency(this.step);r.audioNode.triggerRelease()}}}])&&le(t.prototype,n),i&&le(t,i),e}();function ce(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var de=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.triggerID=i,this.cols=t,this.rows=n,this.synths=[],this.masterSynth=new ue(0);for(var o=0;o<t;o++){for(var a=[],s=0;s<n;s++)a.push({synth:null,isActive:!1});this.synths.push(a)}}var t,n,i;return t=e,(n=[{key:"init",value:function(e){this.masterSynth.updateConnections(e)}},{key:"removeAllSynths",value:function(){for(var e=this.cols,t=this.rows,n=0;n<e;n++)for(var i=0;i<t;i++)this.synths[n][i].isActive&&(this.synths[n][i].synth.reset(),this.synths[n][i].isActive=!1)}},{key:"addSynth",value:function(e,t){var n=new ue(t);n.updateConnections(this.masterSynth.currentConnections),this.synths[e][t].synth=n,this.synths[e][t].isActive=!0}},{key:"removeSynth",value:function(e,t){this.synths[e][t].isActive&&(this.synths[e][t].synth.reset(),this.synths[e][t].isActive=!1)}},{key:"play",value:function(e,t,n){this.synths[e][t].synth.play(n,this.triggerID)}},{key:"onAudioNodeConnectionUpdate",value:function(e){for(var t=this.cols,n=this.rows,i=0;i<t;i++)for(var o=0;o<n;o++)this.synths[i][o].isActive&&this.synths[i][o].synth.updateConnections(e);this.masterSynth.updateConnections(e)}},{key:"onAudioNodeParamChange",value:function(e,t){for(var n=this.cols,i=this.rows,o=0;o<n;o++)for(var a=0;a<i;a++)this.synths[o][a].isActive&&this.synths[o][a].synth.onParamChange(e,t);this.masterSynth.onParamChange(e,t)}}])&&ce(t.prototype,n),i&&ce(t,i),e}();function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ve(e,t,n){return(ve="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=me(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function me(e){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ge(e,t){return(ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ye=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,e=!(i=me(t).call(this))||"object"!==he(i)&&"function"!=typeof i?fe(n):i,t.ROWS=12,t.COLS=16,e.isSequencer=!0,e.loop=null,e.hasAudioInput=!1,e.isParam=!0,e.initAsNotCollapsed=!0,e.data=[];for(var o=t.ROWS,a=t.COLS,s=0;s<a;s++){for(var r=[],l=0;l<o;l++){var u={active:!1,el:null,parentEl:null,step:o-1-l};r.push(u)}e.data.push(r)}return e.outConnections=[],e.outConnectionsLength=0,e.isPlaying=!1,e.onBtnClickBound=e.onBtnClick.bind(fe(e)),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}(t,$),n=t,(i=[{key:"init",value:function(e,n,i,o,a,s,r,l,u){ve(me(t.prototype),"init",this).call(this,e,n,i,o,a,s,r,l,u),this.sequencerManager=new de(t.COLS,t.ROWS,this.ID)}},{key:"removeFromDom",value:function(){this.sequencerManager.removeAllSynths(),ve(me(t.prototype),"removeFromDom",this).call(this)}},{key:"getKey",value:function(e,t){return"col".concat(e,"-row").concat(t)}},{key:"onRemoveClick",value:function(){this.loop.stop(),this.playEl.removeEventListener("click",this.onPlayClickBound),this.pauseEl.removeEventListener("click",this.onPauseClickBound),ve(me(t.prototype),"onRemoveClick",this).call(this)}},{key:"createUI",value:function(){var e=t.ROWS,n=t.COLS,i=document.createElement("div");i.className="sequencer-container";for(var o=0;o<n;o++){var a=document.createElement("div");a.className="sequencer-col",i.appendChild(a);for(var s=0;s<e;s++){var r=document.createElement("div");r.className="sequencer-btn",r.setAttribute("data-col",o),r.setAttribute("data-row",s),a.appendChild(r),r.addEventListener("click",this.onBtnClickBound),this.data[o][s].el=r,this.data[o][s].parentEl=a}}this.topPartEl.appendChild(i);var l=document.createElement("div");l.className="sequencer-controls";var u=document.createElement("div");u.className="inner-controls",this.playEl=document.createElement("h5"),this.playEl.innerHTML="Spela",this.pauseEl=document.createElement("h5"),this.pauseEl.innerHTML="Nollställ",this.onPlayClickBound=this.onPlayClick.bind(this),this.onPauseClickBound=this.onPauseClick.bind(this),this.playEl.addEventListener("click",this.onPlayClickBound),this.pauseEl.addEventListener("click",this.onPauseClickBound),u.appendChild(this.playEl),u.appendChild(this.pauseEl),l.appendChild(u),this.topPartEl.appendChild(l)}},{key:"onPlayClick",value:function(){this.isPlaying||(this.isPlaying=!0,this.loop.start())}},{key:"onPauseClick",value:function(){this.isPlaying=!1,this.loop.stop(),this.reset()}},{key:"reset",value:function(){for(var e=t.ROWS,n=t.COLS,i=0;i<n;i++){this.data[i][0].parentEl.classList.remove("active");for(var o=0;o<e;o++)this.data[i][o].active=!1}this.sequencerManager.removeAllSynths(),this.update()}},{key:"setup",value:function(){var e=this;this.loop=new te.a.Sequence(function(n,i){for(var o=0;o<t.COLS;o++){e.data[o][0].parentEl.classList.remove("active")}var a=e.data[i];e.data[i][0].parentEl.classList.add("active");for(var s=0;s<t.ROWS;s++)a[s].active&&e.outConnectionsLength>0&&e.sequencerManager.play(i,a[s].step,n)},[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],"8n")}},{key:"onBtnClick",value:function(e){e.stopPropagation(),e.preventDefault();var t=parseInt(e.target.getAttribute("data-col")),n=parseInt(e.target.getAttribute("data-row")),i=this.data[t][n];i.active=!i.active,i.active?this.sequencerManager.addSynth(t,i.step):this.sequencerManager.removeSynth(t,i.step),this.update()}},{key:"onOutputClick",value:function(e){0===this.outConnectionsLength&&this.onConnectingCallback(this,e)}},{key:"enableOutput",value:function(e,t){this.output.enable(),this.outConnections.push(t.in),this.outConnectionsLength=this.outConnections.length}},{key:"disableOutput",value:function(e,t){this.outConnections=this.outConnections.filter(function(t){return t.ID!==e.ID}),this.outConnectionsLength=this.outConnections.length,0===this.outConnections.length&&(this.output.disable(),this.sequencerManager.removeAllSynths(),this.onPauseClick())}},{key:"update",value:function(){for(var e=t.ROWS,n=t.COLS,i=0;i<n;i++)for(var o=0;o<e;o++){var a=this.data[i][o];a.active?a.el.classList.add("active"):a.el.classList.remove("active")}}}])&&pe(n.prototype,i),o&&pe(n,o),t}();function be(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var we=function(){function e(t,n,i,o,a,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isActive=!1,this.onClickCallback=n,this.parentEl=t,this.isParamOutput=i,this.el=document.createElement("div"),this.el.className="node-output node-component ".concat(o?"":"right-align"," ").concat(i?"param":"");var r=document.createElement("div");r.className="dot",this.el.appendChild(r);var l=document.createElement("p");l.className="label",l.innerHTML=i?"Data ut":s?"Grafik ut":"Ljud ut",this.el.appendChild(l),this.parentEl.appendChild(this.el),this.onClickBound=this.onClick.bind(this),a?this.el.style.display="none":(r.addEventListener("click",this.onClickBound),this.offsetLeft=void 0,this.offsetTop=void 0)}var t,n,i;return t=e,(n=[{key:"getOffsetLeft",value:function(){return this.offsetLeft||(this.offsetLeft=this.el.offsetLeft),this.offsetLeft}},{key:"getOffsetTop",value:function(){return this.offsetTop=this.el.offsetTop,this.offsetTop}},{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.el.classList.add("selected"),this.onClickCallback({x:e.x,y:e.y})}},{key:"enable",value:function(){this.isActive=!0,this.el.classList.add("active"),this.el.classList.remove("selected")}},{key:"disable",value:function(){this.isActive=!1,this.el.classList.remove("active")}}])&&be(t.prototype,n),i&&be(t,i),e}();function Ce(e){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ke(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ee(e,t){return!t||"object"!==Ce(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ne(e,t,n){return(Ne="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=xe(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function xe(e){return(xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Se(e,t){return(Se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Me=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Ee(this,xe(t).call(this))).el.classList.add("no-height"),e.el.classList.add("waveform-node"),e.needsUpdate=!0,e.isAnalyser=!0,e.isDisposed=!1,e.hasMultipleOutputs=!0,e.initAsNotCollapsed=!0,e.arrSize=256,e.audioValue=0,e.isConnected=!1,e.audioConnections=[],e.audioNode=te.a.context.createAnalyser(),e.audioNode.fftSize=e.arrSize,e.canvas=document.createElement("canvas"),e.canvas.className="waveform-canvas",e.canvas.width="200",e.canvas.height="100",e.ctx=e.canvas.getContext("2d"),e.value=new Uint8Array(e.arrSize),e.topPartEl.appendChild(e.canvas),e.params={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Se(e,t)}(t,$),n=t,(i=[{key:"init",value:function(e,n,i,o,a,s,r,l,u){Ne(xe(t.prototype),"init",this).call(this,e,n,i,o,a,s,r,l,u),this.onOutputClickAudioBound=this.onOutputClickAudio.bind(this),this.onOutputClickDataBound=this.onOutputClickData.bind(this);var c=document.createElement("div");c.className="multiple-outputs",this.bottomPartEl.appendChild(c),this.outputAudio=new we(c,this.onOutputClickAudioBound,!1,!1,!1,!1),this.outputData=new we(c,this.onOutputClickDataBound,!0,!1,!1,!1),this.outputDataConnections=[],this.outputDataConnectionsLength=0,this.outputs={"analyser-audio":this.outputAudio,"analyser-data":this.outputData},this.inDotPos={"analyser-audio":null,"analyser-data":null}}},{key:"onOutputClickAudio",value:function(e){this.onConnectingCallback(this,e,"analyser-audio")}},{key:"onOutputClickData",value:function(e){this.onConnectingCallback(this,e,"analyser-data")}},{key:"getOutputPos",value:function(e){return{x:this.outputs[e].el.offsetLeft,y:this.outputs[e].el.offsetTop}}},{key:"getOutDotPos",value:function(e,t){return this.inDotPos[t]||(this.inDotPos[t]=this.outputs[t].el.getBoundingClientRect()),this.inDotPos[t]}},{key:"getOutputEl",value:function(e){return this.outputs[e]}},{key:"dispose",value:function(){this.isDisposed||(this.audioNode.disconnect(),this.isDisposed=!0)}},{key:"enableInput",value:function(e){Ne(xe(t.prototype),"enableInput",this).call(this,e),this.isConnected=!0}},{key:"disableInput",value:function(e){Ne(xe(t.prototype),"disableInput",this).call(this,e),this.isConnected=!1}},{key:"enableOutput",value:function(e,t){var n=t.outputType;this.outputs[n].enable(),"analyser-data"===n&&(this.outputDataConnections.push(t),this.outputDataConnectionsLength=this.outputDataConnections.length)}},{key:"disableOutput",value:function(e,t,n){"analyser-data"===n?(this.outputDataConnections=this.outputDataConnections.filter(function(e){return e.param.title!==t.title}),this.outputDataConnectionsLength=this.outputDataConnections.length,0===this.outputDataConnectionsLength&&(this.audioValue=0,this.outputs[n].disable())):this.outputs[n].disable()}},{key:"getAudioNode",value:function(){return this.isDisposed&&(this.audioNode=te.a.context.createAnalyser(),this.audioNode.fftSize=this.arrSize,this.isDisposed=!1),this.audioNode}},{key:"getValue",value:function(){return this.isConnected?this.audioValue:0}},{key:"update",value:function(){this.isConnected&&this.audioNode.getByteTimeDomainData(this.value)}},{key:"render",value:function(){var e=this.canvas.width,t=this.canvas.height;this.ctx.clearRect(0,0,e,t),this.ctx.fillStyle="black",this.ctx.strokeStyle="red";var n=0;this.ctx.beginPath();for(var i=0;i<this.arrSize;i++){var o=i/this.arrSize*e,a=(1-this.value[i]/256)*t;n+=1-this.value[i]/256,this.ctx.lineTo(o,a)}if(this.audioValue=100*(n/this.arrSize-.5),this.ctx.stroke(),0!==!this.outputDataConnectionsLength)for(var s=0;s<this.outputDataConnectionsLength;s++){var r=this.outputDataConnections[s].param;this.outputDataConnections[s].in.updateParam(r,this)}}}])&&ke(n.prototype,i),o&&ke(n,o),t}();function De(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Pe=function(){function e(t,n,i,o,a,s,r,l){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=a,this.parameter=s,this.decimals=r,this.disable=l,this.value=(i-o.min)/(o.max-o.min),this.settings=o,this.el=document.createElement("div"),this.el.className="node-control node-range";var c=document.createElement("h5");c.innerHTML=n,c.className="node-range-title",this.el.appendChild(c),this.sliderBg=document.createElement("div"),this.sliderBg.className="node-range-slider-bg",this.knobEl=document.createElement("div"),this.knobEl.className="node-range-knob",this.sliderBg.appendChild(this.knobEl),this.el.appendChild(this.sliderBg),this.valueEl=document.createElement("p"),this.valueEl.className="node-range-value",this.valueEl.innerHTML=i,this.el.appendChild(this.valueEl),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),setTimeout(function(){u.setPos(u.sliderBg.clientHeight)},0),this.sliderBg.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"disableSlider",value:function(){this.disable=!0,this.el.style.opacity=.1}},{key:"enableSlider",value:function(){this.disable=!1,this.el.style.opacity=1}},{key:"remove",value:function(){this.sliderBg.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"getValue",value:function(){return this.value*(this.settings.max-this.settings.min)+this.settings.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onMouseDown",value:function(e){if(!this.disable){e.preventDefault(),e.stopPropagation();var t=this.sliderBg.getBoundingClientRect(),n=this.sliderBg.clientHeight,i=1-Math.round(100*(e.y-t.top))/100/n;this.value=i>1?1:i<0?0:i,this.setPos(n),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)),this.parameter),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}}},{key:"onMouseMove",value:function(e){var t=this.sliderBg.getBoundingClientRect(),n=this.sliderBg.clientHeight,i=1-Math.round(100*(e.y-t.top))/100/n;this.value=i>1?1:i<0?0:i,this.setPos(n),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)),this.parameter),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){this.value;var t=this.value*e;this.knobEl.style.height="".concat(t,"px")}}])&&De(t.prototype,n),i&&De(t,i),e}();function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ie(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Le(e,t,n){return(Le="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Re(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Re(e){return(Re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Be(e,t){return(Be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ve=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=Re(t).call(this))||"object"!==Te(i)&&"function"!=typeof i?Ie(n):i).el.classList.add("no-height"),e.hasConnectedTrigger=!1,e.connectedTriggerID=-1,e.synthParams=[],t.BASE_FREQ=440,t.ROOT=Math.pow(2,1/12),e.isKeyboardListener=!0,e.isSynthOscillator=!0,e.hasAudioInput=!1,e.hasEnvelopeConnection=!1;var o=document.createElement("div");o.className="range-container",e.topPartEl.appendChild(o),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(Ie(e));var a={parentEl:o,title:"Oktav",initValue:-2,settings:{min:-4,max:0},valChangeCallback:e.onRangeChangeCallbackBound,param:"octave",decimals:0,disable:!1};e.octaveRangeSlider=new Pe(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var s={useAsInput:!1,value:a.initValue,param:"octave",slider:e.octaveRangeSlider,title:"Octave"},r={useAsInput:!0,param:"trigger",title:"Trigger",helper:W.oscillatorTrigger};return e.params[s.param]=s,e.params[r.param]=r,e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Be(e,t)}(t,$),n=t,(i=[{key:"enableParam",value:function(e,n){Le(Re(t.prototype),"enableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!0,this.connectedTriggerID=n.out.ID)}},{key:"disableParam",value:function(e){Le(Re(t.prototype),"disableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!1,this.connectedTriggerID=-1)}},{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getParams",value:function(e){e||(e=0);return{}}},{key:"getAudioNode",value:function(){return new te.a.MembraneSynth}},{key:"getFrequency",value:function(e){var n=12*parseInt(this.params.octave.value)+e;return t.BASE_FREQ*Math.pow(t.ROOT,n)}}])&&Oe(n.prototype,i),o&&Oe(n,o),t}();function Ae(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var je=function(){function e(t,n,i,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.waves=["sine","sawtooth","square","triangle"],this.parentEl=t,this.onChange=n,this.param=o,this.partialCount=0;var s=document.createElement("h4");s.className="wave-type-label",s.innerHTML=a;var r=document.createElement("div");r.className="wave-type-selector-container",r.appendChild(s);var l=document.createElement("div");l.className="wave-types-container",r.appendChild(l),this.onWaveClickBound=this.onWaveClick.bind(this),this.waveTypeEls=[];for(var u=0;u<this.waves.length;u++){var c=document.createElement("h4");c.className="wave-type",c.innerHTML=this.waves[u],c.setAttribute("data-wave",this.waves[u]),c.addEventListener("click",this.onWaveClickBound),this.waveTypeEls.push(c),l.appendChild(c)}t.appendChild(r)}var t,n,i;return t=e,(n=[{key:"onWaveClick",value:function(e){for(var t=0;t<this.waveTypeEls.length;t++)this.waveTypeEls[t].classList.remove("active");var n=e.target.getAttribute("data-wave");e.target.classList.add("active"),this.onChange(n,this.param)}},{key:"remove",value:function(){for(var e=0;e<this.waveTypeEls.length;e++)this.waveTypeEls[e].removeEventListener("click",this.onWaveClickBound);this.parentEl.removeChild(this.el)}}])&&Ae(t.prototype,n),i&&Ae(t,i),e}();function He(e){return(He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ue(e,t,n){return(Ue="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ze(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ze(e){return(ze=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ge(e,t){return(Ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ye=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=ze(t).call(this))||"object"!==He(i)&&"function"!=typeof i?_e(n):i).el.classList.add("no-height"),e.hasConnectedTrigger=!1,e.connectedTriggerID=-1,e.synthParams=[],t.BASE_FREQ=440,t.ROOT=Math.pow(2,1/12),e.isKeyboardListener=!0,e.isSynthOscillator=!0,e.hasAudioInput=!1,e.hasEnvelopeConnection=!1;var o=document.createElement("div");o.className="range-container";var a=document.createElement("div");a.className="wave-type-container",e.topPartEl.appendChild(a),e.onWaveChangeCallbackBound=e.onWaveChangeCallback.bind(_e(e)),e.waveTypeSelector=new je(a,e.onWaveChangeCallbackBound,"sine","oscillator-type","Oscillator vågtyp"),e.topPartEl.appendChild(o),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(_e(e));var s={parentEl:o,title:"Oktav",initValue:0,settings:{min:-4,max:4},valChangeCallback:e.onRangeChangeCallbackBound,param:"octave",decimals:0,disable:!1};e.octaveRangeSlider=new Pe(s.parentEl,s.title,s.initValue,s.settings,s.valChangeCallback,s.param,s.decimals,s.disable);var r={useAsInput:!1,value:s.initValue,param:"octave",slider:e.octaveRangeSlider,title:"Octave"},l={useAsInput:!1,value:"sine",param:"oscillator-type",title:"oscillator type",setParam:function(e,t){e.oscillator.type=t}},u={useAsInput:!0,param:"trigger",title:"Trigger",helper:W.oscillatorTrigger};return e.params[r.param]=r,e.params[u.param]=u,e.params[l.param]=l,e.synthParams.push(l.param),e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ge(e,t)}(t,$),n=t,(i=[{key:"enableParam",value:function(e,n){Ue(ze(t.prototype),"enableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!0,this.connectedTriggerID=n.out.ID)}},{key:"disableParam",value:function(e){Ue(ze(t.prototype),"disableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!1,this.connectedTriggerID=-1)}},{key:"onWaveChangeCallback",value:function(e,t){this.params[t].value=e}},{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getParams",value:function(e){e||(e=0);return{}}},{key:"getAudioNode",value:function(){return new te.a.FMSynth}},{key:"getFrequency",value:function(e){var n=12*parseInt(this.params.octave.value)+e;return t.BASE_FREQ*Math.pow(t.ROOT,n)}}])&&Fe(n.prototype,i),o&&Fe(n,o),t}();n(6),n(15),n(17),n(8),n(18),n(9),n(19),n(20),n(21),n(10),n(22),n(23),n(24),n(25),n(26),n(27),n(28),n(29);function We(e){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function qe(e,t){return!t||"object"!==We(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ke(e,t,n){return(Ke="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ze(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Ze(e){return(Ze=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qe(e,t){return(Qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Je=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=qe(this,Ze(t).call(this))).params={},e.inputParams={},e.isForegroundNode=!1,e.isBackgroundNode=!1,e.needsMinMax=!1,e.isRendered=!1,e.currentOutConnections=[],e.currentOutConnectionsLength=0,e.el=document.createElement("div"),e.el.className="node",e.inputHelpersType=L.general,e.isGraphicsNode=!0,e.isRenderNode=!1,e.canConnectToMaterial=!1,e.isCanvasNode=!1,e.dotPos=void 0,e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qe(e,t)}(t,x),n=t,(i=[{key:"init",value:function(e,n,i,o,a,s,r,l,u,c,d,h){Ke(Ze(t.prototype),"init",this).call(this,e,n,i,o,a,s,r,l,u,c,d,h)}},{key:"onConnectionAdd",value:function(e){if(e.detail.inNodeID===this.ID){var t=e.detail.connection,n=window.NS.singletons.ConnectionsManager.params[t.paramID],i=window.NS.singletons.ConnectionsManager.nodes[t.outNodeID];this.enableParam(n,i)}}},{key:"onConnectionRemove",value:function(e){if(e.detail.inNodeID===this.ID){var t=e.detail.connection,n=window.NS.singletons.ConnectionsManager.params[t.paramID],i=window.NS.singletons.ConnectionsManager.nodes[t.outNodeID];this.disableParam(n,i)}}},{key:"enableParam",value:function(e,t){e.enable(),c[e.param.paramHelpersType].update(this,t,e.param)}},{key:"updateParam",value:function(e,t){c[e.param.paramHelpersType].update(this,t,e.param)}},{key:"disableParam",value:function(e,t){e.disable(),c[e.param.paramHelpersType].disconnect(this,e.param,t)}},{key:"onResize",value:function(){}}])&&Xe(n.prototype,i),o&&Xe(n,o),t}();function $e(e){return($e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function et(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function tt(e,t){return!t||"object"!==$e(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function nt(e,t,n){return(nt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=it(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function it(e){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var at=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=tt(this,it(t).call(this))).isForegroundNode=!0,e.isRendered=!0,e.needsUpdate=!0,e.geometry=new THREE.BoxGeometry(3,3,3,10,10,10),e.material=new THREE.MeshPhongMaterial({});var n=new THREE.Mesh(e.geometry,e.material);e.mesh=new THREE.Group,e.mesh.add(n);new THREE.PlaneBufferGeometry(8,2,10,10),new THREE.MeshBasicMaterial({side:THREE.DoubleSide});var i={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Color",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Material",paramHelpersType:"texture",needsFrameUpdate:!1},colorParam:i,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},rotationXParam:{title:"Rotation x",param:"x",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},scaleParam:{title:"Scale",param:"scale",useAsInput:!0,parent:"Scale",paramHelpersType:"scale",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:0}},e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(t,Je),n=t,(i=[{key:"init",value:function(e,n,i,o,a,s,r,l,u,c,d,h){nt(it(t.prototype),"init",this).call(this,e,n,i,o,a,s,r,l,u,c,d,h),this.outputDataConnection=null,this.enabledOutputs=[]}},{key:"getMesh",value:function(){return this.mesh}},{key:"update",value:function(){}},{key:"render",value:function(){}}])&&et(n.prototype,i),o&&et(n,o),t}();function st(e){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function lt(e,t){return!t||"object"!==st(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ut(e,t,n){return(ut="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ct(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ct(e){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dt(e,t){return(dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ht=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=lt(this,ct(t).call(this))).isForegroundNode=!0,e.isRendered=!0,e.needsUpdate=!0,e.geometry=new THREE.SphereGeometry(2,32,32),e.material=new THREE.MeshPhongMaterial({});var n=new THREE.Mesh(e.geometry,e.material);e.mainMesh=n,e.mesh=new THREE.Group,e.mesh.add(n);var i={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Color",paramHelpersType:"color",needsFrameUpdate:!1,defaultConnect:!0};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Texture",paramHelpersType:"texture",needsFrameUpdate:!1,defaultConnect:!0},colorParam:i,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!1},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!0},rotationXParam:{title:"Rotation x",param:"x",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0,defaultConnect:!1},rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0,defaultConnect:!0},scaleParam:{title:"Scale",param:"scale",useAsInput:!0,parent:"Scale",paramHelpersType:"scale",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:1,defaultConnect:!0}},e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dt(e,t)}(t,Je),n=t,(i=[{key:"init",value:function(e,n,i,o,a,s,r,l,u,c,d,h){ut(ct(t.prototype),"init",this).call(this,e,n,i,o,a,s,r,l,u,c,d,h),this.outputDataConnection=null,this.enabledOutputs=[]}},{key:"getMesh",value:function(){return this.mesh}},{key:"update",value:function(){}},{key:"render",value:function(){}}])&&rt(n.prototype,i),o&&rt(n,o),t}();n(31);function pt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ft=function(){function e(t,n,i,o,a){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=i,this.onInputChangeCallback=a,this.decimals=o,this.el=document.createElement("div"),this.el.className="vertical-range-slider";var r=document.createElement("div");r.className="input-container";var l=document.createElement("p");l.innerHTML="Min",r.appendChild(l),this.inputLowEl=document.createElement("input"),this.inputLowEl.type="number",this.inputLowEl.value=-2,this.inputLowEl.step=1,this.inputLowEl.min=-10,this.inputLowEl.max=1,this.inputLowEl.addEventListener("change",this.onInputChangeCallback),r.appendChild(this.inputLowEl);var u=document.createElement("div");u.className="input-container";var c=document.createElement("p");c.innerHTML="Max",u.appendChild(c),this.inputHighEl=document.createElement("input"),this.inputHighEl.type="number",this.inputHighEl.value=2,this.inputHighEl.step=.1,this.inputHighEl.min=2,this.inputHighEl.max=10,this.inputHighEl.addEventListener("change",this.onInputChangeCallback),u.appendChild(this.inputHighEl),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var d=document.createElement("div");d.appendChild(r),d.appendChild(this.rangeInnerContainer),d.appendChild(u),d.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=this.inputLowEl.value;var h=document.createElement("div");h.className="value-container";var p=document.createElement("p");p.innerHTML="Value",h.appendChild(p),h.appendChild(this.valueEl),this.el.appendChild(d),this.el.appendChild(h),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),this.value=0,setTimeout(function(){s.setPos(100)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"setDefaultValues",value:function(e){var t=e.minMax;this.inputLowEl.value=t.min,this.inputLowEl.min=t.min-20,this.inputLowEl.max=t.max+20,this.inputHighEl.value=t.max,this.inputHighEl.min=t.max-20,this.inputHighEl.max=t.max+20;var n=e.defaultVal;this.setValue(n,!0),this.setPos(100)}},{key:"getMinMaxValue",value:function(){return{min:parseFloat(this.inputLowEl.value),max:parseFloat(this.inputHighEl.value)}}},{key:"remove",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e,t){this.value=e,this.setPos(100);var n=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=n,this.valChangeCallback&&!t&&this.valChangeCallback(n)}},{key:"getValue",value:function(){var e=this.getMinMaxValue();return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.setPos(100),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.setPos(100),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.setPos(100),this.valChangeCallback&&(console.log("val change callback"),this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=e-this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(0px, ".concat(t,"px, 0)")}}])&&pt(t.prototype,n),i&&pt(t,i),e}(),vt={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}};function mt(e){return(mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function yt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bt(e,t,n){return(bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wt(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function wt(e){return(wt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ct(e,t){return(Ct=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var kt=function(e){function t(e,n){var i,o,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(a=wt(t).call(this))||"object"!==mt(a)&&"function"!=typeof a?yt(o):a).initValues=n?n.data.visualSettings:null,i.isParam=!0,i.returnsSingleNumber=!0,i.needsUpdate=!0,i.title="Param modifier",i.animateValues={isRunning:!1,timestamp:0,duration:0,reqAnimFrame:-1,firstRunOffset:0},i.onRangeValChangeBound=i.onRangeValChange.bind(yt(i)),i.onInputChangeBound=i.onInputChange.bind(yt(i)),i.modifier={},i.paramVals={},i.params={},i.updateBound=i.update.bind(yt(i)),i.getSettings(),i.update(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ct(e,t)}(t,Je),n=t,(i=[{key:"onInputChange",value:function(e){this.updateVisualSettings(),this.reset()}},{key:"updateVisualSettings",value:function(){var e=this.verticalRangeSlider.getMinMaxValue(),t=this.verticalRangeSlider.value;this.syncVisualSettings({min:e.min,max:e.max,value:t})}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings param-driver-node";var t=document.createElement("div");if(t.className="slider-row",this.verticalRangeSlider=new ft(t,0,this.onRangeValChangeBound,2,this.onInputChangeBound),this.initValues){var n={minMax:{min:this.initValues.min,max:this.initValues.max},defaultVal:this.initValues.value};this.verticalRangeSlider.setDefaultValues(n)}this.durationEl=document.createElement("input"),this.durationEl.type="number",this.durationEl.value=2e3,this.durationEl.step=1,this.durationEl.min=400,this.durationEl.max=1e4,this.durationEl.addEventListener("change",this.onInputChangeBound);var i=document.createElement("div");i.className="duration-container (ms)";var o=document.createElement("p");o.innerHTML="Duration",i.appendChild(o),i.appendChild(this.durationEl);var a=document.createElement("div");a.className="top-bottom-container",a.appendChild(i),this.onToggleStartClickBound=this.onToggleStartClick.bind(this),this.toggleStartBtn=document.createElement("div"),this.toggleStartBtn.className="toggle-start",this.toggleStartBtn.addEventListener("click",this.onToggleStartClickBound),this.toggleBtnText=document.createElement("p"),this.toggleBtnText.innerHTML="Start",this.toggleStartBtn.appendChild(this.toggleBtnText),e.appendChild(t),e.appendChild(a),a.appendChild(this.toggleStartBtn),this.settingsContainer=e}return this.settingsContainer}},{key:"reset",value:function(){this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"}},{key:"onToggleStartClick",value:function(){this.animateValues.isRunning?(this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"):(this.toggleBtnText.innerHTML="Stop",this.animateValues.timestamp=Date.now(),this.animateValues.duration=parseInt(this.durationEl.value),this.animateValues.firstRunOffset=Math.floor(this.verticalRangeSlider.value*this.animateValues.duration),this.animateValues.isReverse=!1,this.animateValues.easing=vt.linear,this.animateValues.isRunning=!0)}},{key:"getValue",value:function(){return this.verticalRangeSlider?this.verticalRangeSlider.getReadyValue():0}},{key:"update",value:function(){if(this.animateValues.isRunning){var e=Date.now(),t=e-this.animateValues.timestamp+this.animateValues.firstRunOffset,n=this.animateValues.easing(Math.min(t/this.animateValues.duration,1)),i=this.animateValues.isReverse?1-n:n;i>=1?(this.animateValues.timestamp=e,this.animateValues.isReverse=!0,this.animateValues.firstRunOffset=0):i<=0&&(this.animateValues.timestamp=e,this.animateValues.isReverse=!1),this.verticalRangeSlider.setValue(i)}}},{key:"render",value:function(){}},{key:"onRangeValChange",value:function(e){this.updateVisualSettings();for(var t=0;t<this.currentOutConnectionsLength;t++){var n=window.NS.singletons.ConnectionsManager.params[this.currentOutConnections[t].connection.paramID];window.NS.singletons.ConnectionsManager.nodes[this.currentOutConnections[t].inNodeID].updateParam(n,this)}}},{key:"onConnectionAdd",value:function(e){e.detail.connection.outNodeID===this.ID&&(this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length)}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,a=this.currentOutConnections.map(function(e){return e}),s=a.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),r=a.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),l=s.concat(r);this.currentOutConnections=l,this.currentOutConnectionsLength=this.currentOutConnections.length}}},{key:"enableInput",value:function(e){bt(wt(t.prototype),"enableInput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),window.cancelAnimationFrame(this.animateValues.reqAnimFrame),bt(wt(t.prototype),"removeFromDom",this).call(this)}}])&&gt(n.prototype,i),o&&gt(n,o),t}();n(33);function Et(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Nt=function(){function e(t,n,i,o,a,s,r,l){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=i,this.height=r||60,this.decimals=o,this.value=(n-a.min)/(a.max-a.min),this.settings=a,this.el=document.createElement("div"),this.el.className="vertical-slider prevent-drag",this.disabledLayer=document.createElement("div"),this.disabledLayer.className="disabled-layer",l&&this.hide(),this.el.appendChild(this.disabledLayer);var c=document.createElement("h4");c.className="vertical-slider-label",c.innerHTML=s,this.el.appendChild(c),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeInnerContainer.style.height="".concat(this.height,"px"),this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var d=document.createElement("div");d.appendChild(this.rangeInnerContainer),d.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=n;var h=document.createElement("div");h.className="value-container",h.appendChild(this.valueEl),this.el.appendChild(d),this.el.appendChild(h),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),setTimeout(function(){u.setPos(u.height)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"hide",value:function(){this.disabledLayer.classList.add("visible")}},{key:"show",value:function(){this.disabledLayer.classList.remove("visible")}},{key:"remove",value:function(){this.rangeInnerContainer.removeEventListener("click",this.onRangeClickBound),this.rangeKnob.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e){this.value=e,this.setPos(this.height);var t=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=t,this.valChangeCallback&&this.valChangeCallback(t)}},{key:"getValue",value:function(){var e=this.settings;return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),i=1-Math.round(100*(e.y-n.top))/100/t;this.value=i>1?1:i<0?0:i,this.setPos(t),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),i=1-Math.round(100*(e.y-n.top))/100/t;this.value=i>1?1:i<0?0:i,this.setPos(t),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),i=1-Math.round(100*(e.y-n.top))/100/t;this.value=i>1?1:i<0?0:i,this.setPos(t),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=e-this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(0px, ".concat(t,"px, 0)")}}])&&Et(t.prototype,n),i&&Et(t,i),e}();function xt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var St=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.toggleVisibilityCallback=n,this.el=document.createElement("div"),this.el.classList.add("visual-helper-settings"),this.parentEl.appendChild(this.el);this.visibilityEnabled=!!i;var o=document.createElement("div");o.classList.add("toggle-visibility-container");var a=document.createElement("h4");a.innerHTML="Toggle visibility",this.toggleVisibilityEl=document.createElement("div"),this.toggleVisibilityEl.classList.add("toggle-visibility"),this.visibilityEnabled&&this.toggleVisibilityEl.classList.add("enabled"),o.appendChild(a),o.appendChild(this.toggleVisibilityEl),this.el.appendChild(o),this.onToggleVisibilityBound=this.onToggleVisibility.bind(this),this.toggleVisibilityEl.addEventListener("click",this.onToggleVisibilityBound)}var t,n,i;return t=e,(n=[{key:"onToggleVisibility",value:function(){this.visibilityEnabled=!this.visibilityEnabled,this.toggleVisibilityCallback(this.visibilityEnabled),this.visibilityEnabled?this.toggleVisibilityEl.classList.add("enabled"):this.toggleVisibilityEl.classList.remove("enabled")}},{key:"enableVisibility",value:function(){this.visibilityEnabled=!0,this.toggleVisibilityEl.classList.add("enabled")}},{key:"disableVisibility",value:function(){this.visibilityEnabled=!1,this.toggleVisibilityEl.classList.remove("enabled")}}])&&xt(t.prototype,n),i&&xt(t,i),e}();n(35);function Mt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Dt=function(){function e(t,n,i,o,a,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.classList.add("dropdown"),this.onSelectedCallback=o;var r=document.createElement("div");r.classList.add("upper-row-container");var l=document.createElement("h4");if(l.innerHTML=i,this.title=i,r.appendChild(l),s){this.resetBtn=document.createElement("div"),this.resetBtn.classList.add("reset-btn"),this.resetBtn.classList.add("button"),this.resetBtn.addEventListener("click",s);var u=document.createElement("h5");u.innerHTML="Reset",this.resetBtn.appendChild(u),r.appendChild(this.resetBtn)}this.el.appendChild(r),this.arrowToggleContainer=document.createElement("div"),this.arrowToggleContainer.classList.add("arrow-toggle-container");var c=document.createElement("img");c.src="./assets/arrow-down-yellow.svg",this.arrowToggleContainer.appendChild(c),this.toggleBound=this.toggle.bind(this),this.arrowToggleContainer.addEventListener("click",this.toggleBound),this.listContainer=document.createElement("div"),this.listContainer.classList.add("list-container"),this.selectedContainer=document.createElement("div"),this.selectedContainer.classList.add("selected-container"),this.selectedContainerTitle=document.createElement("h4"),this.selectedContainerTitle.innerHTML="Nothing selected",this.selectedContainer.appendChild(this.selectedContainerTitle),this.el.appendChild(this.selectedContainer),this.el.appendChild(this.listContainer),this.el.appendChild(this.arrowToggleContainer),this.onItemSelectedBound=this.onItemSelected.bind(this),this.el.addEventListener("click",this.onItemSelectedBound),this.createItems(n,a),this.parentEl=t,this.parentEl.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"createItems",value:function(e,t,n){this.domItems={};for(var i=0;i<e.length;i++){var o=document.createElement("div");o.classList.add("list-item"),o.setAttribute("list-id",e[i].ID||"no-id");var a=document.createElement("h4");a.innerHTML=e[i].title,o.appendChild(a),this.listContainer.appendChild(o);var s=document.createElement("div");s.classList.add("touch-layer"),o.appendChild(s),s.setAttribute("data-id",e[i].title),t&&t===e[i].title&&(this.onSelectedCallback(!0,e[i],this.title),o.classList.add("selected"),this.selectedContainerTitle.innerHTML=t),n&&n===e[i].id&&(o.classList.add("selected"),this.selectedContainerTitle.innerHTML=e[i].title),this.domItems[e[i].title]={el:o,item:e[i]}}}},{key:"update",value:function(e,t){for(var n=null;this.listContainer.firstChild;){var i=this.listContainer.firstChild;i.classList.contains("selected")&&(n=i.getAttribute("list-id")),this.listContainer.removeChild(this.listContainer.firstChild)}this.createItems(e,null,t?null:n),t&&(this.selectedContainerTitle.innerHTML="Nothing selected")}},{key:"toggle",value:function(){this.el.classList.contains("open")?this.closeList():this.openList()}},{key:"openList",value:function(){this.el.classList.add("open")}},{key:"closeList",value:function(){this.el.classList.remove("open")}},{key:"onItemSelected",value:function(e){var t=e.target.getAttribute("data-id")||void 0;if(t){this.closeList();for(var n=Object.keys(this.domItems),i=0;i<n.length;i++)this.domItems[n[i]].el.classList.remove("selected");this.domItems[t].el.classList.add("selected"),this.selectedContainerTitle.innerHTML=t,this.onSelectedCallback(!1,this.domItems[t].item,this.title)}}}])&&Mt(t.prototype,n),i&&Mt(t,i),e}();function Pt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Tt=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onSelectedCallback=n;this.el=document.createElement("div"),this.el.innerHTML='\n            <div class="center-point-settings">\n                <div class="dropdown-container">\n                </div>\n            </div>\n        ';var a=this.el.querySelector(".dropdown-container"),s=this.getNodes();this.dropdown=new Dt(a,s,"Nodes",this.onSelectedCallback,i,o),t.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"getNodes",value:function(e){for(var t=[],n=Object.keys(window.NS.singletons.ConnectionsManager.nodes),i=0;i<n.length;i++){var o=window.NS.singletons.ConnectionsManager.nodes[n[i]];o.isModifier||o.ID===e||t.push(o)}return t}},{key:"refresh",value:function(e,t){var n=this.getNodes(e);this.dropdown.update(n,t)}}])&&Pt(t.prototype,n),i&&Pt(t,i),e}();n(37);function Ot(e){return(Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function It(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rt(e,t,n){return(Rt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Bt(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Bt(e){return(Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vt(e,t){return(Vt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var At=function(e){function t(e,n){var i,o,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(a=Bt(t).call(this))||"object"!==Ot(a)&&"function"!=typeof a?Lt(o):a).initValues=n?n.data.visualSettings:null,i.needsUpdate=!0,i.title="Orbit modifier",i.isVisualHelper=!0,i.isForegroundNode=!0,i.isParam=!0,i.animateValues={isRunning:!!i.initValues&&i.initValues.isRunning,reqAnimFrame:-1,counter:1552337385540},i.currentT=0,i.currentSpeed=i.initValues&&i.initValues.speed?.001*i.initValues.speed:0,i.onNodeAddedFromConnectionsManagerEventBound=i.onNodeAddedFromConnectionsManagerEvent.bind(Lt(i)),i.onNodeRemovedFromConnectionsManagerEventBound=i.onNodeRemovedFromConnectionsManagerEvent.bind(Lt(i)),document.documentElement.addEventListener("node-added-event",i.onNodeAddedFromConnectionsManagerEventBound),document.documentElement.addEventListener("node-remove-event",i.onNodeRemovedFromConnectionsManagerEventBound),i.outValues={Position:{x:0,y:0,z:0}},i.targetNode=null,i.onSpeedChangeBound=i.onSpeedChange.bind(Lt(i)),i.onOrbitXChangeBound=i.onOrbitXChange.bind(Lt(i)),i.onOrbitYChangeBound=i.onOrbitYChange.bind(Lt(i)),i.onOrbitZChangeBound=i.onOrbitZChange.bind(Lt(i));var s=i.initValues&&i.initValues.orbitX?i.initValues.orbitX:0,r=i.initValues&&i.initValues.orbitY?i.initValues.orbitY:0;i.curve=new THREE.EllipseCurve(0,0,s,r,0,2*Math.PI,!1,0);for(var l=i.curve.getPoints(50),u=new Float32Array(153),c=0,d=0;d<51;d++)u[c++]=l[d].x,u[c++]=0,u[c++]=l[d].y;var h=new THREE.BufferGeometry;i.bufferAttr=new THREE.BufferAttribute(u,3),i.bufferAttr.setDynamic(!0),h.addAttribute("position",i.bufferAttr);var p=new THREE.LineBasicMaterial({color:16711680});return i.mesh=new THREE.Line(h,p),i.mesh.visible=!(!i.initValues||!i.initValues.visualHelperEnabled)&&i.initValues.visualHelperEnabled,i.onToggleStartClickBound=i.onToggleStartClick.bind(Lt(i)),i.onToggleVisualHelperVisibilityBound=i.onToggleVisualHelperVisibility.bind(Lt(i)),i.onCenterPointSelectedBound=i.onCenterPointSelected.bind(Lt(i)),i.onConnectionUpdateBound=i.onConnectionUpdate.bind(Lt(i)),document.documentElement.addEventListener("node-connections-update",i.onConnectionUpdateBound),i.nodeConnectedID,i.onCenterPointListResetClickBound=i.onCenterPointListResetClick.bind(Lt(i)),i.updateAxes(),i.getSettings(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vt(e,t)}(t,Je),n=t,(i=[{key:"onCenterPointListResetClick",value:function(){if(this.refreshSettings(!0),this.targetNode=null,this.updateVisualSettings(),this.nodeConnectedID){var e=window.NS.singletons.ConnectionsManager.nodes[this.nodeConnectedID];e.mesh.position.x=0,e.mesh.position.y=0,e.mesh.position.z=0}this.curve.aX=0,this.curve.aY=0,this.updateMesh()}},{key:"onConnectionUpdate",value:function(e){var t=this;this.nodeConnectedID=function(e){for(var n=Object.keys(e),i=0;i<n.length;i++)if(e[n[i]].some(function(e){return e.outNodeID===t.ID}))return n[i]}(e.detail)}},{key:"onNodeAddedFromConnectionsManagerEvent",value:function(){this.refreshSettings()}},{key:"onNodeRemovedFromConnectionsManagerEvent",value:function(){this.refreshSettings()}},{key:"hideSettings",value:function(){}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings orbit-driver-node";var t=document.createElement("div");t.className="slider-row";var n=document.createElement("div");n.className="slider-row bottom-container";var i=new Nt(t,this.initValues?this.initValues.orbitX:10,this.onOrbitXChangeBound,0,{min:0,max:40},"Radie X",60,!0),o=new Nt(t,this.initValues?this.initValues.orbitY:10,this.onOrbitYChangeBound,0,{min:0,max:40},"Radie Y",60,!0),a=new Nt(t,this.initValues?this.initValues.orbitY:10,this.onOrbitZChangeBound,0,{min:0,max:40},"Radie Z",60,!0);new Nt(t,this.initValues?this.initValues.speed:0,this.onSpeedChangeBound,4,{min:0,max:10},"Orbit speed");this.orbitSliders={Position:{x:i,y:o,z:a},Form:{x:i,y:o,z:a}},this.visualHelperSettings=new St(n,this.onToggleVisualHelperVisibilityBound,this.initValues&&this.initValues.visualHelperEnabled?this.initValues.visualHelperEnabled:void 0);var s=this.initValues&&this.initValues.targetNode&&window.NS.singletons.ConnectionsManager.nodes[this.initValues.targetNode]?window.NS.singletons.ConnectionsManager.nodes[this.initValues.targetNode].title:null;this.centerPointSettings=new Tt(n,this.onCenterPointSelectedBound,s,this.onCenterPointListResetClickBound),this.toggleStartBtn=document.createElement("div"),this.toggleStartBtn.className="toggle-start",this.toggleStartBtn.addEventListener("click",this.onToggleStartClickBound),this.toggleBtnText=document.createElement("h4"),this.toggleBtnText.innerHTML=this.initValues&&this.initValues.isRunning?"Stop":"Start",this.toggleStartBtn.appendChild(this.toggleBtnText),e.appendChild(t),e.appendChild(n),e.appendChild(this.toggleStartBtn),this.settingsContainer=e}return this.refreshSettings(),this.settingsContainer}},{key:"onOrbitXChange",value:function(e){this.curve.xRadius=e,this.updateVisualSettings()}},{key:"onOrbitYChange",value:function(e){this.curve.yRadius=e,this.updateVisualSettings()}},{key:"onOrbitZChange",value:function(e){this.curve.yRadius=e,this.updateVisualSettings()}},{key:"onSpeedChange",value:function(e){this.currentSpeed=.001*e,this.updateVisualSettings()}},{key:"onToggleVisualHelperVisibility",value:function(e){this.mesh.visible=e,this.updateVisualSettings()}},{key:"onCenterPointSelected",value:function(e,t){this.targetNode=t,e||this.updateVisualSettings()}},{key:"updateVisualSettings",value:function(){this.syncVisualSettings({orbitX:this.curve.xRadius,orbitY:this.curve.yRadius,speed:1e3*this.currentSpeed,isRunning:this.animateValues.isRunning,visualHelperEnabled:this.mesh.visible,targetNode:this.targetNode?this.targetNode.ID:null}),this.updateMesh()}},{key:"reset",value:function(){this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"}},{key:"onToggleStartClick",value:function(e){this.animateValues.isRunning?(this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"):(this.toggleBtnText.innerHTML="Stop",this.animateValues.isRunning=!0),this.updateVisualSettings()}},{key:"getValue",value:function(e){return this.outValues[e.parent][e.param]}},{key:"update",value:function(){if(this.targetNode&&this.nodeConnectedID){var e=this.targetNode.mesh.position,t={x:e.x,y:e.y,z:e.z},n=this.targetNode.nodeType.getEnabledParamsForType("Position",{x:{enabled:!1},y:{enabled:!1},z:{enabled:!1}}),i=0,o=this.curve.getPoint(this.currentT);this.enabledAxes.x?(this.curve.aX=this.targetNode.mesh.position.x,t.x=o.x):this.curve.aX=0,this.enabledAxes.y&&(i=this.targetNode.mesh.position.y,t.y=o.y),this.enabledAxes.z&&(i=this.targetNode.mesh.position.z,t.z=o.y),this.curve.aY=i;var a={};!this.enabledAxes.x&&n.x.enabled&&(a.x=this.targetNode.mesh.position.x),!this.enabledAxes.y&&n.y.enabled&&(a.y=this.targetNode.mesh.position.y),!this.enabledAxes.z&&n.z.enabled&&(a.z=this.targetNode.mesh.position.z);var s=window.NS.singletons.ConnectionsManager.nodes[this.nodeConnectedID];s.mesh.position.x=t.x,s.mesh.position.y=t.y,s.mesh.position.z=t.z,this.updateMesh(a)}else{this.curve.aX=0,this.curve.aY=0;var r=this.curve.getPoint(this.currentT);this.outValues.Position.x=r.x,this.outValues.Position.y=r.y,this.outValues.Position.z=r.y;for(var l=0;l<this.currentOutConnectionsLength;l++){var u=this.currentOutConnections[l],c=window.NS.singletons.ConnectionsManager.nodes[u.inNodeID],d=window.NS.singletons.ConnectionsManager.params[u.connection.paramID];c.updateParam(d,this)}}this.animateValues.isRunning&&(this.currentT+=this.currentSpeed,this.currentT>1&&(this.currentT=0))}},{key:"updateAxes",value:function(){this.enabledAxes={x:!1,y:!1,z:!1};for(var e=0;e<this.currentOutConnectionsLength;e++){var t=this.currentOutConnections[e],n=window.NS.singletons.ConnectionsManager.params[t.connection.paramID];this.enabledAxes[n.param.param]=!0}}},{key:"updateMesh",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.curve.getPoints(50),n=new Float32Array(153),i=0,o=0;o<51;o++)n[i++]=this.enabledAxes.x?t[o].x:e.x||0,n[i++]=this.enabledAxes.y?t[o].y:e.y||0,n[i++]=this.enabledAxes.z?t[o].y:e.z||0;this.bufferAttr.set(n),this.mesh.geometry.attributes.position.needsUpdate=!0}},{key:"render",value:function(){}},{key:"refreshSettings",value:function(e){this.centerPointSettings.refresh(this.nodeConnectedID,e)}},{key:"onConnectionAdd",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=window.NS.singletons.ConnectionsManager.params[t.paramID];this.orbitSliders[n.param.parent][n.param.param].show(),this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength>0&&(this.mesh.visible=!0,this.visualHelperSettings.enableVisibility(),this.updateAxes(),this.updateMesh(),this.refreshSettings())}}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,a=window.NS.singletons.ConnectionsManager.params[t.paramID];this.orbitSliders[a.param.parent][a.param.param].hide();var s=this.currentOutConnections.map(function(e){return e}),r=s.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),l=s.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),u=r.concat(l);this.currentOutConnections=u,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&(this.reset(),this.mesh.visible=!1,this.visualHelperSettings.disableVisibility()),this.updateAxes(),this.updateMesh(),this.refreshSettings()}}},{key:"enableInput",value:function(e){Rt(Bt(t.prototype),"enableInput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),window.cancelAnimationFrame(this.animateValues.reqAnimFrame),Rt(Bt(t.prototype),"removeFromDom",this).call(this)}},{key:"updateAllowedInputParams",value:function(e){var t=Object.keys(e),n=t.filter(function(t){return e[t].isConnected}),i=t.filter(function(t){return!e[t].isConnected});if(n.length>=2)for(var o=0;o<i.length;o++){var a=i[o];e[a].setConnectionAllowed(!1)}else for(var s=0;s<t.length;s++)e[t[s]].setConnectionAllowed(!0);var r=t.filter(function(t){return"y"===e[t].param.param}),l=t.filter(function(t){return"z"===e[t].param.param});e[r]&&e[l]&&(e[r].isConnected&&e[l].setConnectionAllowed(!1),e[l].isConnected&&e[r].setConnectionAllowed(!1))}}])&&It(n.prototype,i),o&&It(n,o),t}();n(39);function jt(e){return(jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ht(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ft(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _t(e,t,n){return(_t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ut(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Ut(e){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zt(e,t){return(zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Gt=function(e){function t(e,n){var i,o,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(a=Ut(t).call(this))||"object"!==jt(a)&&"function"!=typeof a?Ft(o):a).initValues=n?n.data.visualSettings:null,i.needsUpdate=!0,i.title="Rotation modifier",i.isParam=!0,i.currentRotationY=i.initValues&&i.initValues.rotationX?i.initValues.rotationX:0,i.currentRotationX=i.initValues&&i.initValues.rotationY?i.initValues.rotationY:0,i.outValues={Rotation:{x:0,y:0}},i.onRotationChangeYBound=i.onRotationChangeY.bind(Ft(i)),i.onRotationChangeXBound=i.onRotationChangeX.bind(Ft(i)),i.getSettings(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zt(e,t)}(t,Je),n=t,(i=[{key:"hideSettings",value:function(){}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings rotation-driver-node";var t=document.createElement("div");t.className="slider-row";var n=new Nt(t,this.initValues?this.initValues.rotationX:0,this.onRotationChangeXBound,3,{min:-.1,max:.1},"Rotation X",60,!0),i=new Nt(t,this.initValues?this.initValues.rotationY:0,this.onRotationChangeYBound,3,{min:-.1,max:.1},"Rotation Y",60,!0);this.rotationSliders={Rotation:{x:n,y:i}},e.appendChild(t),this.settingsContainer=e}return this.settingsContainer}},{key:"onRotationChangeX",value:function(e){this.currentRotationX=e,this.updateVisualSettings()}},{key:"onRotationChangeY",value:function(e){this.currentRotationY=e,this.updateVisualSettings()}},{key:"updateVisualSettings",value:function(){this.syncVisualSettings({rotationX:this.currentRotationX,rotationY:this.currentRotationY})}},{key:"reset",value:function(){}},{key:"getValue",value:function(e){return this.outValues[e.parent][e.param]}},{key:"update",value:function(){this.outValues.Rotation.y+=this.currentRotationY,this.outValues.Rotation.x+=this.currentRotationX;for(var e=0;e<this.currentOutConnectionsLength;e++){var t=this.currentOutConnections[e],n=window.NS.singletons.ConnectionsManager.nodes[t.inNodeID],i=window.NS.singletons.ConnectionsManager.params[t.connection.paramID];n.updateParam(i,this)}}},{key:"render",value:function(){}},{key:"onConnectionAdd",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=window.NS.singletons.ConnectionsManager.params[t.paramID];this.rotationSliders[n.param.parent][n.param.param].show(),this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length}}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,a=window.NS.singletons.ConnectionsManager.params[t.paramID];this.rotationSliders[a.param.parent][a.param.param].hide();var s=this.currentOutConnections.map(function(e){return e}),r=s.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),l=s.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),u=r.concat(l);this.currentOutConnections=u,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&this.reset()}}},{key:"enableInput",value:function(e){_t(Ut(t.prototype),"enableInput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),_t(Ut(t.prototype),"removeFromDom",this).call(this)}}])&&Ht(n.prototype,i),o&&Ht(n,o),t}(),Yt=n(41);function Wt(e){return(Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function qt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kt(e,t,n){return(Kt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Zt(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Zt(e){return(Zt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qt(e,t){return(Qt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Jt=function(e){function t(e,n){var i,o,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(a=Zt(t).call(this))||"object"!==Wt(a)&&"function"!=typeof a?qt(o):a).el.classList.add("color-node"),i.title="Color modifier",i.isParam=!0,i.paramVals={},i.params={},n&&n.data&&n.data.visualSettings?i.currentColor=new THREE.Color(n.data.visualSettings.color):i.currentColor=void 0,i.onPickerChangeBound=i.onPickerChange.bind(qt(i)),i.onColorClickBound=i.onColorClick.bind(qt(i)),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qt(e,t)}(t,Je),n=t,(i=[{key:"onConnectionAdd",value:function(e){var n=e.detail;if(this.ID===n.inNodeID)Kt(Zt(t.prototype),"onConnectionAdd",this).call(this,e.detail);else if(this.ID===n.connection.outNodeID){var i={paramID:n.connection.paramID,outNodeID:n.connection.outNodeID,inNodeID:n.inNodeID},o=window.NS.singletons.ConnectionsManager.params[i.paramID];this.enableOutput(o.param,i)}}},{key:"onConnectionRemove",value:function(e){var n=e.detail;this.ID===n.inNodeID?Kt(Zt(t.prototype),"onConnectionRemove",this).call(this,e):this.ID===n.connection.outNodeID&&this.disableOutput(n.connection.paramID)}},{key:"onColorClick",value:function(){this.picker.show()}},{key:"getSettings",value:function(){if(!this.settingsContainer){this.settingsContainer=document.createElement("div"),this.settingsContainer.className="node-settings color-node";var e=document.createElement("h4");e.innerHTML="Välj färg",this.colorPreview=document.createElement("div"),this.colorPreview.className="color-preview",this.settingsContainer.appendChild(e),this.settingsContainer.appendChild(this.colorPreview),this.picker=new Yt.a}return this.colorPreview.addEventListener("click",this.onColorClickBound),this.settingsContainer}},{key:"afterSettingsAddedToDom",value:function(){var e={parent:this.settingsContainer,color:this.currentColor?this.currentColor.getStyle():"#FFFFFF",alpha:!1};if(this.picker.setOptions(e),this.picker.onChange=this.onPickerChangeBound,this.currentColor){var t="#".concat(this.currentColor.getHexString());this.setColor(t)}}},{key:"hideSettings",value:function(){this.colorPreview.removeEventListener("click",this.onColorClickBound)}},{key:"onPickerChange",value:function(e){if(e._rgba){var t="rgb(".concat(e._rgba[0],",").concat(e._rgba[1],",").concat(e._rgba[2],")");this.setColor(t),this.currentColor=new THREE.Color(e.rgbString),this.syncVisualSettings({color:e.rgbString});for(var n=0;n<this.currentOutConnectionsLength;n++){var i=this.currentOutConnections[n].paramID,o=this.currentOutConnections[n].inNodeID,a=window.NS.singletons.ConnectionsManager.params[i];window.NS.singletons.ConnectionsManager.nodes[o].updateParam(a,this)}}}},{key:"getValue",value:function(){return this.currentColor}},{key:"setColor",value:function(e){this.colorPreview&&(this.colorPreview.style.background=e)}},{key:"enableOutput",value:function(e,n){if(Kt(Zt(t.prototype),"enableOutput",this).call(this,e,n),1===this.currentOutConnectionsLength){var i="#".concat(e.defaultVal.getHexString());this.currentColor?i=this.currentColor.getHexString():this.currentColor=e.defaultVal,this.picker&&(this.picker.color=i),this.setColor(i)}}}])&&Xt(n.prototype,i),o&&Xt(n,o),t}();function $t(e){return($t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function en(e,t){return!t||"object"!==$t(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function tn(e){return(tn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nn(e,t){return(nn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var on=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=en(this,tn(t).call(this))).isLightNode=!0,e.el.classList.add("no-height"),e.light=new THREE.DirectionalLight(16777215,1),e.light.position.set(0,0,0),e.geometry=new THREE.SphereGeometry(1,10,10),e.material=new THREE.MeshBasicMaterial,e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Material",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={colorParam:n,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:4}},e.paramVals={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nn(e,t)}(t,Je),t}();function an(e){return(an="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sn(e,t){return!t||"object"!==an(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function rn(e){return(rn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ln(e,t){return(ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var un=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=sn(this,rn(t).call(this))).isLightNode=!0,e.isRendered=!0,e.light=new THREE.PointLight(16777215,1,100),e.light.position.set(0,0,0),e.geometry=new THREE.SphereGeometry(1,20,20),e.material=new THREE.MeshBasicMaterial,e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Color",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Texture",paramHelpersType:"texture",needsFrameUpdate:!1},colorParam:n,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},scaleParam:{title:"Scale",param:"scale",useAsInput:!0,parent:"Scale",paramHelpersType:"scale",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:1}},e.paramVals={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ln(e,t)}(t,Je),t}(),cn={Rymden:[{title:"Jorden",name:"space/2k_earth_daymap.jpg"},{title:"Solen",name:"space/2k_sun.jpg"},{title:"Mars",name:"space/2k_mars.jpg"},{title:"Månen",name:"space/2k_moon.jpg"}]};function dn(e){return(dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function pn(e){return(pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vn(e,t){return(vn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var mn=function(e){function t(e,n){var i,o,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(a=pn(t).call(this))||"object"!==dn(a)&&"function"!=typeof a?fn(o):a).initValues=n?n.data.visualSettings:null,i.isBackgroundNode=!0,i.isParam=!0,i.title="Texture Selector",i.hasSelectedTexture=!1,i.onTextureSelectedBound=i.onTextureSelected.bind(fn(i)),i.texture=(new THREE.TextureLoader).load("assets/textures/blank.jpg"),i.texture.magFilter=THREE.LinearFilter,i.texture.minFilter=THREE.LinearFilter,i.params={},i.paramVals={},i.dropdowns={},i.getSettings(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vn(e,t)}(t,Je),n=t,(i=[{key:"updateVisualSettings",value:function(e,t){var n,i,o;this.syncVisualSettings((o=e,(i=t)in(n={})?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o,n))}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings texture-selector-node";for(var t=Object.keys(cn),n=0;n<t.length;n++){var i=t[n],o=cn[i],a=this.initValues?this.initValues[i]:null,s=new Dt(e,o,i,this.onTextureSelectedBound,a);this.dropdowns[i]=s}this.settingsContainer=e}return this.settingsContainer}},{key:"onTextureSelected",value:function(e,t,n){var i="assets/textures/".concat(t.name);this.texture=(new THREE.TextureLoader).load(i),e||this.updateVisualSettings(t.title,n),this.hasSelectedTexture=!0;for(var o=0;o<this.currentOutConnectionsLength;o++){var a=window.NS.singletons.ConnectionsManager.params[this.currentOutConnections[o].connection.paramID];window.NS.singletons.ConnectionsManager.nodes[this.currentOutConnections[o].inNodeID].updateParam(a,this)}}},{key:"onConnectionAdd",value:function(e){if(e.detail.connection.outNodeID===this.ID&&(this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length,this.hasSelectedTexture)){var t=window.NS.singletons.ConnectionsManager.params[this.currentOutConnections[this.currentOutConnectionsLength-1].connection.paramID];window.NS.singletons.ConnectionsManager.nodes[this.currentOutConnections[this.currentOutConnectionsLength-1].inNodeID].updateParam(t,this)}}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,a=this.currentOutConnections.map(function(e){return e}),s=a.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),r=a.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),l=s.concat(r);this.currentOutConnections=l,this.currentOutConnectionsLength=this.currentOutConnections.length}}}])&&hn(n.prototype,i),o&&hn(n,o),t}();function gn(e){return(gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function bn(e,t){return!t||"object"!==gn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function wn(e,t,n){return(wn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Cn(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Cn(e){return(Cn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function kn(e,t){return(kn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var En=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=bn(this,Cn(t).call(this))).isForegroundNode=!0,e.needsUpdate=!0,e.isRendered=!0,e.particles=600;var n=THREE.UniformsUtils.merge([THREE.UniformsLib.lights,{diffuse:{type:"c",value:new THREE.Color(255)}}]);e.material=new THREE.ShaderMaterial({uniforms:n,vertexShader:S,fragmentShader:M,depthTest:!0,transparent:!0,vertexColors:!0}),e.geometry=new THREE.BufferGeometry;var i=[],o=[],a=[];e.currentParticleSize=2,e.currentParticleColor=[1,1,1],e.offsets=[];for(var s=0;s<e.particles;s++)i.push(2*Math.random()-1),i.push(2*Math.random()-1),i.push(2*Math.random()-1),o.push(1,1,1),a.push(e.currentParticleSize),e.offsets.push(2*Math.random()-1),e.offsets.push(2*Math.random()-1),e.offsets.push(2*Math.random()-1);e.geometry.addAttribute("position",new THREE.Float32BufferAttribute(i,3).setDynamic(!0)),e.geometry.addAttribute("color",new THREE.Float32BufferAttribute(o,3).setDynamic(!0)),e.geometry.addAttribute("size",new THREE.Float32BufferAttribute(a,1).setDynamic(!0)),e.pointsMesh=new THREE.Points(e.geometry,e.material),e.mainMesh=e.pointsMesh,e.mesh=new THREE.Group,e.mesh.add(e.pointsMesh);var r={title:"Color",param:"color",useAsInput:!0,parent:"Material",paramHelpersType:"particleColor",needsFrameUpdate:!1,defaultVal:new THREE.Color(e.currentParticleColor[0],e.currentParticleColor[1],e.currentParticleColor[2]),defaultConnect:!0},l={title:"Form X",param:"x",useAsInput:!0,parent:"Form",paramHelpersType:"particleForm",needsFrameUpdate:!1,defaultVal:2*Math.random()-1,defaultConnect:!0},u={title:"Form Y",param:"y",useAsInput:!0,parent:"Form",paramHelpersType:"particleForm",needsFrameUpdate:!1,defaultVal:2*Math.random()-1,defaultConnect:!1},c={title:"Form Z",param:"z",useAsInput:!0,parent:"Form",paramHelpersType:"particleForm",needsFrameUpdate:!1,defaultVal:2*Math.random()-1,defaultConnect:!0},d={title:"Size",param:"storlek",useAsInput:!0,parent:"Storlek",paramHelpersType:"particleSize",needsFrameUpdate:!1,defaultVal:e.currentParticleSize,minMax:{min:1,max:10},defaultConnect:!0};return e.params={colorParam:r,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!1},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!0},rotationXParam:{title:"Rotation x",param:"x",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0,defaultConnect:!1},rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0,defaultConnect:!0},formXParam:l,formYParam:u,formZParam:c,sizeParam:d},e.paramVals={},e.curve=null,e.connectedFormParams={x:0,y:0,z:0},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&kn(e,t)}(t,Je),n=t,(i=[{key:"init",value:function(e,n,i,o,a,s,r,l,u,c,d,h){wn(Cn(t.prototype),"init",this).call(this,e,n,i,o,a,s,r,l,u,c,d,h),this.outputDataConnection=null,this.enabledOutputs=[]}},{key:"getMesh",value:function(){return this.mesh}},{key:"enableParam",value:function(e,t){e.enable(),"Form"===e.param.parent&&(this.connectedFormParams[e.param.param]=1,this.curve=t.curve),c[e.param.paramHelpersType].update(this,t,e.param)}},{key:"updateParam",value:function(e,t){c[e.param.paramHelpersType].update(this,t,e.param)}},{key:"disableParam",value:function(e,t){var n=this;(e.disable(),"Form"===e.param.parent)&&(this.connectedFormParams[e.param.param]=0,Object.keys(this.connectedFormParams).some(function(e){return n.connectedFormParams[e]>0})||(this.curve=null));c[e.param.paramHelpersType].disconnect(this,e.param,t)}},{key:"update",value:function(){}},{key:"render",value:function(){for(var e=this.geometry.attributes.position.array,t=this.geometry.attributes.size.array,n=this.geometry.attributes.color.array,i=1===this.connectedFormParams.x,o=1===this.connectedFormParams.y,a=1===this.connectedFormParams.z,s=!!this.curve,r=this.params.formXParam.defaultVal,l=this.params.formYParam.defaultVal,u=this.params.formZParam.defaultVal,c=this.currentParticleColor[0],d=this.currentParticleColor[1],h=this.currentParticleColor[2],p=0;p<this.particles;p++){var f=p/this.particles,v=s?this.curve.getPoint(f):void 0,m=3*p;e[m]=i?v.x+this.offsets[m]:r+this.offsets[m],e[m+1]=o?v.y+this.offsets[m+1]:l+this.offsets[m+1],e[m+2]=a?v.y+this.offsets[m+2]:u+this.offsets[m+2],t[p]=this.currentParticleSize,n[m]=c,n[m+1]=d,n[m+2]=h}this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.size.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0}}])&&yn(n.prototype,i),o&&yn(n,o),t}();n(44);function Nn(e){return(Nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Sn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mn(e,t,n){return(Mn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Dn(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Dn(e){return(Dn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pn(e,t){return(Pn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Tn={Kick:{obj:Ve},FMSynth:{obj:Ye},SequencerNode:{obj:ye},WaveformNode:{obj:Me},SpeakerNode:{obj:re},Sphere:{obj:ht,isModifier:!1},Cube:{obj:at,isModifier:!1},ParamDriver:{obj:kt,isModifier:!0},OrbitDriver:{obj:At,isModifier:!0},RotationDriver:{obj:Gt,isModifier:!0},Color:{obj:Jt,isModifier:!0},Form:{obj:function(e){function t(e,n){var i,o,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(a=Dn(t).call(this))||"object"!==Nn(a)&&"function"!=typeof a?Sn(o):a).initValues=n?n.data.visualSettings:null,i.needsUpdate=!0,i.title="Shape modifier",i.isForegroundNode=!0,i.isShapeNode=!0,i.isParam=!0,i.onOrbitXChangeBound=i.onOrbitXChange.bind(Sn(i)),i.onOrbitYChangeBound=i.onOrbitYChange.bind(Sn(i)),i.onOrbitZChangeBound=i.onOrbitZChange.bind(Sn(i));var s=i.initValues&&i.initValues.orbitX?i.initValues.orbitX:0,r=i.initValues&&i.initValues.orbitY?i.initValues.orbitY:0;i.curve=new THREE.EllipseCurve(0,0,s,r,0,2*Math.PI,!1,0);for(var l=i.curve.getPoints(50),u=new Float32Array(153),c=0,d=0;d<51;d++)u[c++]=l[d].x,u[c++]=0,u[c++]=l[d].y;return i.updateAxes(),i.getSettings(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pn(e,t)}(t,Je),n=t,(i=[{key:"hideSettings",value:function(){}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings shape-modifier-node";var t=document.createElement("div");t.className="slider-row";var n=document.createElement("div");n.className="slider-row bottom-container";var i=new Nt(t,this.initValues?this.initValues.orbitX:10,this.onOrbitXChangeBound,0,{min:0,max:40},"Radie X",60,!0),o=new Nt(t,this.initValues?this.initValues.orbitY:10,this.onOrbitYChangeBound,0,{min:0,max:40},"Radie Y",60,!0),a=new Nt(t,this.initValues?this.initValues.orbitY:10,this.onOrbitZChangeBound,0,{min:0,max:40},"Radie Z",60,!0);this.orbitSliders={Position:{x:i,y:o,z:a},Form:{x:i,y:o,z:a}},e.appendChild(t),e.appendChild(n),this.settingsContainer=e}return this.settingsContainer}},{key:"onOrbitXChange",value:function(e){this.curve.xRadius=e,this.updateVisualSettings()}},{key:"onOrbitYChange",value:function(e){this.curve.yRadius=e,this.updateVisualSettings()}},{key:"onOrbitZChange",value:function(e){this.curve.yRadius=e,this.updateVisualSettings()}},{key:"updateVisualSettings",value:function(){this.syncVisualSettings({orbitX:this.curve.xRadius,orbitY:this.curve.yRadius})}},{key:"reset",value:function(){}},{key:"getValue",value:function(e){return this.outValues[e.parent][e.param]}},{key:"update",value:function(){}},{key:"updateAxes",value:function(){this.enabledAxes={x:!1,y:!1,z:!1};for(var e=0;e<this.currentOutConnectionsLength;e++){var t=this.currentOutConnections[e],n=window.NS.singletons.ConnectionsManager.params[t.connection.paramID];this.enabledAxes[n.param.param]=!0}}},{key:"render",value:function(){}},{key:"onConnectionAdd",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=window.NS.singletons.ConnectionsManager.params[t.paramID];this.orbitSliders[n.param.parent][n.param.param].show(),this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength>0&&this.updateAxes()}}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,a=window.NS.singletons.ConnectionsManager.params[t.paramID];this.orbitSliders[a.param.parent][a.param.param].hide();var s=this.currentOutConnections.map(function(e){return e}),r=s.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),l=s.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),u=r.concat(l);this.currentOutConnections=u,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&this.reset(),this.updateAxes()}}},{key:"enableInput",value:function(e){Mn(Dn(t.prototype),"enableInput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),Mn(Dn(t.prototype),"removeFromDom",this).call(this)}},{key:"updateAllowedInputParams",value:function(e){var t=Object.keys(e),n=t.filter(function(t){return e[t].isConnected}),i=t.filter(function(t){return!e[t].isConnected});if(n.length>=2)for(var o=0;o<i.length;o++){var a=i[o];e[a].setConnectionAllowed(!1)}else for(var s=0;s<t.length;s++)e[t[s]].setConnectionAllowed(!0);var r=t.filter(function(t){return"y"===e[t].param.param}),l=t.filter(function(t){return"z"===e[t].param.param});e[r].isConnected&&e[l].setConnectionAllowed(!1),e[l].isConnected&&e[r].setConnectionAllowed(!1)}}])&&xn(n.prototype,i),o&&xn(n,o),t}(),isModifier:!0},"Directional Light":{obj:on,isModifier:!1},"Point Light":{obj:un,isModifier:!1},"Texture Selector":{obj:mn,isModifier:!0},Particles:{obj:En,isModifier:!1}};function On(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var In=function(){function e(t,n,i,o,a,s,r,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onDisconnectCallback=n,this.onInputConnectionCallback=i,this.addCallback=o,this.removeCallback=a,this.onNodeDragStart=s,this.onNodeDragMove=r,this.onNodeDragRelease=l,this.mainRenderer=new T}var t,n,i;return t=e,(n=[{key:"createNode",value:function(e,t,n){var i,o=(i=e.type,Tn[i]),a=o.obj,s=o.isModifier,r=new a(this.mainRenderer,n);return r.init(t,this.parentEl,this.onDisconnectCallback,this.onInputConnectionCallback,e.type,n,this.removeCallback,s,this.onNodeDragStart,this.onNodeDragMove,this.onNodeDragRelease,this.addCallback),r.onResize({w:540,h:538}),r}},{key:"createCanvasNode",value:function(){var e=new Y(this.mainRenderer),t=document.querySelector(".workspace-container");return e.init(t),e}}])&&On(t.prototype,n),i&&On(t,i),e}();function Ln(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Rn=function(){function e(t,n,i,o,a,s,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onConnectingCallback=n,this.onInputConnectionCallback=i,this.addCallback=o,this.initData=a,this.onParameterChange=s,this.onNodeRemove=r}var t,n,i;return t=e,(n=[{key:"init",value:function(){if(this.initData)for(var e=0;e<this.initData.length;e++)this.initData[e].node.init(this.parentEl,this.onConnectingCallback,this.onInputConnectionCallback,this.initData[e].type,this.initData[e],this.onParameterChange,this.onNodeRemove),this.addCallback(this.initData[e].node)}},{key:"createNode",value:function(e,t){var n=new e.obj;n.init(t,this.parentEl,this.onConnectingCallback,this.onInputConnectionCallback,e.type,void 0,this.onParameterChange,this.onNodeRemove),this.addCallback(n)}}])&&Ln(t.prototype,n),i&&Ln(t,i),e}();n(46);function Bn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Vn=function(){function e(t,n,i,o){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.currentNode=null,this.enableParamCallback=n,this.disableParamCallback=i,this.onShowCallback=o,this.el=document.createElement("div"),this.el.className="connection-window window",this.contentContainer=document.createElement("div"),this.contentContainer.className="content-container";var s=document.createElement("h5");s.className="title",s.innerHTML="CONNECTION SETTINGS",this.closeBtn=document.createElement("h5"),this.closeBtn.innerHTML="Hide",this.closeBtn.className="close-btn",this.onHideClickBound=this.onHideClick.bind(this),this.closeBtn.addEventListener("click",this.onHideClickBound),this.el.appendChild(s),this.el.appendChild(this.closeBtn),this.el.appendChild(this.contentContainer),this.hasParamsToShow=!1,this.parentEl.appendChild(this.el),this.el.addEventListener("click",function(){a.onClick()})}var t,n,i;return t=e,(n=[{key:"onClick",value:function(){this.el.classList.contains("has-params")&&this.show()}},{key:"onHideClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.hide()}},{key:"setupForNode",value:function(e){var t=this;this.removeContent(),this.currentNode=e;var n=e.nodeType.assignedParamContainer,i=n?Object.keys(n.inputParams):[];if(i.length>0){this.hasParamsToShow=!0,this.el.classList.add("has-params");var o=n.connectedNodes[0];o&&o.updateAllowedInputParams&&o.updateAllowedInputParams(n.inputParams)}else this.hasParamsToShow=!1,this.el.classList.remove("has-params"),this.hide();i.map(function(e){var i=n.inputParams[e],o=document.createElement("div");o.className="param-item-container";var a=document.createElement("div");a.className="label-container";var s=document.createElement("p");s.innerHTML="param";var r=document.createElement("h4");r.className="param-item",r.innerHTML=i.param.title,a.appendChild(s),a.appendChild(r),o.appendChild(a),t.contentContainer.appendChild(o);var l=document.createElement("div");l.className="connected-nodes-container",o.appendChild(l);var u=document.createElement("p");u.innerHTML="connected nodes",l.appendChild(u),n.connectedNodes.map(function(e){var t=document.createElement("h4");t.className="connected-node-item",t.innerHTML=e.title,l.appendChild(t)});var c=document.createElement("div");c.className="connect-btn",i.connectionAllowed||c.classList.add("not-allowed");var d=document.createElement("h5");d.innerHTML=i.isConnected?"Disconnect":"Connect",c.appendChild(d),i.connectionAllowed&&c.addEventListener("click",function(){var e=n.connectedNodes[0],o=n.node;"Disconnect"===d.innerHTML?t.disableParam(i,e,o):t.enableParam(i,e,o)}),o.appendChild(c)})}},{key:"enableParam",value:function(e,t,n){var i=this.currentNode;this.enableParamCallback(e,t,n),this.setupForNode(i)}},{key:"disableParam",value:function(e,t,n){var i=this.currentNode;this.disableParamCallback(e,t,n),this.setupForNode(i)}},{key:"show",value:function(){this.hasParamsToShow&&(this.onShowCallback(),this.el.classList.add("visible"))}},{key:"removeContent",value:function(){for(var e=this.contentContainer;e.firstChild;)e.firstChild.remove();this.el.classList.remove("has-params"),this.currentNode=null}},{key:"hide",value:function(){this.el.classList.remove("visible")}},{key:"blur",value:function(){this.hide(),this.removeContent()}}])&&Bn(t.prototype,n),i&&Bn(t,i),e}();n(48);function An(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var jn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onClickCallback=n,this.parentEl=t,this.el=document.createElement("div"),this.el.className="node-remove";var i=document.createElement("h5");i.className="label",i.innerHTML="Remove",this.el.appendChild(i),this.parentEl.appendChild(this.el),this.onClickBound=this.onClick.bind(this),this.el.addEventListener("click",this.onClickBound)}var t,n,i;return t=e,(n=[{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.onClickCallback()}},{key:"show",value:function(){this.el.classList.add("visible")}},{key:"hide",value:function(){this.el.classList.remove("visible")}}])&&An(t.prototype,n),i&&An(t,i),e}();n(50);function Hn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Fn=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onShowCallback=n,this.onRemoveCallback=i,this.el=document.createElement("div"),this.el.className="node-settings-window window";var o=document.createElement("h5");o.innerHTML="NODE SETTINGS",o.className="title",this.el.appendChild(o),this.isOpen=!1,this.nodeRemove=new jn(this.el,this.onRemoveCallback),this.closeBtn=document.createElement("h5"),this.closeBtn.innerHTML="Hide",this.closeBtn.className="close-btn",this.onHideClickBound=this.onHideClick.bind(this),this.closeBtn.addEventListener("click",this.onHideClickBound),this.el.appendChild(this.closeBtn),this.parentEl.appendChild(this.el),this.currentSettingsEl=null,this.onClickBound=this.onClick.bind(this),this.el.addEventListener("click",this.onClickBound)}var t,n,i;return t=e,(n=[{key:"onClick",value:function(){this.show()}},{key:"onHideClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.hide()}},{key:"removeCurrent",value:function(){!this.currentSettingsEl||this.currentSettingsEl&&this.currentSettingsEl.parentNode!==this.el||(this.el.removeChild(this.currentSettingsEl),this.el.classList.remove("has-settings"))}},{key:"setupForNode",value:function(e){this.removeCurrent();var t=e.getSettings();t&&(this.currentSettingsEl=t,this.el.appendChild(t),e.afterSettingsAddedToDom&&e.afterSettingsAddedToDom(),this.el.classList.add("has-settings"))}},{key:"checkForUpdates",value:function(e){e.refreshSettings&&(console.log("sss"),this.removeCurrent(),this.setupForNode(e))}},{key:"show",value:function(){this.onShowCallback(),this.el.classList.add("visible"),this.nodeRemove.show()}},{key:"hide",value:function(){this.el.classList.remove("visible"),this.nodeRemove.hide()}},{key:"blur",value:function(){this.hide(),this.removeCurrent()}}])&&Hn(t.prototype,n),i&&Hn(t,i),e}();function _n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Un=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.activeNode=null,this.onConnectionWindowShowBound=this.onConnectionWindowShow.bind(this),this.onNodeSettingsWindowShowBound=this.onNodeSettingsWindowShow.bind(this),this.onNodeRemoveClickBound=this.onNodeRemoveClick.bind(this),this.connectionWindow=new Vn(t,n,i,this.onConnectionWindowShowBound),this.nodeSettingsWindow=new Fn(t,this.onNodeSettingsWindowShowBound,this.onNodeRemoveClickBound)}var t,n,i;return t=e,(n=[{key:"onNodeRemoveClick",value:function(){this.activeNode&&this.activeNode.onRemoveClick()}},{key:"setupForNode",value:function(e){this.activeNode=e,this.connectionWindow.setupForNode(e),this.nodeSettingsWindow.setupForNode(e)}},{key:"onNodeConnect",value:function(e){this.connectionWindow.setupForNode(e)}},{key:"onConnectionWindowShow",value:function(){this.nodeSettingsWindow.hide()}},{key:"onNodeSettingsWindowShow",value:function(){this.nodeSettingsWindow.checkForUpdates(this.activeNode),this.connectionWindow.hide()}},{key:"onNodeDisconnect",value:function(){this.connectionWindow.blur()}},{key:"blur",value:function(){this.nodeSettingsWindow.blur(),this.connectionWindow.blur()}}])&&_n(t.prototype,n),i&&_n(t,i),e}();function zn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Gn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.activeModifier=void 0,this.nonagons=[],this.nonagonsToCheck=[],this.currentCloseParamContainer=void 0,this.currentClosestNode=void 0,this.onDragStartBound=this.onModifierDragStart.bind(this),this.onDragMoveBound=this.onModifierDragMove.bind(this),this.onDragReleaseBound=this.onModifierDragRelease.bind(this),this.disconnectTimer=-1}var t,n,i;return t=e,(n=[{key:"addNonagon",value:function(e){this.nonagons.push(e)}},{key:"removeNonagon",value:function(e){this.nonagons=this.nonagons.filter(function(t){return t.ID!==e.ID})}},{key:"overNonagonCheck",value:function(){for(var e=this.nonagonsToCheck,t=0;t<e.length;t++){var n=e[t].getPos(),i=this.activeModifier.getPos();n.distanceTo(i)<160?e[t].setSelected():e[t].setNotSelected()}}},{key:"onModifierDragStart",value:function(e,t){this.activeModifier=e,this.nonagonsToCheck=this.nonagons.filter(function(e){return e.groupState.isInGroup&&e.groupState.isShowing||!e.groupState.isInGroup});for(var n=0;n<this.nonagonsToCheck.length;n++)console.log("val: ",this.nonagonsToCheck[n].nodeTitle.el.value);this.overNonagonCheck()}},{key:"onModifierDragMove",value:function(e,t){if(this.overNonagonCheck(),this.activeModifier.isConnected)(Math.abs(t.x)>5||Math.abs(t.y)>5)&&this.activeModifier.deactivateAsChild(e);else{var n=this.nonagonsToCheck;if(this.currentCloseParamContainer){var i=this.currentCloseParamContainer.getPos(),o=this.activeModifier.getPos(),a=i.distanceTo(o);if(a>=15)this.currentCloseParamContainer=void 0,this.activeModifier.setAngle(0);else{if(this.currentCloseParamContainer.isDisabledForConnection)return;var s=Math.min((15-a)/5,1)*this.currentCloseParamContainer.rotation;this.activeModifier.setAngle(s)}}else for(var r=0;r<n.length;r++)for(var l=n[r].getParamContainers(),u=0;u<l.length;u++){var c=l[u],d=c.getPos(),h=this.activeModifier.getPos();if(d.distanceTo(h)<15)return void(this.currentCloseParamContainer=c)}}}},{key:"onModifierDragRelease",value:function(){this.currentCloseParamContainer&&!this.currentCloseParamContainer.isDisabledForConnection&&this.activeModifier&&!this.activeModifier.isConnected?this.activeModifier.activateAsChild(this.currentCloseParamContainer,!0):this.currentClosestNode&&(this.currentClosestNode.setNotSelected(),this.currentClosestNode=void 0)}}])&&zn(t.prototype,n),i&&zn(t,i),e}();n(52);function Yn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Wn=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.el=document.createElement("div"),this.el.classList.add("tab-item"),this.tabTitle=document.createElement("h5"),this.setTitle(n.title),this.tabTitle.classList.add("tab-title");var o=document.createElement("div");o.classList.add("touch-layer"),o.setAttribute("data-node",n.ID),this.node=n,this.el.appendChild(this.tabTitle),this.el.appendChild(o),t.appendChild(this.el),this.onTabClickBound=this.onTabClick.bind(this),this.onTabClickCallback=i,o.addEventListener("click",this.onTabClickBound)}var t,n,i;return t=e,(n=[{key:"setTitle",value:function(e){this.tabTitle.innerHTML=e}},{key:"onTabClick",value:function(e){var t=e.target.getAttribute("data-node");this.onTabClickCallback(t)}},{key:"setActive",value:function(){this.el.classList.add("selected"),window.NS.singletons.CanvasNode.foregroundRender.showActive(this.node.ID)}},{key:"setIdle",value:function(){this.el.classList.remove("selected"),window.NS.singletons.CanvasNode.foregroundRender.hideActive(this.node.ID)}},{key:"remove",value:function(){this.parentEl.removeChild(this.el)}}])&&Yn(t.prototype,n),i&&Yn(t,i),e}();n(54);function Xn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var qn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.classList.add("node-selection"),this.nodes={},this.onNodeSelected=n,this.parentEl=t,this.parentEl.appendChild(this.el),this.tabs={},this.onTabClickBound=this.onTabClick.bind(this)}var t,n,i;return t=e,(n=[{key:"addTab",value:function(e){var t=new Wn(this.el,e,this.onTabClickBound);this.tabs[e.ID]=t}},{key:"removeTab",value:function(e){console.log("remove tab: ",e),this.tabs[e.ID].remove(),delete this.tabs[e.ID]}},{key:"setTabTitle",value:function(e,t){this.tabs[e].setTitle(t)}},{key:"addNode",value:function(e){this.addTab(e)}},{key:"removeNode",value:function(e){this.removeTab(e)}},{key:"setTabIdle",value:function(e){e.setIdle()}},{key:"setTabActive",value:function(e){e.setActive()}},{key:"setTabSelected",value:function(e){var t=this;Object.keys(this.tabs).forEach(function(e){t.setTabIdle(t.tabs[e])}),this.setTabActive(this.tabs[e])}},{key:"onTabClick",value:function(e){this.setTabSelected(e),this.onNodeSelected(e)}}])&&Xn(t.prototype,n),i&&Xn(t,i),e}();n(56);function Kn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Zn=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nonagons={},this.parentEl=t,this.ID=n,this.el=document.createElement("div"),this.el.classList.add("group-container"),this.onNodeTabSelectedBound=this.onNodeTabSelected.bind(this),this.nodeSelectionTabs=new qn(this.el,this.onNodeTabSelectedBound),this.moveCoords={start:{x:0,y:0},offset:{x:i.x-100,y:i.y-100}},this.el.style[window.NS.transform]="translate3d(".concat(i.x-100,"px, ").concat(i.y-100,"px, 0)"),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.el.addEventListener("mousedown",this.onMouseDownBound),t.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"setNodeTabTitle",value:function(e,t){this.nodeSelectionTabs.setTabTitle(e,t)}},{key:"hasNonagons",value:function(){return Object.keys(this.nonagons).length>0}},{key:"onNodeTabSelected",value:function(e){var t=this,n=this.nonagons[e];Object.keys(this.nonagons).forEach(function(e){return t.nonagons[e].groupHide()}),n.groupShow()}},{key:"getPos",value:function(){var e=new THREE.Vector2,t=this.el.getBoundingClientRect();return e.set(t.x+t.width/2,t.y+t.height/2),e}},{key:"show",value:function(){this.el.classList.add("visible")}},{key:"hide",value:function(){this.el.classList.remove("visible")}},{key:"delete",value:function(){this.parentEl.removeChild(this.el)}},{key:"addNonagon",value:function(e){var t=this;this.nonagons[e.ID]=e,e.addToGroup(this.el,this.ID),this.nodeSelectionTabs.addNode(e);var n=Object.keys(this.nonagons);1===n.length?e.groupShow():(n.forEach(function(e){t.nonagons[e].groupHide()}),e.groupShow()),this.nodeSelectionTabs.setTabSelected(e.ID)}},{key:"removeNonagon",value:function(e,t){if(t.groupShow(),this.nodeSelectionTabs.removeNode(t),t.removeFromGroup(e,this),delete this.nonagons[t.ID],this.hasNonagons()){console.log("has nonagons",this.nonagons);var n=Object.keys(this.nonagons),i=this.nonagons[n[0]];i.groupShow(),this.nodeSelectionTabs.setTabSelected(i.ID)}}},{key:"onMouseDown",value:function(e){e.preventDefault,e.stopPropagation(),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=e.x-this.moveCoords.start.x,n=e.y-this.moveCoords.start.y;this.moveCoords.offset.x=t,this.moveCoords.offset.y=n,this.el.style[window.NS.transform]="translate3d(".concat(t,"px, ").concat(n,"px, 0)")}},{key:"onMouseUp",value:function(){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}}])&&Kn(t.prototype,n),i&&Kn(t,i),e}();function Qn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Jn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.groups={},this.currentActiveGroup,this.nonagons=[],this.nonagonsToCheck=[],this.nonagonsToCheckLength=0,this.activeNonagon,this.overNonagon}var t,n,i;return t=e,(n=[{key:"updateGroupNodeTabTitle",value:function(e,t){var n=this.getGroupFromNonagon(this.nonagons.find(function(t){return t.ID===e}));n&&n.setNodeTabTitle(e,t)}},{key:"setActiveNonagon",value:function(e){var t=this;this.activeNonagon=e,this.nonagonsToCheck=this.nonagons.filter(function(e){return e.ID!==t.activeNonagon.ID}),this.nonagonsToCheckLength=this.nonagonsToCheck.length}},{key:"addNonagon",value:function(e){this.nonagons.push(e)}},{key:"removeNonagon",value:function(e){this.nonagons=this.nonagons.filter(function(t){return t.ID!==e.ID})}},{key:"getGroupFromNonagon",value:function(e){var t=this,n=Object.keys(this.groups).find(function(n){return Object.keys(t.groups[n].nonagons).includes(e.ID)});return n?this.groups[n]:null}},{key:"getNonagonGroup",value:function(e){var t=this.getGroupFromNonagon(e);if(t)return console.log("return group",t.ID),t;console.log("create new group");var n=new Zn(e.parentEl,e.ID,e.moveCoords.offset);return this.groups[e.ID]=n,n}},{key:"onOverNonagon",value:function(e){e.setSelected(),this.currentActiveGroup||(this.currentActiveGroup=this.getNonagonGroup(e)),this.currentActiveGroup.show(),this.overNonagon=e}},{key:"overNonagonCheck",value:function(){var e=this,t=function(){for(var t=0;t<e.nonagonsToCheckLength;t++){var n=e.nonagonsToCheck[t].getPos(),i=e.activeNonagon.getPos();if(n.distanceTo(i)<160)return e.nonagonsToCheck[t]}return null}();if(t)this.onOverNonagon(t);else{for(var n=0;n<this.nonagonsToCheckLength;n++)this.nonagonsToCheck[n].setNotSelected();this.currentActiveGroup&&(this.currentActiveGroup.hasNonagons()||(this.currentActiveGroup.delete(),delete this.groups[this.overNonagon.ID],this.currentActiveGroup=null)),this.overNonagon=null}}},{key:"removeFromGroup",value:function(e,t,n){t.removeNonagon(e,n),t.hasNonagons()||(t.delete(),delete this.groups[t.ID])}},{key:"onNodeDragStart",value:function(e){this.currentActiveGroup=null,this.setActiveNonagon(e),this.overNonagonCheck()}},{key:"onNodeDragMove",value:function(e,t,n){var i=this.getGroupFromNonagon(t);i?(Math.abs(n.x)>5||Math.abs(n.y)>5)&&this.removeFromGroup(e,i,t):this.overNonagonCheck()}},{key:"onNodeDragEnd",value:function(){this.currentActiveGroup&&this.activeNonagon&&this.overNonagon&&(0===Object.keys(this.currentActiveGroup.nonagons).length?(this.currentActiveGroup.addNonagon(this.overNonagon),this.currentActiveGroup.addNonagon(this.activeNonagon)):this.currentActiveGroup.addNonagon(this.activeNonagon));this.currentActiveGroup=null}}])&&Qn(t.prototype,n),i&&Qn(t,i),e}();function $n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ei=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.collectedInputs=[]}var t,n,i;return t=e,(n=[{key:"showAvailable",value:function(e,t,n,i){var o=t.filter(function(t){return e.ID!==t.ID});this.collectedInputs=[];for(var a=0;a<o.length;a++){var s={node:o[a]};this.collectedInputs.push(s)}for(var r=0;r<this.collectedInputs.length;r++){var l=[],u=this.collectedInputs[r].node,c=u.isModifier?[]:u.nodeType.paramContainers;if(u.isGraphicsNode){for(var d=0;d<l.length;d++){var h=l[d];u.inputHelpersType.isValid(e,u,h.inputType,i)||h.activatePossible()}for(var p=0;p<c.length;p++){var f=c[p];f.isAvailableForConnection(e,u)||f.setAsDisabled()}}else{for(var v=0;v<l.length;v++){var m=l[v];u.inputHelpersType.isValid(e,u,void 0,n,i)||m.activatePossible()}for(var g=0;g<params.length;g++){var y=params[g];y.param.helper.isValid(e,u,y.param,n)||y.activateNotPossible()}}}}},{key:"resetAvailable",value:function(){for(var e=0;e<this.collectedInputs.length;e++){this.collectedInputs[e].inputs,this.collectedInputs[e].params;for(var t=this.collectedInputs[e].node,n=t.isModifier?[]:t.nodeType.paramContainers,i=0;i<n.length;i++){n[i].setAsEnabled()}}}}])&&$n(t.prototype,n),i&&$n(t,i),e}();function ti(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ni=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.selectedDrawing=null,this.nodesAddedCounter=0}var t,n,i;return t=e,(n=[{key:"setSelectedDrawing",value:function(e){this.selectedDrawing=e}},{key:"onNodeAdded",value:function(){this.nodesAddedCounter++,this.isDone()&&(this.initNodeSettings(),this.initGroups())}},{key:"initNodeSettings",value:function(){for(var e=this.selectedDrawing.nodes.filter(function(e){return!!e.data.connectionData}),t=function(t){var n=e[t],i=window.NS.singletons.ConnectionsManager.nodes[n.id],o=window.NS.singletons.ConnectionsManager.nodes[n.data.connectionData.node].nodeType.paramContainers.find(function(e){return e.ID===n.data.connectionData.paramContainer});o&&i&&i.nodeType.activateAsChild(o,!1);for(var a=n.data.paramConnections?n.data.paramConnections:[],s=0;s<a.length;s++){var r=window.NS.singletons.ConnectionsManager.params[n.data.paramConnections[s]];window.NS.singletons.ConnectionsManager.addParamConnection(r,i)}},n=0;n<e.length;n++)t(n)}},{key:"initGroups",value:function(){var e=this.selectedDrawing.nodes.filter(function(e){return e.data.group}),t={};e.forEach(function(e){var n=window.NS.singletons.ConnectionsManager.nodes[e.id];t[e.data.group.Id]?t[e.data.group.Id].push(n):t[e.data.group.Id]=[n]}),Object.keys(t).forEach(function(e){var n=t[e],i=function(e,t){return e.find(function(e){return e.ID===t})}(n,e);i&&function(e,t){e.forEach(function(e){t.addNonagon(e)})}(n,window.NS.singletons.NodeGroupManager.getNonagonGroup(i))})}},{key:"isDone",value:function(){return this.selectedDrawing.nodes.length===this.nodesAddedCounter}}])&&ti(t.prototype,n),i&&ti(t,i),e}();function ii(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var oi=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.hasConfig=!!t,this.nodeLibrary=o,this.availableConnections=new ei,window.NS.singletons.NodeGroupManager=new Jn,this.constructorIsDone=!1,this.keyboardManager=n,this.selectedNode=null,this.enableParamConnectionBound=this.enableParamConnection.bind(this),this.disableParamConnectionBound=this.disableParamConnection.bind(this),this.backendSync=new ni,this.modifierCollisionManager=new Gn,this.windowManager=new Un(i.parentElement,this.enableParamConnectionBound,this.disableParamConnectionBound),this._nodes=[],this._nodeConnections=[],this._graphicNodes=[],this._graphicNodeLength=0,this.resetConnectingBound=this.resetConnecting.bind(this),this.isConnecting=!1,this.outputActiveNode=null,this.outputActiveType=void 0,this.onDisconnectBound=this.onDisconnect.bind(this),this.onInputConnectionBound=this.onInputConnection.bind(this),this.addBound=this.add.bind(this),this.removeBound=this.onNodeRemove.bind(this),this.onAudioNodeParamChangeBound=this.onAudioNodeParamChange.bind(this),this.onNodeDragStartBound=this.onNodeDragStart.bind(this),this.onNodeDragMoveBound=this.onNodeDragMove.bind(this),this.onNodeDragReleaseBound=this.onNodeDragRelease.bind(this),this.audioNodeManager=new Rn(i,null,this.onInputConnectionBound,this.addBound,this.hasConfig?this.config.nodes:[],this.onAudioNodeParamChangeBound,this.removeBound),this.audioNodeManager.init(),this.graphicsNodeManager=new In(i,this.onDisconnectBound,this.onInputConnectionBound,this.addBound,this.removeBound,this.onNodeDragStartBound,this.onNodeDragMoveBound,this.onNodeDragReleaseBound),this.hasConfig&&console.log("has config",this.config),this.constructorIsDone=!0;var a=this.graphicsNodeManager.createCanvasNode();window.NS.singletons.CanvasNode=a,this.onNodeSelectedEventBound=this.onNodeSelectedEvent.bind(this),document.documentElement.addEventListener("node-selected",this.onNodeSelectedEventBound)}var t,n,i;return t=e,(n=[{key:"init",value:function(e){var t=e.nodes?e:{nodes:[]};this.backendSync.setSelectedDrawing(t);for(var n=0;n<t.nodes.length;n++){var i=t.nodes[n],o={type:"graphics",data:i.data};this.initNode(o,i.data.pos,i)}}},{key:"onNodeSelectedEvent",value:function(e){for(var t=0;t<this._nodes.length;t++)this._nodes[t].setNotSelected();e&&e.detail&&(e.detail.setSelected(),this.windowManager.setupForNode(e.detail))}},{key:"onNodeDragStart",value:function(e,t){this.modifierCollisionManager.onModifierDragStart(e.nodeType,t),this.availableConnections.showAvailable(e,this._nodes,this._nodeConnections)}},{key:"onNodeDragMove",value:function(e,t){this.modifierCollisionManager.onModifierDragMove(e,t)}},{key:"onNodeDragRelease",value:function(){this.modifierCollisionManager.onModifierDragRelease(),this.availableConnections.resetAvailable()}},{key:"initNode",value:function(e,t,n){var i=null;if("graphics"===e.type){if(this._graphicNodes.some(function(e){return e.isCanvasNode})&&"Canvas"===e.data.type)return;i=this.graphicsNodeManager.createNode(e.data,t,n)}else i=this.audioNodeManager.createNode(e.data,t,n);return this.nodeLibrary.hide(),i}},{key:"onNodeRemove",value:function(e){this.remove(e)}},{key:"onAudioNodeParamChange",value:function(e,t){this.keyboardManager.onAudioNodeParamChange(e,t)}},{key:"disconnectAnalyserNodes",value:function(e){for(var t=e.filter(function(e){return e.in.isAnalyser}),n=0;n<t.length;n++)t[n].in.dispose()}},{key:"getAudioConnections",value:function(e){return e.filter(function(e){return!e.out.isGraphicsNode&&!e.in.isGraphicsNode})}},{key:"resetConnecting",value:function(){this.isConnecting=!1,this.outputActiveNode=null,this.outputActiveType=void 0,this.availableConnections.resetAvailable()}},{key:"enableParamConnection",value:function(e,t,n){return c[e.param.paramHelpersType].isValid(t,n,e.param,this._nodeConnections)?(w({paramConnections:firebase.firestore.FieldValue.arrayUnion(e.ID)},t.ID,!0).then(function(){console.log("updated node")}).catch(function(){console.log("error updating node")}),window.NS.singletons.ConnectionsManager.addParamConnection(e,t),!0):(this.resetConnecting(),!1)}},{key:"disableParamConnection",value:function(e,t,n){return w({paramConnections:firebase.firestore.FieldValue.arrayRemove(e.ID)},t.ID,!0).then(function(){console.log("updated node")}).catch(function(){console.log("error updating node")}),window.NS.singletons.ConnectionsManager.removeParamConnection(e,t),!0}},{key:"onInputConnection",value:function(e,t){Object.keys(t.inputParams).length,window.NS.singletons.ConnectionsManager.addNodeConnection(e,t),this.windowManager.onNodeConnect(e)}},{key:"onDisconnect",value:function(e,t){for(var n=Object.keys(t.inputParams),i=0;i<n.length;i++){var o=t.inputParams[n[i]];this.disableParamConnection(o,e,t.node)}window.NS.singletons.ConnectionsManager.removeNodeConnection(t,e),this.windowManager.onNodeDisconnect()}},{key:"add",value:function(e){e.isRendered||e.isVisualHelper?(window.NS.singletons.CanvasNode.enableInput(e,"foreground"),this._nodes.push(e)):this._nodes.push(e),(e.isRenderNode||e.isCanvasNode||e.needsUpdate)&&(this._graphicNodes.push(e),this._graphicNodeLength=this._graphicNodes.length),e.isModifier||e.isCanvasNode||(this.modifierCollisionManager.addNonagon(e),window.NS.singletons.NodeGroupManager.addNonagon(e)),this.backendSync.isDone()||this.backendSync.onNodeAdded()}},{key:"remove",value:function(e){if(window.NS.singletons.StatusWindow.onNodeRemove(e),window.NS.singletons.ConnectionsManager.removeNode(e),e.isGraphicsNode||e.needsUpdate){var t=this._graphicNodes.filter(function(t){return t.ID!==e.ID});this._graphicNodes=t,this._graphicNodeLength=this._graphicNodes.length}(e.isRendered||e.isVisualHelper)&&window.NS.singletons.CanvasNode.disableInput(e,"foreground"),e.isModifier||e.isCanvasNode||(this.modifierCollisionManager.removeNonagon(e),window.NS.singletons.NodeGroupManager.removeNonagon(e)),e.removeFromDom();var n,i=this._nodes.filter(function(t){return t.ID!==e.ID});this._nodes=i,(n=e.ID,window.NS.singletons.refs.getDrawingRef().collection("Nodes").doc(n).delete()).then(function(){console.log("node deleted",e.ID),window.NS.singletons.refs.removeNodeRef(e.ID)}).catch(function(e){console.log("error deleting",e)}),this.windowManager.blur()}},{key:"update",value:function(){for(var e=0;e<this._graphicNodeLength;e++)this._graphicNodes[e].update();window.NS.singletons.CanvasNode.update()}},{key:"render",value:function(){for(var e=0;e<this._graphicNodeLength;e++)this._graphicNodes[e].render();window.NS.singletons.CanvasNode.render()}}])&&ii(t.prototype,n),i&&ii(t,i),e}();function ai(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var si=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.workspaceManager=t,this.isModifier=i,this.moveCoords={start:{x:0,y:0},offset:{x:n.x,y:n.y}},this.deltaX=0,this.deltaY=0,this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this)}var t,n,i;return t=e,(n=[{key:"getPos",value:function(){var e=this.isModifier?-20:-130,t=Math.abs(this.workspaceManager.moveCoords.offset.x),n=Math.abs(this.workspaceManager.moveCoords.offset.y);return{x:this.moveCoords.offset.x+t+e,y:this.moveCoords.offset.y+n+e}}},{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this.deltaX=0,this.deltaY=0,this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y}},{key:"onMouseMove",value:function(e){var t=e.x,n=e.y,i=t-this.moveCoords.start.x,o=n-this.moveCoords.start.y;this.moveCoords.offset.x=i,this.moveCoords.offset.y=o;Math.abs(this.workspaceManager.moveCoords.offset.x),Math.abs(this.workspaceManager.moveCoords.offset.y);this.deltaX=i,this.deltaY=o}},{key:"onMouseUp",value:function(e){}}])&&ai(t.prototype,n),i&&ai(t,i),e}(),ri={graphics:{"3D - Shapes":[{type:"Cube",isModifier:!1},{type:"Sphere",isModifier:!1},{type:"Particles",isModifier:!1}],"Procedural Texture (Material)":[{type:"Circle",isModifier:!1},{type:"Voronoi",isModifier:!1},{type:"LavaNoise",isModifier:!1}],Modifiers:[{type:"Color",isModifier:!0},{type:"OrbitDriver",isModifier:!0},{type:"RotationDriver",isModifier:!0},{type:"ParamDriver",isModifier:!0},{type:"Form",isModifier:!0}],Ljus:[{type:"Point Light",isModifier:!1}],Textures:[{type:"Texture Selector",isModifier:!0}]}};n(58);function li(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ui=function(){function e(t,n,i){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.hasDoneInitOnNodeCreation=!1,this.currentCreatedNode=null,this.onNodeAddedCallback=n,this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onMouseOverBound=this.onMouseOver.bind(this),this.onMouseOutBound=this.onMouseOut.bind(this),this.workspaceManager=i,this.mouseIsDown=!1,this.nodeToPlaceData={type:void 0,data:void 0},this.el=document.createElement("div"),this.el.className="node-library";var a=document.createElement("div");a.className="outer-scroll",this.el.appendChild(a),this.isShowing=!1,this.el.addEventListener("mouseover",this.onMouseOverBound),this.titleEl=document.createElement("h4"),this.titleEl.innerHTML="NODE LIBRARY",this.titleEl.className="title-bar",this.el.appendChild(this.titleEl);var s=document.createElement("div");s.className="inner-scroll",a.appendChild(s),this.parentEl.appendChild(this.el);var r=function(e){var t=document.createElement("div");t.className="level-0";var n=document.createElement("h4");n.className="level-title",n.innerHTML=e,t.appendChild(n);var i=function(i){var a=document.createElement("div");a.className="level-1",(n=document.createElement("h4")).className="level-title",n.innerHTML=i,a.appendChild(n),t.appendChild(a);var s=document.createElement("div");s.className="node-container",a.appendChild(s);for(var r=function(t){var n=document.createElement("div"),a=ri[e][i][t].isModifier;n.className="library-node".concat(a?" modifier":""),n.setAttribute("data-type-0",e),n.setAttribute("data-type-1",i);var r=document.createElement("h4");r.className="node-type",r.innerHTML=ri[e][i][t].type;var l=ri[e][i][t].type,u="".concat(l,a?"-modifier":"-node"),c=a?o.getTriangleShape():o.getNonagonShape(!0);if(n.appendChild(c),u){var d="".concat(u.replace(" ","-").toLowerCase(),"-icon"),h=new Image;h.onload=function(){n.appendChild(h)},h.src="./assets/icons/white/".concat(d,".svg")}n.appendChild(r),s.appendChild(n),n.addEventListener("mousedown",function(n){o.nodeToPlaceData.type=e,o.nodeToPlaceData.data=ri[e][i][t],o.onMouseDown(n)})},l=0;l<ri[e][i].length;l++)r(l)};for(var a in ri[e])i(a);s.appendChild(t)};for(var l in ri)r(l)}var t,n,i;return t=e,(n=[{key:"onMouseOver",value:function(){this.mouseIsDown||this.isShowing||this.show()}},{key:"onMouseOut",value:function(){this.mouseIsDown||this.isShowing&&this.hide()}},{key:"hide",value:function(){this.isShowing=!1,this.el.classList.remove("showing"),this.el.removeEventListener("mouseout",this.onMouseOutBound)}},{key:"show",value:function(){this.isShowing=!0,this.el.classList.add("showing"),this.el.addEventListener("mouseout",this.onMouseOutBound)}},{key:"getTriangleShape",value:function(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("modifier"),e.setAttribute("width","44px"),e.setAttribute("height","44px"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","rgba(50, 50, 50, .9)");var t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","M23.677 18.52c.914 1.523-.183 3.472-1.967 3.472h-19.414c-1.784 0-2.881-1.949-1.967-3.472l9.709-16.18c.891-1.483 3.041-1.48 3.93 0l9.709 16.18z"),e.appendChild(t),e}},{key:"getNonagonShape",value:function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width",e?"50px":"260px"),t.setAttribute("height",e?"50px":"260px"),t.setAttribute("viewBox","0 0 1200 1200"),t.setAttribute("fill","rgba(50, 50, 50, .9)");var n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M464.133,1097.487c-22.564,0-55.171-11.867-72.457-26.372l-208.16-174.667c-17.285-14.504-34.635-44.554-38.553-66.777\n\t\t\t\t\t\tL97.777,562.066c-3.918-22.223,2.107-56.394,13.391-75.936l135.865-235.328c11.283-19.542,37.863-41.846,59.068-49.563\n\t\t\t\t\t\tL561.446,108.3c21.205-7.718,55.902-7.718,77.107,0L893.9,201.239c21.205,7.718,47.785,30.021,59.067,49.563l135.864,235.328\n\t\t\t\t\t\tc11.283,19.542,17.309,53.713,13.391,75.936l-47.186,267.604c-3.918,22.224-21.268,52.273-38.553,66.777l-208.16,174.667\n\t\t\t\t\t\tc-17.286,14.505-49.893,26.372-72.457,26.372H464.133z\n\t\t"),t.appendChild(n),t}},{key:"onMouseDown",value:function(e){this.mouseIsDown=!0,this.nodePlaceHelper=new si(this.workspaceManager,{x:e.clientX,y:e.clientY},this.nodeToPlaceData.data.isModifier,this.nodeToPlaceData.data.isModifier?this.getTriangleShape():this.getNonagonShape()),this.nodePlaceHelper.onMouseDown(e),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){this.nodePlaceHelper.onMouseMove(e);var t=this.nodePlaceHelper.getPos();if(Math.abs(this.nodePlaceHelper.deltaX)>4&&!this.currentCreatedNode){var n=this.onNodeAddedCallback(this.nodeToPlaceData,t);return this.currentCreatedNode=n,void n.onMouseDown(e,!1)}this.currentCreatedNode&&this.currentCreatedNode.onMouseMove(e)}},{key:"onMouseUp",value:function(e){this.nodePlaceHelper.onMouseUp(),this.currentCreatedNode&&this.currentCreatedNode.onMouseUp(e,!1),this.currentCreatedNode=null,window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound),this.nodeToPlaceData={type:void 0,data:void 0},this.mouseIsDown=!1}}])&&li(t.prototype,n),i&&li(t,i),e}();function ci(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var di=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),e.KEY_INTS=[65,83,68,70,71,72,74,75,76,186,222,219],this.keys=[];for(var t=0;t<e.KEY_INTS.length;t++){var n={keyNr:e.KEY_INTS[t],step:t,triggered:!1,synth:new ue(t)};this.keys.push(n)}this.onKeyDownBound=this.onKeyDown.bind(this),this.onKeyUpBound=this.onKeyUp.bind(this),window.addEventListener("keydown",this.onKeyDownBound),window.addEventListener("keyup",this.onKeyUpBound)}var t,n,i;return t=e,(n=[{key:"onKeyDown",value:function(e){var t=e.keyCode,n=this.getKey(t);if(null!==n){if(n.triggered)return;n.triggered=!0,n.synth.keyDown()}}},{key:"onKeyUp",value:function(e){var t=e.keyCode,n=this.getKey(t);if(null!==n){if(!n.triggered)return;n.triggered=!1,n.synth.keyUp()}}},{key:"enable",value:function(){window.addEventListener("keydown",this.onKeyDownBound),window.addEventListener("keyup",this.onKeyUpBound)}},{key:"disable",value:function(){window.removeEventListener("keydown",this.onKeyDownBound),window.removeEventListener("keyup",this.onKeyUpBound)}},{key:"play",value:function(e,t){this.keys[e].synth.play(t)}},{key:"onAudioNodeConnectionUpdate",value:function(e){for(var t=0;t<this.keys.length;t++)this.keys[t].synth.updateConnections(e)}},{key:"onAudioNodeParamChange",value:function(e,t){for(var n=0;n<this.keys.length;n++)this.keys[n].synth.onParamChange(e,t)}},{key:"getKey",value:function(e){for(var t=null,n=0;n<this.keys.length;n++)this.keys[n].keyNr!==e||(t=this.keys[n]);return t}}])&&ci(t.prototype,n),i&&ci(t,i),e}();function hi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var pi=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=3e3,this.height=2e3,this.onClickCallback=n,this.containerEl=document.createElement("div"),this.containerEl.className="workspace-container",t.appendChild(this.containerEl),this.el=document.createElement("div"),this.el.className="workspace",this.el.style.width=this.width+"px",this.el.style.height=this.height+"px",this.containerEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.currentScale=1,this.moveCoords={start:{x:0,y:0},offset:{x:-(this.width/2-window.innerWidth/2),y:-(this.height/2-window.innerHeight/2)}},this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0)"),this.el.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"disable",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound)}},{key:"enable",value:function(){this.el.addEventListener("mousedown",this.onMouseDownBound)}},{key:"setScale",value:function(e){this.currentScale=e,this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0) scale(").concat(e,")")}},{key:"onMouseDown",value:function(e){"INPUT"===e.target.nodeName||e.target.classList.contains("prevent-drag")||(this.onClickCallback(),e.preventDefault(),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,window.addEventListener("mousemove",this.onMouseMoveBound),window.addEventListener("mouseup",this.onMouseUpBound))}},{key:"onMouseMove",value:function(e){e.preventDefault();var t=e.x-this.moveCoords.start.x,n=e.y-this.moveCoords.start.y;this.moveCoords.offset.x=t,this.moveCoords.offset.y=n,this.el.style[window.NS.transform]="translate3d(".concat(t,"px, ").concat(n,"px, 0) scale(").concat(this.currentScale,")")}},{key:"onMouseUp",value:function(e){window.removeEventListener("mousemove",this.onMouseMoveBound),window.removeEventListener("mouseup",this.onMouseUpBound)}},{key:"onResize",value:function(e,t){this.containerEl.style.width="".concat(e,"px"),this.containerEl.style.height="".concat(t,"px")}}])&&hi(t.prototype,n),i&&hi(t,i),e}();n(60);function fi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var vi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.unsavedChanges={},this.el=document.createElement("div"),this.el.className="status-window",this.titleEl=document.createElement("h4"),this.titleEl.innerHTML="Backend status",this.onClickBound=this.onClick.bind(this),this.el.addEventListener("click",this.onClickBound),this.statusText=document.createElement("p"),this.statusText.innerHTML="Backend status: <span>Up to date</span>",this.el.appendChild(this.statusText),t.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"addEvent",value:function(e){this.unsavedChanges[e.id]=Object.assign({},this.unsavedChanges[e.id],e.saveData),this.onUnsavedChanges()}},{key:"onNodeRemove",value:function(e){delete this.unsavedChanges[e.ID],0===Object.keys(this.unsavedChanges).length&&this.onSaved()}},{key:"onClick",value:function(){var e=this,t=Object.keys(this.unsavedChanges).map(function(t){return n=t,i=e.unsavedChanges[t],(o=window.NS.singletons.refs.getNodeRef(n))?o.update(i):(console.log("didnt find ref on update"),Promise.resolve());var n,i,o});Promise.all(t).then(function(){console.log("all updated"),e.onSaved()}).catch(function(){console.log("error")})}},{key:"onSaved",value:function(){this.unsavedChanges={},this.el.classList.remove("unsaved"),this.statusText.innerHTML="Backend status: <span>Up to date</span>"}},{key:"onUnsavedChanges",value:function(){this.el.classList.add("unsaved"),this.statusText.innerHTML="Backend status: <span>Unsaved changes !</span>"}}])&&fi(t.prototype,n),i&&fi(t,i),e}();n(62);function mi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var gi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.classList.add("delete-view"),this.img=new Image,this.img.src="./assets/delete.svg",this.el.appendChild(this.img),document.body.appendChild(this.el),t.appendChild(this.el),this.deleteOnRelease=!1}var t,n,i;return t=e,(n=[{key:"onNodeMoveStart",value:function(){this.deleteOnRelease=!1,this.el.classList.add("visible")}},{key:"onNodeMove",value:function(e,t){var n=new THREE.Vector2(e,t),i=this.getPos(),o=n.distanceTo(i);this.deleteOnRelease=o<50;var a=1+(400-Math.min(400,o))/400*.75;this.img.style.transform="scale(".concat(a,")")}},{key:"deleteOnNodeRelease",value:function(){return this.el.classList.remove("visible"),this.img.style.transform="scale(1.0)",this.deleteOnRelease}},{key:"getPos",value:function(){var e=new THREE.Vector2,t=this.el.getBoundingClientRect();return e.set(t.x+t.width/2,t.y+t.height/2),e}}])&&mi(t.prototype,n),i&&mi(t,i),e}();n(64);function yi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var bi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.el=document.createElement("div"),this.el.classList.add("verification-dialog"),this.el.classList.add("hidden");this.el.innerHTML='\n            <div class="inner-content">\n                <h4>ARE YOU SURE?</h4>\n                <button type="button" class="yes-btn">\n                    <h5>Yes</h5>\n                </button>\n                <button type="button" class="no-btn">\n                    <h5>No</h5>\n                </button>\n            </div>\n        ',this.parentEl.appendChild(this.el),this.onYesBtn=this.el.querySelector(".yes-btn"),this.onNoBtn=this.el.querySelector(".no-btn"),this.onYesFn=null,this.onNoFn=null}var t,n,i;return t=e,(n=[{key:"show",value:function(e,t){this.el.classList.remove("hidden"),this.onYesFn=e,this.onNoFn=t,this.onYesBtn.addEventListener("click",this.onYesFn),this.onNoBtn.addEventListener("click",this.onNoFn)}},{key:"hide",value:function(){this.el.classList.add("hidden"),this.onYesBtn.removeEventListener("click",this.onYesFn),this.onNoBtn.removeEventListener("click",this.onNoFn)}}])&&yi(t.prototype,n),i&&yi(t,i),e}();var wi=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.verificationDialog=new bi(t)};function Ci(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ki=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nodes={},this.params={},this.paramConnections={},this.nodeConnections={},this.nodeConnectionsUpdateEvent=new CustomEvent("node-connections-update"),this.paramConnectionsUpdateEvent=new CustomEvent("param-connections-update")}var t,n,i;return t=e,(n=[{key:"addNode",value:function(e){this.nodes[e.ID]=e;var t=new CustomEvent("node-added-event");document.documentElement.dispatchEvent(t)}},{key:"removeNode",value:function(e){for(var t=this,n=this.paramConnections[e.ID]?this.paramConnections[e.ID]:[],i=0;i<n.length;i++){var o=n[i];this.removeParamConnection(this.params[o.paramID],this.nodes[o.outNodeID])}for(var a=Object.keys(this.paramConnections),s=0;s<a.length;s++)for(var r=this.paramConnections[a[s]],l=0;l<r.length;l++)if(r[l].outNodeID===e.ID){var u=this.params[r[l].paramID],c=this.nodes[r[l].outNodeID];this.removeParamConnection(u,c)}for(var d=this.nodeConnections[e.ID]?this.nodeConnections[e.ID]:[],h=function(n){var i=d[n],o=e.nodeType.paramContainers.find(function(e){return e.ID===i.paramContainerID});t.removeNodeConnection(o,t.nodes[i.outNodeID],!0)},p=0;p<d.length;p++)h(p);for(var f=Object.keys(this.nodeConnections),v=function(n){for(var i=t.nodeConnections[f[n]],o=function(o){if(i[o].outNodeID===e.ID){var a=t.nodes[f[n]].nodeType.paramContainers.find(function(e){return e.ID===i[o].paramContainerID});t.removeNodeConnection(a,t.nodes[i[o].outNodeID])}},a=0;a<i.length;a++)o(a)},m=0;m<f.length;m++)v(m);delete this.nodes[e.ID];var g=new CustomEvent("node-removed-event");document.documentElement.dispatchEvent(g),console.log("paramConnections: ",this.paramConnections),console.log("nodeConnections: ",this.nodeConnections)}},{key:"addParam",value:function(e){this.params[e.ID]=e}},{key:"removeParam",value:function(e){delete this.params[e.ID]}},{key:"getNewNodeConnectionObj",value:function(e,t){return{outNodeID:e.ID,paramContainerID:t.ID}}},{key:"addNodeConnection",value:function(e,t){var n=this.getNewNodeConnectionObj(e,t),i=t.node.ID;i in this.nodeConnections||(this.nodeConnections[i]=[]),this.nodeConnections[i].push(n);var o=new CustomEvent("node-connections-update",{detail:this.nodeConnections});document.documentElement.dispatchEvent(o)}},{key:"removeNodeConnection",value:function(e,t,n){n&&t.onNodeDisconnectFromNonagonDelete();var i=e.node.ID,o=this.nodeConnections[i]?this.nodeConnections[i]:[];this.nodeConnections[i]=o.filter(function(n){return n.paramContainerID!==e.ID&&n.outNodeID!==t.ID}),0===this.nodeConnections[i].length&&delete this.nodeConnections[i];var a=new CustomEvent("node-connections-update",{detail:this.nodeConnections});document.documentElement.dispatchEvent(a)}},{key:"getNewParamConnectionObj",value:function(e,t){return{outNodeID:e.ID,paramID:t.ID}}},{key:"addParamConnection",value:function(e,t){var n=this.getNewParamConnectionObj(t,e),i=e.paramContainer.node.ID;i in this.paramConnections||(this.paramConnections[i]=[]),this.paramConnections[i].push(n);var o=new CustomEvent("param-connections-add",{detail:{inNodeID:i,connection:n}});document.documentElement.dispatchEvent(o)}},{key:"removeParamConnection",value:function(e,t){var n=e.paramContainer.node.ID;if(n in this.paramConnections){this.paramConnections[n]=this.paramConnections[n].filter(function(t){return t.paramID!==e.ID}),0===this.paramConnections[n].length&&delete this.paramConnections[n];var i={inNodeID:n,connection:{outNodeID:t.ID,paramID:e.ID}},o=new CustomEvent("param-connections-remove",{detail:i});document.documentElement.dispatchEvent(o)}}}])&&Ci(t.prototype,n),i&&Ci(t,i),e}();function Ei(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ni=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),te.a.Transport.bpm.value=140,te.a.Transport.start(),this.historyState={id:window.location.pathname},window.addEventListener("popstate",this.onPopStateChange.bind(this)),window.addEventListener("resize",function(){t.onResize()}),this.onNodeAddedFromLibraryBound=this.onNodeAddedFromLibrary.bind(this),this.onWorkspaceClickBound=this.onWorkspaceClick.bind(this),this.workspaceManager=new pi(document.body,this.onWorkspaceClickBound),this.onScaleChangeBound=this.onScaleChange.bind(this),this.onResize(),this.nodeLibrary=new ui(document.body,this.onNodeAddedFromLibraryBound,this.workspaceManager),this.nodeManager=new oi(null,this.keyboardManager,this.workspaceManager.el,this.nodeLibrary),window.NS.singletons.StatusWindow=new vi(document.body),window.NS.singletons.ConnectionsManager=new ki,window.NS.singletons.DialogManager=new wi(document.body),this.keyboardManager=new di,window.NS.singletons.DeleteView=new gi(this.workspaceManager.containerEl)}var t,n,i;return t=e,(n=[{key:"init",value:function(e){this.nodeManager.init(e)}},{key:"onLogout",value:function(){this.nodeLibrary.hide(),this.workspaceManager.disable(),this.keyboardManager.disable();for(var e=this.nodeManager._nodes,t=0;t<e.length;t++)this.nodeManager.onNodeRemove(e[t])}},{key:"onLogin",value:function(){this.nodeLibrary.show(),this.workspaceManager.enable(),this.keyboardManager.enable()}},{key:"onScaleChange",value:function(e){console.log(e)}},{key:"onWorkspaceClick",value:function(){this.nodeManager.windowManager.blur(),this.nodeManager.onNodeSelectedEvent()}},{key:"onNodeAddedFromLibrary",value:function(e,t,n){return this.nodeManager.initNode(e,t,n)}},{key:"onPopStateChange",value:function(e){console.log("hash change: ",e)}},{key:"pushState",value:function(e,t){window.history.pushState({id:e},"",t)}},{key:"update",value:function(){this.nodeManager.update()}},{key:"render",value:function(){this.nodeManager.render()}},{key:"onResize",value:function(e,t){this.workspaceManager.onResize(e,t)}}])&&Ei(t.prototype,n),i&&Ei(t,i),e}();n(66);function xi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Si=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.username=n,this.drawings={},this.paths={},this.onSelected=i,this.el=document.createElement("div"),this.el.className="drawings-window",this.onExistingDrawingClickBound=this.onExistingDrawingClick.bind(this),this.onDeleteDrawingBound=this.onDeleteDrawing.bind(this),t.appendChild(this.el),this.getDrawingsData()}var t,n,i;return t=e,(n=[{key:"getDrawingsData",value:function(){var e,t=this;(e=this.username,new Promise(function(t,n){var i=window.NS.singletons.refs.hasUserRef(),o=i?window.NS.singletons.refs.getUserRef():C.collection("Users").doc(e);i||window.NS.singletons.refs.setUserRef(o),o.get().then(function(e){e.exists?(console.log("Document data:",e,"  ",e.data()),t(!0)):(console.log("No such document!"),t(!1))}).catch(function(e){console.log("Error getting document:",e),n()})})).then(function(e){return e?(n=t.username,new Promise(function(e,t){(window.NS.singletons.refs.hasUserRef()?window.NS.singletons.refs.getUserRef():C.collection("Users").doc(n)).collection("Drawings").get().then(function(t){var n={};t.forEach(function(e){var t=e.ref.path;n[e.id]={doc:e.data(),path:t}}),e(n)}).catch(function(e){t(e)})})):Promise.reject("user doesnt exist");var n}).then(function(e){return t.drawings=e,console.log(e),function(e){var t=[];return Object.keys(e).forEach(function(e){t.push(E(e))}),Promise.all(t)}(e)}).then(function(e){for(var n=0;n<e.length;n++){var i=Object.keys(e[n])[0];t.drawings[i].nodes=e[n][i]}t.populateView()}).catch(function(e){console.log("err",e)})}},{key:"populateView",value:function(){var e=this,t=Object.keys(this.drawings),n=t.map(function(t,n){return'\n      <div class="drawings-item">\n        <h4>'.concat(e.drawings[t].doc.title,"</h4>\n        <h5>Nodes: ").concat(e.drawings[t].nodes.length,"</h5>\n        <h5>Last saved: ").concat(new Date(1e3*e.drawings[t].doc.timestamp.seconds),'</h5>\n        <div class="click-cover" data-id="').concat(t,'"></div>\n        <h5 class="delete-btn" data-id="').concat(t,'">Delete</h5>\n      </div>\n    ')}).join(""),i='\n      <div class="drawings-outer-content">\n        <h4>YOUR DRAWINGS</h4>\n        <div class="drawings-window-content-wrapper">\n          '.concat(t.length>0?n:"<h4>NO SAVED DRAWINGS</h4>",'\n        </div>\n        <div class="new-drawing">\n          <div class="init-container">\n            <h4>CREATE NEW DRAWING</h4>\n          </div>\n          <div class="data-container">\n            <div class="input-title-container">\n              <input type="text" placeholder="Title" />\n              <button class="save-title" type="button">Spara</button>\n              <button class="cancel-title" type="button">Bakåt</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    ');this.el.innerHTML=i,this.el.querySelectorAll(".drawings-item").forEach(function(t){t.querySelector(".delete-btn").addEventListener("click",e.onDeleteDrawingBound),t.addEventListener("click",e.onExistingDrawingClickBound)});var o=this.el.querySelector(".data-container");this.el.querySelector(".init-container").addEventListener("click",function(){o.classList.add("visible")});var a=o.querySelector("input");o.querySelector(".save-title").addEventListener("click",function(){var t,n;(t={title:a.value},n=Object.assign({},t,{timestamp:firebase.firestore.FieldValue.serverTimestamp()}),window.NS.singletons.refs.getUserRef().collection("Drawings").add(n)).then(function(t){window.NS.singletons.refs.setDrawingRef(t),e.onSelected()}).catch(function(){console.log("error")})}),o.querySelector(".cancel-title").addEventListener("click",function(){console.log("cancel click",e),o.classList.remove("visible"),a.value=""})}},{key:"onDeleteDrawing",value:function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=e.target.getAttribute("data-id"),i=this.drawings[n].path;window.NS.singletons.DialogManager.verificationDialog.show(function(){window.NS.singletons.DialogManager.verificationDialog.hide(),firebase.functions().httpsCallable("recursiveDelete")({path:i}).then(function(e){console.log("Delete success: "+JSON.stringify(e)),t.getDrawingsData()}).catch(function(e){console.log("Delete failed, see console,"),console.warn(e)})},function(){window.NS.singletons.DialogManager.verificationDialog.hide()})}},{key:"onExistingDrawingClick",value:function(e){var t=e.target.getAttribute("data-id"),n=this.drawings[t];window.NS.singletons.refs.setDrawingRef(function(e){return window.NS.singletons.refs.getUserRef().collection("Drawings").doc(e)}(t)),this.onSelected(n)}},{key:"show",value:function(){this.el.classList.remove("hide")}},{key:"hide",value:function(){this.el.classList.add("hide")}}])&&xi(t.prototype,n),i&&xi(t,i),e}();function Mi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Di=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.userRef=null,this.drawingRef=null,this.nodesRef=null,this.paramContainerRef={},this.nodesRefs={}}var t,n,i;return t=e,(n=[{key:"hasUserRef",value:function(){return!!this.userRef}},{key:"setUserRef",value:function(e){this.userRef=e}},{key:"getUserRef",value:function(){return this.userRef}},{key:"hasDrawingRef",value:function(){return!!this.drawingRef}},{key:"setDrawingRef",value:function(e){this.drawingRef=e}},{key:"getDrawingRef",value:function(){return this.drawingRef}},{key:"addNodeRef",value:function(e){this.nodesRefs[e.id]=e}},{key:"removeNodeRef",value:function(e){delete this.nodesRefs[e]}},{key:"getNodeRef",value:function(e){return this.nodesRefs[e]}},{key:"hasNodeRef",value:function(e){return!!this.nodesRefs[e]}},{key:"setNodesRef",value:function(e){this.nodesRef=e}},{key:"hasNodesRef",value:function(){return!!this.nodesRef}},{key:"getNodesRef",value:function(){return this.nodesRef}}])&&Mi(t.prototype,n),i&&Mi(t,i),e}();function Pi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,"default",function(){return Ti});var Ti=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),window.NS={},window.NS.transform=function(){var e=document.createElement("div");if(null==e.style.transform){var t=["Webkit","Moz","ms"];for(var n in t)if(void 0!==e.style[t[n]+"Transform"])return t[n]+"Transform"}return"transform"}(),window.NS.iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,window.NS.singletons={},this.onDrawingSelectedBound=this.onDrawingSelected.bind(this);var i=new Di;window.NS.singletons.refs=i,this.main=new Ni,this.drawingsWindow=new Si(document.body,t,this.onDrawingSelectedBound),this.onResize(),window.addEventListener("resize",function(){n.onResize()}),this.reqFrameBound=this.reqFrame.bind(this),this.reqFrame()}var t,n,i;return t=e,(n=[{key:"onDrawingSelected",value:function(e){this.drawingsWindow.hide(),this.main.init(e)}},{key:"onLogout",value:function(){this.main.onLogout()}},{key:"onLogin",value:function(){this.main.onLogin()}},{key:"reqFrame",value:function(){window.requestAnimationFrame(this.reqFrameBound),this.main.update(),this.main.render()}},{key:"onResize",value:function(){var e=window.innerWidth,t=window.innerHeight;this.main.onResize(e,t)}}])&&Pi(t.prototype,n),i&&Pi(t,i),e}()}]]);