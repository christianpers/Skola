(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,,,,function(e,t,n){var i=n(14);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-title {\n  width: 100%;\n  display: flex;\n  justify-content: center; }\n  .node-title .node-inner-title {\n    background: black;\n    padding: 4px;\n    display: inline-block; }\n    .node-title .node-inner-title > input {\n      text-align: center;\n      background: transparent;\n      border: 0;\n      color: yellow; }\n",""])},,,function(e,t,n){var i=n(18);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".settings-window {\n  position: absolute;\n  top: 0;\n  left: 0;\n  background: white;\n  transform: translateY(-100%);\n  transition: transform 0.4s; }\n  .settings-window .label-btn {\n    position: absolute;\n    bottom: -27px;\n    left: 0;\n    background: white;\n    padding: 8px;\n    cursor: pointer; }\n    .settings-window .label-btn > h5 {\n      color: black; }\n  .settings-window.visible {\n    transform: translateY(0); }\n  .settings-window .close-fullscreen-btn {\n    position: absolute;\n    left: -40px;\n    top: 20px;\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n    display: none; }\n    .settings-window .close-fullscreen-btn.visible {\n      display: block; }\n    .settings-window .close-fullscreen-btn::after {\n      content: '';\n      height: 2px;\n      width: 100%;\n      background: yellow;\n      transform: rotate(45deg);\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      margin-left: -50%; }\n    .settings-window .close-fullscreen-btn::before {\n      content: '';\n      height: 2px;\n      width: 100%;\n      background: yellow;\n      transform: rotate(-45deg);\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      margin-left: -50%; }\n  .settings-window .bottom-part-settings {\n    z-index: 1;\n    display: flex;\n    padding: 10px; }\n    .settings-window .bottom-part-settings .settings-col:first-child {\n      margin-right: 10px; }\n  .settings-window .settings-item {\n    background: rgba(0, 0, 0, 0.1);\n    padding: 10px;\n    margin-bottom: 10px; }\n    .settings-window .settings-item > h4 {\n      color: black; }\n    .settings-window .settings-item:last-child {\n      margin-bottom: 0; }\n    .settings-window .settings-item:hover {\n      background: rgba(0, 0, 0, 0.3); }\n    .settings-window .settings-item.enabled {\n      background: rgba(0, 0, 0, 0.3); }\n  .settings-window .follow-node-setting {\n    opacity: 0.2; }\n    .settings-window .follow-node-setting:hover {\n      background: rgba(0, 0, 0, 0.1); }\n    .settings-window .follow-node-setting.active {\n      opacity: 1;\n      cursor: pointer; }\n      .settings-window .follow-node-setting.active:hover {\n        background: rgba(0, 0, 0, 0.3); }\n  .settings-window .camera-control-setting {\n    color: white;\n    align-items: center;\n    position: relative;\n    display: flex;\n    justify-content: space-between;\n    cursor: pointer; }\n  .settings-window .toggle-orbit-helper {\n    cursor: pointer; }\n  .settings-window .speed-settings .range-container .range-inner-container .range-knob {\n    background: black; }\n  .settings-window .speed-settings .value-display {\n    color: black; }\n  .settings-window .speed-settings:hover {\n    background: rgba(0, 0, 0, 0.1); }\n  .settings-window .ambient-light .range-container .range-inner-container .range-knob {\n    background: black; }\n  .settings-window .ambient-light .value-display {\n    color: black; }\n  .settings-window .ambient-light:hover {\n    background: rgba(0, 0, 0, 0.1); }\n  .settings-window .axes-helper-setting {\n    color: white;\n    align-items: center;\n    position: relative;\n    display: flex;\n    justify-content: space-between;\n    cursor: pointer; }\n",""])},function(e,t,n){var i=n(20);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".resizer {\n  position: absolute;\n  left: 0;\n  top: 0;\n  height: 20px;\n  cursor: nesw-resize; }\n  .resizer.hidden {\n    display: none; }\n  .resizer > img {\n    height: 100%; }\n  .resizer .touch-layer {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%; }\n",""])},function(e,t,n){var i=n(22);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".fullscreen {\n  position: absolute;\n  left: 30px;\n  top: 0;\n  height: 20px;\n  cursor: pointer; }\n  .fullscreen.hidden {\n    display: none; }\n  .fullscreen > img {\n    height: 100%; }\n  .fullscreen .touch-layer {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%; }\n",""])},function(e,t,n){var i=n(24);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".canvas {\n  width: 640px;\n  height: 600px;\n  right: 0;\n  z-index: 2;\n  transform: translateY(-100%);\n  position: absolute;\n  transition: transform 0.4s; }\n  .canvas .top-part {\n    padding: 0;\n    position: absolute;\n    top: 0;\n    left: 0;\n    height: 100%;\n    width: 100%; }\n    .canvas .top-part > canvas {\n      background: black; }\n  .canvas.visible {\n    transform: translateY(0); }\n  .canvas .bottom-label {\n    position: absolute;\n    bottom: -20px;\n    left: 0;\n    background: #0a0a0a;\n    /* color: black; */\n    /* padding: 10px; */\n    height: 20px;\n    width: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer; }\n    .canvas .bottom-label > h5 {\n      color: yellow; }\n",""])},function(e,t,n){var i=n(26);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,'space-time-ui {\n  display: block;\n  position: absolute;\n  right: 20px;\n  top: 0;\n  padding: 10px;\n  background: transparent;\n  width: 170px; }\n  space-time-ui > .time-container {\n    margin-bottom: 10px;\n    display: grid;\n    grid-auto-rows: auto;\n    grid-template-columns: 90px 1fr;\n    grid-gap: 6px;\n    grid-template-areas: "values button"; }\n    space-time-ui > .time-container > .value-container {\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      grid-gap: 6px; }\n    space-time-ui > .time-container > button {\n      background: yellow;\n      border: 0;\n      padding: 4px 8px;\n      cursor: pointer; }\n      space-time-ui > .time-container > button > h4 {\n        color: black;\n        font-size: 12px;\n        font-weight: bold; }\n  space-time-ui > .speed-slider-container {\n    background: #141414;\n    padding: 6px;\n    margin-bottom: 10px; }\n',""])},,,,,,,,,,,,,,,,,function(e,t,n){var i=n(44);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".vertical-range-slider {\n  text-align: center; }\n  .vertical-range-slider .range-container {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding-left: 0 !important;\n    height: 120px !important; }\n    .vertical-range-slider .range-container .input-container {\n      width: 40%; }\n      .vertical-range-slider .range-container .input-container > p {\n        color: yellow;\n        font-size: 10px;\n        margin-top: 0;\n        margin-bottom: 4px;\n        text-align: left; }\n      .vertical-range-slider .range-container .input-container > input {\n        width: 100%;\n        height: 20px;\n        padding: 5px;\n        background: yellow;\n        color: black;\n        border: 0; }\n    .vertical-range-slider .range-container .range-inner-container {\n      width: 10px;\n      margin-left: 5%;\n      margin-right: 5%;\n      height: 100px;\n      background: black;\n      border: 1px solid yellow;\n      position: relative; }\n      .vertical-range-slider .range-container .range-inner-container .range-knob {\n        position: absolute;\n        top: 0;\n        left: 50%;\n        width: 20px;\n        height: 8px;\n        background: yellow;\n        margin-left: -10px; }\n  .vertical-range-slider .value-container {\n    margin-top: 18px;\n    display: inline-block; }\n    .vertical-range-slider .value-container > p {\n      color: yellow;\n      margin-bottom: 4px; }\n    .vertical-range-slider .value-container .value-display {\n      background: black;\n      color: yellow;\n      padding: 5px 10px;\n      width: 70px;\n      font-family: Arial; }\n",""])},function(e,t,n){var i=n(46);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".vertical-slider {\n  text-align: center;\n  margin-bottom: 16px;\n  border-radius: 3px;\n  color: white;\n  padding: 5px;\n  position: relative;\n  max-width: 80px; }\n  .vertical-slider .disabled-layer {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    border-radius: 8px;\n    background: black;\n    opacity: 0.8;\n    display: none;\n    z-index: 1; }\n    .vertical-slider .disabled-layer.visible {\n      display: block; }\n  .vertical-slider .vertical-slider-label {\n    position: relative;\n    z-index: 1; }\n  .vertical-slider .range-container {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding-left: 0 !important;\n    height: 80px !important; }\n    .vertical-slider .range-container .range-inner-container {\n      width: 10px;\n      margin-left: 5%;\n      margin-right: 5%;\n      height: 60px;\n      background: black;\n      position: relative;\n      border: 1px solid yellow; }\n      .vertical-slider .range-container .range-inner-container .range-knob {\n        position: absolute;\n        top: -8px;\n        left: 50%;\n        width: 32px;\n        height: 16px;\n        background: black;\n        margin-left: -16px;\n        border: 1px solid yellow; }\n  .vertical-slider .value-container {\n    display: inline-block;\n    text-align: center; }\n    .vertical-slider .value-container > p {\n      color: yellow;\n      margin-bottom: 4px;\n      text-align: left; }\n    .vertical-slider .value-container .value-display {\n      color: yellow;\n      padding: 5px 10px;\n      width: 70px;\n      font-family: Arial; }\n",""])},function(e,t,n){var i=n(48);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".dropdown {\n  width: 140px;\n  height: 64px;\n  position: relative;\n  overflow: hidden; }\n  .dropdown > h4 {\n    padding-left: 3px;\n    margin-bottom: 10px; }\n  .dropdown > .upper-row-container {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 0px;\n    border-bottom: 2px solid yellow;\n    padding-bottom: 6px;\n    align-items: flex-end;\n    padding-left: 3px;\n    padding-right: 3px; }\n    .dropdown > .upper-row-container > .reset-btn {\n      background: yellow;\n      padding: 4px;\n      border-radius: 3px;\n      cursor: pointer; }\n      .dropdown > .upper-row-container > .reset-btn > h5 {\n        color: black; }\n  .dropdown .selected-container {\n    margin-top: 10px;\n    margin-bottom: 13px; }\n    .dropdown .selected-container > h4 {\n      padding: 3px 4px; }\n  .dropdown .list-container {\n    width: calc(100% - 30px);\n    height: auto;\n    background: yellow; }\n    .dropdown .list-container .list-item {\n      padding: 4px 4px;\n      cursor: pointer;\n      position: relative; }\n      .dropdown .list-container .list-item > h4 {\n        color: black; }\n      .dropdown .list-container .list-item > .touch-layer {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%; }\n      .dropdown .list-container .list-item.selected {\n        background: black; }\n        .dropdown .list-container .list-item.selected > h4 {\n          color: yellow; }\n      .dropdown .list-container .list-item:hover {\n        background: black; }\n        .dropdown .list-container .list-item:hover > h4 {\n          color: yellow; }\n  .dropdown .arrow-toggle-container {\n    width: 20px;\n    height: 20px;\n    position: absolute;\n    right: 9px;\n    bottom: 12px;\n    background: black;\n    cursor: pointer; }\n    .dropdown .arrow-toggle-container > img {\n      transition: transform .2s; }\n  .dropdown.open {\n    overflow: initial; }\n    .dropdown.open .arrow-toggle-container > img {\n      transform: rotate(180deg); }\n",""])},function(e,t,n){var i=n(50);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-settings.orbit-driver-node {\n  flex-direction: column; }\n  .node-settings.orbit-driver-node .slider-row {\n    width: 100%;\n    display: flex;\n    justify-content: center; }\n    .node-settings.orbit-driver-node .slider-row .vertical-slider {\n      margin-right: 10px; }\n      .node-settings.orbit-driver-node .slider-row .vertical-slider:last-child {\n        margin-right: 0; }\n  .node-settings.orbit-driver-node .visual-helper-settings {\n    padding: 5px; }\n    .node-settings.orbit-driver-node .visual-helper-settings .toggle-visibility {\n      width: 20px;\n      height: 20px;\n      background: yellow;\n      margin-top: 10px;\n      cursor: pointer;\n      opacity: 0.4;\n      border-radius: 4px; }\n      .node-settings.orbit-driver-node .visual-helper-settings .toggle-visibility.enabled {\n        opacity: 1; }\n  .node-settings.orbit-driver-node .center-point-settings {\n    padding: 5px;\n    margin-left: 40px; }\n  .node-settings.orbit-driver-node .toggle-start {\n    color: black;\n    display: block;\n    background: yellow;\n    padding: 6px 20px;\n    border-radius: 4px;\n    margin-top: 50px; }\n    .node-settings.orbit-driver-node .toggle-start > h4 {\n      color: black; }\n",""])},function(e,t,n){var i=n(52);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-settings.rotation-driver-node {\n  flex-direction: column; }\n  .node-settings.rotation-driver-node .slider-row {\n    width: 100%;\n    display: flex;\n    justify-content: center; }\n    .node-settings.rotation-driver-node .slider-row .vertical-slider {\n      margin-right: 10px; }\n      .node-settings.rotation-driver-node .slider-row .vertical-slider:last-child {\n        margin-right: 0; }\n  .node-settings.rotation-driver-node .toggle-start {\n    color: black;\n    display: block;\n    background: yellow;\n    padding: 6px 20px;\n    border-radius: 4px; }\n    .node-settings.rotation-driver-node .toggle-start > h4 {\n      color: black; }\n",""])},,,,function(e,t,n){var i=n(57);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".input-setting {\n  position: relative; }\n  .input-setting > input {\n    background: yellow;\n    border: 0;\n    padding: 4px;\n    /* font-size: 14px; */\n    font-family: Arial;\n    margin-top: 10px; }\n  .input-setting .input-label {\n    margin-bottom: 10px; }\n  .input-setting .apply-btn {\n    margin-left: 10px;\n    background: black;\n    color: yellow;\n    font-family: Arial;\n    border: 1px solid yellow;\n    padding: 4px;\n    cursor: pointer;\n    opacity: .1; }\n    .input-setting .apply-btn.not-saved {\n      background: yellow;\n      color: black;\n      opacity: 1; }\n  .input-setting .disabled-layer {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: black;\n    opacity: 0.8;\n    display: none;\n    z-index: 1; }\n    .input-setting .disabled-layer.visible {\n      display: block; }\n",""])},function(e,t,n){var i=n(59);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,"conversion-inputs > .input-setting:last-child {\n  margin-top: 10px; }\n  conversion-inputs > .input-setting:last-child > .input-label {\n    margin-bottom: 0; }\n",""])},function(e,t,n){var i=n(61);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-settings.shape-modifier-node {\n  flex-direction: column; }\n  .node-settings.shape-modifier-node .slider-row {\n    width: 100%;\n    display: flex;\n    margin-bottom: 20px; }\n    .node-settings.shape-modifier-node .slider-row .orbit-slider-group {\n      position: relative;\n      padding-top: 20px;\n      margin-right: 10px; }\n      .node-settings.shape-modifier-node .slider-row .orbit-slider-group .orbit-slider-label-group {\n        position: absolute;\n        top: -13px;\n        background: yellow;\n        padding: 4px 8px; }\n        .node-settings.shape-modifier-node .slider-row .orbit-slider-group .orbit-slider-label-group > h4 {\n          color: black; }\n        .node-settings.shape-modifier-node .slider-row .orbit-slider-group .orbit-slider-label-group > h5 {\n          color: black; }\n      .node-settings.shape-modifier-node .slider-row .orbit-slider-group .orbit-inner-slider-group {\n        display: flex;\n        border: 1px solid yellow;\n        padding: 6px;\n        align-items: flex-end; }\n        .node-settings.shape-modifier-node .slider-row .orbit-slider-group .orbit-inner-slider-group .input-setting {\n          margin-right: 20px; }\n          .node-settings.shape-modifier-node .slider-row .orbit-slider-group .orbit-inner-slider-group .input-setting:last-child {\n            margin-right: 0; }\n      .node-settings.shape-modifier-node .slider-row .orbit-slider-group:last-child {\n        margin-right: 0; }\n    .node-settings.shape-modifier-node .slider-row .vertical-slider {\n      margin-right: 10px; }\n      .node-settings.shape-modifier-node .slider-row .vertical-slider:last-child {\n        margin-right: 0; }\n  .node-settings.shape-modifier-node .visual-helper-settings {\n    padding: 5px; }\n    .node-settings.shape-modifier-node .visual-helper-settings .toggle-visibility {\n      width: 20px;\n      height: 20px;\n      background: yellow;\n      margin-top: 10px;\n      cursor: pointer;\n      opacity: 0.4;\n      border-radius: 4px; }\n      .node-settings.shape-modifier-node .visual-helper-settings .toggle-visibility.enabled {\n        opacity: 1; }\n  .node-settings.shape-modifier-node .center-point-settings {\n    padding: 5px;\n    margin-left: 40px; }\n  .node-settings.shape-modifier-node .toggle-start {\n    color: black;\n    display: block;\n    background: yellow;\n    padding: 6px 20px;\n    border-radius: 4px;\n    margin-top: 50px; }\n    .node-settings.shape-modifier-node .toggle-start > h4 {\n      color: black; }\n",""])},function(e,t,n){var i=n(63);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-settings.space-orbit-node {\n  flex-direction: column; }\n  .node-settings.space-orbit-node .slider-row {\n    width: 100%;\n    display: flex;\n    margin-bottom: 20px; }\n    .node-settings.space-orbit-node .slider-row .orbit-slider-group {\n      position: relative;\n      padding-top: 20px;\n      margin-right: 10px; }\n      .node-settings.space-orbit-node .slider-row .orbit-slider-group .orbit-slider-label-group {\n        background: yellow;\n        padding: 4px 8px; }\n        .node-settings.space-orbit-node .slider-row .orbit-slider-group .orbit-slider-label-group > h4 {\n          color: black; }\n        .node-settings.space-orbit-node .slider-row .orbit-slider-group .orbit-slider-label-group > h5 {\n          color: black; }\n      .node-settings.space-orbit-node .slider-row .orbit-slider-group .orbit-inner-slider-group {\n        display: flex;\n        border: 1px solid yellow;\n        padding: 6px;\n        align-items: flex-end; }\n        .node-settings.space-orbit-node .slider-row .orbit-slider-group .orbit-inner-slider-group .input-setting {\n          margin-right: 20px; }\n          .node-settings.space-orbit-node .slider-row .orbit-slider-group .orbit-inner-slider-group .input-setting:last-child {\n            margin-right: 0; }\n      .node-settings.space-orbit-node .slider-row .orbit-slider-group:last-child {\n        margin-right: 0; }\n    .node-settings.space-orbit-node .slider-row .vertical-slider {\n      margin-right: 10px; }\n      .node-settings.space-orbit-node .slider-row .vertical-slider:last-child {\n        margin-right: 0; }\n  .node-settings.space-orbit-node .visual-helper-settings {\n    padding: 5px; }\n    .node-settings.space-orbit-node .visual-helper-settings .toggle-visibility {\n      width: 20px;\n      height: 20px;\n      background: yellow;\n      margin-top: 10px;\n      cursor: pointer;\n      opacity: 0.4;\n      border-radius: 4px; }\n      .node-settings.space-orbit-node .visual-helper-settings .toggle-visibility.enabled {\n        opacity: 1; }\n  .node-settings.space-orbit-node .center-point-settings {\n    padding: 5px; }\n  .node-settings.space-orbit-node .toggle-start {\n    color: black;\n    display: block;\n    background: yellow;\n    padding: 6px 20px;\n    border-radius: 4px;\n    margin-top: 50px;\n    cursor: pointer; }\n    .node-settings.space-orbit-node .toggle-start > h4 {\n      color: black; }\n",""])},function(e,t,n){var i=n(65);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".atom-html-label {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 60px;\n  height: 60px;\n  background: rgba(255, 255, 255, 0.8);\n  align-items: center;\n  border-radius: 31px;\n  pointer-events: none; }\n  .atom-html-label .atom-charge {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    font-size: 22px;\n    color: black;\n    font-weight: 700; }\n  .atom-html-label .atom-type {\n    color: white;\n    font-size: 12px;\n    position: absolute;\n    top: -16px;\n    left: 50%;\n    transform: translateX(-50%); }\n  .atom-html-label > .detail-container {\n    position: absolute;\n    top: 50%;\n    transform: translateY(-50%);\n    left: -12px;\n    display: flex; }\n    .atom-html-label > .detail-container.electrons {\n      left: auto;\n      right: -12px; }\n    .atom-html-label > .detail-container > .detail-number {\n      font-weight: 700; }\n    .atom-html-label > .detail-container p {\n      color: white;\n      font-size: 14px; }\n",""])},function(e,t,n){var i=n(67);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".connection-window {\n  position: absolute;\n  top: 300px;\n  left: 0;\n  height: 146px;\n  width: 30px;\n  opacity: .2;\n  z-index: 2; }\n  .connection-window .bg-layer {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background: rgba(27, 28, 30, 0.95);\n    display: none; }\n  .connection-window.visible {\n    width: auto;\n    z-index: 3; }\n    .connection-window.visible .content-container {\n      display: flex; }\n    .connection-window.visible .close-btn {\n      display: block; }\n    .connection-window.visible .bg-layer {\n      display: block; }\n  .connection-window.has-params {\n    opacity: 1; }\n  .connection-window .close-btn {\n    display: none;\n    position: absolute;\n    right: 10px;\n    top: -16px;\n    color: white;\n    cursor: pointer; }\n  .connection-window .title {\n    transform: rotate(90deg);\n    transform-origin: left center;\n    position: absolute;\n    top: -8px;\n    left: 13px;\n    white-space: nowrap;\n    padding: 0 0px 4px 13px; }\n  .connection-window .content-container {\n    display: none;\n    align-items: center;\n    padding-top: 30px;\n    padding-bottom: 30px;\n    padding-left: 40px;\n    padding-right: 40px;\n    background: black;\n    position: relative; }\n  .connection-window .param-item-container {\n    margin-right: 20px; }\n    .connection-window .param-item-container p {\n      color: yellow;\n      margin-bottom: 4px; }\n    .connection-window .param-item-container:last-child {\n      margin-right: 0; }\n    .connection-window .param-item-container .connect-btn {\n      background: yellow;\n      margin-top: 10px;\n      display: inline-block;\n      padding: 4px 6px;\n      cursor: pointer; }\n      .connection-window .param-item-container .connect-btn > h5 {\n        color: black; }\n      .connection-window .param-item-container .connect-btn.not-allowed {\n        opacity: 0.2;\n        cursor: default; }\n  .connection-window .connected-nodes-container {\n    margin-top: 20px; }\n",""])},function(e,t,n){var i=n(69);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-remove {\n  cursor: pointer;\n  background: yellow;\n  padding: 4px 10px;\n  position: absolute;\n  transform: translateY(22px);\n  right: 43px;\n  top: -22px;\n  transition: transform .3s; }\n  .node-remove > h5 {\n    color: black; }\n  .node-remove.visible {\n    transform: translateY(0); }\n",""])},function(e,t,n){var i=n(71);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-settings-window {\n  position: absolute;\n  top: 100px;\n  left: 0;\n  height: 134px;\n  width: 30px;\n  opacity: .2;\n  z-index: 2; }\n  .node-settings-window .bg-layer {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background: rgba(27, 28, 30, 0.95);\n    display: none; }\n  .node-settings-window.has-settings {\n    opacity: 1; }\n  .node-settings-window.visible {\n    width: auto;\n    z-index: 3; }\n    .node-settings-window.visible .node-settings {\n      display: flex; }\n    .node-settings-window.visible .close-btn {\n      display: block; }\n    .node-settings-window.visible .bg-layer {\n      display: block; }\n  .node-settings-window .close-btn {\n    display: none;\n    position: absolute;\n    right: 10px;\n    top: -16px;\n    color: white;\n    cursor: pointer; }\n  .node-settings-window .title {\n    transform: rotate(90deg);\n    transform-origin: left center;\n    position: absolute;\n    top: -8px;\n    left: 13px;\n    white-space: nowrap;\n    padding: 0 0px 4px 13px;\n    z-index: 2; }\n  .node-settings-window .node-settings {\n    display: none;\n    align-items: center;\n    padding-top: 30px;\n    padding-bottom: 30px;\n    padding-left: 40px;\n    padding-right: 40px;\n    background: black;\n    min-width: 160px;\n    position: relative; }\n    .node-settings-window .node-settings.color-node {\n      margin-left: 30px; }\n      .node-settings-window .node-settings.color-node .color-preview {\n        width: 10px;\n        height: 10px;\n        background: white;\n        margin-left: 10px;\n        cursor: pointer; }\n    .node-settings-window .node-settings.param-driver-node {\n      flex-direction: column; }\n      .node-settings-window .node-settings.param-driver-node .top-bottom-container {\n        display: flex;\n        justify-content: space-between;\n        margin-top: 14px;\n        align-items: flex-end; }\n      .node-settings-window .node-settings.param-driver-node .duration-container > p {\n        color: yellow;\n        font-size: 10px;\n        margin-top: 0;\n        margin-bottom: 4px;\n        text-align: left; }\n      .node-settings-window .node-settings.param-driver-node .duration-container > input {\n        width: 100%;\n        height: 20px;\n        padding: 12px 3px;\n        background: yellow;\n        color: black;\n        border: 0; }\n      .node-settings-window .node-settings.param-driver-node .toggle-start {\n        padding: 5px;\n        color: yellow;\n        background: black;\n        border: 1px solid yellow;\n        cursor: pointer;\n        margin-left: 10px; }\n        .node-settings-window .node-settings.param-driver-node .toggle-start > p {\n          text-align: center;\n          color: yellow; }\n        .node-settings-window .node-settings.param-driver-node .toggle-start:hover {\n          background: yellow; }\n          .node-settings-window .node-settings.param-driver-node .toggle-start:hover > p {\n            color: black; }\n",""])},function(e,t,n){var i=n(73);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".selected-node-window {\n  position: absolute;\n  bottom: 19px;\n  left: 0;\n  z-index: 2;\n  background: black; }\n  .selected-node-window .content {\n    padding: 14px; }\n  .selected-node-window .info-container {\n    margin-bottom: 6px; }\n    .selected-node-window .info-container > h4 {\n      margin-top: 4px;\n      color: yellow; }\n    .selected-node-window .info-container:last-child {\n      margin-bottom: 0; }\n",""])},function(e,t,n){var i=n(75);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".tab-item {\n  background: yellow;\n  margin-right: 2px;\n  margin-bottom: 2px;\n  padding: 4px 10px;\n  position: relative;\n  cursor: pointer; }\n  .tab-item.selected {\n    z-index: 1; }\n    .tab-item.selected .touch-layer {\n      background: transparent; }\n  .tab-item .tab-title {\n    color: black; }\n  .tab-item .touch-layer {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.6); }\n",""])},function(e,t,n){var i=n(77);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-selection {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  width: 100%;\n  display: flex;\n  z-index: 3;\n  background: transparent;\n  flex-flow: wrap; }\n",""])},function(e,t,n){var i=n(79);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-group-expand-collapse {\n  position: absolute;\n  top: -19px;\n  left: 0;\n  background: black;\n  padding: 4px 10px;\n  cursor: pointer; }\n  .node-group-expand-collapse > h5 {\n    pointer-events: none;\n    color: white; }\n",""])},function(e,t,n){var i=n(81);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".collapsed-view {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  padding: 4px 10px;\n  background: black;\n  display: none;\n  z-index: 1;\n  justify-content: center;\n  align-items: center;\n  cursor: grab; }\n  .collapsed-view > * {\n    pointer-events: none; }\n",""])},function(e,t,n){var i=n(83);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,'.add-remove-visual-help {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 200px;\n  height: 200px;\n  background: transparent;\n  display: flex;\n  justify-content: center;\n  z-index: 0;\n  align-items: center;\n  transform: translate(-50%, -50%);\n  border-radius: 100px;\n  opacity: 0;\n  transition: opacity .5s; }\n  .add-remove-visual-help > .add-icon {\n    display: none;\n    height: 80px; }\n  .add-remove-visual-help > .remove-icon {\n    display: none; }\n  .add-remove-visual-help > * {\n    pointer-events: none; }\n  .add-remove-visual-help[type="add"] {\n    background: rgba(255, 255, 255, 0.9);\n    z-index: 2;\n    opacity: 1; }\n    .add-remove-visual-help[type="add"] > .add-icon {\n      display: block; }\n  .add-remove-visual-help[type="remove"] {\n    background: rgba(255, 255, 255, 0.9);\n    z-index: 1; }\n    .add-remove-visual-help[type="remove"] > .remove-icon {\n      display: block; }\n',""])},function(e,t,n){var i=n(85);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,'.group-container {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 400px;\n  height: 400px;\n  border: 1px dashed black;\n  transition: height .3s;\n  cursor: grab;\n  z-index: 1; }\n  .group-container .nodes-container {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    overflow: hidden; }\n  .group-container[collapsed="true"] {\n    height: 40px; }\n    .group-container[collapsed="true"] .nodes-container {\n      opacity: 0; }\n    .group-container[collapsed="true"] .node-selection {\n      display: none; }\n    .group-container[collapsed="true"] .collapsed-view {\n      display: flex; }\n',""])},function(e,t,n){var i=n(87);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".node-library {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 260px;\n  height: 100vh;\n  padding-left: 20px;\n  padding-right: 10px;\n  background: #0a0a0a;\n  z-index: 3;\n  transform: translateX(240px);\n  transition: transform .4s; }\n  .node-library .library-tab {\n    display: none;\n    margin-top: 40px;\n    position: relative;\n    z-index: 0; }\n    .node-library .library-tab.visible {\n      display: block; }\n  .node-library .tab-selector {\n    position: absolute;\n    left: 20px;\n    top: 10px;\n    display: flex;\n    z-index: 1; }\n    .node-library .tab-selector .tab-item {\n      padding: 4px 10px;\n      opacity: .4;\n      cursor: pointer; }\n      .node-library .tab-selector .tab-item > h5 {\n        color: #0a0a0a; }\n      .node-library .tab-selector .tab-item.selected {\n        opacity: 1; }\n  .node-library .outer-scroll {\n    height: 100vh;\n    overflow: scroll; }\n  .node-library .title-bar {\n    position: fixed;\n    top: 50%;\n    left: -35px;\n    transform: rotate(90deg);\n    color: white; }\n  .node-library.showing {\n    transform: translateX(0); }\n  .node-library .inner-scroll {\n    height: 100%; }\n  .node-library .level-title {\n    border-bottom: 1px solid #3c3c3c;\n    margin-top: 10px;\n    color: #d2d2d2;\n    text-transform: capitalize; }\n  .node-library .level-1 {\n    margin-left: 10px; }\n  .node-library .node-container {\n    display: flex;\n    margin-top: 24px;\n    flex-wrap: wrap; }\n  .node-library .library-node {\n    margin-right: 2%;\n    padding: 5px;\n    display: flex;\n    flex-direction: column;\n    position: relative;\n    cursor: pointer;\n    margin-bottom: 30px; }\n    .node-library .library-node.modifier {\n      padding-bottom: 10px; }\n    .node-library .library-node .node-type {\n      color: #d2d2d2;\n      position: absolute;\n      top: -15px;\n      left: 0;\n      font-size: 8px; }\n    .node-library .library-node > img {\n      width: 20px;\n      height: 20px;\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      opacity: 0.6; }\n    .node-library .library-node .node-add {\n      width: 30px;\n      align-self: center;\n      margin-top: 5px; }\n",""])},function(e,t,n){var i=n(89);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".status-window {\n  position: absolute;\n  top: 0;\n  left: 300px;\n  padding: 10px 14px;\n  background: black;\n  color: yellow;\n  z-index: 2;\n  transform: translateY(-100%);\n  transition: transform .3s;\n  display: flex;\n  align-items: center; }\n  .status-window > h4 {\n    color: yellow; }\n  .status-window > p > span {\n    font-style: italic;\n    color: yellow; }\n  .status-window > button {\n    padding: 4px 8px;\n    background: yellow;\n    border: 0;\n    color: black;\n    margin-left: 8px;\n    cursor: pointer; }\n    .status-window > button > p {\n      color: inherit; }\n  .status-window.unsaved {\n    transform: translateY(0); }\n    .status-window.unsaved > p > span {\n      color: red; }\n",""])},function(e,t,n){var i=n(91);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".delete-view {\n  position: absolute;\n  bottom: 50px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 48px;\n  opacity: 0;\n  transition: opacity 0.2s;\n  z-index: 2; }\n  .delete-view > img {\n    width: 100%; }\n  .delete-view.visible {\n    opacity: 1; }\n",""])},function(e,t,n){var i=n(93);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".verification-dialog {\n  position: fixed;\n  height: 100vh;\n  width: 100vw;\n  background: rgba(0, 0, 0, 0.8);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 4;\n  top: 0;\n  left: 0; }\n  .verification-dialog.hidden {\n    display: none; }\n  .verification-dialog .inner-content {\n    padding: 30px 60px;\n    background: black; }\n    .verification-dialog .inner-content > h4 {\n      margin-bottom: 20px; }\n    .verification-dialog .inner-content > button {\n      background: yellow;\n      border: 0;\n      padding: 10px 16px;\n      margin-right: 10px;\n      cursor: pointer; }\n      .verification-dialog .inner-content > button:last-child {\n        margin-right: 0; }\n      .verification-dialog .inner-content > button > h5 {\n        color: black; }\n",""])},function(e,t,n){var i=n(95);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".loader {\n  position: fixed;\n  height: 100vh;\n  width: 100vw;\n  background: rgba(0, 0, 0, 0.8);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 4;\n  top: 0;\n  left: 0; }\n  .loader.hidden {\n    display: none; }\n  .loader .loader-img {\n    width: 100px; }\n",""])},function(e,t,n){var i=n(97);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".new-project-dialog {\n  position: fixed;\n  height: 100vh;\n  width: 100vw;\n  background: rgba(0, 0, 0, 0.8);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 4;\n  top: 0;\n  left: 0; }\n  .new-project-dialog.hidden {\n    display: none; }\n  .new-project-dialog .inner-content {\n    padding: 20px 20px;\n    background: black; }\n    .new-project-dialog .inner-content .title-container {\n      margin-bottom: 20px; }\n      .new-project-dialog .inner-content .title-container > h4 {\n        color: white;\n        margin-bottom: 6px; }\n      .new-project-dialog .inner-content .title-container > input {\n        width: 100%;\n        border: 0;\n        padding: 4px 4px;\n        color: black;\n        background: yellow;\n        font-family: Arial;\n        font-weight: 700; }\n        .new-project-dialog .inner-content .title-container > input::placeholder {\n          color: black;\n          font-family: Arial; }\n    .new-project-dialog .inner-content .dropdown-container {\n      margin-bottom: 30px; }\n    .new-project-dialog .inner-content > button {\n      background: yellow;\n      border: 0;\n      padding: 10px 16px;\n      margin-right: 10px;\n      cursor: pointer; }\n      .new-project-dialog .inner-content > button:last-child {\n        margin-right: 0; }\n      .new-project-dialog .inner-content > button > h5 {\n        color: black; }\n",""])},function(e,t,n){var i=n(99);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".save-dialog {\n  position: fixed;\n  height: 100vh;\n  width: 100vw;\n  background: rgba(0, 0, 0, 0.8);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 4;\n  top: 0;\n  left: 0; }\n  .save-dialog.hidden {\n    display: none; }\n  .save-dialog .inner-content {\n    padding: 30px 60px;\n    background: black; }\n    .save-dialog .inner-content > h4 {\n      margin-bottom: 20px; }\n    .save-dialog .inner-content > button {\n      background: yellow;\n      border: 0;\n      padding: 10px 16px;\n      margin-right: 10px;\n      cursor: pointer; }\n      .save-dialog .inner-content > button:last-child {\n        margin-right: 0; }\n      .save-dialog .inner-content > button > h5 {\n        color: black; }\n",""])},function(e,t,n){var i=n(101);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".drawings-window {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  background: rgba(0, 0, 0, 0.8);\n  z-index: 3;\n  display: flex;\n  justify-content: center;\n  align-items: center; }\n  .drawings-window.hide {\n    display: none; }\n  .drawings-window .drawings-outer-content {\n    padding-top: 40px;\n    min-width: 400px;\n    width: 90vw;\n    display: grid;\n    width: 90vw;\n    grid-template-columns: fit-content(280px) auto; }\n    .drawings-window .drawings-outer-content .drawings-container:first-child {\n      margin-right: 40px; }\n    .drawings-window .drawings-outer-content > .generic-drawings .drawings-window-content-wrapper {\n      grid-template-columns: auto; }\n    .drawings-window .drawings-outer-content > h4 {\n      margin-bottom: 4px;\n      background: white;\n      color: black;\n      padding: 2px 4px;\n      display: inline-block; }\n    .drawings-window .drawings-outer-content .new-drawing {\n      padding: 20px;\n      background: white;\n      margin-top: 4px;\n      cursor: pointer;\n      position: relative; }\n      .drawings-window .drawings-outer-content .new-drawing:hover {\n        background: rgba(255, 255, 255, 0.94); }\n      .drawings-window .drawings-outer-content .new-drawing .init-container > h4 {\n        text-align: center;\n        color: black; }\n      .drawings-window .drawings-outer-content .new-drawing .init-container .touch-el {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%; }\n      .drawings-window .drawings-outer-content .new-drawing > .data-container {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: white;\n        display: none;\n        justify-content: center;\n        align-items: center; }\n        .drawings-window .drawings-outer-content .new-drawing > .data-container.visible {\n          display: flex; }\n        .drawings-window .drawings-outer-content .new-drawing > .data-container .input-title-container {\n          display: flex; }\n          .drawings-window .drawings-outer-content .new-drawing > .data-container .input-title-container > input {\n            border: none;\n            background: black;\n            color: white;\n            padding: 4px 6px;\n            font-size: 14px;\n            margin-right: 4px; }\n          .drawings-window .drawings-outer-content .new-drawing > .data-container .input-title-container > button {\n            margin-left: 4px;\n            background: black;\n            border: 0;\n            border-radius: 0;\n            color: white; }\n  .drawings-window .drawings-window-content-wrapper {\n    padding: 8px;\n    background: white;\n    display: grid;\n    grid-template-columns: auto auto auto;\n    grid-gap: 12px; }\n    .drawings-window .drawings-window-content-wrapper > h4 {\n      color: black;\n      text-align: center; }\n    .drawings-window .drawings-window-content-wrapper .drawings-item {\n      padding: 20px;\n      background: rgba(0, 0, 0, 0.03);\n      cursor: pointer;\n      position: relative; }\n      .drawings-window .drawings-window-content-wrapper .drawings-item:hover {\n        background: rgba(0, 0, 0, 0.08); }\n      .drawings-window .drawings-window-content-wrapper .drawings-item:last-child {\n        margin-bottom: 0; }\n      .drawings-window .drawings-window-content-wrapper .drawings-item .top-row {\n        display: flex;\n        margin-bottom: 6px; }\n        .drawings-window .drawings-window-content-wrapper .drawings-item .top-row .block-with-pre {\n          margin-left: 10px; }\n          .drawings-window .drawings-window-content-wrapper .drawings-item .top-row .block-with-pre:first-child {\n            margin-left: 0; }\n          .drawings-window .drawings-window-content-wrapper .drawings-item .top-row .block-with-pre > h5 {\n            color: black;\n            margin-bottom: 2px; }\n          .drawings-window .drawings-window-content-wrapper .drawings-item .top-row .block-with-pre > h4 {\n            background: black;\n            padding: 4px;\n            display: inline-block; }\n          .drawings-window .drawings-window-content-wrapper .drawings-item .top-row .block-with-pre.type > h4 {\n            background: transparent;\n            color: black;\n            border: 2px solid black;\n            padding: 2px 4px; }\n      .drawings-window .drawings-window-content-wrapper .drawings-item > h5 {\n        color: black;\n        margin-bottom: 2px; }\n      .drawings-window .drawings-window-content-wrapper .drawings-item > .click-cover {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%; }\n      .drawings-window .drawings-window-content-wrapper .drawings-item .delete-btn {\n        position: absolute;\n        top: 10px;\n        right: 10px;\n        background: red;\n        color: white;\n        padding: 6px 8px;\n        cursor: pointer; }\n",""])},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t);var o=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="node-param node-component",this.ID=o,this.param=n,this.isConnected=!1,this.connectionAllowed=!0,this.paramContainer=i,this.labelEl=document.createElement("p"),this.labelEl.className="label",this.labelEl.innerHTML=n.param,this.el.appendChild(this.labelEl),t.appendChild(this.el),window.NS.singletons.ConnectionsManager.addParam(this)}var t,n,o;return t=e,(n=[{key:"enable",value:function(){this.el.classList.add("active"),this.isConnected=!0}},{key:"disable",value:function(){this.el.classList.remove("active"),this.isConnected=!1}},{key:"activateNotPossible",value:function(){this.el.classList.add("not-possible")}},{key:"deactivateNotPossible",value:function(){this.el.classList.remove("not-possible")}},{key:"setConnectionAllowed",value:function(e){this.connectionAllowed=e}}])&&i(t.prototype,n),o&&i(t,o),e}(),r=function(e){return e.framebuffer||e.texture},a=function(e){return!!e.picker},s=function(e,t,n){return!(e.framebuffer||e.texture||e.picker||e.isSequencer)&&(!e.isShapeNode&&(!!n&&(!!n.minMax&&(!e.isOrbitPosition&&(!e.isSpaceSize&&(e.isParam&&!n.isConnected||e.isAnalyser&&!n.isConnected))))))},l=function(e,t,n){e.mesh.position[n.param]=t.getValue(n)},c=function(e,t,n){e.mesh.position[t.param]=t.defaultVal},u=function(e,t,n){var i=t.getValue();e.mesh.scale.set(i,i,i)},d=function(e,t,n){e.mesh.scale.set(1,1,1)},h=function(){},p={particleColor:{update:function(e,t){e.currentParticleColor=t.currentColor.toArray()},isValid:a,disconnect:function(e,t){e.currentParticleColor=t.defaultVal.toArray()}},particleSize:{update:function(e,t){e.currentParticleSize=t.getValue()},isValid:function(e,t,n){return!!n&&!!n.minMax&&(e.returnsSingleNumber&&!n.isConnected||e.isAnalyser&&!n.isConnected)},disconnect:function(e,t){e.currentParticleSize=t.defaultVal}},particleForm:{update:h,isValid:function(e){return e.isShapeNode},disconnect:h},particle:{update:h,isValid:s,disconnect:h},target:{update:function(e,t){e.targetPosition=t.mesh.position},isValid:function(e){return!!e.mesh},disconnect:function(e,t,n){t.defaultVal=n.mesh.position}},texture:{update:function(e,t){e.material.needsUpdate=!0,e.material.map=t.framebuffer?t.framebuffer.texture:t.texture},isValid:r,disconnect:function(e){e.material.needsUpdate=!0,e.material.map=null}},normalMap:{update:function(e,t){e.material.normalMap=t.framebuffer.texture,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0},isValid:r,disconnect:function(e){e.material.normalMap=null,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0}},bumpMap:{update:function(e,t){e.material.displacementMap=t.framebuffer.texture,e.material.displacementScale=.1,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0},isValid:r,disconnect:function(e){e.material.displacementMap=null,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0}},color:{update:function(e,t){e.material.color=t.currentColor},isValid:a,disconnect:c},position:{update:l,isValid:s,disconnect:c},rotation:{update:function(e,t,n){var i=t.getValue(n);e.mainMesh.rotation[n.param]=i},isValid:s,disconnect:function(e,t,n){e.mainMesh.rotation[t.param]=t.defaultVal}},scale:{update:u,isValid:s,disconnect:d},shaderParam:{update:function(e,t,n){e.mesh.material.uniforms[n.param].value=t.getValue()},isValid:s,disconnect:c},light:{update:function(e,t,n){var i=t.getValue(n);e.mesh.position[n.param]=i,e.light.position[n.param]=i},isValid:s,disconnect:c},atom:{update:function(e,t,n){var i;if("electrons"===n.param)i=t.getMeshGroup(e);else{var o=t.getAmountPositions(),r=e.getAvailableCorePositions(n.param,o);i=t.getMeshGroup(r)}e.updateMeshType(i,n.param,t.enableDragging,t.controlsAmountAtomRings,t.addToGroup)},isValid:function(e,t,n){return!!n&&!(!e.isParam||n.isConnected)&&(e.type.toLowerCase()===n.param||void 0)},disconnect:function(e,t){}},orbitPosition:{update:l,isValid:function(e,t,n){return!!e.isOrbitPosition&&e.isParam&&!n.isConnected},disconnect:c},spaceSize:{update:u,isValid:function(e,t,n){return!!e.isSpaceSize&&e.isParam&&!n.isConnected},disconnect:d}};function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=function(){function e(t,n,i,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="node-param-container",this.pos=new THREE.Vector2,this.ID=a?a.paramContainerID:r,this.onConnectionUpdateBound=this.onConnectionUpdate.bind(this),document.documentElement.addEventListener("node-connections-update",this.onConnectionUpdateBound),this.rotation=0,this.node=i,this.nodeID=i.ID,this.paramObj=n,this.inputParams=[],this.isDisabledForConnection=!1,this.connectedNodes=[];var s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width","40px"),s.setAttribute("height","40px"),s.setAttribute("viewBox","0 0 24 24");var l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","M23.677 18.52c.914 1.523-.183 3.472-1.967 3.472h-19.414c-1.784 0-2.881-1.949-1.967-3.472l9.709-16.18c.891-1.483 3.041-1.48 3.93 0l9.709 16.18z"),s.appendChild(l),this.connectionPlaceHolder=s,this.el.appendChild(this.connectionPlaceHolder),this.paramContainer=document.createElement("div"),this.paramContainer.className="inner-param-container",this.parentLabel=document.createElement("h5"),this.parentLabel.innerHTML=n.parent,this.parentTitle=n.parent,this.paramContainer.appendChild(this.parentLabel),this.detailParamContainer=document.createElement("div"),this.detailParamContainer.className="detail-param-container",this.el.appendChild(this.paramContainer),this.el.appendChild(this.detailParamContainer),t.appendChild(this.el),this.currentModifierChildren=[];for(var c=0;c<n.children.length;c++){var u=a?a.inputParams[c]:"param-"+Math.random().toString(36).substr(2,9),d=new o(this.detailParamContainer,n.children[c],this,u);this.inputParams[n.children[c].title]=d}}var t,n,i;return t=e,(n=[{key:"setRotation",value:function(e,t){this.el.style.transform="rotate(".concat(e,"deg)"),this.el.classList.add("angle-".concat(t)),this.rotation=e}},{key:"setTextRotation",value:function(e,t){var n=(e.x+t.x)/2,i=(e.y+t.y)/2;Math.abs(Math.atan2(i,n))>1.8&&(this.parentLabel.style.transform="rotate(180deg)",this.detailParamContainer.style.transform="rotate(180deg)")}},{key:"getPos",value:function(){var e=this.connectionPlaceHolder.getBoundingClientRect();return this.pos.set(e.x+e.width/2,e.y+e.height/2),this.pos}},{key:"getCleanPos",value:function(){return this.connectionPlaceHolder.getBoundingClientRect()}},{key:"addModifierAsChild",value:function(e){this.currentModifierChildren.push({id:e.node.ID,modifier:e})}},{key:"removeModifierAsChild",value:function(e){this.currentModifierChildren.find(function(t){return t.id===e}).modifier&&this.currentModifierChildren.filter(function(t){return t.id!==e})}},{key:"isAvailableForConnection",value:function(e,t){if(this.connectedNodes.length>0)return!1;for(var n=Object.keys(this.inputParams),i=0;i<n.length;i++){var o=n[i],r=this.inputParams[o];if(p[r.param.paramHelpersType].isValid(e,t,r.param,r.ID))return!0}return!1}},{key:"setAsEnabled",value:function(){this.el.style.opacity=1,this.isDisabledForConnection=!1}},{key:"setAsDisabled",value:function(){this.el.style.opacity=.1,this.isDisabledForConnection=!0}},{key:"onConnectionUpdate",value:function(e){var t=this,n=e.detail,i=(this.node.ID in n?n[this.node.ID]:[]).filter(function(e){return e.paramContainerID===t.ID});this.connectedNodes=[];for(var o=0;o<i.length;o++){var r=i[o].outNodeID,a=window.NS.singletons.ConnectionsManager.nodes[r];this.connectedNodes.push(a)}}}])&&f(t.prototype,n),i&&f(t,i),e}();function v(e){throw new Error('"'+e+'" is read-only')}function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var y=function(){function e(t,n,i,o){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.params=n,this.paramContainers=[],this.inputParams=[],this.node=i,this.nodeConfig=o,this.parentEl.classList.add("nonagon-node"),this.size=200;var a=Object.keys(this.params).reduce(function(e,t){var n=r.params[t];return e[n.parent]||(e[n.parent]=!0),e},{});3===Object.keys(a).length&&t.classList.add("triangle-shape");var s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width","".concat(this.size,"px")),s.setAttribute("height","".concat(this.size,"px")),s.setAttribute("viewBox","0 0 ".concat(this.size," ").concat(this.size)),this.nonagonSvg=s,t.appendChild(s),this.initParams()}var t,n,i;return t=e,(n=[{key:"initParams",value:function(){var e=this,t=[];for(var n in this.params)this.params[n].useAsInput&&this.params[n].parent&&function(){var i=e.params[n].parent;if(t.some(function(e){return e.parent===i})){t.find(function(e){return e.parent===i}).children.push(e.params[n])}else{var o={parent:i,children:[]};t.push(o),o.children.push(e.params[n])}}();if(t.length>0)for(var i=0;i<t.length;i++){var o=t[i],r=Math.random().toString(36).substr(2,9),a=this.nodeConfig?this.nodeConfig.data.paramContainers[i]:null,s=new g(this.parentEl,o,this.node,r,a);this.paramContainers.push(s)}else{var l=0;for(var c in this.params){new g(this.parentEl,l);v("index"),l++}}for(var u=360/t.length,d=t.length,h=this.size/2,p=2*Math.PI/d,f=[],m=0;m<d;m++){var y={x:h*Math.cos(p*m),y:h*Math.sin(p*m)};f.push(y);var b=m*u+u/2;this.paramContainers[m].setRotation(b,m)}for(var w="M ".concat(f[0].x," ").concat(f[0].y),C=1;C<f.length;C++)w+=" L ".concat(f[C].x," ").concat(f[C].y);w+="Z";var k=document.createElementNS("http://www.w3.org/2000/svg","g");k.setAttribute("transform","translate(".concat(this.size/2,", ").concat(this.size/2,") rotate(-90)")),k.setAttribute("width","".concat(this.size)),k.setAttribute("height","".concat(this.size));var E=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttribute("d",w),E.setAttribute("stroke","black"),k.appendChild(E);for(var S=["rgb(61, 63, 67)","rgb(48, 50, 54)","rgb(36, 37, 41)","rgb(84, 86, 95)","rgb(72, 74, 81)"],x=0;x<f.length;x++){var N=document.createElementNS("http://www.w3.org/2000/svg","path"),M=x,P=x+1<f.length?x+1:0,D=f[M],O=f[P];this.paramContainers[x].setTextRotation(D,O);var T="M ".concat(D.x," ").concat(D.y," L 0 0 L ").concat(O.x," ").concat(O.y);N.setAttribute("fill",S[x%5]),N.setAttribute("d",T),k.appendChild(N);var I=document.createElementNS("http://www.w3.org/2000/svg","path"),R="M ".concat(D.x," ").concat(D.y," ").concat(O.x," ").concat(O.y);I.setAttribute("class","outline"),I.setAttribute("d",R),k.appendChild(I)}this.nonagonSvg.appendChild(k)}},{key:"setActive",value:function(){this.parentEl.style.transform="scale(1)"}},{key:"setInactive",value:function(){this.parentEl.style.transform="scale(.6)"}},{key:"getEnabledParamsForType",value:function(e,t){for(var n=t,i=this.paramContainers.find(function(t){return t.parentTitle===e}),o=Object.keys(i.inputParams),r=o.length,a=0;a<r;a++)i.inputParams[o[a]].isConnected&&(n[i.inputParams[o[a]].param.param]={enabled:!0,paramID:i.inputParams[o[a]].ID});return n}}])&&m(t.prototype,n),i&&m(t,i),e}();function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var w=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.paramContainers=[],this.triangleSvg=null,this.node=o,this.containerEl=n,this.isConnected=!1,this.assignedParamContainer=null,this.pos=new THREE.Vector2,this.parentEl.classList.add("triangle-node");var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("modifier"),r.setAttribute("width","40px"),r.setAttribute("height","40px"),r.setAttribute("viewBox","0 0 24 24");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d","M23.677 18.52c.914 1.523-.183 3.472-1.967 3.472h-19.414c-1.784 0-2.881-1.949-1.967-3.472l9.709-16.18c.891-1.483 3.041-1.48 3.93 0l9.709 16.18z"),r.appendChild(a),this.triangleSvg=r,n.appendChild(r),this.latestAngle=0}var t,n,i;return t=e,(n=[{key:"getPos",value:function(){var e=this.parentEl.getBoundingClientRect();return this.pos.set(e.x+e.width/2,e.y+e.height/2),this.pos}},{key:"setAngle",value:function(e){this.containerEl.style.transform="rotate(".concat(e,"deg)"),this.latestAngle=e}},{key:"activateAsChild",value:function(e,t,n){this.containerEl.style.transform="rotate(0deg)",this.isConnected=!0,this.assignedParamContainer=e,e.addModifierAsChild(this),this.node.setAsChildToParamContainer(e,t,n)}},{key:"deactivateAsChild",value:function(e,t){this.setAngle(this.latestAngle),this.isConnected=!1,this.assignedParamContainer.removeModifierAsChild(this.node.ID),this.node.setAsNotChildToParamContainer(this.assignedParamContainer,e,t),this.assignedParamContainer=null}},{key:"hide",value:function(){this.containerEl.style.opacity=0}},{key:"show",value:function(){this.containerEl.style.opacity=1}},{key:"removeNodeFromDom",value:function(){this.assignedParamContainer.el.removeChild(this.node.el)}}])&&b(t.prototype,n),i&&b(t,i),e}();n(13);function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var k=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.node=n;var i=document.createElement("div");i.className="node-title prevent-drag";var o=document.createElement("div");if(o.className="node-inner-title",i.appendChild(o),document.createElement("h4").innerHTML="Node Title",this.onChangeBound=this.onChange.bind(this),this.onMouseDownBound=this.mouseDown.bind(this),this.onFocusBound=this.onFocus.bind(this),this.onBlurBound=this.onBlur.bind(this),this.el=document.createElement("input"),this.el.type="text",this.el.value=n.title,this.el.addEventListener("change",this.onChangeBound),this.el.addEventListener("click",this.onMouseDownBound),this.el.addEventListener("focus",this.onFocusBound),this.el.addEventListener("blur",this.onBlurBound),o.appendChild(this.el),window.NS.showDebug()){var r=document.createElement("h5");r.innerHTML=n.ID,o.appendChild(r)}t.appendChild(i)}var t,n,i;return t=e,(n=[{key:"onFocus",value:function(){window.NS.singletons.CanvasNode.foregroundRender.toggleCameraControl(!1)}},{key:"onBlur",value:function(){window.NS.singletons.CanvasNode.foregroundRender.toggleCameraControl(!0)}},{key:"mouseDown",value:function(e){e.stopPropagation()}},{key:"blurInput",value:function(){this.el.blur()}},{key:"isValidInput",value:function(e){return!0}},{key:"onChange",value:function(e){var t=this.el.value;this.isValidInput(t)?(this.node.setTitle(t),this.blurInput()):this.el.value=this.node.title}}])&&C(t.prototype,n),i&&C(t,i),e}(),E=(firebase.firestore(),function(e){var t=Object.assign({},e,{timestamp:firebase.firestore.FieldValue.serverTimestamp()});return window.NS.singletons.refs.getUserRef().collection("Drawings").add(t)}),S=function(e,t,n){var i=Object.assign({},e,{timestamp:firebase.firestore.FieldValue.serverTimestamp()});if(n){var o=window.NS.singletons.refs.getNodeRef(t);return o?o.update(i):(console.log("didnt find ref on update"),Promise.reject(new Error("didnt find ref on update")))}return window.NS.singletons.StatusWindow.addEvent({id:t,saveData:i}),new Promise(function(e){e()})},x=function(e,t,n){var i=Object.assign({},e,{timestamp:firebase.firestore.FieldValue.serverTimestamp()});if(n){var o=window.NS.singletons.refs.getGroupRef(t);return o?o.update(i):(console.log("didnt find ref on update"),Promise.reject(new Error("didnt find ref on update")))}return window.NS.singletons.StatusWindow.addEvent({id:t,saveData:i}),new Promise(function(e){e()})},N=function(e){var t={drawing:null,nodes:{},groups:{}},n=function(e){var n=[];return e.nodes.forEach(function(e){var i,o,r;n.push((i=e.id,o=e.data,r=Object.assign({},o,{timestamp:firebase.firestore.FieldValue.serverTimestamp()}),t.drawing.collection("Nodes").doc(i).set(r)))}),Promise.all(n)},i=function(e){var n=[];return e.groups.forEach(function(e){var i,o,r;n.push((i=e.id,o=e.data,r=Object.assign({},o,{timestamp:firebase.firestore.FieldValue.serverTimestamp()}),t.drawing.collection("Groups").doc(i).set(r)))}),Promise.all(n)};return new Promise(function(o,r){E(e.drawing.doc).then(function(i){return console.log("drawing created"),t.drawing=i,n(e)}).then(function(){return i(e)}).then(function(){o(t.drawing)}).catch(function(e){console.log("err: ",e),r(e)})})};function M(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var P=firebase.firestore(),D=function(e){return window.NS.singletons.refs.getDrawingRef().collection("Nodes").doc(e)},O=function(e){return window.NS.singletons.refs.getDrawingRef().collection("Groups").doc(e)},T=function(e){return window.NS.singletons.refs.getUserRef().collection("Drawings").doc(e)},I=function(e,t){var n={nodes:[],groups:[],drawings:e};return new Promise(function(i,o){R(e,t).then(function(i){return n.nodes=i,A(e,t)}).then(function(e){n.groups=e,i(n)}).catch(function(e){o(e)})})},R=function(e,t){var n=[];return Object.keys(e).forEach(function(e){n.push(L(e,t))}),Promise.all(n)},L=function(e,t){return new Promise(function(n,i){window.NS.singletons.refs.getUserRef();t.doc(e).collection("Nodes").get().then(function(t){var i={};i[e]=[],t.forEach(function(t){i[e].push({id:t.id,data:t.data()})}),n(i)}).catch(function(e){i(e)})})},A=function(e,t){var n=[];return Object.keys(e).forEach(function(e){n.push(j(e,t))}),Promise.all(n)},j=function(e,t){return new Promise(function(n,i){window.NS.singletons.refs.getUserRef();t.doc(e).collection("Groups").get().then(function(t){var i={};i[e]=[],t.forEach(function(t){i[e].push({id:t.id,data:t.data()})}),n(i)}).catch(function(e){i(e)})})},_=function(e){return new Promise(function(t,n){var i=window.NS.singletons.refs.hasUserRef(),o=i?window.NS.singletons.refs.getUserRef():P.collection("Users").doc(e);i||(console.log("set user ref",o),window.NS.singletons.refs.setUserRef(o)),o.get().then(function(n){n.exists?(console.log("Document data:",n,"  ",n.data()),t(!0)):(console.log("No such document!"),o.set({username:e}),t(!1))}).catch(function(e){console.log("Error getting document:",e),n()})})};function V(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var B=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hasOutput=!0,this.isGraphicsNode=!1,this.isLightNode=!1,this.hasGraphicsInput=!1,this.needsUpdate=!1,this.hasMultipleOutputs=!1,this.returnsSingleNumber=!1,this.isShapeNode=!1,this._nodeIndex=-1,this._nodeSortIndex=0,this.title="Enter node title",this.onConnectionAddBound=this.onConnectionAdd.bind(this),this.onConnectionRemoveBound=this.onConnectionRemove.bind(this),document.documentElement.addEventListener("param-connections-add",this.onConnectionAddBound),document.documentElement.addEventListener("param-connections-remove",this.onConnectionRemoveBound)}var t,n,i;return t=e,(n=[{key:"init",value:function(e,t,n,i,o,r,a,s,l,c,u,d){var h,p,f=this;if(this.initNodeConfig=!!r,this.ID=this.initNodeConfig?r.id:"temp__"+Math.random().toString(36).substr(2,9),this.onDisconnectCallback=n,this.onInputConnectionCallback=i,this.hasActiveInput=!1,this.type=o,this.onNodeRemove=a,this.isModifier=s,this.onNodeDragStart=l,this.onNodeDragMove=c,this.onNodeDragRelease=u,this.addCallback=d,this.groupState={isInGroup:!1,isShowing:!1},this.parentEl=t,this.connectedNodes=[],this.visualSettings=null,this.innerContainer=document.createElement("div"),this.innerContainer.className="node-inner",this.el.appendChild(this.innerContainer),this.groupHideLayer=document.createElement("div"),this.groupHideLayer.classList.add("group-hide-layer"),this.el.appendChild(this.groupHideLayer),this.isModifier||(this.upperContainer=document.createElement("div"),this.upperContainer.className="node-upper",this.el.appendChild(this.upperContainer)),this.lastDelta={x:0,y:0},this.localDelta={x:0,y:0},this.parentEl.appendChild(this.el),this.onRemoveClickBound=this.onRemoveClick.bind(this),this.isCanvasNode||(this.isModifier?this.el.classList.add("modifier-node"):(this.initNodeConfig&&(this.title=r.data.title),this.nodeTitle=new k(this.upperContainer,this)),this.nodeType=this.isModifier?new w(this.el,this.innerContainer,this.params,this):new y(this.innerContainer,this.params,this,r)),this.moveCoords={start:{x:0,y:0},offset:{x:e.x,y:e.y}},this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0)"),this.initNodeConfig){var g=D(this.ID);window.NS.singletons.refs.addNodeRef(g),window.NS.singletons.ConnectionsManager.addNode(this),this.nodeCreated(r)}else{var v={type:o,title:this.title,pos:e};v=this.isModifier?Object.assign({},v,{paramConnections:[]}):Object.assign({},v),(h=v,p=Object.assign({},h,{timestamp:firebase.firestore.FieldValue.serverTimestamp()}),window.NS.singletons.refs.getDrawingRef().collection("Nodes").add(p)).then(function(e){if(f.ID=e.id,window.NS.singletons.ConnectionsManager.addNode(f),e)window.NS.singletons.refs.addNodeRef(e);else{var t=D(f.ID);window.NS.singletons.refs.addNodeRef(t)}f.nodeCreated()}).catch(function(){console.log("err creating node in db")})}this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.activateDrag()}},{key:"onNodeDisconnectFromNonagonDelete",value:function(){this.nodeType.deactivateAsChild({x:0,y:0},!0),this.nodeType.setAngle(0)}},{key:"nodeCreated",value:function(e){if(!this.isCanvasNode){var t=this.type,n=this.isModifier?"".concat(t,"-modifier"):"".concat(t,"-node"),i="".concat(n.replace(" ","-").toLowerCase(),"-icon"),o=document.createElement("img");o.src="./assets/icons/".concat(i,".svg"),this.innerContainer.appendChild(o)}if(this.nodeType.paramContainers.length>0&&!this.initNodeConfig){for(var r=[],a=0;a<this.nodeType.paramContainers.length;a++){var s={},l=this.nodeType.paramContainers[a],c=Object.keys(l.inputParams);s.inputParams=[];for(var u=0;u<c.length;u++){var d=l.inputParams[c[u]];s.inputParams.push(d.ID)}s.paramContainerID=l.ID,r.push(s)}S({paramContainers:r},this.ID,!0).then(function(){console.log("paramcontainers updated")}).catch(function(){console.log("error updating node")})}this.addCallback(this)}},{key:"setTitle",value:function(e){this.title=e,window.NS.singletons.NodeGroupManager.updateGroupNodeTabTitle(this.ID,e),S({title:this.title},this.ID).then(function(){console.log("updated node")}).catch(function(){console.log("error updating node")})}},{key:"onConnectionAdd",value:function(e){console.log("node on param connection add: ",e.detail,e.type,this.ID)}},{key:"onConnectionRemove",value:function(e){console.log("node on param connection remove: ",e.detail,e.type,this.ID)}},{key:"onModifierDisconnect",value:function(){}},{key:"syncVisualSettings",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.visualSettings=Object.assign({},this.visualSettings,e),S({visualSettings:e},this.ID,t).then(function(){}).catch(function(){})}},{key:"addToGroup",value:function(e){e.appendChild(this.el),this.el.style[window.NS.transform]="translate(-50%, -50%)",this.el.classList.add("center-group"),this.groupState.isInGroup=!0,this.nodeType.setActive&&this.nodeType.setActive()}},{key:"removeFromGroup",value:function(e,t){this.parentEl.appendChild(this.el),this.el.classList.remove("center-group"),this.groupState.isInGroup=!1;this.moveCoords.start.x=e.x-(t.moveCoords.offset.x+100),this.moveCoords.start.y=e.y-(t.moveCoords.offset.y+100)}},{key:"setAsChildToParamContainer",value:function(e,t,n){e.el.appendChild(this.el),this.el.style[window.NS.transform]="initial",this.onInputConnectionCallback(this,e,n),t&&S({connectionData:{paramContainer:e.ID,node:e.node.ID}},this.ID,!0).then(function(){}).catch(function(){})}},{key:"setAsNotChildToParamContainer",value:function(e,t,n){this.onDisconnectCallback(this,e);var i=e.getCleanPos();this.parentEl.appendChild(this.el);var o=e.node,r=function(){return o.groupState.isInGroup?window.NS.singletons.NodeGroupManager.getGroupFromNonagon(o).el.getBoundingClientRect():e.node.el.getBoundingClientRect()},a=function(){return o.groupState.isInGroup?window.NS.singletons.NodeGroupManager.getGroupFromNonagon(o).moveCoords.offset.x:o.moveCoords.offset.x},s=function(){return o.groupState.isInGroup?window.NS.singletons.NodeGroupManager.getGroupFromNonagon(o).moveCoords.offset.y:o.moveCoords.offset.y};if(n){var l=r(),c=i.x-l.x,u=i.y-l.y;this.moveCoords.start.x=a()+c,this.moveCoords.start.y=s()+u,this.moveCoords.offset.x=a(),this.moveCoords.offset.y=s();var d=this.moveCoords.start,h=d.x,p=d.y;this.el.style[window.NS.transform]="translate3d(".concat(h,"px, ").concat(p,"px, 0)")}else{var f=r(),g=i.x-f.x,v=i.y-f.y;this.moveCoords.start.x=t.x-(a()+g),this.moveCoords.start.y=t.y-(s()+v)}S({connectionData:firebase.firestore.FieldValue.delete()},this.ID,!0).then(function(){}).catch(function(){})}},{key:"getParamContainers",value:function(){return this.nodeType.paramContainers}},{key:"enableOutput",value:function(e,t){this.currentOutConnections.push(t),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e){var t=this.currentOutConnections.map(function(e){return e}),n=t.filter(function(e){return e.paramID}),i=t.filter(function(e){return!e.paramID});e?n=n.filter(function(t){return t.paramID&&t.paramID!==e}):i=i.filter(function(e){return e.in.ID!==nodeIn.ID});var o=n.concat(i);this.currentOutConnections=o,this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"onRemoveClick",value:function(){this.onNodeRemove(this)}},{key:"activateDrag",value:function(){this.innerContainer.addEventListener("mousedown",this.onMouseDownBound)}},{key:"getConnectNode",value:function(){return this}},{key:"setNotSelected",value:function(){this.el.classList.remove("selected"),this.nodeTitle&&this.nodeTitle.blurInput(),this.nodeType.setInactive&&!this.groupState.isInGroup&&this.nodeType.setInactive(),window.NS.singletons.CanvasNode.foregroundRender.hideActive(this.ID),this.onDeselected&&this.onDeselected()}},{key:"setSelected",value:function(){this.el.classList.add("selected"),this.isRendered&&window.NS.singletons.CanvasNode.foregroundRender.showActive(this.ID),this.nodeType.setActive&&!this.groupState.isInGroup&&this.nodeType.setActive(),this.onSelected&&this.onSelected()}},{key:"getPos",value:function(){var e=new THREE.Vector2,t=this.innerContainer.getBoundingClientRect();return e.set(t.x+t.width/2,t.y+t.height/2),e}},{key:"removeFromDom",value:function(){this.innerContainer.removeEventListener("mousedown",this.onMouseDownBound),this.isModifier&&this.nodeType.isConnected?this.nodeType.removeNodeFromDom():this.parentEl.removeChild(this.el)}},{key:"groupShow",value:function(){this.el.style.zIndex="1",this.groupHideLayer.classList.remove("visible"),this.groupState.isShowing=!0}},{key:"groupHide",value:function(){this.el.style.zIndex="0",this.groupHideLayer.classList.add("visible"),this.groupState.isShowing=!1}},{key:"onMouseDown",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("INPUT"!==e.target.nodeName&&!e.target.classList.contains("prevent-drag")){this.nodeTitle&&this.nodeTitle.blurInput(),e.stopPropagation(),e.preventDefault();var n=new CustomEvent("node-selected",{detail:this});document.documentElement.dispatchEvent(n),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,this.lastDelta.x=0,this.lastDelta.y=0,this.localDelta.x=e.x,this.localDelta.y=e.y,this.isModifier?this.onNodeDragStart(this,e):window.NS.singletons.NodeGroupManager.onNodeDragStart(this),window.NS.singletons.DeleteView.onNodeMoveStart(),t&&(window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound))}}},{key:"onMouseMove",value:function(e){var t={x:e.x-this.localDelta.x,y:e.y-this.localDelta.y};this.isModifier?this.onNodeDragMove(e,t):window.NS.singletons.NodeGroupManager.onNodeDragMove(e,this,t);var n=e.x-this.moveCoords.start.x,i=e.y-this.moveCoords.start.y;if(this.moveCoords.offset.x=n,this.moveCoords.offset.y=i,this.lastDelta.x=n,this.lastDelta.y=i,!this.isModifier||!this.nodeType.isConnected){this.el.style[window.NS.transform]="translate3d(".concat(n,"px, ").concat(i,"px, 0)");var o=this.getPos();window.NS.singletons.DeleteView.onNodeMove(o.x,o.y)}}},{key:"onMouseUp",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(window.NS.singletons.DeleteView.deleteOnNodeRelease())return this.isModifier&&this.onNodeDragRelease(),window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound),void this.onRemoveClick();this.isModifier?this.onNodeDragRelease():window.NS.singletons.NodeGroupManager.onNodeDragEnd(this),t&&(window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)),0===this.lastDelta.x&&0===this.lastDelta.y||S({pos:this.lastDelta},this.ID,!0).then(function(){console.log("updated node")}).catch(function(){console.log("error updating node")})}},{key:"nodeIndex",set:function(e){this._nodeIndex=e},get:function(){return this._nodeIndex}},{key:"nodeSortIndex",set:function(e){this._nodeSortIndex=e},get:function(){return this._nodeSortIndex}}])&&V(t.prototype,n),i&&V(t,i),e}(),H="\n    float box(in vec2 _st, in vec2 _size){\n        _size = vec2(0.5) - _size*0.5;\n        vec2 uv = smoothstep(_size,\n                            _size+vec2(0.0001),\n                            _st);\n        uv *= smoothstep(_size,\n                        _size+vec2(0.0001),\n                        vec2(1.0)-_st);\n        return uv.x*uv.y;\n    }\n\n    float cross(in vec2 _st, float _size){\n        return  box(_st, vec2(_size,_size/4.)) +\n                box(_st, vec2(_size/4.,_size));\n    }\n\n    float line(in vec2 _st, float _size){\n        return  box(_st, vec2(_size,_size/4.));\n    }\n\n    float circle(in vec2 _st, in float _radius){\n        vec2 dist = _st-vec2(0.5);\n        return 1.-smoothstep(_radius-(_radius*0.01),\n                            _radius+(_radius*0.01),\n                            dot(dist,dist)*4.0);\n    }\n\n    float blurredCircle(in vec2 _st, in float _radius){\n        vec2 dist = _st-vec2(0.5);\n        return 1.-smoothstep(_radius-(_radius*0.3),\n                            _radius+(_radius*0.3),\n                            dot(dist,dist)*4.0);\n    }\n",F='\n    precision highp float;\n    varying vec2 vPos;\n    varying vec2 vUv;\n    varying vec3 vecPos;\n    varying vec3 vecNormal;\n    \n    uniform float lightIntensity;\n    \n    struct PointLight {\n        vec3 color;\n        vec3 position; // light position, in camera coordinates\n        float distance; // used for attenuation purposes. Since\n                        // we\'re writing our own shader, it can\n                        // really be anything we want (as long as\n                        // we assign it to our light in its\n                        // "distance" field\n    };\n    \n    uniform PointLight pointLights[NUM_POINT_LIGHTS];\n',z="\n    // Pretty basic lambertian lighting...\n    vec4 addedLights = vec4(0.0,\n                            0.0,\n                            0.0,\n                            1.0);\n    for(int l = 0; l < NUM_POINT_LIGHTS; l++) {\n        vec3 lightDirection = normalize(vecPos\n                                - pointLights[l].position);\n        addedLights.rgb += clamp(dot(-lightDirection,\n                                vecNormal), 0.0, 1.0)\n                            * pointLights[l].color\n                            * lightIntensity;\n    }\n",U=("\n    varying vec3 vUv;\n    ".concat(H,"\n\n    void main() {\n        float x = (vUv.x + 2.0 - 1.0) / 2.0;\n        float y = (vUv.y + 2.0 - 1.0) / 2.0;\n        vec2 st = vec2(x, y);\n        vec3 color = vec3(blurredCircle(st, 27.2));\n        gl_FragColor = vec4(color, 1.0);\n    }\n"),"\n    ".concat(F,"\n    ").concat(H,"\n\n    void main() {\n        float x = (vPos.x + 2.0 - 1.0) / 2.0;\n        float y = (vPos.y + 2.0 - 1.0) / 2.0;\n        vec2 st = vec2(x, y);\n        vec3 color = vec3(circle(st, 0.1));\n        ").concat(z,"\n        \n        gl_FragColor = vec4(color, 1.0) * addedLights;\n    }\n"),"\n    ".concat(F,"\n    ").concat(H,"\n\n    void main() {\n        vec3 color = vec3(1.0);\n        float x = (vPos.x + 2.0 - 1.0) / 2.0;\n        float y = (vPos.y + 2.0 - 1.0) / 2.0;\n        vec2 st = vec2(x, y);\n        color -= vec3(cross(st, 0.3));\n        ").concat(z,"\n        \n        gl_FragColor = vec4(color, 1.0) * addedLights;\n    }\n"),"\n    ".concat(F,"\n    ").concat(H,"\n\n    void main() {\n        vec3 color = vec3(1.0);\n        float x = (vPos.x + 2.0 - 1.0) / 2.0;\n        float y = (vPos.y + 2.0 - 1.0) / 2.0;\n        vec2 st = vec2(x, y);\n        color -= vec3(line(st, 0.3));\n        ").concat(z,"\n        gl_FragColor = vec4(color, 1.0) * addedLights;\n    }\n"),"\n    attribute float size;\n    varying vec3 vColor;\n    void main() {\n        vColor = color;\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        // gl_PointSize = size * ( 3.0 / -mvPosition.z );\n        gl_PointSize = size;\n        gl_Position = projectionMatrix * mvPosition;\n    }\n"),G='\n    // uniform sampler2D texture;\n    varying vec3 vColor;\n    // struct PointLight {\n    //     vec3 color;\n    //     vec3 position; // light position, in camera coordinates\n    //     float distance; // used for attenuation purposes. Since\n    //                     // we\'re writing our own shader, it can\n    //                     // really be anything we want (as long\n    //                     // as we assign it to our light in its\n    //                     // "distance" field\n    // };\n    \n    // uniform PointLight pointLights[NUM_POINT_LIGHTS];\n    void main() {\n        gl_FragColor = vec4( vColor, 1.0 );\n        // gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );\n    }\n',Y="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\tuniform float time;\n\tuniform vec2 resolution;\n\tvoid main()\t{\n\t\tgl_Position = vec4( position, 1.0 );\n\t}\n",K="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\tuniform float time;\n\tuniform vec2 resolution;\n\tuniform sampler2D u_texture0;\n    uniform sampler2D u_texture1;\n\tuniform vec2 u_res;\n\tuniform float u_connection0;\n    uniform float u_connection1;\n    uniform float u_finalConnection;\n    uniform float u_multiConnection;\n\tvoid main()\t{\n\t\tvec2 st = gl_FragCoord.xy/u_res.xy;\n\t\tvec4 bgColor = texture2D(u_texture0, st);\n        vec4 fgColor = texture2D(u_texture1, st);\n\t\tvec4 whiteColor = vec4(1., 1., 1., 1.);\n        vec4 transparentColor = vec4(1.0, 1.0, 1.0, 0.0);\n\n        // bgColor = vec4(1.0, 0.1, 0.1, 1.0);\n        vec4 finalFgColor = mix(transparentColor, fgColor, u_connection1);\n        vec4 finalBgColor = mix(transparentColor, bgColor, u_connection0);\n        \n        float ra = (finalFgColor.a) * finalFgColor.r + (1.0 - finalFgColor.a) * finalBgColor.r;\n        float ga = (finalFgColor.a) * finalFgColor.g + (1.0 - finalFgColor.a) * finalBgColor.g;\n        float ba = (finalFgColor.a) * finalFgColor.b + (1.0 - finalFgColor.a) * finalBgColor.b;\n\n        vec4 overlayColor = vec4(ra, ga, ba, 1.0);\n\n        \n\n        vec4 finalColor = mix(fgColor + bgColor, overlayColor, u_multiConnection);\n\n        // gl_FragColor = mix(whiteColor, finalColor, u_finalConnection);\n        gl_FragColor = vec4(finalColor);\n\t} \n\n";var X=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=new THREE.WebGLRenderer({alpha:!0}),this.renderer.shadowMap.enabled=!0,window.NS.singletons.PROJECT_TYPE===window.NS.singletons.TYPES.chemistry.id&&this.renderer.setClearColor(0,1)},W={general:{isValid:function(e){return!0}},needsFramebuffer:{isValid:function(e){return e.framebuffer||e.isForegroundNode}},sceneNode:{isValid:function(e,t,n,i){return!(t.enabledInputs.some(function(t){return t.out.ID===e.ID})||!n)&&{background:function(){return e.isBackgroundNode},foreground:function(){return i&&e.outputs[i]?e.isForegroundNode&&!e.outputs[i].isParamOutput:e.isForegroundNode},light:function(){return e.isLightNode&&!t.foregroundRender.hasConnectedLight}}[n]()}}};var q=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);for(var n=(new THREE.TextureLoader).load("./assets/textures/space/star4.jpg"),i=[],o=function(e){return e*(.5-Math.random())},r=0;r<1e3;r++){var a=o(12e3),s=o(12e3),l=o(12e3);i.push(a,s,l)}var c=new THREE.BufferGeometry;c.addAttribute("position",new THREE.Float32BufferAttribute(i,3));var u=new THREE.PointsMaterial({alphaMap:n}),d=new THREE.Points(c,u);t.add(d)};n(15);function J(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Z=Object.freeze({1:"H",2:"He",3:"Li",4:"Be",5:"B",6:"C",7:"N",8:"O",9:"F",10:"Ne",11:"Na",12:"Mg",13:"Al",14:"Si",15:"P",16:"S",17:"Cl",18:"Ar",19:"K",20:"Ca",21:"Sc"}),Q=function(e){return"electron"===e.name},$=function(e){return"mainAtomGroup"===e.name},ee=function(e,t){var n=window.NS.singletons.ConnectionsManager.getConnectedNodeWithType(e,"electrons"),i=window.NS.singletons.ConnectionsManager.getNode(e);i.outerRing.getOrbitalFromPositionKey(t).positions.forEach(function(e){var t=n.getElectronByPositionKeyAndRingIndex(parseInt(e),i.outerRing.index);if(t){t.overrideConnectionAngle=void 0,t.orbitalConnected=!1;var o=i.rings[t.getRingIndex()].getConnectedElectronPosition(i.position,t.ringPositionKey,t.overrideConnectionAngle);t.mesh.position.set(o.x,o.y,0)}}),i.outerRing.markPositionAsAvailable(t)},te=function(e){if(e.length>0)return function e(t,n){return t.parent&&!n?$(t.parent)?e(t,t.parent):Q(t)?e(t,t):e(t.parent,null):n}(e[0].object,null)},ne=function(){for(var e={},t=0,n=[4,10,16,24],i=0;i<n.length;i++)for(var o=.8+1.1*i,r=360/n[i],a=0;a<n[i];a++){var s=r*a,l=o*Math.cos(s*Math.PI/180),c=o*Math.sin(s*Math.PI/180),u={pos:new THREE.Vector2(l,c),type:t%2==0?"protons":"neutrons"};e["".concat(i,"-").concat(a)]=u,t++}return e},ie=function(e,t,n){var i=new THREE.SphereGeometry(.5,10,10),o=new THREE.Mesh(i,t);o.position.set(n.x,n.y,0),e.add(o)},oe=function(e,t,n){var i=e.getObjectByName(t);i&&e.remove(i),e.add(n)},re={electrons:function(e,t,n,i,o,r,a){if(!e.getObjectByName(t)){e.add(n);var s=Object.keys(i),l=0;s.forEach(function(e,t){for(var s=i[e],c=0;c<s;c++){var u=n.children[c+l];if(u){var d=o[u.userData.ID],h=r[e],p=h.getAvailableElectronPosition(a),f=p.key,g=p.pos,v=p.orbitalAngle;d.ringPositionKey=f,d.orbitalAngle=v,h.markPositionAsTaken(f),u.position.x=g.x,u.position.y=g.y,d.setConnectionStatus(e)}}l+=s})}},protons:oe,neutrons:oe},ae=function(e,t){var n=function(e){return e.reduce(function(e,t){var n=t.getRingIndex();return e[n]?e[n]++:e[n]=1,e},{})}(t);S({ringConnections:n},e,!0).then(function(){console.log("circle connections updated")}).catch(function(){console.log("error updating node")})},se=function(e,t){S({visualPos:t},e,!0).then(function(){}).catch(function(){console.log("error updating node")})},le=function(e,t){var n=e.x-t.x,i=e.y-t.y;return Math.atan2(i,n)},ce=function(e){return(e+Math.PI)%(2*Math.PI)},ue=function(e,t,n){var i=e.x+n*Math.cos(t),o=e.y+n*Math.sin(t);return new THREE.Vector2(i,o)},de=function(e,t,n){var i=e.x+t.mesh.position.x+t.radius*Math.cos(n),o=e.y+t.mesh.position.y+t.radius*Math.sin(n);return new THREE.Vector2(i,o)},he=function(e,t,n,i,o){return{x:Math.pow(1-o,3)*e.x+3*Math.pow(1-o,2)*o*t.x+3*(1-o)*Math.pow(o,2)*n.x+Math.pow(o,3)*i.x,y:Math.pow(1-o,3)*e.y+3*Math.pow(1-o,2)*o*t.y+3*(1-o)*Math.pow(o,2)*n.y+Math.pow(o,3)*i.y}},pe=function(e,t,n,i,o,r){var a=[],s={x:t-i,y:n-0},l={x:t-i,y:n-.552*o},c={x:t-.552*i,y:n-o},u={x:t-0,y:n-o};if(r)for(var d=e;d>=0;d--){var h=he(s,l,c,u,d/e);a.push(h)}else for(var p=0;p<=e;p++){var f=he(s,l,c,u,p/e);a.push(f)}return a};function fe(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var ge=THREE,ve=ge.Plane,me=ge.EventDispatcher,ye=ge.Matrix4,be=ge.Raycaster,we=ge.Vector2,Ce=ge.Vector3,ke=function(e,t,n){var i=new ve,o=new be,r=new we,a=new Ce,s=new Ce,l=new Ce,c=new ye,u=[],d=null,h=null,p=this;function f(){t.addEventListener("mousemove",v,!1),t.addEventListener("mousedown",m,!1),t.addEventListener("mouseup",y,!1),t.addEventListener("mouseleave",y,!1),t.addEventListener("touchmove",b,!1),t.addEventListener("touchstart",w,!1),t.addEventListener("touchend",C,!1)}function g(){t.removeEventListener("mousemove",v,!1),t.removeEventListener("mousedown",m,!1),t.removeEventListener("mouseup",y,!1),t.removeEventListener("mouseleave",y,!1),t.removeEventListener("touchmove",b,!1),t.removeEventListener("touchstart",w,!1),t.removeEventListener("touchend",C,!1)}function v(n){n.preventDefault();var f=t.getBoundingClientRect();if(r.x=(n.clientX-f.left)/f.width*2-1,r.y=-(n.clientY-f.top)/f.height*2+1,o.setFromCamera(r,e),d&&p.enabled)return o.ray.intersectPlane(i,s)&&d.position.copy(s.sub(a).applyMatrix4(c)),void p.dispatchEvent({type:"drag",object:d});if(u.length=0,o.setFromCamera(r,e),o.intersectObjects(p._objects,!0,u),u.length>0){var g=u[0].object;i.setFromNormalAndCoplanarPoint(e.getWorldDirection(i.normal),l.setFromMatrixPosition(g.matrixWorld)),h!==g&&(p.dispatchEvent({type:"hoveron",object:g}),t.style.cursor="pointer",h=g)}else null!==h&&(p.dispatchEvent({type:"hoveroff",object:h}),t.style.cursor="auto",h=null)}function m(h){if(h.preventDefault(),u.length=0,o.setFromCamera(r,e),o.intersectObjects(p._objects,!0,u),u.length>0){var f=u.map(function(e){return Object.assign({},e)}),g=n(f);if(!g)return;d=g,o.ray.intersectPlane(i,s)&&(c.getInverse(d.parent.matrixWorld),a.copy(s).sub(l.setFromMatrixPosition(d.matrixWorld))),t.style.cursor="move",p.dispatchEvent({type:"dragstart",object:d})}}function y(e){e.preventDefault(),d&&(p.dispatchEvent({type:"dragend",object:d}),d=null),t.style.cursor=h?"pointer":"auto"}function b(n){n.preventDefault(),n=n.changedTouches[0];var l=t.getBoundingClientRect();if(r.x=(n.clientX-l.left)/l.width*2-1,r.y=-(n.clientY-l.top)/l.height*2+1,o.setFromCamera(r,e),d&&p.enabled)return o.ray.intersectPlane(i,s)&&d.position.copy(s.sub(a).applyMatrix4(c)),void p.dispatchEvent({type:"drag",object:d})}function w(n){n.preventDefault(),n=n.changedTouches[0];var h=t.getBoundingClientRect();r.x=(n.clientX-h.left)/h.width*2-1,r.y=-(n.clientY-h.top)/h.height*2+1,u.length=0,o.setFromCamera(r,e),o.intersectObjects(p._objects,!0,u),u.length>0&&(d=!0===p.transformGroup?p._objects[0]:u[0].object,i.setFromNormalAndCoplanarPoint(e.getWorldDirection(i.normal),l.setFromMatrixPosition(d.matrixWorld)),o.ray.intersectPlane(i,s)&&(c.getInverse(d.parent.matrixWorld),a.copy(s).sub(l.setFromMatrixPosition(d.matrixWorld))),t.style.cursor="move",p.dispatchEvent({type:"dragstart",object:d}))}function C(e){e.preventDefault(),d&&(p.dispatchEvent({type:"dragend",object:d}),d=null),t.style.cursor="auto"}f(),this.enabled=!0,this.transformGroup=!1,this.activate=f,this.deactivate=g,this.dispose=function(){g()},this.getObjects=function(){return p._objects},this.setObjects=function(e,t){var n=p._objects.filter(function(e){return e.userData.parentID&&e.userData.parentID!==t});e.forEach(function(e){return e.userData.parentID=t}),p._objects=[].concat(fe(n),fe(e))},this._objects=[]};ke.prototype=Object.create(me.prototype),ke.prototype.constructor=ke;n(16);function Ee(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Se=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.activeCamera=null;var i=window.innerWidth,o=window.innerHeight;if(this.clock=new THREE.Clock,this.camera=new THREE.PerspectiveCamera(60,i/o,.01,1e4),this.camera.position.z=10,this.activeCamera=this.camera,this.cameraControls=new THREE.OrbitControls(this.camera,n),this.cameraControls.enabled=!0,this.cameraControlsChangedBound=this.cameraControlsChanged.bind(this),this.cameraControls.addEventListener("change",this.cameraControlsChangedBound),this.currentActiveKey,this.activeHelperMeshes={},this.scene=new THREE.Scene,this.renderer=t.renderer,this.axesHelper=new THREE.AxesHelper(5),this.axesHelper.name="AxesHelper",this.ambientLight=new THREE.AmbientLight,this.scene.add(this.ambientLight),window.NS.singletons.PROJECT_TYPE===window.NS.singletons.TYPES.space.id&&(this.stars=new q(this.scene),this.ambientLight.intensity=.5),this.showActiveHelperMeshes=!0,window.NS.singletons.PROJECT_TYPE===window.NS.singletons.TYPES.chemistry.id){this.showActiveHelperMeshes=!1,this.camera.position.z=50,this.cameraControls.screenSpacePanning=!0,this.cameraControls.enableRotate=!1;var r=new THREE.PointLight(16777215,1,100);r.position.set(-10,10,50),this.scene.add(r);var a=this.getCamera(),s=this.getDomNode();this.dragControls=new ke(a,s,te)}this.connectedNodes=[],this.hasConnectedLight=!1,this.meshToFollow=null,this.framebuffer=new THREE.WebGLRenderTarget(640,600,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter})}var t,n,i;return t=e,(n=[{key:"fitCameraToObjects",value:function(){var e=new THREE.Box3;this.connectedNodes.forEach(function(t){e.expandByObject(t.mesh)});var t=e.getCenter(),n=e.getSize(),i=Math.max(n.x,n.y,n.z),o=this.camera.fov*(Math.PI/180),r=Math.abs(i/4*Math.tan(2*o));r*=6,this.camera.position.z=r,this.camera.updateProjectionMatrix(),this.cameraControls.target=t,this.cameraControls.saveState()}},{key:"setMeshToFollow",value:function(e){this.meshToFollow=e}},{key:"resetMeshToFollow",value:function(){this.meshToFollow=null,this.cameraControls.target=new THREE.Vector3}},{key:"setActiveCamera",value:function(e){this.activeCamera=e}},{key:"resetActiveCamera",value:function(){this.activeCamera=this.camera}},{key:"cameraControlsChanged",value:function(e){var t=new CustomEvent("camera-pos-changed",{detail:e.target.object.position});document.documentElement.dispatchEvent(t)}},{key:"toggleAxesHelper",value:function(e){if(e)this.scene.add(this.axesHelper);else{this.scene.getObjectByName(this.axesHelper.name);this.scene.remove(this.axesHelper)}}},{key:"toggleCameraControl",value:function(e){e?(this.cameraControls.enabled=!0,this.renderer.domElement.classList.add("prevent-drag")):(this.cameraControls.enabled=!1,this.renderer.domElement.classList.remove("prevent-drag"))}},{key:"addLight",value:function(e){var t="".concat(e.ID,"-light");e.light.name=t;var n="".concat(e.ID,"-mesh");e.mesh.name=n,this.scene.add(e.light),this.scene.add(e.mesh),this.hasConnectedLight=!0,this.createPlaneMesh(e,n)}},{key:"removeLight",value:function(e){var t="".concat(e.ID,"-light"),n=this.scene.getObjectByName(t);this.scene.remove(n);var i="".concat(e.ID,"-mesh"),o=this.scene.getObjectByName(i);if(this.scene.remove(o),this.hasConnectedLight=!1,this.showActiveHelperMeshes){var r="".concat(i,"-active");this.activeHelperMeshes[r]&&delete this.activeHelperMeshes[r]}}},{key:"addNode",value:function(e){this.connectedNodes.push(e);var t="".concat(e.ID,"-mesh");e.mesh.name=t,this.scene.add(e.mesh),e.mesh.userData&&e.mesh.userData.getForegroundRender&&e.setForegroundRender(this),e.camera&&e.camera.lookAt(this.scene.position),e.isRendered&&this.createPlaneMesh(e,t)}},{key:"removeNode",value:function(e){this.connectedNodes=this.connectedNodes.filter(function(t){return t.ID!==e.ID});var t="".concat(e.ID,"-mesh"),n=this.scene.getObjectByName(t);if(this.scene.remove(n),this.showActiveHelperMeshes){var i="".concat(t,"-active");this.activeHelperMeshes[i]&&delete this.activeHelperMeshes[i]}}},{key:"getCamera",value:function(){return this.camera}},{key:"getDomNode",value:function(){return this.renderer.domElement}},{key:"disableCameraControls",value:function(){this.cameraControls.enabled=!1}},{key:"enableCameraControls",value:function(){this.cameraControls.enabled=!0}},{key:"createPlaneMesh",value:function(e,t){if(this.showActiveHelperMeshes){var n=e.getActiveHelperMesh();n&&(e.mesh.add(n),this.activeHelperMeshes["".concat(t,"-active")]=n)}}},{key:"showActive",value:function(e){var t=this;if(this.showActiveHelperMeshes){Object.keys(window.NS.singletons.ConnectionsManager.nodes).filter(function(e){return window.NS.singletons.ConnectionsManager.nodes[e].isRendered}).forEach(function(e){var n="".concat(e,"-mesh-active");t.activeHelperMeshes[n]&&(t.activeHelperMeshes[n].visible=!1)});var n="".concat(e,"-mesh-active");this.activeHelperMeshes[n]&&(this.currentActiveKey=n,this.activeHelperMeshes[n]&&(this.activeHelperMeshes[n].visible=!0))}}},{key:"hideActive",value:function(e){if(this.showActiveHelperMeshes){var t="".concat(e,"-mesh-active");this.activeHelperMeshes[this.currentActiveKey]&&this.currentActiveKey===t&&(this.activeHelperMeshes[this.currentActiveKey].visible=!1,this.currentActiveKey=null)}}},{key:"update",value:function(){if(this.showActiveHelperMeshes&&this.currentActiveKey&&this.activeHelperMeshes[this.currentActiveKey]&&this.activeHelperMeshes[this.currentActiveKey].lookAt(this.activeCamera.position),this.meshToFollow){var e=this.meshToFollow,t=e.mesh.position,n=(e.distance,new THREE.Vector3(t.x,t.y,t.z));this.cameraControls.target=n}var i=this.clock.getDelta();this.cameraControls.update(i)}},{key:"render",value:function(){this.renderer.setRenderTarget(this.framebuffer),this.renderer.render(this.scene,this.activeCamera)}},{key:"onResize",value:function(e){var t=e.w,n=e.h;this.framebuffer.setSize(t,n),this.camera.aspect?this.camera.aspect=t/n:(this.camera.left=t/-2,this.camera.right=t/2,this.camera.top=n/-2,this.camera.bottom=n/2),this.camera.updateProjectionMatrix()}}])&&Ee(t.prototype,n),i&&Ee(t,i),e}();n(17);function xe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ne=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="axes-helper-setting settings-item",this.foregroundController=n,this.label=document.createElement("h4"),this.label.innerHTML="Visa x y z axlar (inaktiv)",this.el.appendChild(this.label),this.toggleEl=document.createElement("div"),this.toggleEl.className="toggle-el",this.isEnabled=!1,this.onClickBound=this.onClick.bind(this),this.el.addEventListener("click",this.onClickBound),t.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.isEnabled=!this.isEnabled,this.isEnabled?(this.el.classList.add("enabled"),this.label.innerHTML="Visa x y z axlar (aktiv)"):(this.el.classList.remove("enabled"),this.label.innerHTML="Visa x y z axlar (inaktiv)"),this.foregroundController.toggleAxesHelper(this.isEnabled)}}])&&xe(t.prototype,n),i&&xe(t,i),e}();function Me(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Pe=function(){function e(t,n,i,o,r,a,s){var l=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=i,this.decimals=o,this.value=(n-r.min)/(r.max-r.min),this.settings=r,this.el=document.createElement("div"),this.el.className="horizontal-slider prevent-drag "+a;var c=document.createElement("h4");c.className="horizontal-slider-label",c.innerHTML=s,this.el.appendChild(c),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var u=document.createElement("div");u.appendChild(this.rangeInnerContainer),u.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=n;var d=document.createElement("div");d.className="value-container",d.appendChild(this.valueEl),this.el.appendChild(u),this.el.appendChild(d),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),setTimeout(function(){l.setPos(120)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"remove",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e){this.value=e,this.setPos(120);var t=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=t,this.valChangeCallback&&this.valChangeCallback(t)}},{key:"getValue",value:function(){var e=this.settings;return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(".concat(t,"px, 0px, 0)")}}])&&Me(t.prototype,n),i&&Me(t,i),e}();function De(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Oe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="follow-node-setting settings-item",this.isFollowing=!1,this.followingStateHTML="<h4>Tillbaka</h4>",this.notFollowingStateHTML="<h4>Följ aktiv nod</h4>",this.el.innerHTML=this.notFollowingStateHTML,this.onClickBound=this.onClick.bind(this),this.el.addEventListener("click",this.onClickBound),this.parentEl=t,this.parentEl.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"checkActive",value:function(){window.NS.singletons.SelectionManager.currentSelectedNode?(this.el.classList.add("active"),this.isFollowing&&window.NS.singletons.CanvasNode.setForegroundCamera()):(this.el.classList.remove("active"),this.isFollowing=!1,window.NS.singletons.CanvasNode.resetForegroundCamera(),this.el.innerHTML=this.notFollowingStateHTML)}},{key:"onClick",value:function(){this.el.classList.contains("active")&&(this.isFollowing=!this.isFollowing,this.el.innerHTML=this.isFollowing?this.followingStateHTML:this.notFollowingStateHTML,this.isFollowing?window.NS.singletons.CanvasNode.setForegroundCamera():window.NS.singletons.CanvasNode.resetForegroundCamera())}},{key:"setIsFollowingState",value:function(e){this.isFollowing=e,this.el.innerHTML=this.isFollowing?this.followingStateHTML:this.notFollowingStateHTML}}])&&De(t.prototype,n),i&&De(t,i),e}();function Te(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ie=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="toggle-orbit-helper settings-item",this.label=document.createElement("h4"),this.label.innerHTML="Dölj alla orbit helpers",this.el.appendChild(this.label),this.isEnabled=!1,this.onClickBound=this.onClick.bind(this),this.el.addEventListener("click",this.onClickBound),t.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.isEnabled=!this.isEnabled;var t=this.getNodes();this.isEnabled?(this.el.classList.add("enabled"),this.label.innerHTML="Visa alla orbit helpers",t.forEach(function(e){e.visualHelperSettings.disableVisibility(!0,!1)})):(this.el.classList.remove("enabled"),this.label.innerHTML="Dölj alla orbit helpers",t.forEach(function(e){e.visualHelperSettings.enableVisibility(!0,!1)}))}},{key:"getNodes",value:function(){return Object.keys(window.NS.singletons.ConnectionsManager.nodes).filter(function(e){return window.NS.singletons.ConnectionsManager.nodes[e].hasHelperMeshToHide}).map(function(e){return window.NS.singletons.ConnectionsManager.nodes[e]})}}])&&Te(t.prototype,n),i&&Te(t,i),e}();function Re(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Le=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.el=document.createElement("div"),this.el.className="settings-window",this.labelBtn=document.createElement("div"),this.labelBtn.className="label-btn";var r=document.createElement("h5");r.innerHTML="Inställningar",this.labelBtn.appendChild(r),this.el.appendChild(this.labelBtn),this.onLabelClickBound=this.onLabelClick.bind(this),this.labelBtn.addEventListener("click",this.onLabelClickBound),this.bottomPartSettings=document.createElement("div"),this.bottomPartSettings.className="bottom-part-settings";var a=document.createElement("div");a.className="settings-col";var s=document.createElement("div");s.className="settings-col",this.bottomPartSettings.appendChild(a),this.bottomPartSettings.appendChild(s),this.isVisible=!1,window.NS.singletons.PROJECT_TYPE,window.NS.singletons.TYPES.chemistry.id,window.NS.singletons.PROJECT_TYPE===window.NS.singletons.TYPES.space.id&&(this.followNodeSetting=new Oe(a),this.ambientLightSetting=new Pe(s,i.ambientLight.intensity,n,2,{min:0,max:1},"ambient-light settings-item","Ambient light"),this.axesHelper=new Ne(a,i),this.toggleOrbitHelper=new Ie(a)),this.closeFullscreenBtn=document.createElement("div"),this.closeFullscreenBtn.classList.add("close-fullscreen-btn"),this.closeFullscreenBtn.addEventListener("click",o),this.el.appendChild(this.closeFullscreenBtn),this.el.appendChild(this.bottomPartSettings),this.parentEl.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"onLabelClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.isVisible?this.hide():this.show()}},{key:"show",value:function(){this.isVisible=!0,this.el.classList.add("visible"),this.followNodeSetting.checkActive()}},{key:"hide",value:function(){this.isVisible=!1,this.el.classList.remove("visible")}},{key:"showFullscreenBtn",value:function(){this.closeFullscreenBtn.classList.add("visible")}},{key:"hideFullscreenBtn",value:function(){this.closeFullscreenBtn.classList.remove("visible")}}])&&Re(t.prototype,n),i&&Re(t,i),e}();n(19);function Ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function je(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _e=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.moveCoords={start:{x:0,y:0}},this.currentCanvasSize={w:0,h:0},this.getCanvasSize=n,this.setCanvasSize=i,this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.el=document.createElement("div"),this.el.className="resizer hidden";var o=new Image;o.src="./assets/resize.svg",this.el.appendChild(o);var r=document.createElement("div");r.className="touch-layer",this.el.appendChild(r),this.parentEl.appendChild(this.el),this.el.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"show",value:function(){this.el.classList.remove("hidden")}},{key:"hide",value:function(){this.el.classList.add("hidden")}},{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this.moveCoords.start.x=e.x,this.moveCoords.start.y=e.y;var t=Ae(this.getCanvasSize(),2),n=t[0],i=t[1];this.currentCanvasSize.w=n,this.currentCanvasSize.h=i,window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.moveCoords.start.x-e.x,n=e.y-this.moveCoords.start.y;this.setCanvasSize({w:this.currentCanvasSize.w+t,h:this.currentCanvasSize.h+n})}},{key:"onMouseUp",value:function(e){return e.stopPropagation(),e.preventDefault(),window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound),!1}}])&&je(t.prototype,n),i&&je(t,i),e}();n(21);function Ve(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Be=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onFullscreenClick=n,this.el=document.createElement("div"),this.el.className="fullscreen hidden";var i=new Image;i.src="./assets/fullscreen.svg",this.el.appendChild(i);var o=document.createElement("div");o.className="touch-layer",this.el.appendChild(o),this.parentEl.appendChild(this.el),this.el.addEventListener("click",this.onFullscreenClick)}var t,n,i;return t=e,(n=[{key:"show",value:function(){this.el.classList.remove("hidden")}},{key:"hide",value:function(){this.el.classList.add("hidden")}}])&&Ve(t.prototype,n),i&&Ve(t,i),e}();n(23);function He(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Fe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ze=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mainRender=t,this.isFullscreen=!1,this.ID="_"+Math.random().toString(36).substr(2,9),this.isVisible=!1,this.hasOutput=!1,this.isGraphicsNode=!0,this.hasGraphicsInput=!0,this.isCanvasNode=!0,this.initAsNotCollapsed=!0,this.inputHelpersType=W.sceneNode,this.enabledInputs=[],this.el=document.createElement("div"),this.el.className="canvas",this.topPartEl=document.createElement("div"),this.topPartEl.className="top-part",this.el.appendChild(this.topPartEl),this.bottomLabelContainer=document.createElement("div"),this.bottomLabelContainer.className="bottom-label";var i=document.createElement("h5");i.className="canvas-label",i.innerHTML="CANVAS WINDOW",this.bottomLabelContainer.appendChild(i),this.el.appendChild(this.bottomLabelContainer),this.onToggleVisibleClickBound=this.onToggleVisibleClick.bind(this),this.bottomLabelContainer.addEventListener("click",function(e){if(e.target.classList.contains("touch-layer"))return!1;n.onToggleVisibleClickBound()}),this.meshLabels=new Map,this.foregroundRender=new Se(this.mainRender,this.topPartEl),this.getCurrentCanvasDimsBound=this.getCurrentCanvasDims.bind(this),this.setCanvasSizeBound=this.setCanvasSize.bind(this),this.resizer=new _e(this.bottomLabelContainer,this.getCurrentCanvasDimsBound,this.setCanvasSizeBound),this.onFullscreenClickBound=this.onFullscreenClick.bind(this),this.fullscreen=new Be(this.bottomLabelContainer,this.onFullscreenClickBound),this.onAmbientLightSettingChangeBound=this.onAmbientLightSettingChange.bind(this),this.settingsWindow=new Le(this.el,this.onAmbientLightSettingChangeBound,this.foregroundRender,this.onFullscreenClickBound),this.scene=new THREE.Scene,this.renderer=this.mainRender.renderer,this.renderer.setSize(this.topPartEl.clientWidth,this.topPartEl.clientHeight),this.topPartEl.appendChild(this.renderer.domElement);var o=new THREE.PlaneGeometry(2,2),r={};r.u_res={value:new THREE.Vector2(window.innerWidth,window.innerHeight)};var a={u_connection0:{value:0}};a.u_texture0={value:new Image},a.u_connection1={value:0},a.u_texture1={value:new Image},a.u_finalConnection={value:0},a.u_multiConnection={value:0};var s=Object.assign({},r,a);this.material=new THREE.ShaderMaterial({uniforms:s,vertexShader:Y,fragmentShader:K}),this.mesh=new THREE.Mesh(o,this.material),this.scene.add(this.mesh)}var t,n,i;return t=e,(n=[{key:"init",value:function(e){var t=this,n=window.innerWidth,i=window.innerHeight;this.parentEl=e,this.orthoCamera=new THREE.OrthographicCamera(n/-2,n/2,i/2,i/-2,1,1e3),setTimeout(function(){t.onResize()},100),this.onKeyPressBound=this.onKeyPress.bind(this),this.onFullscreenChangeBound=this.onFullscreenChange.bind(this),document.addEventListener("fullscreenchange",this.onFullscreenChangeBound),this.parentEl.appendChild(this.el)}},{key:"addMeshLabel",value:function(e,t,n){this.el.appendChild(n.domEl),this.meshLabels.set(t,{obj:e,htmlLabelObj:n})}},{key:"removeMeshLabel",value:function(e){var t=this.meshLabels.get(e);this.el.removeChild(t.htmlLabelObj.domEl),this.meshLabels.delete(e)}},{key:"onFullscreenChange",value:function(){var e=this;this.isFullscreen&&(this.isFullscreen=!1,this.settingsWindow.hideFullscreenBtn(),setTimeout(function(){e.onResize()},1e3))}},{key:"onKeyPress",value:function(e){27===e.keyCode&&this.onFullscreenClick()}},{key:"onFullscreenClick",value:function(){var e=this;document.fullscreenElement?document.exitFullscreen&&(this.isFullscreen=!1,document.exitFullscreen(),this.settingsWindow.hideFullscreenBtn(),setTimeout(function(){e.onResize()},1e3)):(this.el.requestFullscreen(),this.settingsWindow.showFullscreenBtn(),setTimeout(function(){e.onResize(),e.isFullscreen=!0},1e3))}},{key:"onToggleVisibleClick",value:function(){this.isVisible?(this.isVisible=!1,this.el.classList.remove("visible"),this.resizer.hide(),this.fullscreen.hide(),document.addEventListener("keypress",this.onKeyPressBound)):(this.isVisible=!0,this.el.classList.add("visible"),this.resizer.show(),this.fullscreen.show(),this.onResize(),document.removeEventListener("keypress",this.onKeyPressBound))}},{key:"onAmbientLightSettingChange",value:function(e){this.foregroundRender.ambientLight.intensity=e}},{key:"getCurrentCanvasDims",value:function(){return[this.topPartEl.clientWidth,this.topPartEl.clientHeight]}},{key:"setCanvasSize",value:function(e){e.w<100||e.h<100||(this.el.style.width="".concat(e.w,"px"),this.el.style.height="".concat(e.h,"px"),this.onResize(e))}},{key:"setBackgroundTexture",value:function(e){this.mesh.material.uniforms.u_texture0.value=e,this.mesh.material.uniforms.u_connection0.value=1}},{key:"enableInput",value:function(e,t){if(e.isBackgroundNode){var n=e.framebuffer?e.framebuffer.texture:e.texture;this.mesh.material.uniforms.u_texture0.value=n,this.mesh.material.uniforms.u_connection0.value=1}else if(e.isForegroundNode){if(this.foregroundRender.addNode(e),1===this.foregroundRender.connectedNodes.length){var i=this.foregroundRender.framebuffer.texture;this.mesh.material.uniforms.u_texture1.value=i,this.mesh.material.uniforms.u_connection1.value=1}}else e.isLightNode&&this.foregroundRender.addLight(e);var o={out:e,type:t};this.enabledInputs.push(o),e.isLightNode||(this.mesh.material.uniforms.u_finalConnection.value=1)}},{key:"disableInput",value:function(e,t){e.isBackgroundNode?(this.inputs[t].disable(),this.mesh.material.uniforms.u_texture0.value=null,this.mesh.material.uniforms.u_connection0.value=0,this.mesh.material.uniforms.u_multiConnection.value=0):e.isForegroundNode?(this.foregroundRender.removeNode(e),0===this.foregroundRender.connectedNodes.length&&(this.mesh.material.uniforms.u_texture1.value=null,this.mesh.material.uniforms.u_connection1.value=0)):e.isLightNode&&this.foregroundRender.removeLight(e),this.enabledInputs=this.enabledInputs.filter(function(t){return t.out.ID!==e.ID}),0===this.enabledInputs.filter(function(e){return!e.out.isLightNode}).length?this.mesh.material.uniforms.u_finalConnection.value=0:this.inputs&&!this.inputs.foreground.isActive&&(this.mesh.material.uniforms.u_multiConnection.value=0)}},{key:"update",value:function(){var e=new THREE.Vector3,t=this.foregroundRender.getCamera(),n=He(this.getCurrentCanvasDims(),2),i=n[0],o=n[1];this.foregroundRender.update();var r=!0,a=!1,s=void 0;try{for(var l,c=this.meshLabels.values()[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var u=l.value,d=u.obj,h=u.htmlLabelObj;d.updateWorldMatrix(!0,!1),d.getWorldPosition(e),e.project(t);var p=(.5*e.x+.5)*i,f=(-.5*e.y+.5)*o;h.position={x:p,y:f}}}catch(e){a=!0,s=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw s}}}},{key:"render",value:function(){this.renderer.clear(),this.foregroundRender.render(),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.orthoCamera)}},{key:"onResize",value:function(e){var t=this,n=He(e?[e.w,e.h]:t.getCurrentCanvasDims(),2),i=n[0],o=n[1];this.foregroundRender.onResize({w:i,h:o});var r=new CustomEvent("canvas-resize-event",{detail:[i,o]});document.documentElement.dispatchEvent(r),this.mesh.material.uniforms.u_res.value=new THREE.Vector2(i,o),this.orthoCamera.left=i/-2,this.orthoCamera.right=i/2,this.orthoCamera.top=o/-2,this.orthoCamera.bottom=o/2,this.orthoCamera.updateProjectionMatrix(),this.renderer.setSize(i,o)}}])&&Fe(t.prototype,n),i&&Fe(t,i),e}();n(25);function Ue(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ge=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);this.el=document.createElement("space-time-ui"),this.el.insertAdjacentHTML("beforeend",'\n            <div class="time-container">\n                <div class="value-container">\n                    <h4 class="hour-visual type">Timme:</h4>\n                    <h4 class="hour value"></h4>\n                    <h4 class="day-visual type">Dygn:</h4>\n                    <h4 class="day value"></h4>\n                    <h4 class="year-visual type">År:</h4>\n                    <h4 class="year value"></h4>\n                </div>\n                <button><h4>Start</h4></button>\n            </div>\n            <div class="speed-slider-container"></div>\n        '),t.appendChild(this.el),this.onControlBtnClick=this.onControlBtnClick.bind(this);var n=this.el.querySelector(".hour.value"),i=this.el.querySelector(".day.value"),o=this.el.querySelector(".year.value"),r=this.el.querySelector(".speed-slider-container");this._controlButton=this.el.querySelector("button"),this._controlBtnLabel=this.el.querySelector("button > h4"),this._controlButton.addEventListener("click",this.onControlBtnClick),this.timeUI={hours:{domEl:n},days:{domEl:i},years:{domEl:o}},this.onSpeedSettingChangeBound=this.onSpeedSettingChange.bind(this),this.speedSetting=new Pe(r,window.NS.singletons.LessonManager.space.spaceTimeController.multiplier,this.onSpeedSettingChangeBound,2,{min:-12,max:480},"speed-settings settings-item","Timmar per sekund"),this.parentEl=t,this.update=this.update.bind(this),this.setUI(0,0,0)}var t,n,i;return t=e,(n=[{key:"onSpeedSettingChange",value:function(e){window.NS.singletons.LessonManager.space.spaceTimeController.multiplier=e}},{key:"onControlBtnClick",value:function(){window.NS.singletons.LessonManager.space.spaceTimeController.isRunning?this.onStop():this.onStart()}},{key:"onStart",value:function(){this._controlBtnLabel.innerHTML="Pausa",window.NS.singletons.LessonManager.space.spaceTimeController.start(),this.animFrame=requestAnimationFrame(this.update)}},{key:"onStop",value:function(){this._controlBtnLabel.innerHTML="Starta",cancelAnimationFrame(this.animFrame),window.NS.singletons.LessonManager.space.spaceTimeController.stop()}},{key:"update",value:function(){this.animFrame=requestAnimationFrame(this.update);var e=window.NS.singletons.LessonManager.space.spaceTimeController.getCurrentHourInDay(),t=window.NS.singletons.LessonManager.space.spaceTimeController.getCurrentDay(),n=window.NS.singletons.LessonManager.space.spaceTimeController.getCurrentYear();this.setUI(e,t,n)}},{key:"setUI",value:function(e,t,n){this.timeUI.hours.domEl.innerHTML=Math.floor(e),this.timeUI.days.domEl.innerHTML=t,this.timeUI.years.domEl.innerHTML=n}}])&&Ue(t.prototype,n),i&&Ue(t,i),e}();function Ye(e){return(Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ke(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Xe(e,t){return!t||"object"!==Ye(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function We(e,t,n){return(We="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qe(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function qe(e){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Je(e,t){return(Je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ze=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Xe(this,qe(t).call(this,e)))._spaceTimeUI=new Ge(n.el),n}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Je(e,t)}(t,ze),n=t,(i=[{key:"init",value:function(e){We(qe(t.prototype),"init",this).call(this,e)}},{key:"onNodeDeselect",value:function(){this.settingsWindow.followNodeSetting.checkActive()}},{key:"setForegroundCamera",value:function(e){if(e)this.foregroundRender.setActiveCamera(e);else{var t=window.NS.singletons.SelectionManager.currentSelectedNode;if(t.mesh){t.mesh.position;t.mainMesh.geometry.computeBoundingBox();var n=t.mainMesh.geometry.boundingBox,i=8*-(t.mesh.scale.z*n.max.z),o={mesh:t.mesh,distance:i};this.foregroundRender.setMeshToFollow(o)}}}},{key:"resetForegroundCamera",value:function(){this.foregroundRender.resetMeshToFollow()}}])&&Ke(n.prototype,i),o&&Ke(n,o),t}(),Qe={single:{isValid:function(e,t,n,i){var o=!0;return i.some(function(e){return e.in.ID===t.ID&&!e.param})&&(o=!1),o}},multiple:{isValid:function(e,t,n,i,o){if(e.outputs&&e.outputs[o]&&e.outputs[o].isParamOutput&&!t.isParam)return!1;return!0}},oscillatorTrigger:{isValid:function(e,t,n,i){var o=!0;return i.some(function(n){return n.out.ID===e.ID&&n.in.ID===t.ID})&&(o=!1),e.isSequencer||(o=!1),o}},gain:{isValid:function(e,t,n,i){var o=!0;return i.some(function(n){return n.in.ID===t.ID&&n.out.ID===e.ID})&&(o=!1),e.isEnvelope||(o=!1),o}},frequency:{isValid:function(e,t,n,i){var o=!0;return i.some(function(n){return n.in.ID===t.ID&&n.out.ID===e.ID})&&(o=!1),e.isEnvelope||e.isLFO||(o=!1),o}}};function $e(e){return($e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function et(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function tt(e,t){return!t||"object"!==$e(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function nt(e,t,n){return(nt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=it(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function it(e){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var rt=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=tt(this,it(t).call(this))).audioNode=null,e.isParam=!1,e.isKeyboardListener=!1,e.isOscillator=!1,e.isEnvelope=!1,e.isSpeaker=!1,e.isSignalMath=!1,e.hasAudioInput=!0,e.isSequencer=!1,e.isLFO=!1,e.isAnalyser=!1,e.isSynthOscillator=!1,e.inputHelpersType=Qe.single,e.params={},e.canBeConnected=!1,e.el=document.createElement("div"),e.el.className="node",e.topPartEl=document.createElement("div"),e.topPartEl.className="top-part",e.el.appendChild(e.topPartEl),e.bottomPartEl=document.createElement("div"),e.bottomPartEl.className="bottom-part",e.el.appendChild(e.bottomPartEl),e.inputParams={},e}var n,i,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(t,B),n=t,(i=[{key:"init",value:function(e,n,i,r,a,s,l,c,u){for(var d in nt(it(t.prototype),"init",this).call(this,e,n,i,r,a,s,l,u),this.onParameterChange=c,this.connectedInputs=[],this.connectedOutputs=[],this.params)if(this.params[d].useAsInput){var h=new o(this.topPartEl,this.params[d],this.onInputClickBound);this.inputParams[this.params[d].title]=h}this.isSequencer&&(this.el.classList.add("sequencer"),this.createUI(),this.setup()),this.activateDrag(),this.postInit()}},{key:"enableParam",value:function(e){var t=this.inputParams[e.title];e.isConnected=!0,t.enable(),e.slider&&e.disableSliderOnConnection&&e.slider.disableSlider()}},{key:"disableParam",value:function(e){var t=this.inputParams[e.title];e.isConnected=!1,t.disable(),e.slider&&e.slider.enableSlider()}},{key:"onParameterUpdate",value:function(){var e=this.getParams();this.onParameterChange(this,e)}},{key:"getParams",value:function(){var e={};for(var t in this.params){var n=this.params[t];e[n.param]=this.params[n.param].value}return e}},{key:"enableOutput",value:function(e,n){nt(it(t.prototype),"enableOutput",this).call(this),this.connectedOutputs.push(n.in.ID)}},{key:"disableOutput",value:function(e,n){var i=this.connectedOutputs.filter(function(t){return t!==e.ID});this.connectedOutputs=i,0===this.connectedOutputs.length&&nt(it(t.prototype),"disableOutput",this).call(this)}},{key:"enableInput",value:function(e){nt(it(t.prototype),"enableInput",this).call(this),this.connectedInputs.push("".concat(e.ID,"-").concat(this.ID))}},{key:"disableInput",value:function(e){var n="".concat(e.ID,"-").concat(this.ID),i=this.connectedInputs.filter(function(e){return e!==n});this.connectedInputs=i,0===this.connectedInputs.length&&nt(it(t.prototype),"disableInput",this).call(this)}}])&&et(n.prototype,i),r&&et(n,r),t}(),at=n(9),st=n.n(at);function lt(e){return(lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ct(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ut(e,t){return!t||"object"!==lt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function dt(e){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ht(e,t){return(ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pt=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ut(this,dt(t).call(this))).inputHelpersType=Qe.multiple,e.audioNode=st.a.context.destination,e.isSpeaker=!0,e.initAsNotCollapsed=!0,e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ht(e,t)}(t,rt),n=t,(i=[{key:"getAudioNode",value:function(){var e=new st.a.Limiter;return e.connect(st.a.context.destination),e}}])&&ct(n.prototype,i),o&&ct(n,o),t}();function ft(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var gt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nodes={},this.step=t,this.currentConnections=[],this.oscillatorNodes=[],this.synthOscillatorNodes=[],this.triggerNodes=[]}var t,n,i;return t=e,(n=[{key:"reset",value:function(e){for(var t=0;t<this.currentConnections.length;t++){var n=this.currentConnections[t],i=this.nodes[n.out.ID]?this.nodes[n.out.ID].audioNode:void 0,o=this.nodes[n.in.ID]?this.nodes[n.in.ID].audioNode:void 0,r=this.nodes[n.in.ID]?this.nodes[n.in.ID].musicNode:void 0;if(i&&o)if(n.out.isParam);else{if(r&&r.isAnalyser)continue;o.disconnect()}}this.nodes={},this.oscillatorNodes=[],this.currentConnections=e,this.triggerNodes=[],this.synthOscillatorNodes=[]}},{key:"updateConnections",value:function(e){this.reset(e);for(var t=0;t<e.length;t++){var n=e[t];if(!n.out.isSequencer){if(!this.nodes[n.in.ID]){var i={audioNode:n.in.getAudioNode(),musicNode:n.in};this.nodes[n.in.ID]=i}if(!this.nodes[n.out.ID]){var o=n.out.getAudioNode(n.param?n.param.param:void 0),r={audioNode:o,musicNode:n.out};this.nodes[n.out.ID]=r,n.out.isEnvelope&&this.triggerNodes.push(o),(n.out.isOscillator||n.out.isLFO)&&this.oscillatorNodes.push(r),n.out.isSynthOscillator&&this.synthOscillatorNodes.push(r)}}}for(var a=0;a<e.length;a++){var s=e[a],l=this.nodes[s.out.ID]?this.nodes[s.out.ID].audioNode:void 0,c=this.nodes[s.in.ID]?this.nodes[s.in.ID].audioNode:void 0;this.nodes[s.out.ID]&&this.nodes[s.out.ID].musicNode,this.nodes[s.in.ID]&&this.nodes[s.in.ID].musicNode;if(!s.out.isSequencer||l)if(s.out.isParam){var u=s.param.param;l.connect(c[u])}else l.connect(c)}}},{key:"onParamChange",value:function(e){this.nodes[e.ID]&&(e.isOscillator?this._updateOscillatorParams(this.nodes[e.ID].audioNode,e):e.isSynthOscillator||this._updateParams(this.nodes[e.ID].audioNode,e))}},{key:"_updateSynthOscillatorParams",value:function(e,t){for(var n=0;n<t.synthParams.length;n++){var i=t.params[t.synthParams[n]];i.setParam?i.setParam(e,i.value):e[t.synthParams[n]].value=i.value}}},{key:"_updateOscillatorParams",value:function(e,t){e.frequency.value=t.getFrequency(this.step)}},{key:"_updateParams",value:function(e,t){var n=function(e,t){for(var n in e.params)if(e.params[n].param===t)return e.params[n].isConnected};for(var i in t.params)"gain"===i&&n(t,i)||("frequency"===i||"amplitude"===i||"Q"===i||"gain"===i||"threshold"===i||"ratio"===i?e[i].value=t.params[i].value:e[i]=t.params[i].value)}},{key:"play",value:function(e,t){var n=this.triggerNodes.length,i=this.oscillatorNodes.length,o=this.synthOscillatorNodes.length;for(var r in this.nodes){var a=this.nodes[r];a.musicNode.isOscillator?this._updateOscillatorParams(a.audioNode,a.musicNode):a.musicNode.isSynthOscillator?this._updateSynthOscillatorParams(a.audioNode,a.musicNode):this._updateParams(a.audioNode,a.musicNode)}for(var s=0;s<n;s++)this.triggerNodes[s].triggerAttackRelease(st.a.Time("8n"),e);for(var l=0;l<i;l++){var c=this.oscillatorNodes[l];c.musicNode.isOscillator&&c.musicNode.hasConnectedTrigger&&c.musicNode.connectedTriggerID===t?c.musicNode.hasEnvelopeConnection?c.audioNode.start(e).stop(e+st.a.Time(2)):c.audioNode.start(e).stop(e+st.a.Time("8n")):c.musicNode.isLFO&&(c.audioNode.phase=0,c.audioNode.start(e))}for(var u=0;u<o;u++){var d=this.synthOscillatorNodes[u];if(d.musicNode.connectedTriggerID===t){var h=d.musicNode.getFrequency(this.step);d.audioNode.triggerAttackRelease(h,"8n")}}}},{key:"keyDown",value:function(){var e=this.triggerNodes.length,t=this.oscillatorNodes.length,n=this.synthOscillatorNodes.length;for(var i in this.nodes){var o=this.nodes[i];o.musicNode.isOscillator?this._updateOscillatorParams(o.audioNode,o.musicNode):o.musicNode.isSynthOscillator?this._updateSynthOscillatorParams(o.audioNode,o.musicNode):this._updateParams(o.audioNode,o.musicNode)}for(var r=0;r<t;r++){var a=this.oscillatorNodes[r];a.musicNode.isOscillator?a.audioNode.start():a.musicNode.isLFO&&(a.audioNode.phase=0,a.audioNode.start())}for(var s=0;s<e;s++)this.triggerNodes[s].triggerAttack();for(var l=0;l<n;l++){var c=this.synthOscillatorNodes[l],u=c.musicNode.getFrequency(this.step);c.audioNode.triggerAttack(u)}}},{key:"keyUp",value:function(){for(var e=this.triggerNodes.length,t=this.oscillatorNodes.length,n=this.synthOscillatorNodes.length,i=0;i<t;i++){var o=this.oscillatorNodes[i];o.musicNode.isOscillator?o.musicNode.hasEnvelopeConnection||o.audioNode.stop():o.musicNode.isLFO}for(var r=0;r<e;r++)this.triggerNodes[r].triggerRelease();for(var a=0;a<n;a++){var s=this.synthOscillatorNodes[a];s.musicNode.getFrequency(this.step);s.audioNode.triggerRelease()}}}])&&ft(t.prototype,n),i&&ft(t,i),e}();function vt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var mt=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.triggerID=i,this.cols=t,this.rows=n,this.synths=[],this.masterSynth=new gt(0);for(var o=0;o<t;o++){for(var r=[],a=0;a<n;a++)r.push({synth:null,isActive:!1});this.synths.push(r)}}var t,n,i;return t=e,(n=[{key:"init",value:function(e){this.masterSynth.updateConnections(e)}},{key:"removeAllSynths",value:function(){for(var e=this.cols,t=this.rows,n=0;n<e;n++)for(var i=0;i<t;i++)this.synths[n][i].isActive&&(this.synths[n][i].synth.reset(),this.synths[n][i].isActive=!1)}},{key:"addSynth",value:function(e,t){var n=new gt(t);n.updateConnections(this.masterSynth.currentConnections),this.synths[e][t].synth=n,this.synths[e][t].isActive=!0}},{key:"removeSynth",value:function(e,t){this.synths[e][t].isActive&&(this.synths[e][t].synth.reset(),this.synths[e][t].isActive=!1)}},{key:"play",value:function(e,t,n){this.synths[e][t].synth.play(n,this.triggerID)}},{key:"onAudioNodeConnectionUpdate",value:function(e){for(var t=this.cols,n=this.rows,i=0;i<t;i++)for(var o=0;o<n;o++)this.synths[i][o].isActive&&this.synths[i][o].synth.updateConnections(e);this.masterSynth.updateConnections(e)}},{key:"onAudioNodeParamChange",value:function(e,t){for(var n=this.cols,i=this.rows,o=0;o<n;o++)for(var r=0;r<i;r++)this.synths[o][r].isActive&&this.synths[o][r].synth.onParamChange(e,t);this.masterSynth.onParamChange(e,t)}}])&&vt(t.prototype,n),i&&vt(t,i),e}();function yt(e){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function wt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ct(e,t,n){return(Ct="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=kt(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function kt(e){return(kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Et(e,t){return(Et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var St=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,e=!(i=kt(t).call(this))||"object"!==yt(i)&&"function"!=typeof i?wt(n):i,t.ROWS=12,t.COLS=16,e.isSequencer=!0,e.loop=null,e.hasAudioInput=!1,e.isParam=!0,e.initAsNotCollapsed=!0,e.data=[];for(var o=t.ROWS,r=t.COLS,a=0;a<r;a++){for(var s=[],l=0;l<o;l++){var c={active:!1,el:null,parentEl:null,step:o-1-l};s.push(c)}e.data.push(s)}return e.outConnections=[],e.outConnectionsLength=0,e.isPlaying=!1,e.onBtnClickBound=e.onBtnClick.bind(wt(e)),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Et(e,t)}(t,rt),n=t,(i=[{key:"init",value:function(e,n,i,o,r,a,s,l,c){Ct(kt(t.prototype),"init",this).call(this,e,n,i,o,r,a,s,l,c),this.sequencerManager=new mt(t.COLS,t.ROWS,this.ID)}},{key:"removeFromDom",value:function(){this.sequencerManager.removeAllSynths(),Ct(kt(t.prototype),"removeFromDom",this).call(this)}},{key:"getKey",value:function(e,t){return"col".concat(e,"-row").concat(t)}},{key:"onRemoveClick",value:function(){this.loop.stop(),this.playEl.removeEventListener("click",this.onPlayClickBound),this.pauseEl.removeEventListener("click",this.onPauseClickBound),Ct(kt(t.prototype),"onRemoveClick",this).call(this)}},{key:"createUI",value:function(){var e=t.ROWS,n=t.COLS,i=document.createElement("div");i.className="sequencer-container";for(var o=0;o<n;o++){var r=document.createElement("div");r.className="sequencer-col",i.appendChild(r);for(var a=0;a<e;a++){var s=document.createElement("div");s.className="sequencer-btn",s.setAttribute("data-col",o),s.setAttribute("data-row",a),r.appendChild(s),s.addEventListener("click",this.onBtnClickBound),this.data[o][a].el=s,this.data[o][a].parentEl=r}}this.topPartEl.appendChild(i);var l=document.createElement("div");l.className="sequencer-controls";var c=document.createElement("div");c.className="inner-controls",this.playEl=document.createElement("h5"),this.playEl.innerHTML="Spela",this.pauseEl=document.createElement("h5"),this.pauseEl.innerHTML="Nollställ",this.onPlayClickBound=this.onPlayClick.bind(this),this.onPauseClickBound=this.onPauseClick.bind(this),this.playEl.addEventListener("click",this.onPlayClickBound),this.pauseEl.addEventListener("click",this.onPauseClickBound),c.appendChild(this.playEl),c.appendChild(this.pauseEl),l.appendChild(c),this.topPartEl.appendChild(l)}},{key:"onPlayClick",value:function(){this.isPlaying||(this.isPlaying=!0,this.loop.start())}},{key:"onPauseClick",value:function(){this.isPlaying=!1,this.loop.stop(),this.reset()}},{key:"reset",value:function(){for(var e=t.ROWS,n=t.COLS,i=0;i<n;i++){this.data[i][0].parentEl.classList.remove("active");for(var o=0;o<e;o++)this.data[i][o].active=!1}this.sequencerManager.removeAllSynths(),this.update()}},{key:"setup",value:function(){var e=this;this.loop=new st.a.Sequence(function(n,i){for(var o=0;o<t.COLS;o++){e.data[o][0].parentEl.classList.remove("active")}var r=e.data[i];e.data[i][0].parentEl.classList.add("active");for(var a=0;a<t.ROWS;a++)r[a].active&&e.outConnectionsLength>0&&e.sequencerManager.play(i,r[a].step,n)},[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],"8n")}},{key:"onBtnClick",value:function(e){e.stopPropagation(),e.preventDefault();var t=parseInt(e.target.getAttribute("data-col")),n=parseInt(e.target.getAttribute("data-row")),i=this.data[t][n];i.active=!i.active,i.active?this.sequencerManager.addSynth(t,i.step):this.sequencerManager.removeSynth(t,i.step),this.update()}},{key:"onOutputClick",value:function(e){0===this.outConnectionsLength&&this.onConnectingCallback(this,e)}},{key:"enableOutput",value:function(e,t){this.output.enable(),this.outConnections.push(t.in),this.outConnectionsLength=this.outConnections.length}},{key:"disableOutput",value:function(e,t){this.outConnections=this.outConnections.filter(function(t){return t.ID!==e.ID}),this.outConnectionsLength=this.outConnections.length,0===this.outConnections.length&&(this.output.disable(),this.sequencerManager.removeAllSynths(),this.onPauseClick())}},{key:"update",value:function(){for(var e=t.ROWS,n=t.COLS,i=0;i<n;i++)for(var o=0;o<e;o++){var r=this.data[i][o];r.active?r.el.classList.add("active"):r.el.classList.remove("active")}}}])&&bt(n.prototype,i),o&&bt(n,o),t}();function xt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Nt=function(){function e(t,n,i,o,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isActive=!1,this.onClickCallback=n,this.parentEl=t,this.isParamOutput=i,this.el=document.createElement("div"),this.el.className="node-output node-component ".concat(o?"":"right-align"," ").concat(i?"param":"");var s=document.createElement("div");s.className="dot",this.el.appendChild(s);var l=document.createElement("p");l.className="label",l.innerHTML=i?"Data ut":a?"Grafik ut":"Ljud ut",this.el.appendChild(l),this.parentEl.appendChild(this.el),this.onClickBound=this.onClick.bind(this),r?this.el.style.display="none":(s.addEventListener("click",this.onClickBound),this.offsetLeft=void 0,this.offsetTop=void 0)}var t,n,i;return t=e,(n=[{key:"getOffsetLeft",value:function(){return this.offsetLeft||(this.offsetLeft=this.el.offsetLeft),this.offsetLeft}},{key:"getOffsetTop",value:function(){return this.offsetTop=this.el.offsetTop,this.offsetTop}},{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.el.classList.add("selected"),this.onClickCallback({x:e.x,y:e.y})}},{key:"enable",value:function(){this.isActive=!0,this.el.classList.add("active"),this.el.classList.remove("selected")}},{key:"disable",value:function(){this.isActive=!1,this.el.classList.remove("active")}}])&&xt(t.prototype,n),i&&xt(t,i),e}();function Mt(e){return(Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Dt(e,t){return!t||"object"!==Mt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ot(e,t,n){return(Ot="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Tt(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Tt(e){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function It(e,t){return(It=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Rt=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Dt(this,Tt(t).call(this))).el.classList.add("no-height"),e.el.classList.add("waveform-node"),e.needsUpdate=!0,e.isAnalyser=!0,e.isDisposed=!1,e.hasMultipleOutputs=!0,e.initAsNotCollapsed=!0,e.arrSize=256,e.audioValue=0,e.isConnected=!1,e.audioConnections=[],e.audioNode=st.a.context.createAnalyser(),e.audioNode.fftSize=e.arrSize,e.canvas=document.createElement("canvas"),e.canvas.className="waveform-canvas",e.canvas.width="200",e.canvas.height="100",e.ctx=e.canvas.getContext("2d"),e.value=new Uint8Array(e.arrSize),e.topPartEl.appendChild(e.canvas),e.params={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&It(e,t)}(t,rt),n=t,(i=[{key:"init",value:function(e,n,i,o,r,a,s,l,c){Ot(Tt(t.prototype),"init",this).call(this,e,n,i,o,r,a,s,l,c),this.onOutputClickAudioBound=this.onOutputClickAudio.bind(this),this.onOutputClickDataBound=this.onOutputClickData.bind(this);var u=document.createElement("div");u.className="multiple-outputs",this.bottomPartEl.appendChild(u),this.outputAudio=new Nt(u,this.onOutputClickAudioBound,!1,!1,!1,!1),this.outputData=new Nt(u,this.onOutputClickDataBound,!0,!1,!1,!1),this.outputDataConnections=[],this.outputDataConnectionsLength=0,this.outputs={"analyser-audio":this.outputAudio,"analyser-data":this.outputData},this.inDotPos={"analyser-audio":null,"analyser-data":null}}},{key:"onOutputClickAudio",value:function(e){this.onConnectingCallback(this,e,"analyser-audio")}},{key:"onOutputClickData",value:function(e){this.onConnectingCallback(this,e,"analyser-data")}},{key:"getOutputPos",value:function(e){return{x:this.outputs[e].el.offsetLeft,y:this.outputs[e].el.offsetTop}}},{key:"getOutDotPos",value:function(e,t){return this.inDotPos[t]||(this.inDotPos[t]=this.outputs[t].el.getBoundingClientRect()),this.inDotPos[t]}},{key:"getOutputEl",value:function(e){return this.outputs[e]}},{key:"dispose",value:function(){this.isDisposed||(this.audioNode.disconnect(),this.isDisposed=!0)}},{key:"enableInput",value:function(e){Ot(Tt(t.prototype),"enableInput",this).call(this,e),this.isConnected=!0}},{key:"disableInput",value:function(e){Ot(Tt(t.prototype),"disableInput",this).call(this,e),this.isConnected=!1}},{key:"enableOutput",value:function(e,t){var n=t.outputType;this.outputs[n].enable(),"analyser-data"===n&&(this.outputDataConnections.push(t),this.outputDataConnectionsLength=this.outputDataConnections.length)}},{key:"disableOutput",value:function(e,t,n){"analyser-data"===n?(this.outputDataConnections=this.outputDataConnections.filter(function(e){return e.param.title!==t.title}),this.outputDataConnectionsLength=this.outputDataConnections.length,0===this.outputDataConnectionsLength&&(this.audioValue=0,this.outputs[n].disable())):this.outputs[n].disable()}},{key:"getAudioNode",value:function(){return this.isDisposed&&(this.audioNode=st.a.context.createAnalyser(),this.audioNode.fftSize=this.arrSize,this.isDisposed=!1),this.audioNode}},{key:"getValue",value:function(){return this.isConnected?this.audioValue:0}},{key:"update",value:function(){this.isConnected&&this.audioNode.getByteTimeDomainData(this.value)}},{key:"render",value:function(){var e=this.canvas.width,t=this.canvas.height;this.ctx.clearRect(0,0,e,t),this.ctx.fillStyle="black",this.ctx.strokeStyle="red";var n=0;this.ctx.beginPath();for(var i=0;i<this.arrSize;i++){var o=i/this.arrSize*e,r=(1-this.value[i]/256)*t;n+=1-this.value[i]/256,this.ctx.lineTo(o,r)}if(this.audioValue=100*(n/this.arrSize-.5),this.ctx.stroke(),0!==!this.outputDataConnectionsLength)for(var a=0;a<this.outputDataConnectionsLength;a++){var s=this.outputDataConnections[a].param;this.outputDataConnections[a].in.updateParam(s,this)}}}])&&Pt(n.prototype,i),o&&Pt(n,o),t}();function Lt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var At=function(){function e(t,n,i,o,r,a,s,l){var c=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=r,this.parameter=a,this.decimals=s,this.disable=l,this.value=(i-o.min)/(o.max-o.min),this.settings=o,this.el=document.createElement("div"),this.el.className="node-control node-range";var u=document.createElement("h5");u.innerHTML=n,u.className="node-range-title",this.el.appendChild(u),this.sliderBg=document.createElement("div"),this.sliderBg.className="node-range-slider-bg",this.knobEl=document.createElement("div"),this.knobEl.className="node-range-knob",this.sliderBg.appendChild(this.knobEl),this.el.appendChild(this.sliderBg),this.valueEl=document.createElement("p"),this.valueEl.className="node-range-value",this.valueEl.innerHTML=i,this.el.appendChild(this.valueEl),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),setTimeout(function(){c.setPos(c.sliderBg.clientHeight)},0),this.sliderBg.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"disableSlider",value:function(){this.disable=!0,this.el.style.opacity=.1}},{key:"enableSlider",value:function(){this.disable=!1,this.el.style.opacity=1}},{key:"remove",value:function(){this.sliderBg.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"getValue",value:function(){return this.value*(this.settings.max-this.settings.min)+this.settings.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onMouseDown",value:function(e){if(!this.disable){e.preventDefault(),e.stopPropagation();var t=this.sliderBg.getBoundingClientRect(),n=this.sliderBg.clientHeight,i=1-Math.round(100*(e.y-t.top))/100/n;this.value=i>1?1:i<0?0:i,this.setPos(n),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)),this.parameter),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}}},{key:"onMouseMove",value:function(e){var t=this.sliderBg.getBoundingClientRect(),n=this.sliderBg.clientHeight,i=1-Math.round(100*(e.y-t.top))/100/n;this.value=i>1?1:i<0?0:i,this.setPos(n),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)),this.parameter),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){this.value;var t=this.value*e;this.knobEl.style.height="".concat(t,"px")}}])&&Lt(t.prototype,n),i&&Lt(t,i),e}();function jt(e){return(jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bt(e,t,n){return(Bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ht(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Ht(e){return(Ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ft(e,t){return(Ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var zt=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=Ht(t).call(this))||"object"!==jt(i)&&"function"!=typeof i?Vt(n):i).el.classList.add("no-height"),e.hasConnectedTrigger=!1,e.connectedTriggerID=-1,e.synthParams=[],t.BASE_FREQ=440,t.ROOT=Math.pow(2,1/12),e.isKeyboardListener=!0,e.isSynthOscillator=!0,e.hasAudioInput=!1,e.hasEnvelopeConnection=!1;var o=document.createElement("div");o.className="range-container",e.topPartEl.appendChild(o),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(Vt(e));var r={parentEl:o,title:"Oktav",initValue:-2,settings:{min:-4,max:0},valChangeCallback:e.onRangeChangeCallbackBound,param:"octave",decimals:0,disable:!1};e.octaveRangeSlider=new At(r.parentEl,r.title,r.initValue,r.settings,r.valChangeCallback,r.param,r.decimals,r.disable);var a={useAsInput:!1,value:r.initValue,param:"octave",slider:e.octaveRangeSlider,title:"Octave"},s={useAsInput:!0,param:"trigger",title:"Trigger",helper:Qe.oscillatorTrigger};return e.params[a.param]=a,e.params[s.param]=s,e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ft(e,t)}(t,rt),n=t,(i=[{key:"enableParam",value:function(e,n){Bt(Ht(t.prototype),"enableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!0,this.connectedTriggerID=n.out.ID)}},{key:"disableParam",value:function(e){Bt(Ht(t.prototype),"disableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!1,this.connectedTriggerID=-1)}},{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getParams",value:function(e){e||(e=0);return{}}},{key:"getAudioNode",value:function(){return new st.a.MembraneSynth}},{key:"getFrequency",value:function(e){var n=12*parseInt(this.params.octave.value)+e;return t.BASE_FREQ*Math.pow(t.ROOT,n)}}])&&_t(n.prototype,i),o&&_t(n,o),t}();function Ut(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Gt=function(){function e(t,n,i,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.waves=["sine","sawtooth","square","triangle"],this.parentEl=t,this.onChange=n,this.param=o,this.partialCount=0;var a=document.createElement("h4");a.className="wave-type-label",a.innerHTML=r;var s=document.createElement("div");s.className="wave-type-selector-container",s.appendChild(a);var l=document.createElement("div");l.className="wave-types-container",s.appendChild(l),this.onWaveClickBound=this.onWaveClick.bind(this),this.waveTypeEls=[];for(var c=0;c<this.waves.length;c++){var u=document.createElement("h4");u.className="wave-type",u.innerHTML=this.waves[c],u.setAttribute("data-wave",this.waves[c]),u.addEventListener("click",this.onWaveClickBound),this.waveTypeEls.push(u),l.appendChild(u)}t.appendChild(s)}var t,n,i;return t=e,(n=[{key:"onWaveClick",value:function(e){for(var t=0;t<this.waveTypeEls.length;t++)this.waveTypeEls[t].classList.remove("active");var n=e.target.getAttribute("data-wave");e.target.classList.add("active"),this.onChange(n,this.param)}},{key:"remove",value:function(){for(var e=0;e<this.waveTypeEls.length;e++)this.waveTypeEls[e].removeEventListener("click",this.onWaveClickBound);this.parentEl.removeChild(this.el)}}])&&Ut(t.prototype,n),i&&Ut(t,i),e}();function Yt(e){return(Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Kt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Xt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wt(e,t,n){return(Wt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qt(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function qt(e){return(qt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Jt(e,t){return(Jt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Zt=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=qt(t).call(this))||"object"!==Yt(i)&&"function"!=typeof i?Xt(n):i).el.classList.add("no-height"),e.hasConnectedTrigger=!1,e.connectedTriggerID=-1,e.synthParams=[],t.BASE_FREQ=440,t.ROOT=Math.pow(2,1/12),e.isKeyboardListener=!0,e.isSynthOscillator=!0,e.hasAudioInput=!1,e.hasEnvelopeConnection=!1;var o=document.createElement("div");o.className="range-container";var r=document.createElement("div");r.className="wave-type-container",e.topPartEl.appendChild(r),e.onWaveChangeCallbackBound=e.onWaveChangeCallback.bind(Xt(e)),e.waveTypeSelector=new Gt(r,e.onWaveChangeCallbackBound,"sine","oscillator-type","Oscillator vågtyp"),e.topPartEl.appendChild(o),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(Xt(e));var a={parentEl:o,title:"Oktav",initValue:0,settings:{min:-4,max:4},valChangeCallback:e.onRangeChangeCallbackBound,param:"octave",decimals:0,disable:!1};e.octaveRangeSlider=new At(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var s={useAsInput:!1,value:a.initValue,param:"octave",slider:e.octaveRangeSlider,title:"Octave"},l={useAsInput:!1,value:"sine",param:"oscillator-type",title:"oscillator type",setParam:function(e,t){e.oscillator.type=t}},c={useAsInput:!0,param:"trigger",title:"Trigger",helper:Qe.oscillatorTrigger};return e.params[s.param]=s,e.params[c.param]=c,e.params[l.param]=l,e.synthParams.push(l.param),e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jt(e,t)}(t,rt),n=t,(i=[{key:"enableParam",value:function(e,n){Wt(qt(t.prototype),"enableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!0,this.connectedTriggerID=n.out.ID)}},{key:"disableParam",value:function(e){Wt(qt(t.prototype),"disableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!1,this.connectedTriggerID=-1)}},{key:"onWaveChangeCallback",value:function(e,t){this.params[t].value=e}},{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getParams",value:function(e){e||(e=0);return{}}},{key:"getAudioNode",value:function(){return new st.a.FMSynth}},{key:"getFrequency",value:function(e){var n=12*parseInt(this.params.octave.value)+e;return t.BASE_FREQ*Math.pow(t.ROOT,n)}}])&&Kt(n.prototype,i),o&&Kt(n,o),t}();n(8),n(27),n(29),n(10),n(30),n(11),n(31),n(32),n(33),n(12),n(34),n(35),n(36),n(37),n(38),n(39),n(40),n(41);function Qt(e){return(Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function en(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function tn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nn(e,t,n){return(nn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=on(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function on(e){return(on=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rn(e,t){return(rn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var an=function(e){function t(){var e,n,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(i=on(t).call(this))||"object"!==Qt(i)&&"function"!=typeof i?tn(n):i).params={},e.inputParams={},e.isForegroundNode=!1,e.isBackgroundNode=!1,e.needsMinMax=!1,e.isRendered=!1,e.currentOutConnections=[],e.currentOutConnectionsLength=0,e.el=document.createElement("div"),e.el.className="node",e.inputHelpersType=W.general,e.isGraphicsNode=!0,e.isRenderNode=!1,e.canConnectToMaterial=!1,e.isCanvasNode=!1,e.dotPos=void 0,e.onCanvasResizeBound=e.onCanvasResize.bind(tn(e)),document.documentElement.addEventListener("canvas-resize-event",e.onCanvasResizeBound),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rn(e,t)}(t,B),n=t,(i=[{key:"init",value:function(e,n,i,o,r,a,s,l,c,u,d,h){nn(on(t.prototype),"init",this).call(this,e,n,i,o,r,a,s,l,c,u,d,h)}},{key:"onCanvasResize",value:function(e){var t=$t(e.detail,2);t[0],t[1]}},{key:"onConnectionAdd",value:function(e){if(e.detail.inNodeID===this.ID){var t=e.detail.connection,n=window.NS.singletons.ConnectionsManager.params[t.paramID],i=window.NS.singletons.ConnectionsManager.nodes[t.outNodeID];this.enableParam(n,i)}}},{key:"onConnectionRemove",value:function(e){if(e.detail.inNodeID===this.ID){var t=e.detail.connection,n=window.NS.singletons.ConnectionsManager.params[t.paramID],i=window.NS.singletons.ConnectionsManager.nodes[t.outNodeID];this.disableParam(n,i)}}},{key:"enableParam",value:function(e,t){e.enable(),p[e.param.paramHelpersType].update(this,t,e.param)}},{key:"updateParam",value:function(e,t){p[e.param.paramHelpersType].update(this,t,e.param)}},{key:"disableParam",value:function(e,t){e.disable(),p[e.param.paramHelpersType].disconnect(this,e.param,t)}},{key:"getActiveHelperMesh",value:function(){var e=new THREE.Box3;e.expandByObject(this.mainMesh);var t=e.getSize(),n=new THREE.PlaneBufferGeometry(t.x+.4,t.z+.4,1,1),i=new THREE.ShaderMaterial({uniforms:{},vertexShader:"\n    varying vec3 vUv; \n\n    void main() {\n      vUv = position; \n\n      vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n      gl_Position = projectionMatrix * modelViewPosition; \n    }\n",fragmentShader:"\n    uniform vec3 colorA; \n    uniform vec3 colorB; \n    varying vec3 vUv;\n\n    float circle(vec2 _st, float _radius){\n        vec2 dist = _st-vec2(0.5);\n        return 1.-smoothstep(_radius-(_radius*0.01),\n                _radius+(_radius*0.01),\n                dot(dist,dist)*4.352);\n    }\n\n    void main() {\n        float x = (vUv.x + 2.0 - 1.0) / 2.0;\n        float y = (vUv.y + 2.0 - 1.0) / 2.0;\n        vec2 st = vec2(x, y);\n        vec3 color = vec3(circle(st, 4.8)) - vec3(circle(st, 4.0));\n        gl_FragColor = vec4(color, color.r);\n    }\n"});i.transparent=!0;var o=new THREE.Mesh(n,i);return o.position.y=0,o.scale.set(1.1,1.1,1),o.visible=!1,o}},{key:"onResize",value:function(){}}])&&en(n.prototype,i),o&&en(n,o),t}();function sn(e){return(sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ln(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function cn(e,t){return!t||"object"!==sn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function un(e,t,n){return(un="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=dn(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function dn(e){return(dn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hn(e,t){return(hn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pn=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=cn(this,dn(t).call(this))).isForegroundNode=!0,e.isRendered=!0,e.needsUpdate=!0,e.geometry=new THREE.BoxGeometry(3,3,3,10,10,10),e.material=new THREE.MeshPhongMaterial({});var n=new THREE.Mesh(e.geometry,e.material);e.mesh=new THREE.Group,e.mesh.add(n);new THREE.PlaneBufferGeometry(8,2,10,10),new THREE.MeshBasicMaterial({side:THREE.DoubleSide});var i={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Color",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Material",paramHelpersType:"texture",needsFrameUpdate:!1},colorParam:i,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},rotationXParam:{title:"Rotation x",param:"x",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},scaleParam:{title:"Scale",param:"scale",useAsInput:!0,parent:"Scale",paramHelpersType:"scale",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:0}},e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hn(e,t)}(t,an),n=t,(i=[{key:"init",value:function(e,n,i,o,r,a,s,l,c,u,d,h){un(dn(t.prototype),"init",this).call(this,e,n,i,o,r,a,s,l,c,u,d,h),this.outputDataConnection=null,this.enabledOutputs=[]}},{key:"getMesh",value:function(){return this.mesh}},{key:"update",value:function(){}},{key:"render",value:function(){}}])&&ln(n.prototype,i),o&&ln(n,o),t}();function fn(e){return(fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function vn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function mn(e,t){return!t||"object"!==fn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function yn(e,t,n){return(yn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=bn(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function bn(e){return(bn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wn(e,t){return(wn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Cn=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=mn(this,bn(t).call(this))).isForegroundNode=!0,e.isRendered=!0,e.needsUpdate=!0,e.geometry=new THREE.SphereGeometry(2,32,32),e.material=new THREE.MeshPhongMaterial({});var n=new THREE.Mesh(e.geometry,e.material);e.mainMesh=n,e.mesh=new THREE.Group,e.mesh.add(n);var i=window.innerWidth,o=window.innerHeight;e.camera=new THREE.PerspectiveCamera(70,i/o,.1,100),e.camera.position.set(-1,1,-10),e.mesh.add(e.camera);var r={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Color",paramHelpersType:"color",needsFrameUpdate:!1,defaultConnect:!0};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Texture",paramHelpersType:"texture",needsFrameUpdate:!1,defaultConnect:!0},colorParam:r,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!1},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!0},rotationXParam:{title:"Rotation x",param:"x",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0,defaultConnect:!1},rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0,defaultConnect:!0},scaleParam:{title:"Scale",param:"scale",useAsInput:!0,parent:"Scale",paramHelpersType:"scale",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:1,defaultConnect:!0}},e.paramVals={},e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wn(e,t)}(t,an),n=t,(i=[{key:"init",value:function(e,n,i,o,r,a,s,l,c,u,d,h){yn(bn(t.prototype),"init",this).call(this,e,n,i,o,r,a,s,l,c,u,d,h),this.outputDataConnection=null,this.enabledOutputs=[]}},{key:"onCanvasResize",value:function(e){var t=gn(e.detail,2),n=t[0],i=t[1];this.camera.aspect?this.camera.aspect=n/i:(this.camera.left=n/-2,this.camera.right=n/2,this.camera.top=i/-2,this.camera.bottom=i/2),this.camera.updateProjectionMatrix()}},{key:"getMesh",value:function(){return this.mesh}},{key:"update",value:function(){}},{key:"render",value:function(){}}])&&vn(n.prototype,i),o&&vn(n,o),t}();n(43);function kn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var En=function(){function e(t,n,i,o,r){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=i,this.onInputChangeCallback=r,this.decimals=o,this.el=document.createElement("div"),this.el.className="vertical-range-slider";var s=document.createElement("div");s.className="input-container";var l=document.createElement("p");l.innerHTML="Min",s.appendChild(l),this.inputLowEl=document.createElement("input"),this.inputLowEl.type="number",this.inputLowEl.value=-2,this.inputLowEl.step=1,this.inputLowEl.min=-10,this.inputLowEl.max=1,this.inputLowEl.addEventListener("change",this.onInputChangeCallback),s.appendChild(this.inputLowEl);var c=document.createElement("div");c.className="input-container";var u=document.createElement("p");u.innerHTML="Max",c.appendChild(u),this.inputHighEl=document.createElement("input"),this.inputHighEl.type="number",this.inputHighEl.value=2,this.inputHighEl.step=.1,this.inputHighEl.min=2,this.inputHighEl.max=10,this.inputHighEl.addEventListener("change",this.onInputChangeCallback),c.appendChild(this.inputHighEl),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var d=document.createElement("div");d.appendChild(s),d.appendChild(this.rangeInnerContainer),d.appendChild(c),d.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=this.inputLowEl.value;var h=document.createElement("div");h.className="value-container";var p=document.createElement("p");p.innerHTML="Value",h.appendChild(p),h.appendChild(this.valueEl),this.el.appendChild(d),this.el.appendChild(h),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),this.value=0,setTimeout(function(){a.setPos(100)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"setDefaultValues",value:function(e){var t=e.minMax;this.inputLowEl.value=t.min,this.inputLowEl.min=t.min-20,this.inputLowEl.max=t.max+20,this.inputHighEl.value=t.max,this.inputHighEl.min=t.max-20,this.inputHighEl.max=t.max+20;var n=e.defaultVal;this.setValue(n,!0),this.setPos(100)}},{key:"getMinMaxValue",value:function(){return{min:parseFloat(this.inputLowEl.value),max:parseFloat(this.inputHighEl.value)}}},{key:"remove",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e,t){this.value=e,this.setPos(100);var n=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=n,this.valChangeCallback&&!t&&this.valChangeCallback(n)}},{key:"getValue",value:function(){var e=this.getMinMaxValue();return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.setPos(100),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.setPos(100),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.setPos(100),this.valChangeCallback&&(console.log("val change callback"),this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=e-this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(0px, ".concat(t,"px, 0)")}}])&&kn(t.prototype,n),i&&kn(t,i),e}(),Sn={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}};function xn(e){return(xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Nn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Mn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pn(e,t,n){return(Pn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Dn(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Dn(e){return(Dn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function On(e,t){return(On=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Tn=function(e){function t(e,n){var i,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(r=Dn(t).call(this))||"object"!==xn(r)&&"function"!=typeof r?Mn(o):r).initValues=n?n.data.visualSettings:null,i.isParam=!0,i.returnsSingleNumber=!0,i.needsUpdate=!0,i.title="Param modifier",i.animateValues={isRunning:!1,timestamp:0,duration:0,reqAnimFrame:-1,firstRunOffset:0},i.onRangeValChangeBound=i.onRangeValChange.bind(Mn(i)),i.onInputChangeBound=i.onInputChange.bind(Mn(i)),i.modifier={},i.paramVals={},i.params={},i.updateBound=i.update.bind(Mn(i)),i.getSettings(),i.update(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&On(e,t)}(t,an),n=t,(i=[{key:"onInputChange",value:function(e){this.updateVisualSettings(),this.reset()}},{key:"updateVisualSettings",value:function(){var e=this.verticalRangeSlider.getMinMaxValue(),t=this.verticalRangeSlider.value;this.syncVisualSettings({min:e.min,max:e.max,value:t})}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings param-driver-node";var t=document.createElement("div");if(t.className="slider-row",this.verticalRangeSlider=new En(t,0,this.onRangeValChangeBound,2,this.onInputChangeBound),this.initValues){var n={minMax:{min:this.initValues.min,max:this.initValues.max},defaultVal:this.initValues.value};this.verticalRangeSlider.setDefaultValues(n)}this.durationEl=document.createElement("input"),this.durationEl.type="number",this.durationEl.value=2e3,this.durationEl.step=1,this.durationEl.min=400,this.durationEl.max=1e4,this.durationEl.addEventListener("change",this.onInputChangeBound);var i=document.createElement("div");i.className="duration-container (ms)";var o=document.createElement("p");o.innerHTML="Duration",i.appendChild(o),i.appendChild(this.durationEl);var r=document.createElement("div");r.className="top-bottom-container",r.appendChild(i),this.onToggleStartClickBound=this.onToggleStartClick.bind(this),this.toggleStartBtn=document.createElement("div"),this.toggleStartBtn.className="toggle-start",this.toggleStartBtn.addEventListener("click",this.onToggleStartClickBound),this.toggleBtnText=document.createElement("p"),this.toggleBtnText.innerHTML="Start",this.toggleStartBtn.appendChild(this.toggleBtnText),e.appendChild(t),e.appendChild(r),r.appendChild(this.toggleStartBtn),this.settingsContainer=e}return this.settingsContainer}},{key:"reset",value:function(){this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"}},{key:"onToggleStartClick",value:function(){this.animateValues.isRunning?(this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"):(this.toggleBtnText.innerHTML="Stop",this.animateValues.timestamp=Date.now(),this.animateValues.duration=parseInt(this.durationEl.value),this.animateValues.firstRunOffset=Math.floor(this.verticalRangeSlider.value*this.animateValues.duration),this.animateValues.isReverse=!1,this.animateValues.easing=Sn.linear,this.animateValues.isRunning=!0)}},{key:"getValue",value:function(){return this.verticalRangeSlider?this.verticalRangeSlider.getReadyValue():0}},{key:"update",value:function(){if(this.animateValues.isRunning){var e=Date.now(),t=e-this.animateValues.timestamp+this.animateValues.firstRunOffset,n=this.animateValues.easing(Math.min(t/this.animateValues.duration,1)),i=this.animateValues.isReverse?1-n:n;i>=1?(this.animateValues.timestamp=e,this.animateValues.isReverse=!0,this.animateValues.firstRunOffset=0):i<=0&&(this.animateValues.timestamp=e,this.animateValues.isReverse=!1),this.verticalRangeSlider.setValue(i)}}},{key:"render",value:function(){}},{key:"onRangeValChange",value:function(e){this.updateVisualSettings();for(var t=0;t<this.currentOutConnectionsLength;t++){var n=window.NS.singletons.ConnectionsManager.params[this.currentOutConnections[t].connection.paramID];window.NS.singletons.ConnectionsManager.nodes[this.currentOutConnections[t].inNodeID].updateParam(n,this)}}},{key:"onConnectionAdd",value:function(e){e.detail.connection.outNodeID===this.ID&&(this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length)}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,r=this.currentOutConnections.map(function(e){return e}),a=r.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),s=r.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),l=a.concat(s);this.currentOutConnections=l,this.currentOutConnectionsLength=this.currentOutConnections.length}}},{key:"enableInput",value:function(e){Pn(Dn(t.prototype),"enableInput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),window.cancelAnimationFrame(this.animateValues.reqAnimFrame),Pn(Dn(t.prototype),"removeFromDom",this).call(this)}}])&&Nn(n.prototype,i),o&&Nn(n,o),t}();n(45);function In(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Rn=function(){function e(t,n,i,o,r,a,s,l){var c=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=i,this.height=s||60,this.decimals=o,this.value=(n-r.min)/(r.max-r.min),this.settings=r,this.el=document.createElement("div"),this.el.className="vertical-slider prevent-drag",this.disabledLayer=document.createElement("div"),this.disabledLayer.className="disabled-layer",l&&this.hide(),this.el.appendChild(this.disabledLayer);var u=document.createElement("h4");u.className="vertical-slider-label",u.innerHTML=a,this.el.appendChild(u),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeInnerContainer.style.height="".concat(this.height,"px"),this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var d=document.createElement("div");d.appendChild(this.rangeInnerContainer),d.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=n;var h=document.createElement("div");h.className="value-container",h.appendChild(this.valueEl),this.el.appendChild(d),this.el.appendChild(h),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),setTimeout(function(){c.setPos(c.height)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"hide",value:function(){this.disabledLayer.classList.add("visible")}},{key:"show",value:function(){this.disabledLayer.classList.remove("visible")}},{key:"remove",value:function(){this.rangeInnerContainer.removeEventListener("click",this.onRangeClickBound),this.rangeKnob.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e){this.value=e,this.setPos(this.height);var t=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=t,this.valChangeCallback&&this.valChangeCallback(Number(t))}},{key:"getValue",value:function(){var e=this.settings;return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),i=1-Math.round(100*(e.y-n.top))/100/t;this.value=i>1?1:i<0?0:i,this.setPos(t),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),i=1-Math.round(100*(e.y-n.top))/100/t;this.value=i>1?1:i<0?0:i,this.setPos(t),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),i=1-Math.round(100*(e.y-n.top))/100/t;this.value=i>1?1:i<0?0:i,this.setPos(t),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=e-this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(0px, ".concat(t,"px, 0)")}}])&&In(t.prototype,n),i&&In(t,i),e}();function Ln(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var An=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.toggleVisibilityCallback=n,this.el=document.createElement("div"),this.el.classList.add("visual-helper-settings"),this.parentEl.appendChild(this.el);this.visibilityEnabled=!!i;var o=document.createElement("div");o.classList.add("toggle-visibility-container");var r=document.createElement("h4");r.innerHTML="Toggle visibility",this.toggleVisibilityEl=document.createElement("div"),this.toggleVisibilityEl.classList.add("toggle-visibility"),this.visibilityEnabled&&this.toggleVisibilityEl.classList.add("enabled"),o.appendChild(r),o.appendChild(this.toggleVisibilityEl),this.el.appendChild(o),this.onToggleVisibilityBound=this.onToggleVisibility.bind(this),this.toggleVisibilityEl.addEventListener("click",this.onToggleVisibilityBound)}var t,n,i;return t=e,(n=[{key:"onToggleVisibility",value:function(){this.visibilityEnabled=!this.visibilityEnabled,this.toggleVisibilityCallback(this.visibilityEnabled),this.visibilityEnabled?this.toggleVisibilityEl.classList.add("enabled"):this.toggleVisibilityEl.classList.remove("enabled")}},{key:"enableVisibility",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.visibilityEnabled=!0,this.toggleVisibilityEl.classList.add("enabled"),e&&this.toggleVisibilityCallback(this.visibilityEnabled,t)}},{key:"disableVisibility",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.visibilityEnabled=!1,this.toggleVisibilityEl.classList.remove("enabled"),e&&this.toggleVisibilityCallback(this.visibilityEnabled,t)}}])&&Ln(t.prototype,n),i&&Ln(t,i),e}();n(47);function jn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _n=function(){function e(t,n,i,o,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.classList.add("dropdown"),this.onSelectedCallback=o;var s=document.createElement("div");s.classList.add("upper-row-container");var l=document.createElement("h4");if(l.innerHTML=i,this.title=i,s.appendChild(l),a){this.resetBtn=document.createElement("div"),this.resetBtn.classList.add("reset-btn"),this.resetBtn.classList.add("button"),this.resetBtn.addEventListener("click",a);var c=document.createElement("h5");c.innerHTML="Reset",this.resetBtn.appendChild(c),s.appendChild(this.resetBtn)}this.el.appendChild(s),this.arrowToggleContainer=document.createElement("div"),this.arrowToggleContainer.classList.add("arrow-toggle-container");var u=document.createElement("img");u.src="./assets/arrow-down-yellow.svg",this.arrowToggleContainer.appendChild(u),this.toggleBound=this.toggle.bind(this),this.arrowToggleContainer.addEventListener("click",this.toggleBound),this.listContainer=document.createElement("div"),this.listContainer.classList.add("list-container"),this.selectedContainer=document.createElement("div"),this.selectedContainer.classList.add("selected-container"),this.selectedContainerTitle=document.createElement("h4"),this.selectedContainerTitle.innerHTML="Nothing selected",this.selectedContainer.appendChild(this.selectedContainerTitle),this.el.appendChild(this.selectedContainer),this.el.appendChild(this.listContainer),this.el.appendChild(this.arrowToggleContainer),this.onItemSelectedBound=this.onItemSelected.bind(this),this.el.addEventListener("click",this.onItemSelectedBound),this.createItems(n,r),this.parentEl=t,this.parentEl.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"createItems",value:function(e,t,n){this.domItems={};for(var i=0;i<e.length;i++){var o=document.createElement("div");o.classList.add("list-item"),o.setAttribute("list-id",e[i].ID||"no-id");var r=document.createElement("h4");r.innerHTML=e[i].title,o.appendChild(r),this.listContainer.appendChild(o);var a=document.createElement("div");a.classList.add("touch-layer"),o.appendChild(a),a.setAttribute("data-id",e[i].title),t&&t===e[i].title&&(this.onSelectedCallback(!0,e[i],this.title),o.classList.add("selected"),this.selectedContainerTitle.innerHTML=t),n&&n===e[i].id&&(o.classList.add("selected"),this.selectedContainerTitle.innerHTML=e[i].title),this.domItems[e[i].title]={el:o,item:e[i]}}}},{key:"update",value:function(e,t){for(var n=null;this.listContainer.firstChild;){var i=this.listContainer.firstChild;i.classList.contains("selected")&&(n=i.getAttribute("list-id")),this.listContainer.removeChild(this.listContainer.firstChild)}this.createItems(e,null,t?null:n),t&&(this.selectedContainerTitle.innerHTML="Nothing selected")}},{key:"toggle",value:function(){this.el.classList.contains("open")?this.closeList():this.openList()}},{key:"openList",value:function(){this.el.classList.add("open")}},{key:"closeList",value:function(){this.el.classList.remove("open")}},{key:"onItemSelected",value:function(e){var t=e.target.getAttribute("data-id")||void 0;if(t){this.closeList();for(var n=Object.keys(this.domItems),i=0;i<n.length;i++)this.domItems[n[i]].el.classList.remove("selected");this.domItems[t].el.classList.add("selected"),this.selectedContainerTitle.innerHTML=t,this.onSelectedCallback(!1,this.domItems[t].item,this.title)}}}])&&jn(t.prototype,n),i&&jn(t,i),e}();function Vn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Bn=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onSelectedCallback=n;this.el=document.createElement("div"),this.el.innerHTML='\n            <div class="center-point-settings">\n                <div class="dropdown-container">\n                </div>\n            </div>\n        ';var r=this.el.querySelector(".dropdown-container"),a=this.getNodes();this.dropdown=new _n(r,a,"Nodes",this.onSelectedCallback,i,o),t.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"getNodes",value:function(e){for(var t=[],n=Object.keys(window.NS.singletons.ConnectionsManager.nodes),i=0;i<n.length;i++){var o=window.NS.singletons.ConnectionsManager.nodes[n[i]];o.isModifier||o.ID===e||t.push(o)}return t}},{key:"refresh",value:function(e,t){var n=this.getNodes(e);this.dropdown.update(n,t)}}])&&Vn(t.prototype,n),i&&Vn(t,i),e}();n(49);function Hn(e){return(Hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function zn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Un(e,t,n){return(Un="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Gn(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Gn(e){return(Gn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Yn(e,t){return(Yn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Kn=function(e){function t(e,n){var i,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(r=Gn(t).call(this))||"object"!==Hn(r)&&"function"!=typeof r?zn(o):r).initValues=n?n.data.visualSettings:null,i.needsUpdate=!0,i.title="Orbit modifier",i.hasMesh=!0,i.isForegroundNode=!0,i.hasHelperMeshToHide=!0,i.isParam=!0,i.animateValues={isRunning:!!i.initValues&&i.initValues.isRunning,reqAnimFrame:-1,counter:1552337385540},i.currentT=0,i.currentSpeed=i.initValues&&i.initValues.speed?.001*i.initValues.speed:0,i.onNodeAddedFromConnectionsManagerEventBound=i.onNodeAddedFromConnectionsManagerEvent.bind(zn(i)),i.onNodeRemovedFromConnectionsManagerEventBound=i.onNodeRemovedFromConnectionsManagerEvent.bind(zn(i)),document.documentElement.addEventListener("node-added-event",i.onNodeAddedFromConnectionsManagerEventBound),document.documentElement.addEventListener("node-remove-event",i.onNodeRemovedFromConnectionsManagerEventBound),i.outValues={Position:{x:0,y:0,z:0}},i.targetNode=null,i.onSpeedChangeBound=i.onSpeedChange.bind(zn(i)),i.onOrbitXChangeBound=i.onOrbitXChange.bind(zn(i)),i.onOrbitYChangeBound=i.onOrbitYChange.bind(zn(i)),i.onOrbitZChangeBound=i.onOrbitZChange.bind(zn(i)),i.initCurve(),i.onToggleStartClickBound=i.onToggleStartClick.bind(zn(i)),i.onToggleVisualHelperVisibilityBound=i.onToggleVisualHelperVisibility.bind(zn(i)),i.onCenterPointSelectedBound=i.onCenterPointSelected.bind(zn(i)),i.onConnectionUpdateBound=i.onConnectionUpdate.bind(zn(i)),document.documentElement.addEventListener("node-connections-update",i.onConnectionUpdateBound),i.nodeConnectedID,i.onCenterPointListResetClickBound=i.onCenterPointListResetClick.bind(zn(i)),i.updateAxes(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Yn(e,t)}(t,an),n=t,(i=[{key:"initCurve",value:function(){var e=this.initValues&&this.initValues.orbitX?this.initValues.orbitX:0,t=this.initValues&&this.initValues.orbitY?this.initValues.orbitY:0;this.curve=new THREE.EllipseCurve(0,0,e,t,0,2*Math.PI,!1,0);for(var n=this.curve.getPoints(50),i=new Float32Array(153),o=0,r=0;r<51;r++)i[o++]=n[r].x,i[o++]=0,i[o++]=n[r].y;var a=new THREE.BufferGeometry;this.bufferAttr=new THREE.BufferAttribute(i,3),this.bufferAttr.setDynamic(!0),a.addAttribute("position",this.bufferAttr);var s=new THREE.LineBasicMaterial({color:16711680});this.mesh=new THREE.Line(a,s),this.mesh.visible=!(!this.initValues||!this.initValues.visualHelperEnabled)&&this.initValues.visualHelperEnabled}},{key:"onCenterPointListResetClick",value:function(){if(this.targetNode=null,this.updateVisualSettings(),this.nodeConnectedID){var e=window.NS.singletons.ConnectionsManager.nodes[this.nodeConnectedID];e.mesh.position.x=0,e.mesh.position.y=0,e.mesh.position.z=0}this.curve.aX=0,this.curve.aY=0,this.refreshSettings(!0),this.updateMesh()}},{key:"onConnectionUpdate",value:function(e){var t=this;this.nodeConnectedID=function(e){for(var n=Object.keys(e),i=0;i<n.length;i++)if(e[n[i]].some(function(e){return e.outNodeID===t.ID}))return n[i]}(e.detail)}},{key:"onNodeAddedFromConnectionsManagerEvent",value:function(){this.refreshSettings()}},{key:"onNodeRemovedFromConnectionsManagerEvent",value:function(){this.refreshSettings()}},{key:"hideSettings",value:function(){}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings orbit-driver-node";var t=document.createElement("div");t.className="slider-row";var n=document.createElement("div");n.className="slider-row bottom-container";var i=new Rn(t,this.initValues?this.initValues.orbitX:10,this.onOrbitXChangeBound,0,{min:0,max:40},"Radie X",60,!0),o=new Rn(t,this.initValues?this.initValues.orbitY:10,this.onOrbitYChangeBound,0,{min:0,max:40},"Radie Y",60,!0),r=new Rn(t,this.initValues?this.initValues.orbitY:10,this.onOrbitZChangeBound,0,{min:0,max:40},"Radie Z",60,!0);new Rn(t,this.initValues?this.initValues.speed:0,this.onSpeedChangeBound,4,{min:0,max:10},"Orbit speed");this.orbitSliders={Position:{x:i,y:o,z:r},Form:{x:i,y:o,z:r}},this.visualHelperSettings=new An(n,this.onToggleVisualHelperVisibilityBound,this.initValues&&this.initValues.visualHelperEnabled?this.initValues.visualHelperEnabled:void 0);var a=this.initValues&&this.initValues.targetNode&&window.NS.singletons.ConnectionsManager.nodes[this.initValues.targetNode]?window.NS.singletons.ConnectionsManager.nodes[this.initValues.targetNode].title:null;this.centerPointSettings=new Bn(n,this.onCenterPointSelectedBound,a,this.onCenterPointListResetClickBound),this.toggleStartBtn=document.createElement("div"),this.toggleStartBtn.className="toggle-start",this.toggleStartBtn.addEventListener("click",this.onToggleStartClickBound),this.toggleBtnText=document.createElement("h4"),this.toggleBtnText.innerHTML=this.initValues&&this.initValues.isRunning?"Stop":"Start",this.toggleStartBtn.appendChild(this.toggleBtnText),e.appendChild(t),e.appendChild(n),e.appendChild(this.toggleStartBtn),this.settingsContainer=e}return this.refreshSettings(),this.settingsContainer}},{key:"onOrbitXChange",value:function(e){this.curve.xRadius=e,this.updateVisualSettings()}},{key:"onOrbitYChange",value:function(e){this.curve.yRadius=e,this.updateVisualSettings()}},{key:"onOrbitZChange",value:function(e){this.curve.yRadius=e,this.updateVisualSettings()}},{key:"onSpeedChange",value:function(e){this.currentSpeed=.001*e,this.updateVisualSettings()}},{key:"onToggleVisualHelperVisibility",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.mesh.visible=e,t&&this.updateVisualSettings()}},{key:"onCenterPointSelected",value:function(e,t){this.targetNode=t,e||this.updateVisualSettings()}},{key:"updateVisualSettings",value:function(){this.syncVisualSettings({orbitX:this.curve.xRadius,orbitY:this.curve.yRadius,speed:1e3*this.currentSpeed,isRunning:this.animateValues.isRunning,visualHelperEnabled:this.mesh.visible,targetNode:this.targetNode?this.targetNode.ID:null}),this.updateMesh()}},{key:"reset",value:function(){this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"}},{key:"onToggleStartClick",value:function(e){this.animateValues.isRunning?(this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"):(this.toggleBtnText.innerHTML="Stop",this.animateValues.isRunning=!0),this.updateVisualSettings()}},{key:"getValue",value:function(e){return this.outValues[e.parent][e.param]}},{key:"update",value:function(){if(this.targetNode&&this.nodeConnectedID){var e=this.targetNode.mesh.position,t={x:e.x,y:e.y,z:e.z},n=this.targetNode.nodeType.getEnabledParamsForType("Position",{x:{enabled:!1},y:{enabled:!1},z:{enabled:!1}}),i=0,o=this.curve.getPoint(this.currentT);this.enabledAxes.x?(this.curve.aX=this.targetNode.mesh.position.x,t.x=o.x):this.curve.aX=0,this.enabledAxes.y&&(i=this.targetNode.mesh.position.y,t.y=o.y),this.enabledAxes.z&&(i=this.targetNode.mesh.position.z,t.z=o.y),this.curve.aY=i;var r={};!this.enabledAxes.x&&n.x.enabled&&(r.x=this.targetNode.mesh.position.x),!this.enabledAxes.y&&n.y.enabled&&(r.y=this.targetNode.mesh.position.y),!this.enabledAxes.z&&n.z.enabled&&(r.z=this.targetNode.mesh.position.z);var a=window.NS.singletons.ConnectionsManager.nodes[this.nodeConnectedID];a.mesh.position.x=t.x,a.mesh.position.y=t.y,a.mesh.position.z=t.z,this.updateMesh(r)}else{this.curve.aX=0,this.curve.aY=0;var s=this.curve.getPoint(this.currentT);this.outValues.Position.x=s.x,this.outValues.Position.y=s.y,this.outValues.Position.z=s.y;for(var l=0;l<this.currentOutConnectionsLength;l++){var c=this.currentOutConnections[l],u=window.NS.singletons.ConnectionsManager.nodes[c.inNodeID],d=window.NS.singletons.ConnectionsManager.params[c.connection.paramID];u.updateParam(d,this)}}this.animateValues.isRunning&&(this.currentT=this._calcCurrentT())}},{key:"updateAxes",value:function(){this.enabledAxes={x:!1,y:!1,z:!1};for(var e=0;e<this.currentOutConnectionsLength;e++){var t=this.currentOutConnections[e],n=window.NS.singletons.ConnectionsManager.params[t.connection.paramID];this.enabledAxes[n.param.param]=!0}}},{key:"updateMesh",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.curve.getPoints(50),n=new Float32Array(153),i=0,o=0;o<51;o++)n[i++]=this.enabledAxes.x?t[o].x:e.x||0,n[i++]=this.enabledAxes.y?t[o].y:e.y||0,n[i++]=this.enabledAxes.z?t[o].y:e.z||0;this.bufferAttr.set(n),this.mesh.geometry.attributes.position.needsUpdate=!0}},{key:"render",value:function(){}},{key:"refreshSettings",value:function(e){var t=this;this.centerPointSettings&&this.centerPointSettings.refresh(this.nodeConnectedID,e),this.currentOutConnections.forEach(function(e){var n=e.connection,i=window.NS.singletons.ConnectionsManager.params[n.paramID];i&&t.orbitSliders&&t.orbitSliders[i.param.parent][i.param.param].show()})}},{key:"onConnectionAdd",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection;window.NS.singletons.ConnectionsManager.params[t.paramID];this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength>0&&(this.mesh.visible=!0,this.visualHelperSettings&&this.visualHelperSettings.enableVisibility(),this.updateAxes(),this.updateMesh(),this.refreshSettings())}}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,r=window.NS.singletons.ConnectionsManager.params[t.paramID];this.orbitSliders[r.param.parent][r.param.param].hide();var a=this.currentOutConnections.map(function(e){return e}),s=a.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),l=a.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),c=s.concat(l);this.currentOutConnections=c,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&(this.visualHelperSettings&&this.visualHelperSettings.disableVisibility(),this.reset(),this.mesh.visible=!1),this.updateAxes(),this.updateMesh(),this.refreshSettings()}}},{key:"enableInput",value:function(e){Un(Gn(t.prototype),"enableInput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),window.cancelAnimationFrame(this.animateValues.reqAnimFrame),Un(Gn(t.prototype),"removeFromDom",this).call(this)}},{key:"updateAllowedInputParams",value:function(e){var t=Object.keys(e),n=t.filter(function(t){return e[t].isConnected}),i=t.filter(function(t){return!e[t].isConnected});if(n.length>=2)for(var o=0;o<i.length;o++){var r=i[o];e[r].setConnectionAllowed(!1)}else for(var a=0;a<t.length;a++)e[t[a]].setConnectionAllowed(!0);var s=t.filter(function(t){return"y"===e[t].param.param}),l=t.filter(function(t){return"z"===e[t].param.param});e[s]&&e[l]&&(e[s].isConnected&&e[l].setConnectionAllowed(!1),e[l].isConnected&&e[s].setConnectionAllowed(!1))}},{key:"_calcCurrentT",value:function(){return this.currentT+this.currentSpeed*window.NS.settings.speedModifier}},{key:"currentT",get:function(){return this._currentT},set:function(e){this._currentT=e,this._currentT>1&&(this._currentT=0)}}])&&Fn(n.prototype,i),o&&Fn(n,o),t}();n(51);function Xn(e){return(Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function qn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Jn(e,t,n){return(Jn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Zn(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Zn(e){return(Zn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qn(e,t){return(Qn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var $n=function(e){function t(e,n){var i,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(r=Zn(t).call(this))||"object"!==Xn(r)&&"function"!=typeof r?qn(o):r).initValues=n?n.data.visualSettings:null,i.needsUpdate=!0,i.title="Rotation modifier",i.isParam=!0,i.currentRotationY=i.initValues&&i.initValues.rotationX?i.initValues.rotationX:0,i.currentRotationX=i.initValues&&i.initValues.rotationY?i.initValues.rotationY:0,i.outValues={Rotation:{x:0,y:0}},i.onRotationChangeYBound=i.onRotationChangeY.bind(qn(i)),i.onRotationChangeXBound=i.onRotationChangeX.bind(qn(i)),i.getSettings(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qn(e,t)}(t,an),n=t,(i=[{key:"hideSettings",value:function(){}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings rotation-driver-node";var t=document.createElement("div");t.className="slider-row";var n=new Rn(t,this.initValues?this.initValues.rotationX:0,this.onRotationChangeXBound,3,{min:-.1,max:.1},"Rotation X",60,!0),i=new Rn(t,this.initValues?this.initValues.rotationY:0,this.onRotationChangeYBound,3,{min:-.1,max:.1},"Rotation Y",60,!0);this.rotationSliders={Rotation:{x:n,y:i}},e.appendChild(t),this.settingsContainer=e}return this.settingsContainer}},{key:"onRotationChangeX",value:function(e){this.currentRotationX=e,this.updateVisualSettings()}},{key:"onRotationChangeY",value:function(e){this.currentRotationY=e,this.updateVisualSettings()}},{key:"updateVisualSettings",value:function(){this.syncVisualSettings({rotationX:this.currentRotationX,rotationY:this.currentRotationY})}},{key:"reset",value:function(){}},{key:"getValue",value:function(e){return this.outValues[e.parent][e.param]}},{key:"update",value:function(){this.outValues.Rotation.y+=this.currentRotationY,this.outValues.Rotation.x+=this.currentRotationX;for(var e=0;e<this.currentOutConnectionsLength;e++){var t=this.currentOutConnections[e],n=window.NS.singletons.ConnectionsManager.nodes[t.inNodeID],i=window.NS.singletons.ConnectionsManager.params[t.connection.paramID];n.updateParam(i,this)}}},{key:"render",value:function(){}},{key:"onConnectionAdd",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=window.NS.singletons.ConnectionsManager.params[t.paramID];this.rotationSliders[n.param.parent][n.param.param].show(),this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length}}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,r=window.NS.singletons.ConnectionsManager.params[t.paramID];this.rotationSliders[r.param.parent][r.param.param].hide();var a=this.currentOutConnections.map(function(e){return e}),s=a.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),l=a.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),c=s.concat(l);this.currentOutConnections=c,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&this.reset()}}},{key:"enableInput",value:function(e){Jn(Zn(t.prototype),"enableInput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),Jn(Zn(t.prototype),"removeFromDom",this).call(this)}}])&&Wn(n.prototype,i),o&&Wn(n,o),t}(),ei=n(53);function ti(e){return(ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ni(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ii(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oi(e,t,n){return(oi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ri(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ri(e){return(ri=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ai(e,t){return(ai=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var si=function(e){function t(e,n){var i,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(r=ri(t).call(this))||"object"!==ti(r)&&"function"!=typeof r?ii(o):r).el.classList.add("color-node"),i.title="Color modifier",i.isParam=!0,i.paramVals={},i.params={},n&&n.data&&n.data.visualSettings?i.currentColor=new THREE.Color(n.data.visualSettings.color):i.currentColor=new THREE.Color(1,1,1),i.onPickerChangeBound=i.onPickerChange.bind(ii(i)),i.onColorClickBound=i.onColorClick.bind(ii(i)),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ai(e,t)}(t,an),n=t,(i=[{key:"onConnectionAdd",value:function(e){var n=e.detail;if(this.ID===n.inNodeID)oi(ri(t.prototype),"onConnectionAdd",this).call(this,e.detail);else if(this.ID===n.connection.outNodeID){var i={paramID:n.connection.paramID,outNodeID:n.connection.outNodeID,inNodeID:n.inNodeID},o=window.NS.singletons.ConnectionsManager.params[i.paramID];this.enableOutput(o.param,i)}}},{key:"onConnectionRemove",value:function(e){var n=e.detail;this.ID===n.inNodeID?oi(ri(t.prototype),"onConnectionRemove",this).call(this,e):this.ID===n.connection.outNodeID&&(this.disableOutput(n.connection.paramID),this.currentColor=new THREE.Color(1,1,1))}},{key:"onColorClick",value:function(){this.picker.show()}},{key:"getSettings",value:function(){if(!this.settingsContainer){this.settingsContainer=document.createElement("div"),this.settingsContainer.className="node-settings color-node";var e=document.createElement("h4");e.innerHTML="Välj färg",this.colorPreview=document.createElement("div"),this.colorPreview.className="color-preview",this.settingsContainer.appendChild(e),this.settingsContainer.appendChild(this.colorPreview),this.picker=new ei.a}return this.colorPreview.addEventListener("click",this.onColorClickBound),this.settingsContainer}},{key:"afterSettingsAddedToDom",value:function(){var e={parent:this.settingsContainer,color:this.currentColor?this.currentColor.getStyle():"#FFFFFF",alpha:!1};if(this.picker.setOptions(e),this.picker.onChange=this.onPickerChangeBound,this.currentColor){var t="#".concat(this.currentColor.getHexString());this.setColor(t)}}},{key:"hideSettings",value:function(){this.colorPreview.removeEventListener("click",this.onColorClickBound)}},{key:"onPickerChange",value:function(e){if(e._rgba){var t="rgb(".concat(e._rgba[0],",").concat(e._rgba[1],",").concat(e._rgba[2],")");this.setColor(t),this.currentColor=new THREE.Color(e.rgbString),this.syncVisualSettings({color:e.rgbString});for(var n=0;n<this.currentOutConnectionsLength;n++){var i=this.currentOutConnections[n].paramID,o=this.currentOutConnections[n].inNodeID,r=window.NS.singletons.ConnectionsManager.params[i];window.NS.singletons.ConnectionsManager.nodes[o].updateParam(r,this)}}}},{key:"getValue",value:function(){return this.currentColor}},{key:"setColor",value:function(e){this.colorPreview&&(this.colorPreview.style.background=e)}},{key:"enableOutput",value:function(e,n){if(oi(ri(t.prototype),"enableOutput",this).call(this,e,n),1===this.currentOutConnectionsLength){var i="#".concat(e.defaultVal.getHexString());this.currentColor?i=this.currentColor.getHexString():this.currentColor=e.defaultVal,this.picker&&(this.picker.color=i),this.setColor(i)}}}])&&ni(n.prototype,i),o&&ni(n,o),t}();function li(e){return(li="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ci(e,t){return!t||"object"!==li(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ui(e){return(ui=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function di(e,t){return(di=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var hi=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ci(this,ui(t).call(this))).isLightNode=!0,e.el.classList.add("no-height"),e.light=new THREE.DirectionalLight(16777215,1),e.light.position.set(0,0,0),e.geometry=new THREE.SphereGeometry(1,10,10),e.material=new THREE.MeshBasicMaterial,e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Material",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={colorParam:n,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:4}},e.paramVals={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&di(e,t)}(t,an),t}();function pi(e){return(pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fi(e,t){return!t||"object"!==pi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function gi(e){return(gi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vi(e,t){return(vi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var mi=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=fi(this,gi(t).call(this))).isLightNode=!0,e.isRendered=!0,e.light=new THREE.PointLight(16777215,1,100),e.light.position.set(0,0,0),e.light.castShadow=!0,e.geometry=new THREE.SphereGeometry(2,32,32),e.material=new THREE.MeshBasicMaterial,e.mesh=new THREE.Mesh(e.geometry,e.material),e.mainMesh=e.mesh;var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Color",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Texture",paramHelpersType:"texture",needsFrameUpdate:!1},colorParam:n,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},scaleParam:{title:"Scale",param:"scale",useAsInput:!0,parent:"Scale",paramHelpersType:"scale",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:1}},e.paramVals={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vi(e,t)}(t,an),t}(),yi={Planeter:[{title:"Jorden",name:"space/2k_earth_daymap.jpg"},{title:"Solen",name:"space/2k_sun.jpg"},{title:"Mars",name:"space/2k_mars.jpg"},{title:"Månen",name:"space/2k_moon.jpg"}]};function bi(e){return(bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ci(e){return(Ci=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ki(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ei(e,t){return(Ei=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Si=function(e){function t(e,n){var i,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(r=Ci(t).call(this))||"object"!==bi(r)&&"function"!=typeof r?ki(o):r).initValues=n?n.data.visualSettings:null,i.isBackgroundNode=!0,i.isParam=!0,i.title="Texture Selector",i.hasSelectedTexture=!1,i.onTextureSelectedBound=i.onTextureSelected.bind(ki(i)),i.texture=(new THREE.TextureLoader).load("assets/textures/blank.jpg"),i.texture.magFilter=THREE.LinearFilter,i.texture.minFilter=THREE.LinearFilter,i.params={},i.paramVals={},i.dropdowns={},i.getSettings(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ei(e,t)}(t,an),n=t,(i=[{key:"updateVisualSettings",value:function(e,t){var n,i,o;this.syncVisualSettings((o=e,(i=t)in(n={})?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o,n))}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings texture-selector-node";for(var t=Object.keys(yi),n=0;n<t.length;n++){var i=t[n],o=yi[i],r=this.initValues?this.initValues[i]:null,a=new _n(e,o,i,this.onTextureSelectedBound,r);this.dropdowns[i]=a}this.settingsContainer=e}return this.settingsContainer}},{key:"onTextureSelected",value:function(e,t,n){var i="assets/textures/".concat(t.name);this.texture=(new THREE.TextureLoader).load(i),e||this.updateVisualSettings(t.title,n),this.hasSelectedTexture=!0;for(var o=0;o<this.currentOutConnectionsLength;o++){var r=window.NS.singletons.ConnectionsManager.params[this.currentOutConnections[o].connection.paramID];window.NS.singletons.ConnectionsManager.nodes[this.currentOutConnections[o].inNodeID].updateParam(r,this)}}},{key:"onConnectionAdd",value:function(e){if(e.detail.connection.outNodeID===this.ID&&(this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length,this.hasSelectedTexture)){var t=window.NS.singletons.ConnectionsManager.params[this.currentOutConnections[this.currentOutConnectionsLength-1].connection.paramID];window.NS.singletons.ConnectionsManager.nodes[this.currentOutConnections[this.currentOutConnectionsLength-1].inNodeID].updateParam(t,this)}}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,r=this.currentOutConnections.map(function(e){return e}),a=r.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),s=r.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),l=a.concat(s);this.currentOutConnections=l,this.currentOutConnectionsLength=this.currentOutConnections.length}}}])&&wi(n.prototype,i),o&&wi(n,o),t}();function xi(e){return(xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ni(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Mi(e,t){return!t||"object"!==xi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Pi(e,t,n){return(Pi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Di(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Di(e){return(Di=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oi(e,t){return(Oi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ti=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Mi(this,Di(t).call(this)))._currentAngle=0,e.isForegroundNode=!0,e.needsUpdate=!0,e.isRendered=!0,e.particles=600;var n=THREE.UniformsUtils.merge([THREE.UniformsLib.lights,{diffuse:{type:"c",value:new THREE.Color(255)}}]);e.material=new THREE.ShaderMaterial({uniforms:n,vertexShader:U,fragmentShader:G,depthTest:!0,transparent:!0,vertexColors:!0}),e.geometry=new THREE.BufferGeometry;var i=[],o=[],r=[];e.currentParticleSize=2,e.currentParticleColor=[1,1,1],e.offsets=[];for(var a=0;a<e.particles;a++)i.push(2*Math.random()-1),i.push(2*Math.random()-1),i.push(2*Math.random()-1),o.push(1,1,1),r.push(e.currentParticleSize),e.offsets.push(2*Math.random()-1),e.offsets.push(2*Math.random()-1),e.offsets.push(2*Math.random()-1);e.geometry.addAttribute("position",new THREE.Float32BufferAttribute(i,3).setDynamic(!0)),e.geometry.addAttribute("color",new THREE.Float32BufferAttribute(o,3).setDynamic(!0)),e.geometry.addAttribute("size",new THREE.Float32BufferAttribute(r,1).setDynamic(!0)),e.pointsMesh=new THREE.Points(e.geometry,e.material),e.mainMesh=e.pointsMesh,e.mesh=new THREE.Group,e.mesh.add(e.pointsMesh);var s={title:"Color",param:"color",useAsInput:!0,parent:"Material",paramHelpersType:"particleColor",needsFrameUpdate:!1,defaultVal:new THREE.Color(e.currentParticleColor[0],e.currentParticleColor[1],e.currentParticleColor[2]),defaultConnect:!0},l={title:"Form X",param:"x",useAsInput:!0,parent:"Form",paramHelpersType:"particleForm",needsFrameUpdate:!1,defaultVal:2*Math.random()-1,defaultConnect:!0},c={title:"Form Y",param:"y",useAsInput:!0,parent:"Form",paramHelpersType:"particleForm",needsFrameUpdate:!1,defaultVal:2*Math.random()-1,defaultConnect:!1},u={title:"Form Z",param:"z",useAsInput:!0,parent:"Form",paramHelpersType:"particleForm",needsFrameUpdate:!1,defaultVal:2*Math.random()-1,defaultConnect:!0};e.currentParticleSize;return e.params={colorParam:s,rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0,defaultConnect:!0},formXParam:l,formYParam:c,formZParam:u},e.paramVals={},e.curve=null,e.connectedFormParams={x:0,y:0,z:0},e.isSelected=!1,e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oi(e,t)}(t,an),n=t,(i=[{key:"init",value:function(e,n,i,o,r,a,s,l,c,u,d,h){Pi(Di(t.prototype),"init",this).call(this,e,n,i,o,r,a,s,l,c,u,d,h),this.outputDataConnection=null,this.enabledOutputs=[]}},{key:"onSelected",value:function(){this.isSelected=!0}},{key:"onDeselected",value:function(){this.isSelected=!1}},{key:"getActiveHelperMesh",value:function(){}},{key:"getMesh",value:function(){return this.mesh}},{key:"enableParam",value:function(e,t){e.enable(),"Form"===e.param.parent&&(this.connectedFormParams[e.param.param]=1,this.curve=t.curve),p[e.param.paramHelpersType].update(this,t,e.param)}},{key:"updateParam",value:function(e,t){p[e.param.paramHelpersType].update(this,t,e.param)}},{key:"disableParam",value:function(e,t){var n=this;(e.disable(),"Form"===e.param.parent)&&(this.connectedFormParams[e.param.param]=0,Object.keys(this.connectedFormParams).some(function(e){return n.connectedFormParams[e]>0})||(this.curve=null));p[e.param.paramHelpersType].disconnect(this,e.param,t)}},{key:"update",value:function(){}},{key:"render",value:function(){for(var e=this.geometry.attributes.position.array,t=this.geometry.attributes.size.array,n=this.geometry.attributes.color.array,i=1===this.connectedFormParams.x,o=1===this.connectedFormParams.y,r=1===this.connectedFormParams.z,a=!!this.curve,s=this.params.formXParam.defaultVal,l=this.params.formYParam.defaultVal,c=this.params.formZParam.defaultVal,u=this.isSelected?1:this.currentParticleColor[0],d=this.isSelected?1:this.currentParticleColor[1],h=this.isSelected?1:this.currentParticleColor[2],p=this.isSelected?4:this.currentParticleSize,f=0;f<this.particles;f++){var g=f/this.particles,v=a?this.curve.getPoint(g):void 0,m=3*f;e[m]=i?v.x+this.offsets[m]:s+this.offsets[m],e[m+1]=o?v.y+this.offsets[m+1]:l+this.offsets[m+1],e[m+2]=r?v.y+this.offsets[m+2]:c+this.offsets[m+2],t[f]=p,n[m]=u,n[m+1]=d,n[m+2]=h}this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.size.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0}}])&&Ni(n.prototype,i),o&&Ni(n,o),t}();n(56);function Ii(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ri=function(){function e(t,n,i,o,r,a,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.callback=o;var l=document.createElement("div");l.className="input-setting";var c=document.createElement("h4");c.className="input-label",c.innerHTML="".concat(n),this._name=n;var u=document.createElement("h4");u.className="range",u.innerHTML="Min: ".concat(i.min);var d=document.createElement("h4");d.className="range",d.innerHTML="Max: ".concat(i.max),this.regExp=/^((-)?(0|([1-9][0-9]*))(\.[0-9]+)?)$/,l.appendChild(c),a||(l.appendChild(u),l.appendChild(d)),this.onChangeBound=this.onChange.bind(this),this._callbackOnChange=s,this.el=document.createElement("input"),this.el.type="number",this.el.value=i.value,this.el.step=i.step,this.el.min=i.min,this.el.max=i.max,this.el.addEventListener("input",this.onChangeBound),this.el.addEventListener("click",function(e){e.stopPropagation()}),this.el.addEventListener("blur",function(){console.log("blur")}),this.onApplyBound=this.onApply.bind(this),this.applyBtn=document.createElement("button"),this.applyBtn.innerHTML="OK",this.applyBtn.addEventListener("click",this.onApplyBound),this.applyBtn.classList.add("apply-btn"),this.disabledLayer=document.createElement("div"),this.disabledLayer.className="disabled-layer",r&&this.hide(),l.appendChild(this.el),l.appendChild(this.applyBtn),l.appendChild(this.disabledLayer),t.appendChild(l)}var t,n,i;return t=e,(n=[{key:"onApply",value:function(e){e.stopPropagation();var t=Number(this.el.value);this.applyBtn.classList.remove("not-saved"),this.isValidInput(t)?this.callback(t,this._name):this.el.value=this.el.min}},{key:"isValidInput",value:function(e){return!!this.regExp.test(e)&&!(e<this.el.min||e>this.el.max)}},{key:"onChange",value:function(e){var t=Number(this.el.value);this.applyBtn.classList.add("not-saved"),this.isValidInput(t)?this._callbackOnChange&&this._callbackOnChange(t,this._name):this.el.value=this.el.min}},{key:"setValue",value:function(e){this.el.value=e}},{key:"getValue",value:function(){return this.el.value}},{key:"remove",value:function(){this.el.removeEventListener("change",this.onChangeBound)}},{key:"hide",value:function(){this.disabledLayer.classList.add("visible")}},{key:"show",value:function(){this.disabledLayer.classList.remove("visible")}}])&&Ii(t.prototype,n),i&&Ii(t,i),e}();n(58);function Li(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ai=function(){function e(t,n){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._inputs=new Map,this._inputCallback=this._inputCallback.bind(this),this._onInputApply=this._onInputApply.bind(this),this._applyCallback=t.applyCallback;var o=document.createElement("conversion-inputs");n.appendChild(o),t.inputs.forEach(function(e,n){var r=new Ri(o,e.name,e.inputSettings,i._onInputApply,t.disabled,n>0,i._inputCallback);i._inputs.set(e.name,{input:r,conversionFn:e.conversionFn,isMaster:e.isMaster}),e.isMaster&&(i._masterInput=r)})}var t,n,i;return t=e,(n=[{key:"_onInputApply",value:function(e,t){this._applyCallback(this._masterInput.getValue())}},{key:"_inputCallback",value:function(e,t){var n=!0,i=!1,o=void 0;try{for(var r,a=this._inputs.keys()[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var s=r.value;if(s!==t){var l=this._inputs.get(s);l.input.setValue(l.conversionFn(e))}}}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}}},{key:"setValue",value:function(e){var t=!0,n=!1,i=void 0;try{for(var o,r=this._inputs.values()[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;a.input.setValue(a.conversionFn(e))}}catch(e){n=!0,i=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}}},{key:"getValue",value:function(){return this._masterInput.getValue()}},{key:"show",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,o=this._inputs.values()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value.input.show()}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}},{key:"hide",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,o=this._inputs.values()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value.input.hide()}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}}])&&Li(t.prototype,n),i&&Li(t,i),e}();n(60);function ji(e){return(ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Vi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bi(e,t,n){return(Bi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Hi(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Hi(e){return(Hi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fi(e,t){return(Fi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var zi=function(e){return Math.round((Number(e)+Number.EPSILON)/149.6*100)/100},Ui=function(e){return Math.round(149.6*(e+Number.EPSILON)*10)/10},Gi=function(e){function t(e,n){var i,o,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(r=Hi(t).call(this))||"object"!==ji(r)&&"function"!=typeof r?Vi(o):r).initValues=n?n.data.visualSettings:null,i.needsUpdate=!1,i.title="Shape modifier",i.isForegroundNode=!0,i.isShapeNode=!0,i.isParam=!0,i.onOrbitXChangeBound=i.onOrbitXChange.bind(Vi(i)),i.onOrbitYChangeBound=i.onOrbitYChange.bind(Vi(i)),i.onOrbitZChangeBound=i.onOrbitZChange.bind(Vi(i));var a=i.initValues&&i.initValues.orbitX?i.initValues.orbitX:0,s=i.initValues&&i.initValues.orbitY?i.initValues.orbitY:0;i.curve=new THREE.EllipseCurve(0,0,a,s,0,2*Math.PI,!1,0);for(var l=i.curve.getPoints(50),c=new Float32Array(153),u=0,d=0;d<51;d++)c[u++]=l[d].x,c[u++]=0,c[u++]=l[d].y;return i.updateAxes(),i.getSettings(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fi(e,t)}(t,an),n=t,(i=[{key:"hideSettings",value:function(){}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings shape-modifier-node";var t=document.createElement("div");t.className="slider-row";var n=document.createElement("div");n.className="orbit-slider-group",t.appendChild(n);n.insertAdjacentHTML("afterbegin",'\n\t\t\t\t<div class="orbit-slider-label-group">\n\t\t\t\t\t<h4>Orbit</h4>\n\t\t\t\t\t<h5>Miljoner km</h5>\n\t\t\t\t</div>\n\t\t\t');var i=document.createElement("div");i.className="orbit-inner-slider-group",n.appendChild(i);var o={value:0,step:1e-6,min:0,max:4503},r={name:"X (Miljoner km)",inputSettings:Object.assign({},o,{value:this.initValues?this.initValues.orbitX:o.value}),conversionFn:Ui,isMaster:!0},a={name:"X (Jord Radie)",inputSettings:Object.assign({},o,{step:.1,value:this.initValues?zi(this.initValues.orbitX):zi(o.value)}),conversionFn:zi},s={disabled:!0,hideMinMax:!1,applyCallback:this.onOrbitXChangeBound,inputs:[r,a]},l=new Ai(s,i),c={name:"Y (Miljoner km)",inputSettings:Object.assign({},o,{value:this.initValues?this.initValues.orbitY:o.value}),conversionFn:Ui,isMaster:!0},u={name:"Y (Jord Radie)",inputSettings:Object.assign({},o,{step:.1,value:this.initValues?zi(this.initValues.orbitY):zi(o.value)}),conversionFn:zi},d={disabled:!0,hideMinMax:!1,applyCallback:this.onOrbitYChangeBound,inputs:[c,u]},h=new Ai(d,i),p={name:"Z (Miljoner km)",inputSettings:Object.assign({},o,{value:this.initValues?this.initValues.orbitY:o.value}),conversionFn:Ui,isMaster:!0},f={name:"Z (Jord Radie)",inputSettings:Object.assign({},o,{step:.1,value:this.initValues?zi(this.initValues.orbitY):zi(o.value)}),conversionFn:zi},g={disabled:!0,hideMinMax:!1,applyCallback:this.onOrbitZChangeBound,inputs:[p,f]},v=new Ai(g,i);this.orbitSliders={Form:{x:l,y:h,z:v}},e.appendChild(t),this.settingsContainer=e,this.initValues&&this.initValues.orbitX&&this.onOrbitXChange(this.initValues.orbitX,!1),this.initValues&&this.initValues.orbitY&&this.onOrbitYChange(this.initValues.orbitY,!1)}return this.settingsContainer}},{key:"getOrbitVal",value:function(e,t){var n=(e-0)/4503;return t?800*n:800*n+3*window.NS.singletons.lessons.space.distanceModifier}},{key:"onOrbitXChange",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.curve.xRadius=this.getOrbitVal(e,!0),this.currentXInputVal=e,t&&this.updateVisualSettings()}},{key:"onOrbitYChange",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.curve.yRadius=this.getOrbitVal(e,!0),this.currentYInputVal=e,t&&this.updateVisualSettings()}},{key:"onOrbitZChange",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.curve.yRadius=this.getOrbitVal(e,!0),this.currentYInputVal=e,t&&this.updateVisualSettings()}},{key:"updateVisualSettings",value:function(){this.syncVisualSettings({orbitX:this.orbitSliders.Form.x.getValue(),orbitY:this.currentYInputVal})}},{key:"reset",value:function(){}},{key:"getValue",value:function(e){return this.outValues[e.parent][e.param]}},{key:"update",value:function(){}},{key:"updateAxes",value:function(){this.enabledAxes={x:!1,y:!1,z:!1};for(var e=0;e<this.currentOutConnectionsLength;e++){var t=this.currentOutConnections[e],n=window.NS.singletons.ConnectionsManager.params[t.connection.paramID];this.enabledAxes[n.param.param]=!0}}},{key:"render",value:function(){}},{key:"onConnectionAdd",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=window.NS.singletons.ConnectionsManager.params[t.paramID];this.orbitSliders[n.param.parent][n.param.param].show(),this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength>0&&this.updateAxes()}}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,r=window.NS.singletons.ConnectionsManager.params[t.paramID];this.orbitSliders[r.param.parent][r.param.param].hide();var a=this.currentOutConnections.map(function(e){return e}),s=a.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),l=a.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),c=s.concat(l);this.currentOutConnections=c,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&this.reset(),this.updateAxes()}}},{key:"enableInput",value:function(e){Bi(Hi(t.prototype),"enableInput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),Bi(Hi(t.prototype),"removeFromDom",this).call(this)}},{key:"updateAllowedInputParams",value:function(e){var t=Object.keys(e),n=t.filter(function(t){return e[t].isConnected}),i=t.filter(function(t){return!e[t].isConnected});if(n.length>=2)for(var o=0;o<i.length;o++){var r=i[o];e[r].setConnectionAllowed(!1)}else for(var a=0;a<t.length;a++)e[t[a]].setConnectionAllowed(!0);var s=t.filter(function(t){return"y"===e[t].param.param}),l=t.filter(function(t){return"z"===e[t].param.param});e[s].isConnected&&e[l].setConnectionAllowed(!1),e[l].isConnected&&e[s].setConnectionAllowed(!1)}}])&&_i(n.prototype,i),o&&_i(n,o),t}();function Yi(e){return(Yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ki(e,t){return!t||"object"!==Yi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Xi(e){return(Xi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wi(e,t){return(Wi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qi=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Ki(this,Xi(t).call(this))).needsUpdate=!1,e.mainMesh.castShadow=!0,e.mainMesh.receiveShadow=!0;return e.params={textureParam:{title:"Texture",param:"Planet",useAsInput:!0,parent:"Texture",paramHelpersType:"texture",needsFrameUpdate:!1,defaultConnect:!0},positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"orbitPosition",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"orbitPosition",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!1},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"orbitPosition",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!0},rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0,defaultConnect:!0},sizeParam:{title:"Storlek",param:"Storlek",useAsInput:!0,parent:"Storlek",paramHelpersType:"spaceSize",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:1,defaultConnect:!0}},e.paramVals={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wi(e,t)}(t,Cn),t}();function Ji(e){return(Ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Qi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $i(e,t,n){return($i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=eo(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function eo(e){return(eo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function to(e,t){return(to=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var no=5e4,io=function(e){return Math.round((Number(e)+Number.EPSILON)/6371*100)/100},oo=function(e){return Math.round(6371*(e+Number.EPSILON)*10)/10},ro=function(e){function t(e,n){var i,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(r=eo(t).call(this))||"object"!==Ji(r)&&"function"!=typeof r?Qi(o):r).initValues=n?n.data.visualSettings:null,i.isParam=!0,i.returnsSingleNumber=!0,i.title="Planet storlek",i.isSpaceSize=!0,i.sizeInput=null,i.maxScale=8,i.onInputChangeBound=i.onInputChange.bind(Qi(i)),i.currentConvertedValue=i.initValues&&i.initValues.size?i.getConvertedVal(i.initValues.size):i.getConvertedVal(no),i.getSettings(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&to(e,t)}(t,an),n=t,(i=[{key:"getConvertedVal",value:function(e){return(e-0)/142980*this.maxScale+.01}},{key:"updateVisualSettings",value:function(e){this.syncVisualSettings({size:e})}},{key:"onInputChange",value:function(e){this.currentConvertedValue=this.getConvertedVal(e);for(var t=0;t<this.currentOutConnectionsLength;t++){var n=window.NS.singletons.ConnectionsManager.params[this.currentOutConnections[t].connection.paramID];window.NS.singletons.ConnectionsManager.nodes[this.currentOutConnections[t].inNodeID].updateParam(n,this)}this.updateVisualSettings(e)}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings space-size-node";var t={value:this.initValues&&this.initValues.size?this.initValues.size:no,step:1,min:0,max:142980},n={name:"Storlek (km)",inputSettings:Object.assign({},t,{value:this.initValues?this.initValues.size:no}),conversionFn:oo,isMaster:!0},i={name:"Storlek (Jordens radie)",inputSettings:Object.assign({},t,{step:.1,value:this.initValues?io(this.initValues.size):io(t.value)}),conversionFn:io},o={disabled:!1,hideMinMax:!1,applyCallback:this.onInputChangeBound,inputs:[n,i]};this.sizeInput=new Ai(o,e),this.settingsContainer=e}return this.settingsContainer}},{key:"getValue",value:function(){return 4*this.currentConvertedValue}},{key:"reset",value:function(){this.currentConvertedValue=this.getConvertedVal(no)}},{key:"onConnectionAdd",value:function(e){e.detail.connection.outNodeID===this.ID&&(this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length)}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,r=this.currentOutConnections.map(function(e){return e}),a=r.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),s=r.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),l=a.concat(s);this.currentOutConnections=l,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&this.reset()}}},{key:"removeFromDom",value:function(){this.reset(),$i(eo(t.prototype),"removeFromDom",this).call(this)}}])&&Zi(n.prototype,i),o&&Zi(n,o),t}(),ao={Rymden:[{title:"Solen",name:"space/2k_sun.jpg"},{title:"Månen",name:"space/2k_moon.jpg"},{title:"Merkurius",name:"space/2k_mercury.jpg"},{title:"Venus",name:"space/2k_venus_surface.jpg"},{title:"Jorden",name:"space/2k_earth_daymap.jpg"},{title:"Mars",name:"space/2k_mars.jpg"},{title:"Jupiter",name:"space/2k_jupiter.jpg"},{title:"Saturnus",name:"space/2k_saturn.jpg"},{title:"Uranus",name:"space/2k_uranus.jpg"},{title:"Neptunus",name:"space/2k_neptune.jpg"}]};function so(e){return(so="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function co(e,t){return!t||"object"!==so(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function uo(e){return(uo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ho(e,t){return(ho=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var po=function(e){function t(e,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=co(this,uo(t).call(this,e,n))).title="Planet textur",i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ho(e,t)}(t,Si),n=t,(i=[{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings texture-selector-node";for(var t=Object.keys(ao),n=0;n<t.length;n++){var i=t[n],o=ao[i],r=this.initValues?this.initValues[i]:null,a=new _n(e,o,i,this.onTextureSelectedBound,r);this.dropdowns[i]=a}this.settingsContainer=e}return this.settingsContainer}}])&&lo(n.prototype,i),o&&lo(n,o),t}();n(62);function fo(e){return(fo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function go(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function vo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mo(e,t,n){return(mo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=yo(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function yo(e){return(yo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bo(e,t){return(bo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var wo=function(e){return Math.round((Number(e)+Number.EPSILON)/149.6*100)/100},Co=function(e){return Math.round(149.6*(e+Number.EPSILON)*10)/10},ko=function(e){function t(e,n){var i,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(r=yo(t).call(this,e,n))||"object"!==fo(r)&&"function"!=typeof r?vo(o):r).title="Rymd orbit position",i.isOrbitPosition=!0,i.onCameraChangedBound=i.onCameraChanged.bind(vo(i)),i.onCenterPointListResetClickBound=i.onCenterPointListResetClick.bind(vo(i)),i.animateValues.isRunning=!0,i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bo(e,t)}(t,Kn),n=t,(i=[{key:"initBackendData",value:function(){this.getSettings()}},{key:"onCameraChanged",value:function(e){var t=this;if(this.targetNode){Object.keys(this.enabledAxes).forEach(function(e){"x"===e?t.curve.xRadius=t.getOrbitVal(t.currentXInputVal):t.curve.yRadius=t.getOrbitVal(t.currentYInputVal)});var n=this.getSpeedVal(this.speedInput.getValue()).speed;this.currentSpeed=n+.005}}},{key:"initCurve",value:function(){var e=this.initValues&&this.initValues.orbitX?this.initValues.orbitX:0,t=this.initValues&&this.initValues.orbitY?this.initValues.orbitY:0,n=this.getOrbitVal(e),i=this.getOrbitVal(t);this.currentXInputVal=e,this.currentYInputVal=t;var o=this.initValues&&this.initValues.speed?this.initValues.speed:0;this.currentSpeed=Number(o),this.curve=new THREE.EllipseCurve(0,0,n,i,0,2*Math.PI,!1,0);for(var r=this.curve.getPoints(50),a=new Float32Array(153),s=0,l=0;l<51;l++)a[s++]=r[l].x,a[s++]=0,a[s++]=r[l].y;var c=new THREE.BufferGeometry;this.bufferAttr=new THREE.BufferAttribute(a,3),this.bufferAttr.setDynamic(!0),c.addAttribute("position",this.bufferAttr);var u=new THREE.LineBasicMaterial({color:16711680});this.mesh=new THREE.Line(c,u),this.mesh.visible=!(!this.initValues||!this.initValues.visualHelperEnabled)&&this.initValues.visualHelperEnabled,this.setDistanceToOrigin()}},{key:"setDistanceToOrigin",value:function(){var e=this.curve.getPoint(0),t=new THREE.Vector3(e.x,0,e.y),n=new THREE.Vector3,i=t.distanceToSquared(n);this.currentDistanceToOrigin=i}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings space-orbit-node";var t=document.createElement("div");t.className="slider-row";var n=document.createElement("div");n.className="orbit-slider-group",t.appendChild(n);n.insertAdjacentHTML("afterbegin",'\n\t\t\t\t<div class="orbit-slider-label-group">\n\t\t\t\t\t<h4>Orbit</h4>\n\t\t\t\t\t<h5>Miljoner km</h5>\n\t\t\t\t</div>\n\t\t\t');var i=document.createElement("div");i.className="orbit-inner-slider-group",n.appendChild(i);var o=document.createElement("div");o.className="slider-row";var r=document.createElement("div");r.className="orbit-slider-group",o.appendChild(r);r.insertAdjacentHTML("afterbegin",'\n\t\t\t\t<div class="orbit-slider-label-group">\n\t\t\t\t\t<h4>Hastighet</h4>\n\t\t\t\t\t<h5>1 varv runt center-punkt</h5>\n\t\t\t\t</div>\n\t\t\t');var a=document.createElement("div");a.className="orbit-inner-slider-group",r.appendChild(a);var s=document.createElement("div");s.className="orbit-slider-group",o.appendChild(s);s.insertAdjacentHTML("afterbegin",'\n\t\t\t\t<div class="orbit-slider-label-group">\n\t\t\t\t\t<h4>Center punkt</h4>\n\t\t\t\t\t<h5>Välj center punkt (default Solen)</h5>\n\t\t\t\t</div>\n\t\t\t');var l=document.createElement("div");l.className="orbit-inner-slider-group",s.appendChild(l);var c=this.initValues&&this.initValues.targetNode&&window.NS.singletons.ConnectionsManager.nodes[this.initValues.targetNode]?window.NS.singletons.ConnectionsManager.nodes[this.initValues.targetNode].title:null;this.centerPointSettings=new Bn(l,this.onCenterPointSelectedBound,c,this.onCenterPointListResetClickBound);var u={value:0,step:1e-6,min:0,max:4503},d={name:"X (Miljoner km)",inputSettings:Object.assign({},u,{value:this.initValues?this.initValues.orbitX:u.value}),conversionFn:Co,isMaster:!0},h={name:"X (Jordens omloppsbana)",inputSettings:Object.assign({},u,{step:.1,value:this.initValues?wo(this.initValues.orbitX):wo(u.value)}),conversionFn:wo},p={disabled:!0,hideMinMax:!1,applyCallback:this.onOrbitXChangeBound,inputs:[d,h]},f=new Ai(p,i),g={name:"Y (Miljoner km)",inputSettings:Object.assign({},u,{value:this.initValues?this.initValues.orbitY:u.value}),conversionFn:Co,isMaster:!0},v={name:"Y (Jordens omloppsbana)",inputSettings:Object.assign({},u,{step:.1,value:this.initValues?wo(this.initValues.orbitY):wo(u.value)}),conversionFn:wo},m={disabled:!0,hideMinMax:!1,applyCallback:this.onOrbitYChangeBound,inputs:[g,v]},y=new Ai(m,i),b={name:"Z (Miljoner km)",inputSettings:Object.assign({},u,{value:this.initValues?this.initValues.orbitY:u.value}),conversionFn:Co,isMaster:!0},w={name:"Z (Jordens omloppsbana)",inputSettings:Object.assign({},u,{step:.1,value:this.initValues?wo(this.initValues.orbitY):wo(u.value)}),conversionFn:wo},C={disabled:!0,hideMinMax:!1,applyCallback:this.onOrbitZChangeBound,inputs:[b,w]},k=new Ai(C,i);this.initValues&&this.initValues.orbitX&&(this.currentXInputVal=this.initValues.orbitX),this.initValues&&this.initValues.orbitY&&(this.currentYInputVal=this.initValues.orbitY),this.speedDefaultSettings={value:this.initValues?this.initValues.speed:0,step:.1,min:0,max:60255},this.speedInput=new Ri(a,"Hastighet (dagar)",this.speedDefaultSettings,this.onSpeedChangeBound,!1),this.orbitSliders={Position:{x:f,y:y,z:k},Form:{x:f,y:y,z:k}},e.appendChild(t),e.appendChild(o),this.settingsContainer=e}return this.refreshSettings(),this.settingsContainer}},{key:"updateVisualSettings",value:function(){this.syncVisualSettings({orbitX:this.orbitSliders.Position.x.getValue(),orbitY:this.currentYInputVal,speed:this.speedInput.getValue(),isRunning:this.animateValues.isRunning,visualHelperEnabled:this.mesh.visible,targetNode:this.targetNode?this.targetNode.ID:null}),this.updateMesh()}},{key:"onCenterPointSelected",value:function(e,t){this.targetNode=t,e||this.updateVisualSettings()}},{key:"onCenterPointListResetClick",value:function(){if(this.targetNode&&window.NS.singletons.LessonManager.space.removePlanetToCheckDistance(this.targetNode),this.targetNode=null,this.updateVisualSettings(),this.nodeConnectedID){var e=window.NS.singletons.ConnectionsManager.nodes[this.nodeConnectedID];e.mesh.position.x=0,e.mesh.position.y=0,e.mesh.position.z=0}this.curve.aX=0,this.curve.aY=0,this.refreshSettings(!0),this.updateMesh()}},{key:"getSpeedVal",value:function(e){if(!this.currentXInputVal||e<=0)return{speed:0,kmHSpeed:0};var t=2*Math.PI*this.currentXInputVal;return{speed:t/e/3e3,kmHSpeed:t/(24*e)*1e6}}},{key:"getOrbitVal",value:function(e,t){var n=(e-0)/4503;return t?800*n:800*n+3*window.NS.singletons.lessons.space.distanceModifier}},{key:"onOrbitXChange",value:function(e){this.curve.xRadius=this.getOrbitVal(e,!0),this.currentXInputVal=e,this.updateVisualSettings(),this.setDistanceToOrigin()}},{key:"onOrbitYChange",value:function(e){this.curve.yRadius=this.getOrbitVal(e,!0),this.currentYInputVal=e,this.updateVisualSettings(),this.setDistanceToOrigin()}},{key:"onOrbitZChange",value:function(e){this.curve.yRadius=this.getOrbitVal(e,!0),this.currentYInputVal=e,this.updateVisualSettings(),this.setDistanceToOrigin()}},{key:"onSpeedChange",value:function(e){this.currentSpeed=Number(e),this.updateVisualSettings()}},{key:"update",value:function(){mo(yo(t.prototype),"update",this).call(this)}},{key:"reset",value:function(){this.animateValues.isRunning=!1,this.currentSpeed=0,this.orbitSliders.Position.x.setValue(0),this.orbitSliders.Position.y.setValue(0),this.orbitSliders.Position.z.setValue(0),this.speedInput.setValue(0),this.curve.xRadius=0,this.currentXInputVal=0,this.curve.yRadius=0,this.currentYInputVal=0,this.nodeConnectedID=null,this.setDistanceToOrigin(),this.onCenterPointListResetClick()}},{key:"_calcCurrentT",value:function(){return this.currentSpeed>0?window.NS.singletons.LessonManager.space.spaceTimeController.getNormalizedPositionInYear(this.currentSpeed):0}},{key:"currentT",get:function(){return this._currentT},set:function(e){this._currentT=e}}])&&go(n.prototype,i),o&&go(n,o),t}();function Eo(e){return(Eo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function So(e,t){return!t||"object"!==Eo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xo(e){return(xo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function No(e,t){return(No=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Mo=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=So(this,xo(t).call(this))).light.distance=0;return e.params={textureParam:{title:"Texture",param:"Planet",useAsInput:!0,parent:"Texture",paramHelpersType:"texture",needsFrameUpdate:!1,defaultConnect:!0},positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"orbitPosition",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"orbitPosition",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!1},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"orbitPosition",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,defaultConnect:!0},rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0,defaultConnect:!0},sizeParam:{title:"Storlek",param:"Storlek",useAsInput:!0,parent:"Storlek",paramHelpersType:"spaceSize",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:1,defaultConnect:!0}},e.paramVals={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&No(e,t)}(t,mi),t}();function Po(e){return(Po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Do(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Oo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function To(e,t,n){return(To="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Io(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Io(e){return(Io=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ro(e,t){return(Ro=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Lo=2*Math.PI,Ao=function(e){function t(e,n){var i,o,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(r=Io(t).call(this))||"object"!==Po(r)&&"function"!=typeof r?Oo(o):r).initValues=n?n.data.visualSettings:null,i.needsUpdate=!0,i.title="Planet rotation",i.isParam=!0;var a=i.initValues&&i.initValues.rotationY;return i.currentRotationY=a?i.initValues.rotationY:0,i.outValues={Rotation:{y:0}},i.onInputChangeBound=i.onInputChange.bind(Oo(i)),i.getSettings(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ro(e,t)}(t,an),n=t,(i=[{key:"hideSettings",value:function(){}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings rotation-driver-node";var t=document.createElement("div");t.className="slider-row";var n={value:this.initValues?this.initValues.rotationY:1,step:1,min:0,max:2e4},i=new Ri(t,"Rotation (Timmar)",n,this.onInputChangeBound);this.rotationSliders={Rotation:{y:i}},e.appendChild(t),this.settingsContainer=e}return this.settingsContainer}},{key:"onInputChange",value:function(e){this.currentRotationY=e,this.updateVisualSettings()}},{key:"updateVisualSettings",value:function(){this.syncVisualSettings({rotationY:this.currentRotationY})}},{key:"reset",value:function(){this.outValues.Rotation.y=0,this.rotationSliders.Rotation.y.setValue(0),this.currentRotationY=0}},{key:"getValue",value:function(e){return this.outValues[e.parent][e.param]}},{key:"update",value:function(){if(this.currentRotationY>0){var e=window.NS.singletons.LessonManager.space.spaceTimeController.getNormalizedCurrentHourInDay(this.currentRotationY/24)*Lo;Math.round(1e3*(e+Number.EPSILON));this.outValues.Rotation.y=-Math.round(1e3*(e+Number.EPSILON))/1e3}else this.outValues.Rotation.y=0;for(var t=0;t<this.currentOutConnectionsLength;t++){var n=this.currentOutConnections[t],i=window.NS.singletons.ConnectionsManager.nodes[n.inNodeID],o=window.NS.singletons.ConnectionsManager.params[n.connection.paramID];i.updateParam(o,this)}}},{key:"render",value:function(){}},{key:"onConnectionAdd",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection;window.NS.singletons.ConnectionsManager.params[t.paramID];this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length}}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,r=(window.NS.singletons.ConnectionsManager.params[t.paramID],this.currentOutConnections.map(function(e){return e})),a=r.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),s=r.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),l=a.concat(s);this.currentOutConnections=l,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&this.reset()}}},{key:"enableInput",value:function(e){To(Io(t.prototype),"enableInput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),To(Io(t.prototype),"removeFromDom",this).call(this)}}])&&Do(n.prototype,i),o&&Do(n,o),t}();function jo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _o=function(){function e(t,n,i,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._angle=t,this.overridedAngle,this._radius=n,this._allowConnectionMove=r,this.positions=i,this.color=new THREE.Color(1,0,1).getHex();var a=new THREE.CircleGeometry(1,10),s=new THREE.MeshBasicMaterial({color:this.color});this.mesh=new THREE.Mesh(a,s);var l=t*(Math.PI/180),c=(n+5)*Math.cos(l),u=(n+5)*Math.sin(l);this.mesh.position.x=c,this.mesh.position.y=u,this.currentDistance=Number.MAX_SAFE_INTEGER,this.hideMesh()}var t,n,i;return t=e,(n=[{key:"overrideAngle",value:function(e){this.overridedAngle=e}},{key:"setRadius",value:function(e){var t=this.angleRadian,n=e*Math.cos(t),i=e*Math.sin(t);this.mesh.position.x=n,this.mesh.position.y=i}},{key:"hideMesh",value:function(){this.mesh.visible=!1}},{key:"showMesh",value:function(){this.mesh.visible=!0}},{key:"resetConnecting",value:function(){this.setDistance(20),this.hideMesh()}},{key:"setDistance",value:function(e){this.currentDistance=e;var t=Math.min(e,20),n=Math.min(Math.max(.2*(20-t),.1),4);this.mesh.scale.set(n,n,n)}},{key:"allowConnectionMove",get:function(){return this._allowConnectionMove}},{key:"visualAngle",get:function(){return this.overridedAngle?this.overridedAngle:this._angle}},{key:"angle",get:function(){return this._angle}},{key:"radius",get:function(){return this._radius}},{key:"angleRadian",get:function(){return this._angle*(Math.PI/180)}},{key:"positions",get:function(){return this._positions},set:function(e){this._positions=e}}])&&jo(t.prototype,n),i&&jo(t,i),e}(),Vo="onAtomConnectionUpdate",Bo="onOrbitalPositionsUpdate";function Ho(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Fo(e,t,n){return(Fo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=zo(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function zo(e){return(zo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Uo=function(e,t){return e%t*(360/t)+90},Go=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.title="AtomCircle",this.index=i,this.atomEl=o,this.positions={},this.ringDef=n,this.radius=t;for(var r=0;r<n.amountElectrons;r++){var a=this.getElectronPosition({x:0,y:0},r),s=Uo(r,n.orbitalPositions);this.positions[r]={available:!0,position:a,orbitalAngle:s}}this.orbitals=[];for(var l=this.ringDef.orbitalPositions,c=0;c<l;c++){var u=Uo(c,l),d=this.getPositionsForOrbital(u),h=new _o(u,t,d,this.index>0,this.ringDef.allowElectronAngleMove);this.orbitals.push(h)}this.highlightColor=new THREE.Color(245/255,244/255,225/255).getHex(),this.defaultColor=new THREE.Color(250/255,75/255,75/255).getHex(),this.connectedColor=new THREE.Color(152/255,235/255,169/255).getHex(),this.initCurve(t)}var t,n,i;return t=e,(n=[{key:"initCurve",value:function(e){for(var t,n,i,o,r,a,s,l,c,u=(a=pe(t=10,n=0,i=0,-(o=e),r=e),s=pe(t,n,i,o,r,!0),l=pe(t,n,i,o,-r),c=pe(t,n,i,-o,-r,!0),[].concat(J(s),J(l),J(c),J(a))),d=0,h=u.length,p=new Float32Array(3*h),f=0;f<h;f++)p[d++]=u[f].x,p[d++]=u[f].y,p[d++]=0;this.geometry=new THREE.BufferGeometry,this.bufferAttr=new THREE.BufferAttribute(p,3),this.geometry.addAttribute("position",this.bufferAttr),this.material=new THREE.LineBasicMaterial({transparent:!0,color:this.defaultColor,opacity:1}),this.material.userData.toggleSelected=!0,this.mesh=new THREE.Group,this.ringMesh=new THREE.Line(this.geometry,this.material),this.mesh.add(this.ringMesh);for(var g=0;g<this.orbitals.length;g++)this.mesh.add(this.orbitals[g].mesh);this.mesh.visible=!1}},{key:"totalAmountPositions",value:function(){return this.ringDef.amountElectrons}},{key:"getOrbitalForAngle",value:function(e){return this.orbitals.find(function(t){return t.angle===e})}},{key:"setHighlighted",value:function(){this.material.color.setHex(this.highlightColor)}},{key:"setDefault",value:function(){this.material.color.setHex(this.defaultColor)}},{key:"markPositionAsTaken",value:function(e){var t=this;this.positions[e]=Object.assign({},this.positions[e],{available:!1});var n=this.getOrbitalFromPositionKey(e),i=!n.positions.some(function(e){return t.positions[e].available}),o=new CustomEvent(Bo,{detail:{isFull:i,orbital:n,ringIndex:this.index}});this.atomEl.dispatchEvent(o)}},{key:"markPositionAsAvailable",value:function(e){var t=this;this.positions[e]=Object.assign({},this.positions[e],{available:!0});var n=this.getOrbitalFromPositionKey(e),i=!n.positions.some(function(e){return t.positions[e].available}),o=new CustomEvent(Bo,{detail:{isFull:i,orbital:n,ringIndex:this.index}});this.atomEl.dispatchEvent(o)}},{key:"getAvailableElectronPosition",value:function(e){var t=this.getAvailablePositionKeys()[0];if(!t)return{key:void 0,pos:void 0};var n=this.positions[t],i=new THREE.Vector2,o=n.position,r=n.orbitalAngle;return i.x=o.x+e.x,i.y=o.y+e.y,this.markPositionAsTaken(t),{key:t,pos:i,orbitalAngle:r}}},{key:"getConnectedElectronPosition",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(void 0!==n){var i=n*(Math.PI/180),o=e.x+this.radius*Math.cos(i),r=e.y+this.radius*Math.sin(i);return new THREE.Vector2(o,r)}return this.getElectronPosition(e,t)}},{key:"getElectronPosition",value:function(e,t){var n,i,o,r=this.ringDef.orbitalPositions,a=(o=(n=t)>=(i=r)?5:-5,Uo(n,i)-o)*(Math.PI/180),s=e.x+this.radius*Math.cos(a),l=e.y+this.radius*Math.sin(a);return new THREE.Vector2(s,l)}},{key:"getNotCompleteOrbitals",value:function(){var e=this,t=[];return this.orbitals.forEach(function(n){var i=n.positions.filter(function(t){return e.positions[t].available});1===i.length&&t.push({orbital:n,availablePositionKey:i[0]})}),t}},{key:"getOrbitalFromPositionKey",value:function(e){return this.orbitals.find(function(t){return t.positions.some(function(t){return t===e.toString()})})}},{key:"remove",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"update",value:function(){}},{key:"render",value:function(){}},{key:"removeFromDom",value:function(){this.reset(),Fo(zo(e.prototype),"removeFromDom",this).call(this)}},{key:"getAvailablePositionKeys",value:function(){var e=this;return Object.keys(this.positions).filter(function(t){return e.positions[t].available})}},{key:"getPositionsForOrbital",value:function(e){var t=this;return Object.keys(this.positions).filter(function(n){return t.positions[n].orbitalAngle===e})}},{key:"isFull",get:function(){var e=this;return 0===Object.keys(this.positions).filter(function(t){return e.positions[t].available}).length}}])&&Ho(t.prototype,n),i&&Ho(t,i),e}();function Yo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ko=function(e,t){return t.connectingAtom.id!==e?t.connectingAtom:t.dragAtom},Xo=function(e,t){return window.NS.singletons.LessonManager.atomConnectionsManager.findConnections(e).filter(function(e){var n=window.NS.singletons.LessonManager.atomConnectionsManager.getConnection(e);return![n.connectingAtom.id,n.dragAtom.id].includes(t)}).map(function(e){return window.NS.singletons.LessonManager.atomConnectionsManager.getConnection(e)})},Wo=function(e,t){var n=window.NS.singletons.ConnectionsManager.getNode(t.id),i=e.distanceTo(n.position),o=ce(le(e,n.position)),r=[],a=window.NS.singletons.ConnectionsManager.getConnectedNodeWithType(t.id,"electrons");a&&(r=a.getConnectedElectrons());var s=ue(e,o,i);return s.sub(e),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){Yo(e,t,n[t])})}return e}({},t,{baseOffset:s,connectedElectrons:r})},qo=function(e){var t,n=window.NS.singletons.ConnectionsManager.getNode(e).position;return function e(t,i,o){if(0===i.length)return o;for(var r=0;r<i.length;r++){var a=i[r],s=Ko(t,a),l=Wo(n,s);o.push(l),o.concat(e(s.id,Xo(s.id,t),o))}return o}(e,(t=e,window.NS.singletons.LessonManager.atomConnectionsManager.findConnections(t).map(function(e){return window.NS.singletons.LessonManager.atomConnectionsManager.getConnection(e)})),[])};function Jo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Zo=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.object=t,this.finalPosition=n,this.startPosition=new THREE.Vector2(t.position.x,t.position.y),this.finishedCallback=i,this.currentPosition=this.startPosition.clone(),this.targetPosition=n.clone(),this.updateBound=this.update.bind(this),this.renderBound=this.render.bind(this),this.reqframe=-1,this.update()}var t,n,i;return t=e,(n=[{key:"update",value:function(){var e=this.targetPosition.x-this.currentPosition.x,t=this.targetPosition.y-this.currentPosition.y;Math.abs(e)>.05||Math.abs(t)>.05?this.reqframe=window.requestAnimationFrame(this.updateBound):this.finishedCallback&&this.finishedCallback(),this.currentPosition.x+=.1*e,this.currentPosition.y+=.1*t,this.render()}},{key:"render",value:function(){this.object.position.x=this.currentPosition.x,this.object.position.y=this.currentPosition.y,this.object.position.z=0}}])&&Jo(t.prototype,n),i&&Jo(t,i),e}();function Qo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var $o=function(){function e(t,n,i,o,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.object=t,this.radius=o,this.center=r,this.finishedCallback=a,this.currentAngle=n,this.targetAngle=i,this.updateBound=this.update.bind(this),this.renderBound=this.render.bind(this),this.reqframe=-1,this.update()}var t,n,i;return t=e,(n=[{key:"update",value:function(){var e=this.targetAngle-this.currentAngle;Math.abs(e)>.05?this.reqframe=window.requestAnimationFrame(this.updateBound):this.finishedCallback&&this.finishedCallback(),this.currentAngle+=.1*e,this.render()}},{key:"render",value:function(){var e=Math.PI/180*this.currentAngle,t=ue(this.center,e,this.radius);this.object.position.x=t.x,this.object.position.y=t.y,this.object.position.z=0}}])&&Qo(t.prototype,n),i&&Qo(t,i),e}(),er=function(e,t,n,i){window.NS.singletons.LessonManager.atomRulesManager;var o={isConnected:window.NS.singletons.LessonManager.atomConnectionsManager.hasConnections(e)},r=function(e){var t=function(e){var t=window.NS.singletons.ConnectionsManager.getNode(e).outerRing,n=window.NS.singletons.ConnectionsManager.getConnectedNodeWithType(e,"electrons");if(n){var i=n.getConnectedElectrons();return{notCompleteOrbitals:t.getNotCompleteOrbitals(),connectedElectrons:i}}return{}}(e),n=t.notCompleteOrbitals,i=t.connectedElectrons;return{notCompleteOrbitals:n,connectedElectrons:void 0===i?[]:i}},a=r(e);if(a.connectedAtoms=qo(e),o.connectedElectrons=a.connectedElectrons,a.notCompleteOrbitals&&a.notCompleteOrbitals.length>0){var s=window.NS.singletons.ConnectionsManager.getNodesWithType(t,e),l={};(s||[]).forEach(function(e){var t=r(e.ID).notCompleteOrbitals;t&&t.length>0&&(t.forEach(function(e){e.orbital.showMesh()}),l[e.ID]={notCompleteOrbitals:t,atom:e})});o.connectionData=l,o.draggingAtomData=a}else o.connectionData={},o.draggingAtomData=a;return o};function tr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var nr=1e3,ir=function(){function e(t,n,i,o){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onDisconnectCallback=t,this.hideMesh=i,this.progressMesh=o,setTimeout(function(){r.progressMesh.visible=!0,r.hideMesh.material.opacity=0,r.reqframe=window.requestAnimationFrame(r.onUpdateBound)},100),this.hasDisconnected=!1,this.startPosition=n.clone(),this.timeout=setTimeout(function(){r.hasDisconnected=!0,r.reset(),r.onDisconnectCallback()},nr),this.onUpdateBound=this.onProgressUpdate.bind(this),this.startTime=performance.now()}var t,n,i;return t=e,(n=[{key:"onProgressUpdate",value:function(){this.reqframe=window.requestAnimationFrame(this.onUpdateBound);var e=performance.now()-this.startTime,t=Math.max(1-e/nr,0);this.progressMesh.scale.set(t,t,1)}},{key:"reset",value:function(){this.progressMesh.visible=!1,this.progressMesh.scale.set(1,1,1),this.hideMesh.material.opacity=1,cancelAnimationFrame(this.reqframe)}},{key:"onMove",value:function(e){e.distanceTo(this.startPosition)>1&&(this.reset(),clearTimeout(this.timeout))}},{key:"onEnd",value:function(){this.reset(),clearTimeout(this.timeout)}}])&&tr(t.prototype,n),i&&tr(t,i),e}();function or(e){return(or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ar(e,t){return!t||"object"!==or(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function sr(e){return(sr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lr(e,t){return(lr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function cr(e){return(cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ur(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function dr(e,t){return!t||"object"!==cr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function hr(e){return(hr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pr(e,t){return(pr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var fr={AtomDragEvents:function(e){return function(t){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),ar(this,sr(n).apply(this,arguments))}var i,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lr(e,t)}(n,e),i=n,(o=[{key:"onDragStart",value:function(e){var t=e.object;if(this.foregroundRender.disableCameraControls(),function e(t,n,i){return t.parent&&!i?function(e,t){return e.userData&&e.userData.nodeID===t}(t.parent,n)?e(t,n,!0):e(t.parent,n,!1):i}(t,this.ID,!1)){if(this.foregroundRender.dragControls.addEventListener("drag",this.onDragBound),this.foregroundRender.dragControls.addEventListener("dragend",this.onDragEndBound),Q(t)){this.dragData=Object.assign({},this.dragData,function(e,t,n){var i={},o=window.NS.singletons.ConnectionsManager.getConnectedNodeWithType(e,"electrons");i.centerPoint={};var r=o.getElectron(n.userData.ID);return i.electronObj=r,i.centerPoint.x=t.x,i.centerPoint.y=t.y,i}(this.ID,this.position,t));var n=new CustomEvent("node-selected",{detail:this});document.documentElement.dispatchEvent(n)}$(t)&&(this.dragData=Object.assign({},this.dragData,er(this.ID,this.type,this.position,this.outerRing)),this.dragData.isConnected&&(this.disconnectHandler=new ir(this.atomDisconnectCallback,t.position,this.circleDragMesh,this.disconnectProgressMesh)))}}},{key:"onDrag",value:function(e){var t=e.object;Q(t)&&(this.dragData=Object.assign({},this.dragData,function(e,t,n){for(var i={},o=n.centerPoint,r=le(e.position,o),a=t.length,s=0;s<a;s++){var l=t[s];if(!l.isFull){var c=de(o,l,r),u=new THREE.Vector2(e.position.x,e.position.y);c.distanceTo(u)<1?(i.ringToReleaseOn=l,i.releasePoint=c,l.setHighlighted()):(n.ringToReleaseOn&&n.ringToReleaseOn.index===l.index&&(i.ringToReleaseOn=null,i.releasePoint=null),l.setDefault())}}return i}(t,this.visibleRings,this.dragData))),$(t)&&(this.dragData=Object.assign({},this.dragData,function(e,t){var n=t.dragData,i=t.position,o=t.outerRing,r=t.rings,a=(t.ID,t.debugMesh,Object.keys(n.connectionData)),s=n.draggingAtomData,l=i,c=o;return a.forEach(function(e){var t=n.connectionData[e],i=t.notCompleteOrbitals,o=t.atom.position;i.forEach(function(e){var t=e.orbital,n=(e.availablePositionKey,t.angleRadian),i=t.radius+c.radius;t.setRadius(i);var r=ue(o,n,i).distanceTo(l);t.setDistance(r)})}),s.connectedElectrons.forEach(function(t){var n=r[t.getRingIndex()].getConnectedElectronPosition(e.position,t.ringPositionKey,t.overrideConnectionAngle);t.position=n}),s.connectedAtoms.forEach(function(t){var n=window.NS.singletons.ConnectionsManager.getNode(t.id),i=e.position.clone().add(t.baseOffset);n.position=i,t.connectedElectrons.forEach(function(e){var t=n.rings[e.getRingIndex()].getConnectedElectronPosition(i,e.ringPositionKey,e.overrideConnectionAngle);e.mesh.position.set(t.x,t.y,0)})}),{}}(t,this)),this.dragData.isConnected&&this.disconnectHandler.onMove(t.position)),t.position.z=0}},{key:"onDragEnd",value:function(e){var t=e.object,n=this.dragData,i=(n.releasePoint,n.ringToReleaseOn),o=(n.atomToConnect,n.electronObj);if(Q(t)){!function(e,t,n,i,o){if(e){var r=e.getAvailableElectronPosition(i),a=r.key,s=r.pos,l=r.orbitalAngle;a&&(t.setConnectionStatus(e.index),t.ringPositionKey=a,t.orbitalAngle=l,e.markPositionAsTaken(a),new Zo(o,s),e.setDefault())}else{var c=n[t.getRingIndex()];c&&c.markPositionAsAvailable(t.ringPositionKey),t.ringPositionKey=void 0,t.orbitalAngle=void 0,t.setConnectionStatus(-1)}}(i,o,this.visibleRings,this.position,t);var r=window.NS.singletons.ConnectionsManager.getConnectedNodeWithType(this.ID,"electrons").getConnectedElectrons();ae(this.ID,r),this.syncAtomRings(r.length),this.dragData.releasePoint=null,this.dragData.ringToReleaseOn=null,this.dragData.electronObj=null,this.updateAtomHTML();var a=new CustomEvent("node-selected");document.documentElement.dispatchEvent(a)}if($(t)){if(this.dragData.isConnected&&(this.disconnectHandler.onEnd(),this.disconnectHandler.hasDisconnected))return;this.disconnectHandler=void 0;var s=window.NS.singletons.ConnectionsManager.getConnectedNodeWithType(this.ID,"electrons");!function(e,t){var n=e.dragData,i=(e.position,e.outerRing),o=e.rings,r=e.ID,a=(e.debugMesh,Object.keys(n.connectionData)),s=function(){var e={dist:Number.MAX_SAFE_INTEGER,orbital:void 0};if(a.forEach(function(t){var i=n.connectionData[t],o=i.notCompleteOrbitals,r=i.atom;r.position,o.forEach(function(t){var n=t.orbital,i=t.availablePositionKey,o=n.currentDistance;n.resetConnecting(),o<e.dist&&(e.dist=o,e.orbital=n,e.atom=r,e.connectingPositionKey=i)})}),e.dist<2)return e}();if(s){var l=function(e,t){return e.find(function(e){return e.orbital.angle-180===t||e.orbital.angle+180===t||e.orbital.allowConnectionMove})}(n.draggingAtomData.notCompleteOrbitals,s.orbital.angle);if(l){var c={positionKey:s.connectingPositionKey,outerRing:s.atom.outerRing};c.outerRing.markPositionAsTaken(c.positionKey),i.markPositionAsTaken(l.availablePositionKey);var u=s.orbital.angleRadian,d=s.orbital.radius+i.radius,h=ue(s.atom.position,u,d);e.position=h,n.draggingAtomData.connectedElectrons.forEach(function(e){var t=o[e.getRingIndex()].getConnectedElectronPosition(h,e.ringPositionKey,e.overrideConnectionAngle);e.position=t});var p=ce(s.orbital.angleRadian)*(180/Math.PI),f=t.find(function(e){return Number(e.getRingIndex())===i.index&&e.orbitalAngle===l.orbital.angle});l.orbital.angle!==p&&(new $o(f.mesh,l.orbital.angle,p,i.radius,h),f.overrideConnectionAngle=p),window.NS.singletons.LessonManager.atomConnectionsManager.addConnection(r,s.atom.ID,l.orbital.angle,s.orbital.angle,l.availablePositionKey,c.positionKey)}}}(this,s?s.getConnectedElectrons():[]),this.dragData.draggingAtomData.connectedAtoms.forEach(function(e){var t=window.NS.singletons.ConnectionsManager.getNode(e.id).position;se(e.id,{x:t.x,y:t.y})});var l=this.position;se(this.ID,{x:l.x,y:l.y})}this.dragData.connectedElectrons=[],this.foregroundRender.enableCameraControls(),this.foregroundRender.dragControls.removeEventListener("drag",this.onDragBound),this.foregroundRender.dragControls.removeEventListener("dragend",this.onDragEndBound)}}])&&rr(i.prototype,o),r&&rr(i,r),n}()},AtomEventHandler:function(e){return function(t){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),dr(this,hr(n).apply(this,arguments))}var i,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pr(e,t)}(n,e),i=n,(o=[{key:"onOrbitalChange",value:function(e){var t=e.detail,n=t.isFull,i=t.orbital,o=t.ringIndex;console.log("---- START ",this.ID,"---------"),console.log("on orbital change 1");var r=window.NS.singletons.ConnectionsManager.getConnectedNodeWithType(this.ID,"electrons");r?(console.log("on orbital change 3"," ringINdex: ",o," orbital: ",i),i.positions.forEach(function(e){var t=r.getElectronByPositionKeyAndRingIndex(parseInt(e),o);console.log("electron; ",t," posKey: ",e),t&&(t.orbitalConnected=n)}),console.log("---- END ",this.ID,"---------")):console.log("on orbital change 2")}},{key:"onAtomDisconnect",value:function(){window.NS.singletons.LessonManager.atomConnectionsManager.findConnections(this.ID).forEach(function(e){var t=window.NS.singletons.LessonManager.atomConnectionsManager.getConnection(e),n=t.dragAtom,i=n.positionKey,o=n.id,r=t.connectingAtom,a=r.positionKey,s=r.id;ee(o,i),ee(s,a),window.NS.singletons.LessonManager.atomConnectionsManager.removeConnection(e)}),window.NS.singletons.LessonManager.atomConnectionsManager.syncConnections(),this.dragData=Object.assign({},this.dragData,er(this.ID,this.type,this.position,this.outerRing))}},{key:"onAtomConnectionUpdateEvent",value:function(){this.updateAtomHTML()}}])&&ur(i.prototype,o),r&&ur(i,r),n}()}};n(64);function gr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var vr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._el=document.createElement("div"),this._el.classList.add("atom-html-label");this._el.insertAdjacentHTML("beforeend",'\n            <p class="atom-type"></p>\n            <p class="atom-charge"></p>\n            <div class="detail-container protons">\n                <p class="detail-number"></p>\n            </div>\n            <div class="detail-container electrons">\n                <p class="detail-number"></p>\n            </div>\n        '),this._atomTypeEl=this._el.querySelector(".atom-type"),this._atomChargeText=this._el.querySelector(".atom-charge"),this._amountProtonsTextEl=this._el.querySelector(".protons .detail-number"),this._amountElectronsTextEl=this._el.querySelector(".electrons .detail-number"),this.amountProtons=0,this.amountElectrons=0}var t,n,i;return t=e,(n=[{key:"domEl",get:function(){return this._el}},{key:"charge",set:function(e){this._atomChargeText.innerHTML=e,this._charge=e}},{key:"position",set:function(e){var t=e.x,n=e.y;this._el.style.transform="translate(-50%, -50%) translate(".concat(t,"px,").concat(n,"px)")}},{key:"amountProtons",set:function(e){this._amountProtons=e,this.charge=this._amountProtons-this._amountElectrons,this._amountProtonsTextEl.innerHTML=e,this._atomTypeEl.innerHTML=Z[e]||"-"}},{key:"amountElectrons",set:function(e){this._amountElectrons=e,this.charge=this._amountProtons-this._amountElectrons,this._amountElectronsTextEl.innerHTML=e}}])&&gr(t.prototype,n),i&&gr(t,i),e}();function mr(e){return(mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function br(e,t,n){return(br="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wr(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function wr(e){return(wr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Cr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function kr(e,t,n){return t&&Cr(e.prototype,t),n&&Cr(e,n),e}function Er(e,t){return(Er=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Sr=Object.freeze({0:{amountElectrons:2,orbitalPositions:1,orbitals:1,allowElectronAngleMove:!0},1:{amountElectrons:8,orbitalPositions:4,orbitals:4,allowElectronAngleMove:!1},2:{amountElectrons:18,orbitalPositions:9,orbitals:9,allowElectronAngleMove:!1},3:{amountElectrons:32,orbitalPositions:16,orbitals:16,allowElectronAngleMove:!1}}),xr=function(e){function t(e,n){var i,o,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(r=wr(t).call(this))||"object"!==mr(r)&&"function"!=typeof r?yr(o):r).initRingConnections=n&&n.data.ringConnections?n.data.ringConnections:{};var a=n&&n.data.visualPos?n.data.visualPos:{x:0,y:0};i.isForegroundNode=!0,i.isRendered=!0,i.corePositions=ne(),i.dragControls=null,i.visibleRings=[],i.atomDisconnectCallback=i.onAtomDisconnect.bind(yr(i)),i.dragData={centerPoint:new THREE.Vector2,ringToReleaseOn:null,releasePoint:null,electronObj:null,atoms:[],atomToConnect:null,connectedElectrons:[]},i.onDragStartBound=i.onDragStart.bind(yr(i)),i.onDragBound=i.onDrag.bind(yr(i)),i.onDragEndBound=i.onDragEnd.bind(yr(i)),i.foregroundRender=null,i.mesh=new THREE.Group,i.mesh.userData={getForegroundRender:!0},i.mainAtomGroup=new THREE.Group,i.mainAtomGroup.position.x=a.x,i.mainAtomGroup.position.y=a.y,i.mainAtomGroup.name="mainAtomGroup",i.electronsGroup=new THREE.Group,i.electronsGroup.name="electronsGroup",i.mesh.add(i.mainAtomGroup),i.mesh.add(i.electronsGroup),i.groupMapping={mainAtomGroup:i.mainAtomGroup,electronsGroup:i.electronsGroup};var s=new THREE.Color(0,0,0).getHex(),l=new THREE.CircleGeometry(5,32),c=new THREE.MeshBasicMaterial({color:s,transparent:!0,opacity:1});c.userData.toggleSelected=!0,i.circleDragMesh=new THREE.Mesh(l,c),i.mainAtomGroup.add(i.circleDragMesh);var u=new THREE.Color(1,0,0).getHex(),d=new THREE.CircleGeometry(5,32),h=new THREE.MeshBasicMaterial({color:u});i.disconnectProgressMesh=new THREE.Mesh(d,h),i.disconnectProgressMesh.visible=!1,i.mainAtomGroup.add(i.disconnectProgressMesh);var p=new THREE.BoxGeometry(1,1,1),f=new THREE.MeshBasicMaterial({color:16776960});i.debugMesh=new THREE.Mesh(p,f),i.debugMesh.position.x=50,i.debugMesh.position.y=50,i.rings={},i.ringMeshGroup=new THREE.Group,i.onAtomConnectionUpdateEvent=i.onAtomConnectionUpdateEvent.bind(yr(i)),document.documentElement.addEventListener(Vo,i.onAtomConnectionUpdateEvent),i.onOrbitalChangeEvent=i.onOrbitalChange.bind(yr(i)),i.el.addEventListener(Bo,i.onOrbitalChangeEvent);for(var g=Object.keys(Sr),v=0;v<g.length;v++){var m=g[v],y=Sr[m],b=new Go(6+2*v,y,v,i.el);i.ringMeshGroup.add(b.mesh),i.rings[v]=b}i.mainAtomGroup.add(i.ringMeshGroup);return i.params={protonsParam:{title:"Protoner",param:"protons",useAsInput:!0,parent:"Protoner",paramHelpersType:"atom",needsFrameUpdate:!1,minMax:{min:1,max:20},defaultVal:1,defaultConnect:!0},electronsParam:{title:"Elektroner",param:"electrons",useAsInput:!0,parent:"Elektroner",paramHelpersType:"atom",needsFrameUpdate:!1,minMax:{min:1,max:20},defaultVal:1,defaultConnect:!0},neutronsParam:{title:"Neutroner",param:"neutrons",useAsInput:!0,parent:"Neutroner",paramHelpersType:"atom",needsFrameUpdate:!1,minMax:{min:1,max:20},defaultVal:1,defaultConnect:!0}},i.paramVals={},i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Er(e,t)}(t,fr.AtomEventHandler(fr.AtomDragEvents(an))),kr(t,null,[{key:"tag",get:function(){return"AtomNode"}}]),kr(t,[{key:"setScale",value:function(e){this.mesh.scale.set(e,e,e)}},{key:"enableHide",value:function(){this.mesh.traverseVisible(function(e){e.material&&e.material.userData.toggleSelected&&(e.material.opacity=.05)})}},{key:"disableHide",value:function(){this.mesh.traverseVisible(function(e){e.material&&e.material.userData.toggleSelected&&(e.material.opacity=1)})}},{key:"setForegroundRender",value:function(e){this.foregroundRender=e,this.foregroundRender.scene.add(this.debugMesh),this._atomHTMLLabel=new vr,window.NS.singletons.CanvasNode.addMeshLabel(this.mainAtomGroup,this.ID,this._atomHTMLLabel),this.mesh.userData.nodeID=this.ID,this.foregroundRender.dragControls.addEventListener("dragstart",this.onDragStartBound),this.foregroundRender.dragControls.setObjects(this.mainAtomGroup.children,"".concat(this.ID,"-mainAtomGroup"))}},{key:"getAvailableCorePositions",value:function(e,t){var n=this;return Object.keys(this.corePositions).filter(function(t){return n.corePositions[t].type===e}).slice(0,t).map(function(e){return n.corePositions[e].pos})}},{key:"getCartesianForRing",value:function(e,t){var n=this.visibleRings[t],i=this.position;return{x:i.x+n.mesh.position.x+n.radius*Math.cos(e),y:i.y+n.mesh.position.y+n.radius*Math.sin(e)}}},{key:"syncAtomRings",value:function(e){this.visibleRings=[];for(var t=function(e,t){var n=0,i=e;return Object.keys(t).forEach(function(e){var o=t[e].amountElectrons;i>=0&&n++,i-=o}),e>0&&0===n&&(n=1),n}(e,Sr),n=Object.keys(this.rings).length,i=0;i<n;i++){var o=i<t;this.rings[i].mesh.visible=o,o&&this.visibleRings.push(this.rings[i])}}},{key:"onModifierDisconnect",value:function(e){if(window.NS.singletons.ConnectionsManager.getNode(e).controlsAmountAtomRings){window.NS.singletons.LessonManager.atomConnectionsManager.findConnections(this.ID).forEach(function(e){var t=window.NS.singletons.LessonManager.atomConnectionsManager.getConnection(e),n=t.dragAtom,i=n.positionKey,o=n.id,r=t.connectingAtom,a=r.positionKey,s=r.id;ee(o,i),ee(s,a),window.NS.singletons.LessonManager.atomConnectionsManager.removeConnection(e)}),window.NS.singletons.LessonManager.atomConnectionsManager.syncConnections(),this.visibleRings=[];for(var t=Object.keys(this.rings).length,n=0;n<t;n++)this.rings[n].mesh.visible=!1}}},{key:"updateMeshType",value:function(e,t,n,i,o){var r=this,a=this.groupMapping[o]||this.mainAtomGroup;n&&this.foregroundRender.dragControls.setObjects(e.children,"".concat(this.ID,"-").concat(t));var s=window.NS.singletons.ConnectionsManager.getConnectedNodeWithType(this.ID,"electrons");if(s&&!s.atomBackendSynced&&"electrons"===t){var l=s.electrons,c=Object.keys(l);if(c.length>0){var u=0;Object.keys(this.initRingConnections).forEach(function(e){for(var t=r.initRingConnections[e],n=0;n<t;n++)l[c[u]].setConnectionStatus(e),u++})}s.atomBackendSynced=!0}if(s){var d=s.getConnectedElectrons();this.syncAtomRings(d.length)}"electrons"===t?re[t](a,t,e,this.initRingConnections,s.electrons,this.visibleRings,this.position):re[t](a,t,e),this.updateAtomHTML()}},{key:"updateAtomHTML",value:function(){var e=window.NS.singletons.ConnectionsManager.getConnectedNodeWithType(this.ID,"protons");if(e){var t=e.getAmount();this._atomHTMLLabel.amountProtons=t}var n=this.visibleRings.reduce(function(e,t){return e+(t.totalAmountPositions()-t.getAvailablePositionKeys().length)},0);this._atomHTMLLabel.amountElectrons=n}},{key:"removeFromDom",value:function(){window.NS.singletons.CanvasNode.removeMeshLabel(this.ID),br(wr(t.prototype),"removeFromDom",this).call(this),this.foregroundRender.dragControls.removeEventListener("dragstart",this.onDragStartBound),this.foregroundRender.dragControls.removeEventListener("drag",this.onDragBound),this.foregroundRender.dragControls.removeEventListener("dragend",this.onDragEndBound)}},{key:"position",get:function(){var e=new THREE.Vector2;return e.x=this.mainAtomGroup.position.x,e.y=this.mainAtomGroup.position.y,e},set:function(e){this.mainAtomGroup.position.set(e.x,e.y,0)}},{key:"outerRing",get:function(){if(this.visibleRings.length>0)return this.visibleRings[this.visibleRings.length-1]}}]),t}();function Nr(e){return(Nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Pr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Dr(e,t,n){return(Dr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Or(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Or(e){return(Or=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Tr(e,t){return(Tr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ir=function(e){function t(e,n){var i,o,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(r=Or(t).call(this))||"object"!==Nr(r)&&"function"!=typeof r?Pr(o):r).initValues=n?n.data.visualSettings:null,i.onInputChangeBound=i.onInputChange.bind(Pr(i)),i.title="Protons modifier",i.hasMeshToAdd=!0,i.isParam=!0,i.outValues={},i.mesh=new THREE.Group,i.mesh.name="protons",i.addToGroup="mainAtomGroup";var a=new THREE.Color(1,.1,0).getHex();return i.material=new THREE.MeshBasicMaterial({transparent:!0,opacity:1,color:a,side:THREE.DoubleSide}),i.material.userData.toggleSelected=!0,i.getSettings(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tr(e,t)}(t,an),n=t,(i=[{key:"hideSettings",value:function(){}},{key:"getAmountPositions",value:function(){return this.visualSettings?this.visualSettings.amountProtons:this.initValues&&this.initValues.amountProtons?this.initValues.amountProtons:0}},{key:"getMeshGroup",value:function(e){for(var t=this,n=this.mesh.children.length-1;n>=0;n--)this.mesh.remove(this.mesh.children[n]);return e.forEach(function(e){return ie(t.mesh,t.material,e)}),this.mesh}},{key:"onInputChange",value:function(e){if(this.updateVisualSettings(e),e!==this.mesh.children.length)for(var t=0;t<this.currentOutConnectionsLength;t++){var n=window.NS.singletons.ConnectionsManager.params[this.currentOutConnections[t].connection.paramID];window.NS.singletons.ConnectionsManager.nodes[this.currentOutConnections[t].inNodeID].updateParam(n,this)}}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings protons-modifier-node";var t={value:this.initValues&&this.initValues.amountProtons?this.initValues.amountProtons:0,step:1,min:0,max:50};this.amountInput=new Ri(e,"Antal Protoner",t,this.onInputChangeBound),this.settingsContainer=e}return this.settingsContainer}},{key:"updateVisualSettings",value:function(e){this.syncVisualSettings({amountProtons:e})}},{key:"reset",value:function(){console.log("node reset"),this.amountInput.setValue(0),this.updateVisualSettings(0),this.initValues=null}},{key:"resetConnection",value:function(e,t){var n=window.NS.singletons.ConnectionsManager.getNode(e),i=window.NS.singletons.ConnectionsManager.params[t.paramID];n.updateParam(i,this)}},{key:"getAmount",value:function(){return this.mesh.children.length}},{key:"onConnectionAdd",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection;window.NS.singletons.ConnectionsManager.params[t.paramID];this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length}}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){console.log("connection remove");var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,r=(window.NS.singletons.ConnectionsManager.params[t.paramID],this.currentOutConnections.map(function(e){return e})),a=r.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),s=r.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),l=a.concat(s);this.currentOutConnections=l,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&(this.reset(),this.resetConnection(o,t))}}},{key:"enableInput",value:function(e){Dr(Or(t.prototype),"enableInput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),Dr(Or(t.prototype),"removeFromDom",this).call(this)}}])&&Mr(n.prototype,i),o&&Mr(n,o),t}();function Rr(e){return(Rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Lr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ar(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jr(e,t,n){return(jr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_r(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function _r(e){return(_r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vr(e,t){return(Vr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Br=function(e){function t(e,n){var i,o,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(r=_r(t).call(this))||"object"!==Rr(r)&&"function"!=typeof r?Ar(o):r).initValues=n?n.data.visualSettings:null,i.onInputChangeBound=i.onInputChange.bind(Ar(i)),i.title="Neutrons modifier",i.hasMeshToAdd=!0,i.isParam=!0,i.outValues={},i.mesh=new THREE.Group,i.mesh.name="neutrons",i.addToGroup="mainAtomGroup";var a=new THREE.Color(1,.6,.6).getHex();return i.material=new THREE.MeshBasicMaterial({transparent:!0,opacity:1,color:a,side:THREE.DoubleSide}),i.material.userData.toggleSelected=!0,i.getSettings(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vr(e,t)}(t,an),n=t,(i=[{key:"hideSettings",value:function(){}},{key:"getAmountPositions",value:function(){return this.visualSettings?this.visualSettings.amountNeutrons:this.initValues&&this.initValues.amountNeutrons?this.initValues.amountNeutrons:0}},{key:"getMeshGroup",value:function(e){for(var t=this,n=this.mesh.children.length-1;n>=0;n--)this.mesh.remove(this.mesh.children[n]);return e.forEach(function(e){return ie(t.mesh,t.material,e)}),this.mesh}},{key:"onInputChange",value:function(e){if(this.updateVisualSettings(e),e!==this.mesh.children.length)for(var t=0;t<this.currentOutConnectionsLength;t++){var n=window.NS.singletons.ConnectionsManager.params[this.currentOutConnections[t].connection.paramID];window.NS.singletons.ConnectionsManager.nodes[this.currentOutConnections[t].inNodeID].updateParam(n,this)}}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings neutrons-modifier-node";var t={value:this.initValues&&this.initValues.amountNeutrons?this.initValues.amountNeutrons:0,step:1,min:0,max:50};this.amountInput=new Ri(e,"Antal Neutroner",t,this.onInputChangeBound),this.settingsContainer=e}return this.settingsContainer}},{key:"updateVisualSettings",value:function(e){this.syncVisualSettings({amountNeutrons:e})}},{key:"reset",value:function(){this.amountInput.setValue(0),this.updateVisualSettings(0),this.initValues=null}},{key:"resetConnection",value:function(e,t){var n=window.NS.singletons.ConnectionsManager.getNode(e),i=window.NS.singletons.ConnectionsManager.params[t.paramID];n.updateParam(i,this)}},{key:"onConnectionAdd",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection;window.NS.singletons.ConnectionsManager.params[t.paramID];this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length}}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,r=(window.NS.singletons.ConnectionsManager.params[t.paramID],this.currentOutConnections.map(function(e){return e})),a=r.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),s=r.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),l=a.concat(s);this.currentOutConnections=l,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&(this.reset(),this.resetConnection(o,t))}}},{key:"enableInput",value:function(e){jr(_r(t.prototype),"enableInput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),jr(_r(t.prototype),"removeFromDom",this).call(this)}}])&&Lr(n.prototype,i),o&&Lr(n,o),t}();function Hr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Fr=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ID="".concat(Date.now(),"-").concat(t),this.connectionStatus={connectedToRingIndex:-1},this._orbitalAngle=void 0,this._isConnectingToAtom=!1,this._ringPositionKey,this._overrideConnectionAngle=void 0,this.parentMesh=i;var o=new THREE.SphereGeometry(.5,10,10);this.orbitalConnectedColor=new THREE.Color(152/255,235/255,169/255).getHex(),this.selectedColor=new THREE.Color(75/255,133/255,250/255).getHex(),this.deselectedColor=new THREE.Color(.8,.8,1).getHex();var r=new THREE.MeshBasicMaterial({transparent:!0,opacity:1,color:this.deselectedColor,side:THREE.DoubleSide});r.userData.toggleSelected=!0,this.mesh=new THREE.Mesh(o,r),this.mesh.name="electron",this.mesh.userData={ID:this.ID},this._orbitalIndex,this.currentAngle=0,this.mesh.position.set(n.x,n.y,n.z),this.parentMesh.add(this.mesh)}var t,n,i;return t=e,(n=[{key:"getRingIndex",value:function(){return this.connectionStatus.connectedToRingIndex}},{key:"setConnectionStatus",value:function(e){this.connectionStatus.connectedToRingIndex=parseInt(e)}},{key:"getConnectionStatus",value:function(){return this.connectionStatus}},{key:"isConnected",value:function(){return this.connectionStatus.connectedToRingIndex>-1}},{key:"remove",value:function(){this.mesh.geometry.dispose(),this.mesh.material.dispose(),this.parentMesh.remove(this.mesh)}},{key:"ringPositionKey",set:function(e){var t=e?this.selectedColor:this.deselectedColor;this.mesh.material.color.set(t),this._ringPositionKey=e?parseInt(e):e},get:function(){return this._ringPositionKey}},{key:"isConnectingToAtom",get:function(){return this._isConnectingToAtom},set:function(e){this._isConnectingToAtom=e}},{key:"position",set:function(e){this.mesh.position.set(e.x,e.y,0)}},{key:"orbitalAngle",set:function(e){this._orbitalAngle=e},get:function(){return this._orbitalAngle}},{key:"overrideConnectionAngle",get:function(){return this._overrideConnectionAngle},set:function(e){this._overrideConnectionAngle=e}},{key:"orbitalConnected",set:function(e){this._orbitalConnected=e;var t=!1===e?this.selectedColor:this.orbitalConnectedColor;this.mesh.material.color.set(t)}}])&&Hr(t.prototype,n),i&&Hr(t,i),e}();function zr(e){return(zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ur(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Gr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Yr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kr(e,t,n){return(Kr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Xr(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Xr(e){return(Xr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wr(e,t){return(Wr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qr,Jr=function(e){function t(e,n){var i,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=!(r=Xr(t).call(this))||"object"!==zr(r)&&"function"!=typeof r?Yr(o):r).atomBackendSynced=!1,i.initValues=n?n.data.visualSettings:null,i.onInputChangeBound=i.onInputChange.bind(Yr(i)),i.title="Electrons modifier",i.hasMeshToAdd=!0,i.isParam=!0,i.electrons={},i.controlsAmountAtomRings=!0,i.nodeSortIndex=1,i.enableDragging=!0,i.outValues={},i.mesh=new THREE.Group,i.mesh.name="electrons",i.addToGroup="electronsGroup",i.getSettings(),i}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wr(e,t)}(t,an),n=t,(i=[{key:"hideSettings",value:function(){}},{key:"getElectronByPositionKey",value:function(e){var t=this,n=Object.keys(this.electrons).find(function(n){return parseInt(t.electrons[n].ringPositionKey)===e});return this.electrons[n]}},{key:"getElectronByPositionKeyAndRingIndex",value:function(e,t){var n=this,i=Object.keys(this.electrons).filter(function(e){return Number.isFinite(n.electrons[e].ringPositionKey)}).find(function(i){return n.electrons[i].ringPositionKey===e&&n.electrons[i].getRingIndex()===t});return this.electrons[i]}},{key:"getElectron",value:function(e){return this.electrons[e]}},{key:"getConnectedElectrons",value:function(){var e=this;return Object.keys(this.electrons).filter(function(t){return e.electrons[t].isConnected()}).map(function(t){return e.electrons[t]})}},{key:"getMeshGroup",value:function(e){var t=this,n=t.visualSettings?t.visualSettings.amountElectrons:t.initValues&&t.initValues.amountElectrons?t.initValues.amountElectrons:0,i=e.nodeIndex,o=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0,o=[],r=e,a=Math.ceil(t/r),s=0;s<a;s++)for(var l=s*r,c=Math.min(t-l,r),u=1.3*(s+a/2-a),d=1;d<=c;d++){var h=n?1.3*-d:1.3*d,p=new THREE.Vector3(h,u,0);p.add(i),o.push(p)}return o}(3,n,!1,new THREE.Vector3(8*i+6,20,0)),r=Object.keys(this.electrons),a=n-r.length;if(0===a)return this.mesh;if(a<0){var s=Math.abs(a),l=[],c=r.filter(function(e){return!t.electrons[e].isConnected()}),u=r.filter(function(e){return t.electrons[e].isConnected()}).sort(function(e,n){return t.electrons[n].getRingIndex()-t.electrons[e].getRingIndex()});if(c.length<s){for(var d,h=s-c.length,p=0;p<h;p++)l.push(u[p]);(d=l).push.apply(d,Ur(c))}else l=c.slice(0,s);for(var f=0;f<l.length;f++){var g=this.electrons[l[f]];if(g.isConnected())e.visibleRings[g.getRingIndex()].markPositionAsAvailable(g.ringPositionKey);g.remove(),delete this.electrons[l[f]]}ae(this.ID,this.getConnectedElectrons())}else for(var v=a,m=0;m<v;m++){var y=r.length+m,b=new Fr(y,o[y],this.mesh);this.electrons[b.ID]=b}return this.mesh}},{key:"onInputChange",value:function(e){if(this.updateVisualSettings(e),e!==this.mesh.children.length)for(var t=0;t<this.currentOutConnectionsLength;t++){var n=window.NS.singletons.ConnectionsManager.params[this.currentOutConnections[t].connection.paramID];window.NS.singletons.ConnectionsManager.nodes[this.currentOutConnections[t].inNodeID].updateParam(n,this)}}},{key:"getSettings",value:function(){if(!this.settingsContainer){var e=document.createElement("div");e.className="node-settings electrons-modifier-node";var t={value:this.initValues&&this.initValues.amountElectrons?this.initValues.amountElectrons:0,step:1,min:0,max:50};this.amountInput=new Ri(e,"Antal Elektroner",t,this.onInputChangeBound),this.settingsContainer=e}return this.settingsContainer}},{key:"updateVisualSettings",value:function(e){this.syncVisualSettings({amountElectrons:e},!0)}},{key:"reset",value:function(){this.amountInput.setValue(0),this.updateVisualSettings(0),this.initValues=null}},{key:"resetConnection",value:function(e,t){var n=window.NS.singletons.ConnectionsManager.params[t.paramID];e.updateParam(n,this)}},{key:"onConnectionAdd",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection;window.NS.singletons.ConnectionsManager.params[t.paramID];this.currentOutConnections.push(e.detail),this.currentOutConnectionsLength=this.currentOutConnections.length}}},{key:"onConnectionRemove",value:function(e){if(e.detail.connection.outNodeID===this.ID){var t=e.detail.connection,n=t.paramID,i=t.outNodeID,o=e.detail.inNodeID,r=(window.NS.singletons.ConnectionsManager.params[t.paramID],window.NS.singletons.ConnectionsManager.getNode(o)),a=this.currentOutConnections.map(function(e){return e}),s=a.filter(function(e){return e.inNodeID===o&&e.connection.paramID!==n}),l=a.filter(function(e){return e.inNodeID===o&&e.connection.outNodeID!==i}),c=s.concat(l);this.currentOutConnections=c,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&(this.reset(),this.resetConnection(r,t),r.onModifierDisconnect(i))}}},{key:"enableInput",value:function(e){Kr(Xr(t.prototype),"enableInput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),Kr(Xr(t.prototype),"removeFromDom",this).call(this)}}])&&Gr(n.prototype,i),o&&Gr(n,o),t}();function Zr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Qr=(Zr(qr={Kick:{obj:zt},FMSynth:{obj:Zt},SequencerNode:{obj:St},WaveformNode:{obj:Rt},SpeakerNode:{obj:pt},Sphere:{obj:Cn,isModifier:!1},Cube:{obj:pn,isModifier:!1},ParamDriver:{obj:Tn,isModifier:!0},"Orbit Modifier":{obj:Kn,isModifier:!0},"Rotation Modifier":{obj:$n,isModifier:!0},Color:{obj:si,isModifier:!0},Form:{obj:Gi,isModifier:!0},"Directional Light":{obj:hi,isModifier:!1},"Point Light":{obj:mi,isModifier:!1},"Texture Selector":{obj:Si,isModifier:!0},Particles:{obj:Ti,isModifier:!1},Planet:{obj:qi,isModifier:!1},Sun:{obj:Mo,isModifier:!1},"Size Modifier":{obj:ro,isModifier:!0}},"Texture Selector",{obj:po,isModifier:!0}),Zr(qr,"Planet Position",{obj:ko,isModifier:!0}),Zr(qr,"Planet Rotation",{obj:Ao,isModifier:!0}),Zr(qr,"Atom",{obj:xr,isModifier:!1}),Zr(qr,"Protons",{obj:Ir,isModifier:!0}),Zr(qr,"Neutrons",{obj:Br,isModifier:!0}),Zr(qr,"Electrons",{obj:Jr,isModifier:!0}),qr);function $r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ea=function(){function e(t,n,i,o,r,a,s,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onDisconnectCallback=n,this.onInputConnectionCallback=i,this.addCallback=o,this.removeCallback=r,this.onNodeDragStart=a,this.onNodeDragMove=s,this.onNodeDragRelease=l,this.mainRenderer=new X}var t,n,i;return t=e,(n=[{key:"createNode",value:function(e,t,n){var i,o=(i=e.type,Qr[i]),r=o.obj,a=o.isModifier,s=new r(this.mainRenderer,n);return s.init(t,this.parentEl,this.onDisconnectCallback,this.onInputConnectionCallback,e.type,n,this.removeCallback,a,this.onNodeDragStart,this.onNodeDragMove,this.onNodeDragRelease,this.addCallback),s.onResize({w:540,h:538}),s}},{key:"createCanvasNode",value:function(){var e;e=window.NS.singletons.PROJECT_TYPE===window.NS.singletons.TYPES.space.id?new Ze(this.mainRenderer):new ze(this.mainRenderer);var t=document.querySelector(".workspace-container");return e.init(t),e}}])&&$r(t.prototype,n),i&&$r(t,i),e}();function ta(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var na=function(){function e(t,n,i,o,r,a,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onConnectingCallback=n,this.onInputConnectionCallback=i,this.addCallback=o,this.initData=r,this.onParameterChange=a,this.onNodeRemove=s}var t,n,i;return t=e,(n=[{key:"init",value:function(){if(this.initData)for(var e=0;e<this.initData.length;e++)this.initData[e].node.init(this.parentEl,this.onConnectingCallback,this.onInputConnectionCallback,this.initData[e].type,this.initData[e],this.onParameterChange,this.onNodeRemove),this.addCallback(this.initData[e].node)}},{key:"createNode",value:function(e,t){var n=new e.obj;n.init(t,this.parentEl,this.onConnectingCallback,this.onInputConnectionCallback,e.type,void 0,this.onParameterChange,this.onNodeRemove),this.addCallback(n)}}])&&ta(t.prototype,n),i&&ta(t,i),e}();n(66);n(68);n(70);function ia(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var oa=function(){function e(t,n,i){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onShowCallback=n,this.onRemoveCallback=i,this.el=document.createElement("div"),this.el.className="node-settings-window window",this.bgLayer=document.createElement("div"),this.bgLayer.className="bg-layer",this.bgLayer.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),o.hide()}),this.el.appendChild(this.bgLayer);var r=document.createElement("h5");r.innerHTML="NOD INSTÄLLNINGAR",r.className="title",this.el.appendChild(r),this.isOpen=!1,this.closeBtn=document.createElement("h5"),this.closeBtn.innerHTML="Hide",this.closeBtn.className="close-btn",this.onHideClickBound=this.onHideClick.bind(this),this.closeBtn.addEventListener("click",this.onHideClickBound),this.el.appendChild(this.closeBtn),this.parentEl.appendChild(this.el),this.currentSettingsEl=null,this.onClickBound=this.onClick.bind(this),this.el.addEventListener("click",this.onClickBound)}var t,n,i;return t=e,(n=[{key:"onClick",value:function(){this.show()}},{key:"onHideClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.hide()}},{key:"removeCurrent",value:function(){!this.currentSettingsEl||this.currentSettingsEl&&this.currentSettingsEl.parentNode!==this.el||(this.el.removeChild(this.currentSettingsEl),this.el.classList.remove("has-settings"))}},{key:"setupForNode",value:function(e){if(this.removeCurrent(),e.getSettings){var t=e.getSettings();this.currentSettingsEl=t,this.el.appendChild(t),e.afterSettingsAddedToDom&&e.afterSettingsAddedToDom(),this.el.classList.add("has-settings")}}},{key:"checkForUpdates",value:function(e){e.refreshSettings&&(this.removeCurrent(),this.setupForNode(e))}},{key:"show",value:function(){this.onShowCallback(),window.NS.singletons.CanvasNode.foregroundRender.toggleCameraControl(!1),this.el.classList.add("visible"),this.isOpen=!0}},{key:"hide",value:function(){this.el.classList.remove("visible"),window.NS.singletons.CanvasNode.foregroundRender.toggleCameraControl(!0),this.isOpen=!1}},{key:"blur",value:function(){this.hide(),this.removeCurrent()}}])&&ia(t.prototype,n),i&&ia(t,i),e}();n(72);function ra(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var aa=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.el=document.createElement("div"),this.el.className="selected-node-window",this.parentEl.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"setNode",value:function(e){var t=function(e,t,n){return'\n                <div class="'.concat(e,' info-container">\n                    <h5>').concat(t,"</h5>\n                    <h4>").concat(n,"</h4>\n                </div>\n            ")},n=function(e){var n=function(e){if(e.nodeType.isConnected&&e.nodeType.assignedParamContainer){var t=e.nodeType.assignedParamContainer.node.ID,n=window.NS.singletons.ConnectionsManager.nodes[t];if(n)return n.title}return"No title on parent"}(e);return t("connected-to-node","Kopplad till:",n)},i=function(e){var i;if(!e)return"";var o=t("node-info","Node:",e.title);return i="".concat(o),e.isModifier&&(i="".concat(o).concat(n(e))),i}(window.NS.singletons.ConnectionsManager.nodes[e]),o='\n            <div class="content">\n                '.concat(i,"\n            </div>\n        "),r=this.el.querySelector(".content");r&&this.el.removeChild(r),this.el.insertAdjacentHTML("afterbegin",o)}},{key:"blur",value:function(){this.el.innerHTML=""}}])&&ra(t.prototype,n),i&&ra(t,i),e}();function sa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var la=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.activeNode=null,this.onConnectionWindowShowBound=this.onConnectionWindowShow.bind(this),this.onNodeSettingsWindowShowBound=this.onNodeSettingsWindowShow.bind(this),this.onNodeRemoveClickBound=this.onNodeRemoveClick.bind(this),this.nodeSettingsWindow=new oa(t,this.onNodeSettingsWindowShowBound,this.onNodeRemoveClickBound),this.selectedNodeWindow=new aa(t)}var t,n,i;return t=e,(n=[{key:"onNodeRemoveClick",value:function(){this.activeNode&&this.activeNode.onRemoveClick()}},{key:"setupForNode",value:function(e){this.activeNode=e,this.nodeSettingsWindow.setupForNode(e),this.selectedNodeWindow.setNode(e.ID)}},{key:"onNodeConnect",value:function(e){}},{key:"onConnectionWindowShow",value:function(){this.nodeSettingsWindow.hide()}},{key:"onNodeSettingsWindowShow",value:function(){this.nodeSettingsWindow.checkForUpdates(this.activeNode)}},{key:"onNodeDisconnect",value:function(){}},{key:"blur",value:function(){this.nodeSettingsWindow.blur(),this.selectedNodeWindow.blur()}},{key:"nodeSettingsOpen",value:function(){return this.nodeSettingsWindow.isOpen}}])&&sa(t.prototype,n),i&&sa(t,i),e}();function ca(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ua=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._nodes=new Map}var t,n,i;return t=e,(n=[{key:"add",value:function(e){if(e.needsUpdate){var t=this._nodes.get(e.ID);if(t){var n=Object.assign({},t,{count:t.count+=1});this._nodes.set(e.ID,n)}else{var i={count:1,node:e};this._nodes.set(e.ID,i)}}}},{key:"delete",value:function(e){if(this._nodes.has(e.ID)){var t=this._nodes.get(e.ID);t.count--,t.count<=0&&this._nodes.delete(e.ID)}}},{key:"update",value:function(){this._nodes.forEach(function(e){e.node.update()})}},{key:"render",value:function(){this._nodes.forEach(function(e){e.node.render()})}}])&&ca(t.prototype,n),i&&ca(t,i),e}();function da(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ha=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.activeModifier=void 0,this.nonagons=[],this.nonagonsToCheck=[],this.currentCloseParamContainer=void 0,this.currentClosestNode=void 0,this.onDragStartBound=this.onModifierDragStart.bind(this),this.onDragMoveBound=this.onModifierDragMove.bind(this),this.onDragReleaseBound=this.onModifierDragRelease.bind(this),this.disconnectTimer=-1}var t,n,i;return t=e,(n=[{key:"addNonagon",value:function(e){this.nonagons.push(e)}},{key:"removeNonagon",value:function(e){this.nonagons=this.nonagons.filter(function(t){return t.ID!==e.ID})}},{key:"overNonagonCheck",value:function(){for(var e=this.nonagonsToCheck,t=0;t<e.length;t++){var n=e[t].getPos(),i=this.activeModifier.getPos();n.distanceTo(i)<160&&window.NS.singletons.SelectionManager.setSelected(e[t])}}},{key:"onModifierDragStart",value:function(e,t){this.activeModifier=e,this.nonagonsToCheck=this.nonagons.filter(function(e){return e.groupState.isInGroup&&e.groupState.isShowing||!e.groupState.isInGroup}),this.overNonagonCheck()}},{key:"onModifierDragMove",value:function(e,t){if(this.overNonagonCheck(),this.activeModifier.isConnected)(Math.abs(t.x)>5||Math.abs(t.y)>5)&&this.activeModifier.deactivateAsChild(e);else{var n=this.nonagonsToCheck;if(this.currentCloseParamContainer){var i=this.currentCloseParamContainer.getPos(),o=this.activeModifier.getPos(),r=i.distanceTo(o);if(r>=15)this.currentCloseParamContainer=void 0,this.activeModifier.setAngle(0);else{if(this.currentCloseParamContainer.isDisabledForConnection)return;var a=Math.min((15-r)/5,1)*this.currentCloseParamContainer.rotation;this.activeModifier.setAngle(a)}}else for(var s=0;s<n.length;s++)for(var l=n[s].getParamContainers(),c=0;c<l.length;c++){var u=l[c],d=u.getPos(),h=this.activeModifier.getPos();if(d.distanceTo(h)<15)return void(this.currentCloseParamContainer=u)}}}},{key:"onModifierDragRelease",value:function(){this.currentCloseParamContainer&&!this.currentCloseParamContainer.isDisabledForConnection&&this.activeModifier&&!this.activeModifier.isConnected?this.activeModifier.activateAsChild(this.currentCloseParamContainer,!0):this.currentClosestNode&&(this.currentClosestNode.setNotSelected(),this.currentClosestNode=void 0)}}])&&da(t.prototype,n),i&&da(t,i),e}();n(74);function pa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var fa=function(){function e(t,n,i,o,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.el=document.createElement("div"),this.el.classList.add("tab-item"),this.tabIndex=o,this.onTabDragStart=r,this.onTabDragEnd=a,this.tabTitle=document.createElement("h5"),this.setTitle(n.title),this.tabTitle.classList.add("tab-title"),this.touchLayer=document.createElement("div"),this.touchLayer.classList.add("touch-layer"),this.touchLayer.setAttribute("data-node",n.ID),this.node=n,this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.mouseDownTimestamp=Date.now(),this.tabGroupMover=null,this.activateTabGroupMoverTimer=null,this.currentX=0,this.draggingActive=!1,this.el.appendChild(this.tabTitle),this.el.appendChild(this.touchLayer),t.appendChild(this.el),this.onTabClickBound=this.onTabClick.bind(this),this.onTabClickCallback=i,this.touchLayer.addEventListener("click",this.onTabClickBound)}var t,n,i;return t=e,(n=[{key:"getWidth",value:function(){return this.el.getBoundingClientRect().width}},{key:"activateDragging",value:function(){this.draggingActive=!0,this.el.style.transform="translateX(".concat(this.currentX,"px) scale(0.8)")}},{key:"disableDragging",value:function(){this.draggingActive=!1,this.el.style.transform="translateX(".concat(this.currentX,"px) scale(1)")}},{key:"onMouseDown",value:function(e){var t=this;e.preventDefault(),e.stopPropagation(),window.addEventListener("mouseup",this.onMouseUpBound),this.mouseDownTimestamp=Date.now(),this.activateTabGroupMoverTimer=setTimeout(function(){t.onTabDragStart(t,e),t.activateDragging()},500)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),clearTimeout(this.activateTabGroupMoverTimer),this.draggingActive?(this.disableDragging(),this.onTabDragEnd()):(this.disableDragging(),this.onTabClickBound(e))}},{key:"setTitle",value:function(e){this.tabTitle.innerHTML=e}},{key:"onTabClick",value:function(e){var t=e.target.getAttribute("data-node");this.onTabClickCallback(t)}},{key:"setActive",value:function(){this.el.classList.add("selected");var e=new CustomEvent("node-selected",{detail:this.node});document.documentElement.dispatchEvent(e)}},{key:"setIdle",value:function(){this.el.classList.remove("selected")}},{key:"remove",value:function(){this.parentEl.removeChild(this.el)}},{key:"renderDOM",value:function(e,t){this.draggingActive?this.el.style.transform="translateX(".concat(e,"px) scale(0.8)"):this.el.style.transform="translateX(".concat(e,"px)"),t&&(this.currentX=e)}}])&&pa(t.prototype,n),i&&pa(t,i),e}();function ga(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function va(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ma=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderDOM=t,this.updateOrder=n,this.activeTab=null,this.allTabs={},this.moveCoords={startX:0},this.renderOrder=[],this.filteredRenderOrder=[],this.latestDragOrder=[],this.tabSizes={},this.onDragMoveBound=this.onDragMove.bind(this)}var t,n,i;return t=e,(n=[{key:"initMove",value:function(e,t,n,i,o){var r=this;this.moveCoords.startX=n.clientX,this.renderOrder=i,this.tabSizes=o,this.activeTab=e,this.allTabs=t,console.log("init render order",this.renderOrder),this.filteredRenderOrder=this.renderOrder.filter(function(e){return e!==r.activeTab.node.ID}),window.addEventListener("mousemove",this.onDragMoveBound)}},{key:"setRenderOrder",value:function(e){this.renderOrder=e}},{key:"getNewOrder",value:function(e){var t=this.filteredRenderOrder.slice(0,e),n=this.filteredRenderOrder.slice(e,this.filteredRenderOrder.length),i=[].concat(ga(t),[this.activeTab.node.ID],ga(n));this.latestDragOrder=i,this.updateOrder(i)}},{key:"onDragMove",value:function(e){for(var t=e.clientX-this.moveCoords.startX,n=this.activeTab.currentX+t+this.tabSizes[this.activeTab.node.ID]/2,i=0,o=0;o<this.renderOrder.length;o++){var r=this.tabSizes[this.renderOrder[o]];Math.abs(n-i)<5&&this.getNewOrder(o),i+=r}this.activeTab.renderDOM(this.activeTab.currentX+t)}},{key:"onDragEnd",value:function(){return window.removeEventListener("mousemove",this.onDragMoveBound),this.latestDragOrder}}])&&va(t.prototype,n),i&&va(t,i),e}();n(76);function ya(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ba=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.classList.add("node-selection"),this.nodes={},this.onUpdatedRenderOrder=i,this.renderOrder=[],this.onNodeSelected=n,this.parentEl=t,this.parentEl.appendChild(this.el),this.tabs={},this.tabWidths={},this.renderDOMBound=this.renderDOM.bind(this),this.updateOrderBound=this.updateOrder.bind(this),this.tabGroupMover=new ma(this.renderDOMBound,this.updateOrderBound),this.onTabClickBound=this.onTabClick.bind(this),this.onTabDragStartBound=this.onTabDragStart.bind(this),this.onTabDragEndBound=this.onTabDragEnd.bind(this)}var t,n,i;return t=e,(n=[{key:"onTabDragStart",value:function(e,t){this.onTabClick(e.node.ID),this.tabGroupMover.initMove(e,this.tabs,t,this.renderOrder,this.tabWidths)}},{key:"onTabDragEnd",value:function(){}},{key:"addTab",value:function(e){var t=new fa(this.el,e,this.onTabClickBound,Object.keys(this.tabs).length,this.onTabDragStartBound,this.onTabDragEndBound);this.tabs[e.ID]=t}},{key:"removeTab",value:function(e){this.tabs[e.ID].remove(),delete this.tabs[e.ID],delete this.tabWidths[e.ID]}},{key:"setTabTitle",value:function(e,t){this.tabs[e].setTitle(t)}},{key:"addNode",value:function(e){this.addTab(e)}},{key:"removeNode",value:function(e){this.removeTab(e)}},{key:"setTabIdle",value:function(e){e.setIdle()}},{key:"setTabActive",value:function(e){e.setActive()}},{key:"setTabSelected",value:function(e){var t=this;Object.keys(this.tabs).forEach(function(e){t.setTabIdle(t.tabs[e])}),this.setTabActive(this.tabs[e])}},{key:"onTabClick",value:function(e){this.setTabSelected(e),this.onNodeSelected(e)}},{key:"updateOrder",value:function(e){this.renderDOM(e)}},{key:"renderDOM",value:function(e){for(var t=0,n=e||this.renderOrder,i=n.length,o=0;o<i;o++){var r=n[o],a=this.tabWidths[r];this.tabs[r].draggingActive||this.tabs[r].renderDOM(t,!0),t+=a}}}])&&ya(t.prototype,n),i&&ya(t,i),e}();n(78);function wa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ca=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.classList.add("node-group-expand-collapse"),this._parentEl=t,this._statusEl=document.createElement("h5"),this._statusEl.innerHTML="Minimera",this.el.appendChild(this._statusEl),t.appendChild(this.el),this._onClick=this._onClick.bind(this),this.el.addEventListener("click",this._onClick),this._isExpanded=!0}var t,n,i;return t=e,(n=[{key:"_onClick",value:function(e){var t=!this._isExpanded;this.isExpanded=t}},{key:"isExpanded",get:function(){return this._isExpanded},set:function(e){this._isExpanded=e,this._parentEl.setAttribute("collapsed",!this._isExpanded);var t=this._isExpanded?"Minimera":"Expandera";this._statusEl.innerHTML=t}}])&&wa(t.prototype,n),i&&wa(t,i),e}();n(80);function ka(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ea=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.classList.add("collapsed-view"),t.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"setData",value:function(e){var t=e.amountNonagons,n="\n            <h5>Antal noder: ".concat(t,"</h5>\n        ");this.el.innerHTML=n}}])&&ka(t.prototype,n),i&&ka(t,i),e}();n(82);function Sa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var xa=Object.freeze({plus:"add",minus:"remove"}),Na=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.classList.add("add-remove-visual-help");var n=document.createElement("img");n.classList.add("add-icon"),n.src="./assets/plus.svg";var i=document.createElement("img");i.classList.add("remove-icon"),i.src="./assets/minus.svg",this.el.appendChild(n),this.el.appendChild(i),t.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"setType",value:function(e){this.el.setAttribute("type",e)}}])&&Sa(t.prototype,n),i&&Sa(t,i),e}();n(84);function Ma(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Pa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Da=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nonagons={},this.parentEl=window.NS.workspaceEl,this.ID=n?n.id:null,this.tempID=i||void 0,this.el=document.createElement("div"),this.el.classList.add("group-container"),this._nodesContainerEl=document.createElement("div"),this._nodesContainerEl.classList.add("nodes-container"),this.el.appendChild(this._nodesContainerEl),this._expandCollapseController=new Ca(this.el),this._collapsedView=new Ea(this.el),this._addRemoveVisualHelp=new Na(this.el),this.onUpdatedRenderOrderBound=this.onUpdatedRenderOrder.bind(this),this.onNodeTabSelectedBound=this.onNodeTabSelected.bind(this),this.nodeSelectionTabs=new ba(this.el,this.onNodeTabSelectedBound,this.onUpdatedRenderOrderBound),this.parentEl.appendChild(this.el);var o=t||(n&&n.data?n.data.pos:{x:window.innerWidth/2,y:window.innerHeight/2});if(this.moveCoords={start:{x:0,y:0},offset:{x:o.x-100,y:o.y-100}},this.lastDelta={x:0,y:0},this.el.style[window.NS.transform]="translate3d(".concat(o.x-100,"px, ").concat(o.y-100,"px, 0)"),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.el.addEventListener("mousedown",this.onMouseDownBound),n){var r=O(this.ID);window.NS.singletons.refs.addGroupRef(r)}}var t,n,i;return t=e,(n=[{key:"isExpanded",value:function(){return this._expandCollapseController.isExpanded}},{key:"getCurrentID",value:function(){return this.ID?this.ID:this.tempID}},{key:"onUpdatedRenderOrder",value:function(e){x({renderOrder:e},this.ID,!0).then(function(e){console.log("render order in group updated")}).catch(function(e){console.log("error updating group",e)})}},{key:"triggerAddEvent",value:function(){var e=new CustomEvent("add-new-group",{detail:this.tempID});document.documentElement.dispatchEvent(e)}},{key:"syncBackend",value:function(){var e=this;return new Promise(function(t,n){var i,o,r={pos:e.moveCoords.offset,nodes:Ma(Object.keys(e.nonagons)),renderOrder:Ma(Object.keys(e.nonagons))};(i=r,o=Object.assign({},i,{timestamp:firebase.firestore.FieldValue.serverTimestamp()}),window.NS.singletons.refs.getDrawingRef().collection("Groups").add(o)).then(function(n){if(e.ID=n.id,e.tempID=null,n)window.NS.singletons.refs.addGroupRef(n);else{var i=O(e.ID);window.NS.singletons.refs.addGroupRef(i)}t(n.id)}).catch(function(e){console.log("err creating group in db",e),n()})})}},{key:"setNodeTabTitle",value:function(e,t){this.nodeSelectionTabs.setTabTitle(e,t)}},{key:"hasNonagons",value:function(){return Object.keys(this.nonagons).length>0}},{key:"amountNonagons",value:function(){return Object.keys(this.nonagons).length}},{key:"onNodeTabSelected",value:function(e){var t=this,n=this.nonagons[e];Object.keys(this.nonagons).forEach(function(e){return t.nonagons[e].groupHide()}),n.groupShow()}},{key:"getPos",value:function(){var e=new THREE.Vector2,t=this.el.getBoundingClientRect();return e.set(t.x+t.width/2,t.y+t.height/2),e}},{key:"showAddHelper",value:function(){this._addRemoveVisualHelp.setType(xa.plus)}},{key:"showRemoveHelper",value:function(){this._addRemoveVisualHelp.setType(xa.minus)}},{key:"hideAddRemoveVisualHelper",value:function(){this._addRemoveVisualHelp.setType(void 0)}},{key:"delete",value:function(){this.el&&this.parentEl.removeChild(this.el)}},{key:"hasNonagon",value:function(e){return!!this.nonagons[e]}},{key:"addNonagon",value:function(e,t){var n=this;if(function(){n.nonagons[e.ID]=e,e.addToGroup(n._nodesContainerEl),n.nodeSelectionTabs.addNode(e),n._collapsedView.setData({amountNonagons:n.amountNonagons()});var t=Object.keys(n.nonagons);1===t.length?e.groupShow():(t.forEach(function(e){n.nonagons[e].groupHide()}),e.groupShow()),n.nodeSelectionTabs.setTabSelected(e.ID)}(),!t){var i=Ma(Object.keys(this.nonagons));x({nodes:i,renderOrder:i},this.ID,!0).then(function(e){console.log("nodes in group updated")}).catch(function(){console.log("error updating group add nonagon")})}}},{key:"removeNonagon",value:function(e,t){var n=this;!function(){if(t.groupShow(),n.nodeSelectionTabs.removeNode(t),t.removeFromGroup(e,n),delete n.nonagons[t.ID],n._collapsedView.setData({amountNonagons:n.amountNonagons()}),n.hasNonagons()){console.log("has nonagons",n.nonagons);var i=Object.keys(n.nonagons),o=n.nonagons[i[0]];o.groupShow(),n.nodeSelectionTabs.setTabSelected(o.ID),t.setSelected()}}();var i=Object.keys(this.nonagons);x({nodes:i,renderOrder:i},this.ID,!0).then(function(e){console.log("node removed from group")}).catch(function(){console.log("error updating group nonagon remove")})}},{key:"onMouseDown",value:function(e){e.preventDefault,e.stopPropagation(),"INPUT"===e.target.nodeName||e.target.classList.contains("prevent-drag")||(this.lastDelta.x=0,this.lastDelta.y=0,this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound))}},{key:"onMouseMove",value:function(e){var t=e.x-this.moveCoords.start.x,n=e.y-this.moveCoords.start.y;this.moveCoords.offset.x=t,this.moveCoords.offset.y=n,this.lastDelta.x=t,this.lastDelta.y=n,this.el.style[window.NS.transform]="translate3d(".concat(t,"px, ").concat(n,"px, 0)")}},{key:"onMouseUp",value:function(){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound),0===this.lastDelta.x&&0===this.lastDelta.y||x({pos:this.lastDelta},this.ID,!0).then(function(){console.log("updated group")}).catch(function(){console.log("error updating group")})}}])&&Pa(t.prototype,n),i&&Pa(t,i),e}();function Oa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ta=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.groups={},this.currentActiveGroup,this.nonagons=[],this.nonagonsToCheck=[],this.nonagonsToCheckLength=0,this.activeNonagon,this.overNonagon,this.onAddGroupToBackendBound=this.onAddGroupToBackend.bind(this),document.documentElement.addEventListener("add-new-group",this.onAddGroupToBackendBound)}var t,n,i;return t=e,(n=[{key:"onAddGroupToBackend",value:function(e){var t=this,n=this.groups[e.detail];n.syncBackend().then(function(i){t.groups[i]=n,delete t.groups[e.detail],console.log("success",t.groups)}).catch(function(){console.log("err")})}},{key:"updateGroupNodeTabTitle",value:function(e,t){var n=this.getGroupFromNonagon(this.nonagons.find(function(t){return t.ID===e}));n&&n.setNodeTabTitle(e,t)}},{key:"setActiveNonagon",value:function(e){var t=this;this.activeNonagon=e,this.nonagonsToCheck=this.nonagons.filter(function(e){return e.ID!==t.activeNonagon.ID}),this.nonagonsToCheckLength=this.nonagonsToCheck.length}},{key:"addNonagon",value:function(e){this.nonagons.push(e)}},{key:"removeNonagon",value:function(e){this.nonagons=this.nonagons.filter(function(t){return t.ID!==e.ID})}},{key:"getGroupFromNonagon",value:function(e){var t=this,n=Object.keys(this.groups).find(function(n){return Object.keys(t.groups[n].nonagons).includes(e.ID)});return n?this.groups[n]:null}},{key:"createGroup",value:function(e,t,n){if(t){var i=new Da(null,t,null);return this.groups[i.ID]=i,i}var o=new Da(e,t,n);return n&&(this.groups[n]=o),o}},{key:"getNonagonGroup",value:function(e){var t=this.getGroupFromNonagon(e);return t?(console.log("return existing group",t.ID),t):(console.log("create new group"),this.createGroup(e.moveCoords.offset,null,e.ID))}},{key:"onOverNonagon",value:function(e){this.currentActiveGroup||(this.currentActiveGroup=this.getNonagonGroup(e)),this.overNonagon=e}},{key:"overNonagonCheck",value:function(){var e=this,t=function(){for(var t=Object.keys(e.groups).filter(function(t){return e.groups[t].isExpanded()}),n=t.length,i=e.activeNonagon.getPos(),o=0;o<n;o++)if(e.groups[t[o]].getPos().distanceTo(i)<280)return e.groups[t[o]];return null}();!t&&this.currentActiveGroup&&this.currentActiveGroup.hideAddRemoveVisualHelper(),this.alreadyConnected&&!t&&(this.alreadyConnected=!1);var n=function(){for(var t=e.activeNonagon.getPos(),n=0;n<e.nonagonsToCheckLength;n++)if(e.nonagonsToCheck[n].getPos().distanceTo(t)<160)return e.nonagonsToCheck[n];return null}();n?this.onOverNonagon(n):t?(this.currentActiveGroup&&this.currentActiveGroup.ID!==t.ID&&this.currentActiveGroup.hideAddRemoveVisualHelper(),this.currentActiveGroup=t):(window.NS.singletons.SelectionManager.deselectAllNonagons(this.nonagonsToCheck),this.currentActiveGroup&&(this.currentActiveGroup.hideAddRemoveVisualHelper(),this.currentActiveGroup.hasNonagons()||(this.currentActiveGroup.delete(),delete this.groups[this.overNonagon.ID]),this.currentActiveGroup=null),this.overNonagon=null)}},{key:"removeFromGroup",value:function(e,t,n){if(t.removeNonagon(e,n),!t.hasNonagons()){var i=t.ID;(o=i,window.NS.singletons.refs.getDrawingRef().collection("Groups").doc(o).delete()).then(function(){console.log("group deleted",i),window.NS.singletons.refs.removeGroupRef(i)}).catch(function(e){console.log("error deleting",e)}),t.delete(),delete this.groups[t.ID],this.currentActiveGroup=null}var o}},{key:"onNodeDragStart",value:function(e){this.currentActiveGroup=null,this.setActiveNonagon(e),this.getGroupFromNonagon(e)&&(this.alreadyConnected=!0),this.overNonagonCheck()}},{key:"onNodeDragMove",value:function(e,t,n){var i=this.getGroupFromNonagon(t);if(i)return i.hideAddRemoveVisualHelper(),void((Math.abs(n.x)>20||Math.abs(n.y)>20)&&this.removeFromGroup(e,i,t));this.currentActiveGroup&&!this.alreadyConnected&&this.currentActiveGroup.showAddHelper(),this.overNonagonCheck()}},{key:"onNodeDragEnd",value:function(){this.currentActiveGroup&&this.activeNonagon&&(0===Object.keys(this.currentActiveGroup.nonagons).length?(this.currentActiveGroup.addNonagon(this.overNonagon),this.currentActiveGroup.addNonagon(this.activeNonagon),this.currentActiveGroup.triggerAddEvent()):this.currentActiveGroup.hasNonagon(this.activeNonagon.ID)||this.currentActiveGroup.addNonagon(this.activeNonagon),this.currentActiveGroup.hideAddRemoveVisualHelper());this.alreadyConnected=!1,this.currentActiveGroup=null}}])&&Oa(t.prototype,n),i&&Oa(t,i),e}();function Ia(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ra=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nonagons={},this.currentSelectedNode=null}var t,n,i;return t=e,(n=[{key:"addNonagon",value:function(e){this.nonagons[e.ID]=e}},{key:"removeNonagon",value:function(e){delete this.nonagons[e.ID]}},{key:"setSelected",value:function(e){this.deselectAllNonagons(void 0),e&&(e.setSelected(),this.nonagons[e.ID]&&(this.currentSelectedNode=e)),window.NS.singletons.PROJECT_TYPE===window.NS.singletons.TYPES.space.id&&window.NS.singletons.CanvasNode.onNodeDeselect()}},{key:"deselectAllNonagons",value:function(e){var t=this;if(this.currentSelectedNode=null,e)for(var n=0;n<e.length;n++)e[n].setNotSelected();else Object.keys(this.nonagons).forEach(function(e){t.nonagons[e].setNotSelected()})}}])&&Ia(t.prototype,n),i&&Ia(t,i),e}();function La(e){return(La="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Aa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ja(e,t){return!t||"object"!==La(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _a(e,t,n){return(_a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Va(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Va(e){return(Va=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ba(e,t){return(Ba=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ha=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ja(this,Va(t).call(this))}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ba(e,t)}(t,Ra),n=t,(i=[{key:"setSelected",value:function(e){var n=this;(_a(Va(t.prototype),"setSelected",this).call(this,e),e&&this.nonagons[e.ID])?(Object.keys(this.nonagons).forEach(function(e){n.nonagons[e].enableHide()}),e.disableHide()):Object.keys(this.nonagons).forEach(function(e){n.nonagons[e].disableHide()})}}])&&Aa(n.prototype,i),o&&Aa(n,o),t}();function Fa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var za=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.collectedInputs=[]}var t,n,i;return t=e,(n=[{key:"showAvailable",value:function(e,t,n,i){var o=t.filter(function(t){return e.ID!==t.ID});this.collectedInputs=[];for(var r=0;r<o.length;r++){var a={node:o[r]};this.collectedInputs.push(a)}for(var s=0;s<this.collectedInputs.length;s++){var l=[],c=this.collectedInputs[s].node,u=c.isModifier?[]:c.nodeType.paramContainers;if(c.isGraphicsNode){for(var d=0;d<l.length;d++){var h=l[d];c.inputHelpersType.isValid(e,c,h.inputType,i)||h.activatePossible()}for(var p=0;p<u.length;p++){var f=u[p];f.isAvailableForConnection(e,c)||f.setAsDisabled()}}else{for(var g=0;g<l.length;g++){var v=l[g];c.inputHelpersType.isValid(e,c,void 0,n,i)||v.activatePossible()}for(var m=0;m<params.length;m++){var y=params[m];y.param.helper.isValid(e,c,y.param,n)||y.activateNotPossible()}}}}},{key:"resetAvailable",value:function(){for(var e=0;e<this.collectedInputs.length;e++){this.collectedInputs[e].inputs,this.collectedInputs[e].params;for(var t=this.collectedInputs[e].node,n=t.isModifier?[]:t.nodeType.paramContainers,i=0;i<n.length;i++){n[i].setAsEnabled()}}}}])&&Fa(t.prototype,n),i&&Fa(t,i),e}();function Ua(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ga=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.selectedDrawing=null,this.nodesAddedCounter=0}var t,n,i;return t=e,(n=[{key:"setSelectedDrawing",value:function(e){this.selectedDrawing=e}},{key:"onNodeAdded",value:function(){this.nodesAddedCounter++,this.isDone()&&(this.initNodeSettings(),this.initGroups(),this.initBackendData())}},{key:"initNodeSettings",value:function(){for(var e=this.selectedDrawing.nodes.filter(function(e){return!!e.data.connectionData}).sort(function(e,t){var n=window.NS.singletons.ConnectionsManager.nodes[e.id];return window.NS.singletons.ConnectionsManager.nodes[t.id].nodeSortIndex-n.nodeSortIndex}),t=function(t){var n=e[t],i=window.NS.singletons.ConnectionsManager.nodes[n.id],o=window.NS.singletons.ConnectionsManager.nodes[n.data.connectionData.node].nodeType.paramContainers.find(function(e){return e.ID===n.data.connectionData.paramContainer});o&&i&&i.nodeType.activateAsChild(o,!1,!0);for(var r=n.data.paramConnections?n.data.paramConnections:[],a=0;a<r.length;a++){var s=window.NS.singletons.ConnectionsManager.params[n.data.paramConnections[a]];s&&window.NS.singletons.ConnectionsManager.addParamConnection(s,i)}},n=0;n<e.length;n++)t(n)}},{key:"initGroups",value:function(){(this.selectedDrawing.groups||[]).forEach(function(e){var t=window.NS.singletons.NodeGroupManager.createGroup(null,e,null);e.data.renderOrder.forEach(function(e){var n=window.NS.singletons.ConnectionsManager.nodes[e];t.addNonagon(n,!0)})})}},{key:"initBackendData",value:function(){Object.values(window.NS.singletons.ConnectionsManager.nodes).forEach(function(e){e.initBackendData&&e.initBackendData()})}},{key:"isDone",value:function(){return this.selectedDrawing.nodes.length===this.nodesAddedCounter}}])&&Ua(t.prototype,n),i&&Ua(t,i),e}();function Ya(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ka=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.hasConfig=!!t,this.nodeLibrary=o,this.availableConnections=new za,this._updateLoopManager=new ua,window.NS.singletons.NodeGroupManager=new Ta,window.NS.singletons.PROJECT_TYPE===window.NS.singletons.TYPES.chemistry.id?window.NS.singletons.SelectionManager=new Ha:window.NS.singletons.SelectionManager=new Ra,this.constructorIsDone=!1,this.keyboardManager=n,this.selectedNode=null,this.enableParamConnectionBound=this.enableParamConnection.bind(this),this.disableParamConnectionBound=this.disableParamConnection.bind(this),this.backendSync=new Ga,this.modifierCollisionManager=new ha,this.windowManager=new la(i.parentElement,this.enableParamConnectionBound,this.disableParamConnectionBound),this._nodes=[],this._nodeConnections=[],this._graphicNodes=[],this._graphicNodeLength=0,this.resetConnectingBound=this.resetConnecting.bind(this),this.isConnecting=!1,this.outputActiveNode=null,this.outputActiveType=void 0,this.onDisconnectBound=this.onDisconnect.bind(this),this.onInputConnectionBound=this.onInputConnection.bind(this),this.addBound=this.add.bind(this),this.removeBound=this.onNodeRemove.bind(this),this.onAudioNodeParamChangeBound=this.onAudioNodeParamChange.bind(this),this.onNodeDragStartBound=this.onNodeDragStart.bind(this),this.onNodeDragMoveBound=this.onNodeDragMove.bind(this),this.onNodeDragReleaseBound=this.onNodeDragRelease.bind(this),this.audioNodeManager=new na(i,null,this.onInputConnectionBound,this.addBound,this.hasConfig?this.config.nodes:[],this.onAudioNodeParamChangeBound,this.removeBound),this.audioNodeManager.init(),this.graphicsNodeManager=new ea(i,this.onDisconnectBound,this.onInputConnectionBound,this.addBound,this.removeBound,this.onNodeDragStartBound,this.onNodeDragMoveBound,this.onNodeDragReleaseBound),this.hasConfig&&console.log("has config",this.config),this.constructorIsDone=!0;var r=this.graphicsNodeManager.createCanvasNode();window.NS.singletons.CanvasNode=r,this.onNodeSelectedEventBound=this.onNodeSelectedEvent.bind(this),document.documentElement.addEventListener("node-selected",this.onNodeSelectedEventBound)}var t,n,i;return t=e,(n=[{key:"init",value:function(e){var t=e||{nodes:[],groups:[]};this.backendSync.setSelectedDrawing(t);for(var n=0;n<t.nodes.length;n++){var i=t.nodes[n],o={type:"graphics",data:i.data};this.initNode(o,i.data.pos,i)}window.NS.singletons.CanvasNode.foregroundRender.fitCameraToObjects()}},{key:"onNodeSelectedEvent",value:function(e){window.NS.singletons.SelectionManager.deselectAllNonagons();for(var t=Object.keys(window.NS.singletons.SelectionManager.nonagons),n=this._nodes.filter(function(e){return!t.some(function(t){return t===e.ID})}),i=0;i<n.length;i++)n[i].setNotSelected();e&&e.detail?(window.NS.singletons.SelectionManager.setSelected(e.detail),this.windowManager.setupForNode(e.detail)):window.NS.singletons.SelectionManager.setSelected(),window.NS.singletons.PROJECT_TYPE===window.NS.singletons.TYPES.space.id&&window.NS.singletons.CanvasNode.onNodeDeselect()}},{key:"onNodeDragStart",value:function(e,t){this.modifierCollisionManager.onModifierDragStart(e.nodeType,t),this.availableConnections.showAvailable(e,this._nodes,this._nodeConnections)}},{key:"onNodeDragMove",value:function(e,t){this.modifierCollisionManager.onModifierDragMove(e,t)}},{key:"onNodeDragRelease",value:function(){this.modifierCollisionManager.onModifierDragRelease(),this.availableConnections.resetAvailable()}},{key:"initNode",value:function(e,t,n){var i=null;if("graphics"===e.type){if(this._nodes.some(function(e){return e.isCanvasNode})&&"Canvas"===e.data.type)return;i=this.graphicsNodeManager.createNode(e.data,t,n)}else i=this.audioNodeManager.createNode(e.data,t,n);return this.nodeLibrary.hide(),i}},{key:"onNodeRemove",value:function(e){this.remove(e)}},{key:"onAudioNodeParamChange",value:function(e,t){this.keyboardManager.onAudioNodeParamChange(e,t)}},{key:"disconnectAnalyserNodes",value:function(e){for(var t=e.filter(function(e){return e.in.isAnalyser}),n=0;n<t.length;n++)t[n].in.dispose()}},{key:"getAudioConnections",value:function(e){return e.filter(function(e){return!e.out.isGraphicsNode&&!e.in.isGraphicsNode})}},{key:"resetConnecting",value:function(){this.isConnecting=!1,this.outputActiveNode=null,this.outputActiveType=void 0,this.availableConnections.resetAvailable()}},{key:"enableParamConnection",value:function(e,t,n){return p[e.param.paramHelpersType].isValid(t,n,e.param,this._nodeConnections)?(S({paramConnections:firebase.firestore.FieldValue.arrayUnion(e.ID)},t.ID,!0).then(function(){console.log("updated node")}).catch(function(){console.log("error updating node")}),window.NS.singletons.ConnectionsManager.addParamConnection(e,t),this._updateLoopManager.add(t),this._updateLoopManager.add(n),!0):(this.resetConnecting(),!1)}},{key:"disableParamConnection",value:function(e,t,n){return S({paramConnections:firebase.firestore.FieldValue.arrayRemove(e.ID)},t.ID,!0).then(function(){console.log("updated node")}).catch(function(){console.log("error updating node")}),window.NS.singletons.ConnectionsManager.removeParamConnection(e,t),this._updateLoopManager.delete(t),this._updateLoopManager.delete(n),!0}},{key:"onInputConnection",value:function(e,t,n){var i=this;if(window.NS.singletons.ConnectionsManager.addNodeConnection(e,t),!n){Object.keys(t.inputParams).filter(function(e){return t.inputParams[e].param.defaultConnect}).map(function(e){return t.inputParams[e]}).forEach(function(t){return i.enableParamConnection(t,e,t.paramContainer.node)});this.windowManager.onNodeConnect(e)}if(n){e.needsUpdate&&this._updateLoopManager.add(e);Object.keys(t.inputParams).filter(function(e){return t.inputParams[e].param.defaultConnect}).map(function(e){return t.inputParams[e]}).forEach(function(e){e.paramContainer.node.needsUpdate&&i._updateLoopManager.add(e.paramContainer.node)})}}},{key:"onDisconnect",value:function(e,t){console.log("on disconnect");for(var n=Object.keys(t.inputParams),i=0;i<n.length;i++){var o=t.inputParams[n[i]];this.disableParamConnection(o,e,t.node)}window.NS.singletons.ConnectionsManager.removeNodeConnection(t,e),this.windowManager.onNodeDisconnect()}},{key:"add",value:function(e){(e.isRendered||e.hasMesh)&&window.NS.singletons.CanvasNode.enableInput(e,"foreground"),this._nodes.push(e),e.isModifier||e.isCanvasNode||(this.modifierCollisionManager.addNonagon(e),window.NS.singletons.NodeGroupManager.addNonagon(e),window.NS.singletons.SelectionManager.addNonagon(e)),this.backendSync.isDone()||this.backendSync.onNodeAdded()}},{key:"remove",value:function(e){window.NS.singletons.StatusWindow.onNodeRemove(e),window.NS.singletons.ConnectionsManager.removeNode(e),(e.isRendered||e.hasMesh)&&window.NS.singletons.CanvasNode.disableInput(e,"foreground"),e.isModifier||e.isCanvasNode||(this.modifierCollisionManager.removeNonagon(e),window.NS.singletons.NodeGroupManager.removeNonagon(e),window.NS.singletons.SelectionManager.removeNonagon(e)),e.removeFromDom();var t,n=this._nodes.filter(function(t){return t.ID!==e.ID});this._nodes=n,(t=e.ID,window.NS.singletons.refs.getDrawingRef().collection("Nodes").doc(t).delete()).then(function(){console.log("node deleted",e.ID),window.NS.singletons.refs.removeNodeRef(e.ID)}).catch(function(e){console.log("error deleting",e)}),this.windowManager.blur()}},{key:"update",value:function(){this._updateLoopManager.update(),window.NS.singletons.CanvasNode.update()}},{key:"render",value:function(){this._updateLoopManager.render(),window.NS.singletons.CanvasNode.render()}}])&&Ya(t.prototype,n),i&&Ya(t,i),e}();function Xa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Wa=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.workspaceManager=t,this.isModifier=i,this.moveCoords={start:{x:0,y:0},offset:{x:n.x,y:n.y}},this.deltaX=0,this.deltaY=0,this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this)}var t,n,i;return t=e,(n=[{key:"getPos",value:function(){var e=this.isModifier?-20:-130,t=Math.abs(this.workspaceManager.moveCoords.offset.x),n=Math.abs(this.workspaceManager.moveCoords.offset.y);return{x:this.moveCoords.offset.x+t+e,y:this.moveCoords.offset.y+n+e}}},{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this.deltaX=0,this.deltaY=0,this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y}},{key:"onMouseMove",value:function(e){var t=e.x,n=e.y,i=t-this.moveCoords.start.x,o=n-this.moveCoords.start.y;this.moveCoords.offset.x=i,this.moveCoords.offset.y=o;Math.abs(this.workspaceManager.moveCoords.offset.x),Math.abs(this.workspaceManager.moveCoords.offset.y);this.deltaX=i,this.deltaY=o}},{key:"onMouseUp",value:function(e){}}])&&Xa(t.prototype,n),i&&Xa(t,i),e}(),qa={graphics:{"3d-shapes":[{type:"Planet",isModifier:!1},{title:"Partiklar",type:"Particles",isModifier:!1},{title:"Solen",type:"Sun",isModifier:!1}],Modifiers:[{title:"Planet storlek",type:"Size Modifier",isModifier:!0},{title:"Planet textur",type:"Texture Selector",isModifier:!0},{type:"Planet Position",isModifier:!0},{type:"Planet Rotation",isModifier:!0},{type:"Form",isModifier:!0},{type:"Color",isModifier:!0}]}},Ja={graphics:{"3d-shapes":[{type:"Atom",isModifier:!1}],Modifiers:[{type:"Protons",isModifier:!0},{type:"Neutrons",isModifier:!0},{type:"Electrons",isModifier:!0}]}};function Za(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Qa=function(){function e(t,n,i,o,r,a){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.type=n,this.setMouseDown=o,this.workspaceManager=r,this.onNodeAddedCallback=a,this.nodeToPlaceData={type:void 0,data:void 0},this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.el=document.createElement("div"),this.el.classList.add("library-tab"),this.parentEl.appendChild(this.el);var l=document.createElement("div");l.className="outer-scroll",this.el.appendChild(l);var c=document.createElement("div");c.className="inner-scroll",l.appendChild(c);var u=function(e){var t=document.createElement("div");t.className="level-0";var n=document.createElement("h4");n.className="level-title",n.innerHTML=e,t.appendChild(n);var o=function(o){var r=document.createElement("div");r.className="level-1",(n=document.createElement("h4")).className="level-title",n.innerHTML=o,r.appendChild(n),t.appendChild(r);var a=document.createElement("div");a.className="node-container",r.appendChild(a);for(var l=function(t){var n=document.createElement("div"),r=i[e][o][t].isModifier;n.className="library-node".concat(r?" modifier":""),n.setAttribute("data-type-0",e),n.setAttribute("data-type-1",o);var l=document.createElement("h4");l.className="node-type",l.innerHTML=i[e][o][t].type;var c=i[e][o][t].title;c&&(l.innerHTML=c);var u=i[e][o][t].type,d="".concat(u,r?"-modifier":"-node"),h=r?s.getTriangleShape():s.getNonagonShape(!0);if(n.appendChild(h),d){var p="".concat(d.replace(" ","-").toLowerCase(),"-icon"),f=new Image;f.onload=function(){n.appendChild(f)},f.src="./assets/icons/white/".concat(p,".svg")}n.appendChild(l),a.appendChild(n),n.addEventListener("mousedown",function(n){s.nodeToPlaceData.type=e,s.nodeToPlaceData.data=i[e][o][t],s.onMouseDown(n)})},c=0;c<i[e][o].length;c++)l(c)};for(var r in i[e])o(r);c.appendChild(t)};for(var d in i)u(d)}var t,n,i;return t=e,(n=[{key:"show",value:function(){this.el.classList.add("visible")}},{key:"hide",value:function(){this.el.classList.remove("visible")}},{key:"onMouseDown",value:function(e){this.setMouseDown(!0),this.nodePlaceHelper=new Wa(this.workspaceManager,{x:e.clientX,y:e.clientY},this.nodeToPlaceData.data.isModifier,this.nodeToPlaceData.data.isModifier?this.getTriangleShape():this.getNonagonShape()),this.nodePlaceHelper.onMouseDown(e),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){this.nodePlaceHelper.onMouseMove(e);var t=this.nodePlaceHelper.getPos();if(Math.abs(this.nodePlaceHelper.deltaX)>4&&!this.currentCreatedNode){var n=this.onNodeAddedCallback(this.nodeToPlaceData,t);return this.currentCreatedNode=n,void n.onMouseDown(e,!1)}this.currentCreatedNode&&this.currentCreatedNode.onMouseMove(e)}},{key:"onMouseUp",value:function(e){this.nodePlaceHelper.onMouseUp(),this.currentCreatedNode&&this.currentCreatedNode.onMouseUp(e,!1),this.currentCreatedNode=null,window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound),this.nodeToPlaceData={type:void 0,data:void 0},this.setMouseDown(!1)}},{key:"getTriangleShape",value:function(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("modifier"),e.setAttribute("width","44px"),e.setAttribute("height","44px"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","rgba(50, 50, 50, .9)");var t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","M23.677 18.52c.914 1.523-.183 3.472-1.967 3.472h-19.414c-1.784 0-2.881-1.949-1.967-3.472l9.709-16.18c.891-1.483 3.041-1.48 3.93 0l9.709 16.18z"),e.appendChild(t),e}},{key:"getNonagonShape",value:function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width",e?"50px":"260px"),t.setAttribute("height",e?"50px":"260px"),t.setAttribute("viewBox","0 0 1200 1200"),t.setAttribute("fill","rgba(50, 50, 50, .9)");var n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M464.133,1097.487c-22.564,0-55.171-11.867-72.457-26.372l-208.16-174.667c-17.285-14.504-34.635-44.554-38.553-66.777\n\t\t\t\t\t\tL97.777,562.066c-3.918-22.223,2.107-56.394,13.391-75.936l135.865-235.328c11.283-19.542,37.863-41.846,59.068-49.563\n\t\t\t\t\t\tL561.446,108.3c21.205-7.718,55.902-7.718,77.107,0L893.9,201.239c21.205,7.718,47.785,30.021,59.067,49.563l135.864,235.328\n\t\t\t\t\t\tc11.283,19.542,17.309,53.713,13.391,75.936l-47.186,267.604c-3.918,22.224-21.268,52.273-38.553,66.777l-208.16,174.667\n\t\t\t\t\t\tc-17.286,14.505-49.893,26.372-72.457,26.372H464.133z\n\t\t"),t.appendChild(n),t}}])&&Za(t.prototype,n),i&&Za(t,i),e}();function $a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var es=function(){function e(t,n){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.el=document.createElement("div"),this.el.classList.add("tab-selector"),this.tabs={},n.forEach(function(e){var t=document.createElement("div");t.classList.add("tab-item"),t.addEventListener("click",function(){i.onTabClick(e.type)});var n=document.createElement("h5");n.innerHTML=e.type,t.appendChild(n),i.el.appendChild(t),i.tabs[e.type]={el:t,obj:e}}),this.parentEl.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"onTabClick",value:function(e){this.setTabSelected(e)}},{key:"deselectTabs",value:function(){var e=this;Object.keys(this.tabs).forEach(function(t){var n=e.tabs[t];n.el.classList.remove("selected"),n.obj.hide()})}},{key:"setTabSelected",value:function(e){this.deselectTabs();var t=this.tabs[e];t.el.classList.add("selected"),t.obj.show()}}])&&$a(t.prototype,n),i&&$a(t,i),e}();n(86);function ts(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ns=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.hasDoneInitOnNodeCreation=!1,this.currentCreatedNode=null,this.onMouseOverBound=this.onMouseOver.bind(this),this.onMouseOutBound=this.onMouseOut.bind(this),this.mouseIsDown=!1,this.el=document.createElement("div"),this.el.className="node-library",this.setMouseDownBound=this.setMouseDown.bind(this),this.spaceTab=new Qa(this.el,"Rymden",qa,this.setMouseDownBound,i,n),this.chemistryTab=new Qa(this.el,"Kemi",Ja,this.setMouseDownBound,i,n);var o={space:this.spaceTab,chemistry:this.chemistryTab};this.tabSelector=new es(this.el,[o[window.NS.singletons.PROJECT_TYPE]]);var r=window.NS.singletons.TYPES[window.NS.singletons.PROJECT_TYPE].title;this.tabSelector.setTabSelected(r||"Rymden"),this.isShowing=!1,this.el.addEventListener("mouseover",this.onMouseOverBound),this.titleEl=document.createElement("h4"),this.titleEl.innerHTML="NODE LIBRARY",this.titleEl.className="title-bar",this.el.appendChild(this.titleEl),this.parentEl.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"setMouseDown",value:function(e){this.mouseIsDown=e}},{key:"onMouseOver",value:function(){this.mouseIsDown||this.isShowing||this.show()}},{key:"onMouseOut",value:function(){this.mouseIsDown||this.isShowing&&this.hide()}},{key:"hide",value:function(){this.isShowing=!1,this.el.classList.remove("showing"),this.el.removeEventListener("mouseout",this.onMouseOutBound)}},{key:"show",value:function(){this.isShowing=!0,this.el.classList.add("showing"),this.el.addEventListener("mouseout",this.onMouseOutBound)}}])&&ts(t.prototype,n),i&&ts(t,i),e}();function is(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var os=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),e.KEY_INTS=[65,83,68,70,71,72,74,75,76,186,222,219],this.keys=[];for(var t=0;t<e.KEY_INTS.length;t++){var n={keyNr:e.KEY_INTS[t],step:t,triggered:!1,synth:new gt(t)};this.keys.push(n)}this.onKeyDownBound=this.onKeyDown.bind(this),this.onKeyUpBound=this.onKeyUp.bind(this),window.addEventListener("keydown",this.onKeyDownBound),window.addEventListener("keyup",this.onKeyUpBound)}var t,n,i;return t=e,(n=[{key:"onKeyDown",value:function(e){var t=e.keyCode,n=this.getKey(t);if(null!==n){if(n.triggered)return;n.triggered=!0,n.synth.keyDown()}}},{key:"onKeyUp",value:function(e){var t=e.keyCode,n=this.getKey(t);if(null!==n){if(!n.triggered)return;n.triggered=!1,n.synth.keyUp()}}},{key:"enable",value:function(){window.addEventListener("keydown",this.onKeyDownBound),window.addEventListener("keyup",this.onKeyUpBound)}},{key:"disable",value:function(){window.removeEventListener("keydown",this.onKeyDownBound),window.removeEventListener("keyup",this.onKeyUpBound)}},{key:"play",value:function(e,t){this.keys[e].synth.play(t)}},{key:"onAudioNodeConnectionUpdate",value:function(e){for(var t=0;t<this.keys.length;t++)this.keys[t].synth.updateConnections(e)}},{key:"onAudioNodeParamChange",value:function(e,t){for(var n=0;n<this.keys.length;n++)this.keys[n].synth.onParamChange(e,t)}},{key:"getKey",value:function(e){for(var t=null,n=0;n<this.keys.length;n++)this.keys[n].keyNr!==e||(t=this.keys[n]);return t}}])&&is(t.prototype,n),i&&is(t,i),e}();function rs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var as=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=3e3,this.height=2e3,this.onClickCallback=n,this.containerEl=document.createElement("div"),this.containerEl.className="workspace-container",t.appendChild(this.containerEl),this.el=document.createElement("div"),this.el.className="workspace",this.el.style.width=this.width+"px",this.el.style.height=this.height+"px",this.containerEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.currentScale=1,this.moveCoords={start:{x:0,y:0},offset:{x:-(this.width/2-window.innerWidth/2),y:-(this.height/2-window.innerHeight/2)}},this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0)"),this.el.addEventListener("mousedown",this.onMouseDownBound)}var t,n,i;return t=e,(n=[{key:"disable",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound)}},{key:"enable",value:function(){this.el.addEventListener("mousedown",this.onMouseDownBound)}},{key:"setScale",value:function(e){this.currentScale=e,this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0) scale(").concat(e,")")}},{key:"onMouseDown",value:function(e){"INPUT"===e.target.nodeName||e.target.classList.contains("prevent-drag")||(this.onClickCallback(),e.preventDefault(),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,window.addEventListener("mousemove",this.onMouseMoveBound),window.addEventListener("mouseup",this.onMouseUpBound))}},{key:"onMouseMove",value:function(e){e.preventDefault();var t=e.x-this.moveCoords.start.x,n=e.y-this.moveCoords.start.y;this.moveCoords.offset.x=t,this.moveCoords.offset.y=n,this.el.style[window.NS.transform]="translate3d(".concat(t,"px, ").concat(n,"px, 0) scale(").concat(this.currentScale,")")}},{key:"onMouseUp",value:function(e){window.removeEventListener("mousemove",this.onMouseMoveBound),window.removeEventListener("mouseup",this.onMouseUpBound)}},{key:"onResize",value:function(e,t){this.containerEl.style.width="".concat(e,"px"),this.containerEl.style.height="".concat(t,"px")}}])&&rs(t.prototype,n),i&&rs(t,i),e}();function ss(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ls=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentDay=0,this.currentYear=0,this.multiplier=1,this.isRunning=!1,this.counter=0,this._secondsCounter=0,this._timestamp=performance.now(),this.update=this.update.bind(this)}var t,n,i;return t=e,(n=[{key:"reset",value:function(){this.currentDay=0,this.currentYear=1,this.multiplier=0,this.counter=0}},{key:"start",value:function(){this._timestamp=performance.now(),this.isRunning=!0,this.animFrame=requestAnimationFrame(this.update)}},{key:"stop",value:function(){this.isRunning=!1,cancelAnimationFrame(this.animFrame)}},{key:"update",value:function(){this.animFrame=requestAnimationFrame(this.update);var e=performance.now(),t=e-this._timestamp;this._timestamp=e;var n=t/1e3%60;this.counter+=n*this.secondsMultiplier}},{key:"getNormalizedCurrentHourInDay",value:function(e){return Math.abs(this.counter%e/e)}},{key:"getCurrentHourInDay",value:function(){return this.counter%1*24}},{key:"getCurrentDay",value:function(){return Math.floor(this.counter%365)}},{key:"getNormalizedPositionInYear",value:function(e){return Math.min(this.counter%e/e,1)}},{key:"getCurrentYear",value:function(){return Math.floor(this.counter/365)}},{key:"multiplier",set:function(e){this._multiplier=e,this.secondsMultiplier=e},get:function(){return this._multiplier}},{key:"secondsMultiplier",set:function(e){this._secondsMultiplier=e/24},get:function(){return this._secondsMultiplier}}])&&ss(t.prototype,n),i&&ss(t,i),e}();function cs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var us=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.planetsToCheckDistance=[],window.NS.singletons.lessons.space={},window.NS.singletons.lessons.space.distanceModifier=0,this.origin=new THREE.Vector3,this.spaceTimeController=new ls,this.onCameraChangedBound=this.onCameraChanged.bind(this),document.documentElement.addEventListener("camera-pos-changed",this.onCameraChangedBound)}var t,n,i;return t=e,(n=[{key:"onCameraChanged",value:function(e){var t=this;if(this.planetsToCheckDistance&&0!==this.planetsToCheckDistance.length){for(var n,i,o,r=window.NS.singletons.ConnectionsManager.getConnectedNodeWithType(this.planetsToCheckDistance[0].ID,"Space Orbit"),a=new THREE.Vector3(e.detail.x,0,e.detail.z),s=0,l=0;l<this.planetsToCheckDistance.length;l++){var c=(this.planetsToCheckDistance[l],n=void 0,i=void 0,o=void 0,n=a.distanceToSquared(t.origin),i=r?r.currentDistanceToOrigin:0,o=Math.abs(n-i),Math.max(Math.min(1-(o-3e3)/200,1),0));c>0&&(s=c)}window.NS.singletons.lessons.space.distanceModifier=s}}},{key:"addPlanetToCheckDistance",value:function(e){this.removePlanetToCheckDistance(e),this.planetsToCheckDistance.push(e)}},{key:"removePlanetToCheckDistance",value:function(e){var t=this.planetsToCheckDistance.filter(function(t){return t.ID!==e.ID});this.planetsToCheckDistance=t}}])&&cs(t.prototype,n),i&&cs(t,i),e}();function ds(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function hs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ps=function(e){return["".concat(e[0],"-").concat(e[1]),"".concat(e[1],"-").concat(e[0])]},fs=function(e){var t,n;(t={atomConnections:e},n=Object.assign({},t,{timestamp:firebase.firestore.FieldValue.serverTimestamp()}),window.NS.singletons.refs.getDrawingRef().update(n)).then(function(){console.log("drawing updated")}).catch(function(){console.log("err updating")})},gs=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.connections=new Map}var t,n,i;return t=e,(n=[{key:"init",value:function(e){var t=this,n=e.atomConnections;if(n){Object.keys(n).forEach(function(e){var i=n[e];t.connections.set(e,i);var o=i.connectingAtom,r=o.id,a=o.orbitalAngle,s=o.positionKey,l=i.dragAtom,c=l.id,u=l.orbitalAngle,d=l.positionKey,h=window.NS.singletons.ConnectionsManager.getNode(c),p=window.NS.singletons.ConnectionsManager.getNode(r),f=h.outerRing;f.markPositionAsTaken(d),p.outerRing.markPositionAsTaken(s);var g=window.NS.singletons.ConnectionsManager.getConnectedNodeWithType(c,"electrons").getConnectedElectrons(),v=ce(a*(Math.PI/180))*(180/Math.PI),m=g.find(function(e){return Number(e.getRingIndex())===f.index&&e.orbitalAngle===u});if(u!==v){new $o(m.mesh,u,v,f.radius,h.position);m.overrideConnectionAngle=v}});var i=new CustomEvent(Vo);document.documentElement.dispatchEvent(i)}}},{key:"getConnection",value:function(e){return this.connections.get(e)}},{key:"hasConnections",value:function(e){return this.findConnections(e).length>0}},{key:"findConnections",value:function(e){var t=[],n=!0,i=!1,o=void 0;try{for(var r,a=this.connections.entries()[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var s=ds(r.value,2),l=s[0],c=s[1];e!==c.dragAtom.id&&e!==c.connectingAtom.id||t.push(l)}}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return t}},{key:"getConnectionPart",value:function(e,t){return t.dragAtom.id===e?t.dragAtom:t.connectingAtom}},{key:"addConnection",value:function(e,t,n,i,o,r){var a={dragAtom:{id:e,orbitalAngle:n,positionKey:o},connectingAtom:{id:t,orbitalAngle:i,positionKey:r}},s=ps([e,t]);this.connections.has(s[0])||this.connections.has(s[1])||this.connections.set(s[0],a),this.syncConnections()}},{key:"removeConnection",value:function(e){this.connections.delete(e)}},{key:"syncConnections",value:function(){var e={},t=!0,n=!1,i=void 0;try{for(var o,r=this.connections.entries()[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=ds(o.value,2),s=a[0],l=a[1];e[s]=l}}catch(e){n=!0,i=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}fs(e);var c=new CustomEvent(Vo);document.documentElement.dispatchEvent(c)}}])&&hs(t.prototype,n),i&&hs(t,i),e}();function vs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ms=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._hidePlaneGeometry=new THREE.PlaneGeometry(1,1);var t=new THREE.Color(0,0,0).getHex();this._hidePlaneMaterial=new THREE.MeshBasicMaterial({transparent:!0,opacity:.8,color:t,side:THREE.DoubleSide})}var t,n,i;return t=e,(n=[{key:"getAtomHidePlane",value:function(){var e=new THREE.Mesh(this._hidePlaneGeometry,this._hidePlaneMaterial);return e.position.z=.51,e.scale.set(12,12,1),e.visible=!1,e}}])&&vs(t.prototype,n),i&&vs(t,i),e}();function ys(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var bs=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.space=null,window.NS.singletons.PROJECT_TYPE===window.NS.singletons.TYPES.space.id&&(this.space=new us),window.NS.singletons.PROJECT_TYPE===window.NS.singletons.TYPES.chemistry.id&&(this.atomConnectionsManager=new gs,this.shared=new ms)}var t,n,i;return t=e,(n=[{key:"init",value:function(e){window.NS.singletons.PROJECT_TYPE===window.NS.singletons.TYPES.chemistry.id&&this.atomConnectionsManager.init(e.doc)}}])&&ys(t.prototype,n),i&&ys(t,i),e}();n(88);function ws(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Cs=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.unsavedChanges={},this.el=document.createElement("div"),this.el.className="status-window",this.onClickBound=this.onClick.bind(this),this.onSaveDialogClose=this.onSaveDialogClose.bind(this),this.statusText=document.createElement("p"),this.el.appendChild(this.statusText),this.btn=document.createElement("button"),this.btn.addEventListener("click",this.onClickBound);var n=document.createElement("p");this.btn.appendChild(n),n.innerHTML="Spara",this.el.appendChild(this.btn),t.appendChild(this.el),this._timeout=void 0}var t,n,i;return t=e,(n=[{key:"addEvent",value:function(e){this.unsavedChanges[e.id]=Object.assign({},this.unsavedChanges[e.id],e.saveData),this.onUnsavedChanges()}},{key:"onNodeRemove",value:function(e){delete this.unsavedChanges[e.ID],0===Object.keys(this.unsavedChanges).length&&this.onSaved()}},{key:"onClick",value:function(){var e=this;clearTimeout(this._timeout),this._timeout=void 0;var t=Object.keys(this.unsavedChanges).map(function(t){return n=t,i=e.unsavedChanges[t],(o=window.NS.singletons.refs.getNodeRef(n))?o.update(i):(console.log("didnt find ref on update"),Promise.resolve());var n,i,o});Promise.all(t).then(function(){console.log("all updated"),e.onSaved()}).catch(function(){console.log("error")})}},{key:"onSaveDialogClose",value:function(){window.NS.singletons.DialogManager.saveDialog.hide(),this._timeout=void 0}},{key:"onSaved",value:function(){this.unsavedChanges={},this.el.classList.remove("unsaved"),window.NS.singletons.DialogManager.saveDialog.hide(),clearTimeout(this._timeout),this._timeout=void 0}},{key:"onUnsavedChanges",value:function(){this.el.classList.add("unsaved"),this.statusText.innerHTML="<span>Du har osparade ändringar !</span>",this._timeout||(this._timeout=this.getTimeout())}},{key:"getTimeout",value:function(){var e=this;return setTimeout(function(){window.NS.singletons.DialogManager.saveDialog.hide(),window.NS.singletons.DialogManager.saveDialog.shouldShow()?window.NS.singletons.DialogManager.saveDialog.show(e.onClickBound,e.onSaveDialogClose):e._timeout=e.getTimeout()},5e3)}}])&&ws(t.prototype,n),i&&ws(t,i),e}();n(90);function ks(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Es=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.classList.add("delete-view"),this.img=new Image,this.img.src="./assets/delete.svg",this.el.appendChild(this.img),document.body.appendChild(this.el),t.appendChild(this.el),this.deleteOnRelease=!1}var t,n,i;return t=e,(n=[{key:"onNodeMoveStart",value:function(){this.deleteOnRelease=!1,this.el.classList.add("visible")}},{key:"onNodeMove",value:function(e,t){var n=new THREE.Vector2(e,t),i=this.getPos(),o=n.distanceTo(i);this.deleteOnRelease=o<50;var r=1+(400-Math.min(400,o))/400*.75;this.img.style.transform="scale(".concat(r,")")}},{key:"deleteOnNodeRelease",value:function(){return this.el.classList.remove("visible"),this.img.style.transform="scale(1.0)",this.deleteOnRelease}},{key:"getPos",value:function(){var e=new THREE.Vector2,t=this.el.getBoundingClientRect();return e.set(t.x+t.width/2,t.y+t.height/2),e}}])&&ks(t.prototype,n),i&&ks(t,i),e}();n(92);function Ss(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var xs=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.el=document.createElement("div"),this.el.classList.add("verification-dialog"),this.el.classList.add("hidden");this.el.innerHTML='\n            <div class="inner-content">\n                <h4>ÄR DU SÄKER ?</h4>\n                <button type="button" class="yes-btn">\n                    <h5>Ja</h5>\n                </button>\n                <button type="button" class="no-btn">\n                    <h5>Nej</h5>\n                </button>\n            </div>\n        ',this.parentEl.appendChild(this.el),this.onYesBtn=this.el.querySelector(".yes-btn"),this.onNoBtn=this.el.querySelector(".no-btn"),this.onYesFn=null,this.onNoFn=null}var t,n,i;return t=e,(n=[{key:"show",value:function(e,t){this.el.classList.remove("hidden"),this.onYesFn=e,this.onNoFn=t,this.onYesBtn.addEventListener("click",this.onYesFn),this.onNoBtn.addEventListener("click",this.onNoFn)}},{key:"hide",value:function(){this.el.classList.add("hidden"),this.onYesBtn.removeEventListener("click",this.onYesFn),this.onNoBtn.removeEventListener("click",this.onNoFn)}}])&&Ss(t.prototype,n),i&&Ss(t,i),e}();n(94);function Ns(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ms=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.el=document.createElement("div"),this.el.classList.add("loader"),this.el.classList.add("hidden"),this.loaderImg=new Image,this.loaderImg.className="loader-img",this.loaderImg.src="./assets/loader.svg",this.parentEl.appendChild(this.el)}var t,n,i;return t=e,(n=[{key:"show",value:function(){this.el.classList.remove("hidden"),this.el.appendChild(this.loaderImg)}},{key:"hide",value:function(){this.el.classList.add("hidden"),this.el.removeChild(this.loaderImg)}}])&&Ns(t.prototype,n),i&&Ns(t,i),e}();n(96);function Ps(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ds=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.el=document.createElement("div"),this.el.classList.add("new-project-dialog"),this.el.classList.add("hidden");this.el.innerHTML='\n            <div class="inner-content">\n                <div class="title-container">\n                    <h4>Projektnamn:</h4>\n                    <input class="title-input" type="text" placeholder="Projektnamn" />\n                </div>\n                <div class="dropdown-container"></div>\n                <button class="save-btn btn" type="button"><h5>Spara</h5></button>\n                <button class="cancel-btn btn" type="button"><h5>Avbryt</h5></button>\n            </div>\n        ';var n,i=this.el.querySelector(".dropdown-container"),o=(n=window.NS.singletons.TYPES,Object.keys(n).map(function(e){return{id:e,title:n[e].title}}));this.selectedType=null,this.onTypeSelectedBound=this.onTypeSelected.bind(this),this.typeDropdown=new _n(i,o,"Välj typ av projekt:",this.onTypeSelectedBound),this.parentEl.appendChild(this.el),this.inputEl=this.el.querySelector(".title-input"),this.onSaveClickBound=this.onSaveClick.bind(this),this.onCancelClickBound=this.onCancelClick.bind(this),this.onSaveBtn=this.el.querySelector(".save-btn"),this.onCancelBtn=this.el.querySelector(".cancel-btn"),this.onSaveFn=null,this.onCancelFn=null}var t,n,i;return t=e,(n=[{key:"onTypeSelected",value:function(e,t,n){console.log("type: ",t," sdf: ",n),this.selectedType=t}},{key:"onSaveClick",value:function(){var e=this.inputEl.value;if(!(e.length<=0)&&this.selectedType){var t=this.selectedType.id;this.onSaveFn(e,t)}}},{key:"onCancelClick",value:function(){this.inputEl.value="",this.onCancelFn()}},{key:"show",value:function(e,t){this.el.classList.remove("hidden"),this.onSaveFn=e,this.onCancelFn=t,this.onSaveBtn.addEventListener("click",this.onSaveClickBound),this.onCancelBtn.addEventListener("click",this.onCancelClickBound)}},{key:"hide",value:function(){this.el.classList.add("hidden"),this.onSaveBtn.removeEventListener("click",this.onSaveFn),this.onCancelBtn.removeEventListener("click",this.onCancelFn)}},{key:"onError",value:function(){this.el.classList.add("error")}}])&&Ps(t.prototype,n),i&&Ps(t,i),e}();n(98);function Os(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ts=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this._canShowSaveDialog=n,this.el=document.createElement("div"),this.el.classList.add("save-dialog"),this.el.classList.add("hidden");this.el.innerHTML='\n            <div class="inner-content">\n                <h4>Du har osparade ändringar</h4>\n                <button type="button" class="save">\n                    <h5>Spara nu</h5>\n                </button>\n                <button type="button" class="close">\n                    <h5>Stäng</h5>\n                </button>\n            </div>\n        ',this.parentEl.appendChild(this.el),this.onSaveBtn=this.el.querySelector(".save"),this.onCloseBtn=this.el.querySelector(".close"),this.onYesFn=null,this.onNoFn=null}var t,n,i;return t=e,(n=[{key:"shouldShow",value:function(){return this._canShowSaveDialog()}},{key:"show",value:function(e,t){this.el.classList.remove("hidden"),this.onYesFn=e,this.onNoFn=t,this.onSaveBtn.addEventListener("click",this.onYesFn),this.onCloseBtn.addEventListener("click",this.onNoFn)}},{key:"hide",value:function(){this.el.classList.add("hidden"),this.onSaveBtn.removeEventListener("click",this.onYesFn),this.onCloseBtn.removeEventListener("click",this.onNoFn)}}])&&Os(t.prototype,n),i&&Os(t,i),e}();function Is(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Rs=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.verificationDialog=new xs(t),this.loaderDialog=new Ms(t),this.newProjectDialog=new Ds(t),this.saveDialog=new Ts(t,n),this._dialogs=[this.verificationDialog,this.loaderDialog,this.newProjectDialog,this.saveDialog]}var t,n,i;return t=e,(n=[{key:"hideAll",value:function(){this._dialogs.forEach(function(e){return e.hide()})}}])&&Is(t.prototype,n),i&&Is(t,i),e}();function Ls(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var As=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nodes={},this.params={},this.paramConnections={},this.nodeConnections={},this.nodeConnectionsUpdateEvent=new CustomEvent("node-connections-update"),this.paramConnectionsUpdateEvent=new CustomEvent("param-connections-update")}var t,n,i;return t=e,(n=[{key:"getNode",value:function(e){return this.nodes[e]}},{key:"addNode",value:function(e){var t=this;if(this.nodes[e.ID]=e,!e.isModifier){var n=Object.keys(this.nodes).filter(function(e){return!t.nodes[e].isModifier}).indexOf(e.ID);e.nodeIndex=n}var i=new CustomEvent("node-added-event");document.documentElement.dispatchEvent(i)}},{key:"removeNode",value:function(e){for(var t=this,n=this.paramConnections[e.ID]?this.paramConnections[e.ID]:[],i=0;i<n.length;i++){var o=n[i];this.removeParamConnection(this.params[o.paramID],this.nodes[o.outNodeID])}for(var r=Object.keys(this.paramConnections),a=0;a<r.length;a++)for(var s=this.paramConnections[r[a]],l=0;l<s.length;l++)if(s[l].outNodeID===e.ID){var c=this.params[s[l].paramID],u=this.nodes[s[l].outNodeID];this.removeParamConnection(c,u)}for(var d=this.nodeConnections[e.ID]?this.nodeConnections[e.ID]:[],h=function(n){var i=d[n],o=e.nodeType.paramContainers.find(function(e){return e.ID===i.paramContainerID});t.removeNodeConnection(o,t.nodes[i.outNodeID],!0)},p=0;p<d.length;p++)h(p);for(var f=Object.keys(this.nodeConnections),g=function(n){for(var i=t.nodeConnections[f[n]],o=function(o){if(i[o].outNodeID===e.ID){var r=t.nodes[f[n]].nodeType.paramContainers.find(function(e){return e.ID===i[o].paramContainerID});t.removeNodeConnection(r,t.nodes[i[o].outNodeID])}},r=0;r<i.length;r++)o(r)},v=0;v<f.length;v++)g(v);delete this.nodes[e.ID];var m=new CustomEvent("node-removed-event");document.documentElement.dispatchEvent(m),console.log("paramConnections: ",this.paramConnections),console.log("nodeConnections: ",this.nodeConnections)}},{key:"addParam",value:function(e){this.params[e.ID]=e}},{key:"removeParam",value:function(e){delete this.params[e.ID]}},{key:"getNewNodeConnectionObj",value:function(e,t){return{outNodeID:e.ID,paramContainerID:t.ID}}},{key:"hasNodeConnection",value:function(e,t){var n=this.nodeConnections[e];return!!n&&n.some(function(e){return e.outNodeID===t})}},{key:"addNodeConnection",value:function(e,t){var n=this.getNewNodeConnectionObj(e,t),i=t.node.ID;i in this.nodeConnections||(this.nodeConnections[i]=[]),this.nodeConnections[i].push(n);var o=new CustomEvent("node-connections-update",{detail:this.nodeConnections});document.documentElement.dispatchEvent(o)}},{key:"removeNodeConnection",value:function(e,t,n){n&&t.onNodeDisconnectFromNonagonDelete();var i=e.node.ID,o=this.nodeConnections[i]?this.nodeConnections[i]:[];this.nodeConnections[i]=o.filter(function(n){return n.paramContainerID!==e.ID&&n.outNodeID!==t.ID}),0===this.nodeConnections[i].length&&delete this.nodeConnections[i];var r=new CustomEvent("node-connections-update",{detail:this.nodeConnections});document.documentElement.dispatchEvent(r)}},{key:"getNewParamConnectionObj",value:function(e,t){return{outNodeID:e.ID,paramID:t.ID}}},{key:"addParamConnection",value:function(e,t){try{var n=this.getNewParamConnectionObj(t,e),i=e.paramContainer.node.ID;i in this.paramConnections||(this.paramConnections[i]=[]),this.paramConnections[i].push(n);var o=new CustomEvent("param-connections-add",{detail:{inNodeID:i,connection:n}});document.documentElement.dispatchEvent(o)}catch(e){console.error("add param connection error: ",e)}}},{key:"removeParamConnection",value:function(e,t){var n=e.paramContainer.node.ID;if(n in this.paramConnections){this.paramConnections[n]=this.paramConnections[n].filter(function(t){return t.paramID!==e.ID}),0===this.paramConnections[n].length&&delete this.paramConnections[n];var i={inNodeID:n,connection:{outNodeID:t.ID,paramID:e.ID}},o=new CustomEvent("param-connections-remove",{detail:i});document.documentElement.dispatchEvent(o)}}},{key:"getNodesWithType",value:function(e,t){var n=this;return Object.keys(this.nodes).filter(function(i){return n.nodes[i].type&&n.nodes[i].type===e&&n.nodes[i].ID!==t}).map(function(e){return n.nodes[e]})}},{key:"getConnectedNodeWithType",value:function(e,t){var n=this,i=this.nodeConnections[e];if(i){var o=i.find(function(e){return n.nodes[e.outNodeID].type.toLowerCase()===t});if(o)return this.nodes[o.outNodeID]}return null}}])&&Ls(t.prototype,n),i&&Ls(t,i),e}();function js(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _s=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),st.a.Transport.bpm.value=140,st.a.Transport.start(),this.historyState={id:window.location.pathname},window.addEventListener("popstate",this.onPopStateChange.bind(this)),window.addEventListener("resize",function(){t.onResize()}),this.onNodeAddedFromLibraryBound=this.onNodeAddedFromLibrary.bind(this),this.onWorkspaceClickBound=this.onWorkspaceClick.bind(this),window.NS.settings={speedModifier:1},window.NS.singletons.lessons={},this.workspaceManager=new as(document.body,this.onWorkspaceClickBound),window.NS.workspaceEl=this.workspaceManager.el,this.onScaleChangeBound=this.onScaleChange.bind(this),this.onResize(),this._canShowSaveDialog=this._canShowSaveDialog.bind(this),window.NS.singletons.StatusWindow=new Cs(document.body),window.NS.singletons.ConnectionsManager=new As,window.NS.singletons.DialogManager=new Rs(document.body,this._canShowSaveDialog),this.keyboardManager=new os,window.NS.singletons.DeleteView=new Es(this.workspaceManager.containerEl)}var t,n,i;return t=e,(n=[{key:"init",value:function(e){this.nodeLibrary=new ns(this.workspaceManager.containerEl,this.onNodeAddedFromLibraryBound,this.workspaceManager),window.NS.singletons.PROJECT_TYPE===window.NS.singletons.TYPES.space.id?(window.NS.singletons.LessonManager=new bs,window.NS.singletons.LessonManager.init(e.drawing),this.nodeManager=new Ka(null,this.keyboardManager,this.workspaceManager.el,this.nodeLibrary),this.nodeManager.init(e)):(this.nodeManager=new Ka(null,this.keyboardManager,this.workspaceManager.el,this.nodeLibrary),this.nodeManager.init(e),window.NS.singletons.LessonManager=new bs,window.NS.singletons.LessonManager.init(e.drawing))}},{key:"onLogout",value:function(){window.location.reload()}},{key:"onLogin",value:function(){this.nodeLibrary.show(),this.workspaceManager.enable(),this.keyboardManager.enable()}},{key:"_canShowSaveDialog",value:function(){return!this.nodeManager.windowManager.nodeSettingsOpen()}},{key:"onScaleChange",value:function(e){}},{key:"onWorkspaceClick",value:function(){this.nodeManager.windowManager.blur(),this.nodeManager.onNodeSelectedEvent()}},{key:"onNodeAddedFromLibrary",value:function(e,t,n){return this.nodeManager.initNode(e,t,n)}},{key:"onPopStateChange",value:function(e){console.log("hash change: ",e)}},{key:"pushState",value:function(e,t){window.history.pushState({id:e},"",t)}},{key:"update",value:function(){this.nodeManager.update()}},{key:"render",value:function(){this.nodeManager.render()}},{key:"onResize",value:function(e,t){this.workspaceManager.onResize(e,t)}}])&&js(t.prototype,n),i&&js(t,i),e}(),Vs=function(e){for(var t={},n=0;n<e.length;n++){var i=Object.keys(e[n])[0];t[i]=e[n][i]}return t},Bs=function(e){var t=function(e){return e<10?"0".concat(e):e},n=new Date(1e3*e.seconds),i=new Intl.DateTimeFormat("en",{year:"numeric"}).format(n),o=t(Number(new Intl.DateTimeFormat("en",{month:"numeric"}).format(n))),r=t(Number(new Intl.DateTimeFormat("en",{day:"2-digit"}).format(n))),a=t(n.getHours()),s=t(n.getMinutes());return"".concat(i,"-").concat(o,"-").concat(r,"  ").concat(a,":").concat(s)},Hs=function(e,t){return new Promise(function(n,i){_(e).then(function(e){return function(e){return new Promise(function(t,n){window.NS.singletons.refs.getUserRef().collection("Drawings").doc(e).get().then(function(e){e.exists?(console.log("Document data:",e,"  ",e.data()),t(!0)):t(!1)}).catch(function(e){console.log("Error getting document:",e),n()})})}(t)}).then(function(e){n(e)}).catch(function(e){i(e)})})},Fs=function(e,t){return new Promise(function(n,i){_(e).then(function(n){if(n)return function(e,t){var n=function(e,t){return new Promise(function(n,i){e.collection(t).get().then(function(e){var t=[];e.forEach(function(e){t.push({id:e.id,data:e.data()})}),n(t)}).catch(function(e){i(e)})})};return new Promise(function(i,o){var r=(window.NS.singletons.refs.hasUserRef()?window.NS.singletons.refs.getUserRef():P.collection("Users").doc(e)).collection("Drawings").doc(t);r||i(void 0);var a={drawing:{},nodes:[],groups:[]};r.get().then(function(e){if(e.exists){a.drawing={doc:e.data()};var t=[n(r,"Nodes"),n(r,"Groups")];return Promise.all(t)}i(void 0)}).then(function(e){var t=M(e,2),n=t[0],o=t[1];a.nodes=n,a.groups=o,i(a)}).catch(function(e){o(e)})})}(e,t)}).then(function(e){n(e)}).catch(function(e){i(e)})})},zs=function(e){return new Promise(function(t,n){_(e).then(function(n){if(n)return function(e){return new Promise(function(t,n){(window.NS.singletons.refs.hasUserRef()?window.NS.singletons.refs.getUserRef():P.collection("Users").doc(e)).collection("Drawings").get().then(function(e){var n={};e.forEach(function(e){var t=e.ref.path;n[e.id]={doc:e.data(),path:t}}),t(n)}).catch(function(e){n(e)})})}(e);t([])}).then(function(e){0===e.length&&t({groups:[],nodes:[],drawings:{}});var n=function(){var e=window.NS.singletons.refs.getUserRef();if(e)return e.collection("Drawings")}();return I(e,n)}).then(function(e){var n=e.groups,i=e.nodes,o=e.drawings,r=Vs(i),a=Vs(n),s=Object.keys(o),l={};s.forEach(function(e){l[e]={groups:a[e],nodes:r[e],drawing:o[e]}}),t(l)}).catch(function(e){console.log("err",e),n(e)})})},Us=function(){return new Promise(function(e,t){return new Promise(function(e,t){P.collection("GenericDrawings").get().then(function(t){var n={};t.forEach(function(e){var t=e.ref.path;n[e.id]={doc:e.data(),path:t}}),e(n)}).catch(function(e){t(e)})}).then(function(t){0===t.length&&e({groups:[],nodes:[],drawings:{}});var n=P.collection("GenericDrawings");return I(t,n)}).then(function(t){var n=t.groups,i=t.nodes,o=t.drawings,r=Vs(i),a=Vs(n),s=Object.keys(o),l={};s.forEach(function(e){l[e]={groups:a[e],nodes:r[e],drawing:o[e]}}),e(l)}).catch(function(e){t(e)})})},Gs=function(e){var t=window.NS.singletons.TYPES;return t[e]?t[e].title:"Not set"},Ys=function(e,t){var n=function(e,t){return Object.keys(e).map(function(n,i){return"\n            ".concat(t?function(e,t){return'\n            <div class="drawings-item">\n                <div class="top-row">\n                    <div class="title block-with-pre">\n                        <h5>Namn:</h5>\n                        <h4>'.concat(e.drawing.doc.title,'</h4>\n                    </div>\n                    <div class="type block-with-pre border">\n                        <h5>Typ:</h5>\n                        <h4>').concat(Gs(e.drawing.doc.type),"</h4>\n                    </div>\n                </div>\n                <h5>Noder: ").concat(e.nodes.length,"</h5>\n                <h5>Skapat: ").concat(Bs(e.drawing.doc.timestamp),'</h5>\n                <div class="click-cover" data-id="').concat(t,'" data-drawing-type="generic"></div>\n            </div>\n        ')}(e[n],n):function(e,t){return'\n            <div class="drawings-item">\n                <div class="top-row">\n                    <div class="title block-with-pre">\n                        <h5>Namn:</h5>\n                        <h4>'.concat(e.drawing.doc.title,'</h4>\n                    </div>\n                    <div class="type block-with-pre border">\n                        <h5>Typ:</h5>\n                        <h4>').concat(Gs(e.drawing.doc.type),"</h4>\n                    </div>\n                </div>\n                \n                <h5>Noder: ").concat(e.nodes.length,"</h5>\n                <h5>Skapat: ").concat(Bs(e.drawing.doc.timestamp),'</h5>\n                <div class="click-cover" data-id="').concat(t,'"></div>\n                <h5 class="delete-btn" data-id="').concat(t,'">Delete</h5>\n            </div>\n        ')}(e[n],n),"\n        ")}).join("")},i=n(e),o=n(t,!0);return'\n      <div class="drawings-outer-content">\n        <div class="generic-drawings drawings-container">\n            <h4>GENERELLA PROJEKT / BOILERPLATES</h4>\n            <div class="drawings-window-content-wrapper">\n                '.concat(o,'\n            </div>\n        </div>\n        <div class="personal-drawings drawings-container">\n            <h4>DINA PROJEKT</h4>\n            <div class="drawings-window-content-wrapper">\n                ').concat(i.length>0?i:"<h4>INGA SPARADE PROJEKT</h4>",'\n            </div>\n            <div class="new-drawing">\n                <div class="init-container">\n                    <h4>SKAPA NYTT PROJEKT</h4>\n                    <div class="touch-el"></div>\n                </div>\n            </div>\n        </div>\n      </div>\n    ')};n(100);function Ks(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Xs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ws=function(){function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.username=n,this.drawings={},this.genericDrawings={},this.paths={},this.onSelected=i,this.el=document.createElement("div"),this.el.className="drawings-window",t.appendChild(this.el),o.length>0?this.initFromDrawingId(n,o):this.initFromScratch(n)}var t,n,i;return t=e,(n=[{key:"initFromDrawingId",value:function(e,t){var n=this;Hs(e,t).then(function(i){i?Fs(e,t).then(function(e){window.NS.singletons.refs.setDrawingRef(T(t)),n.onSelected(e)}).catch(function(e){console.log("err: ",e)}):window.location.href=window.location.origin}).catch(function(e){console.log("err: ",e)})}},{key:"initFromScratch",value:function(e){var t=this;this.onExistingDrawingClickBound=this.onExistingDrawingClick.bind(this),this.onDeleteDrawingBound=this.onDeleteDrawing.bind(this),this.onNewProjectSaveBound=this.onNewProjectSave.bind(this),this.onNewProjectCancelBound=this.onNewProjectCancel.bind(this);var n;(n=[zs(e),Us()],Promise.all(n)).then(function(e){var n=Ks(e,2),i=n[0],o=n[1];t.drawings=i,t.genericDrawings=o,t.el.innerHTML=Ys(i,o),t.makeInteractive()}).catch(function(e){console.log("sdfsdf",e)})}},{key:"makeInteractive",value:function(){var e=this;this.el.querySelectorAll(".drawings-item").forEach(function(t){var n=t.querySelector(".delete-btn");n&&n.addEventListener("click",e.onDeleteDrawingBound),t.addEventListener("click",e.onExistingDrawingClickBound)}),this.el.querySelector(".init-container .touch-el").addEventListener("click",function(){window.NS.singletons.DialogManager.newProjectDialog.show(e.onNewProjectSaveBound,e.onNewProjectCancelBound)})}},{key:"onDeleteDrawing",value:function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=e.target.getAttribute("data-id"),i=this.drawings[n].drawing.path;window.NS.singletons.DialogManager.verificationDialog.show(function(){window.NS.singletons.DialogManager.verificationDialog.hide(),window.NS.singletons.DialogManager.loaderDialog.show(),firebase.functions().httpsCallable("recursiveDelete")({path:i}).then(function(e){window.NS.singletons.DialogManager.loaderDialog.hide(),zs(t.username).then(function(e){t.drawings=e,t.el.innerHTML=Ys(t.drawings,t.genericDrawings),t.makeInteractive()})}).catch(function(e){window.NS.singletons.DialogManager.loaderDialog.hide(),console.log("Delete failed, see console,"),console.warn(e)})},function(){window.NS.singletons.DialogManager.verificationDialog.hide()})}},{key:"onExistingDrawingClick",value:function(e){var t=this,n=e.target.getAttribute("data-id"),i=e.target.getAttribute("data-drawing-type");if(i&&"generic"===i)return function(e){window.NS.singletons.DialogManager.loaderDialog.show();var n=t.genericDrawings[e];N(n).then(function(e){window.NS.singletons.refs.setDrawingRef(e),window.NS.singletons.DialogManager.loaderDialog.hide(),t.onSelected(n)}).catch(function(e){console.log("err",e)})}(n),!1;var o=this.drawings[n];window.NS.singletons.refs.setDrawingRef(T(n)),this.onSelected(o)}},{key:"show",value:function(){this.el.classList.remove("hide")}},{key:"hide",value:function(){this.el.classList.add("hide")}},{key:"onNewProjectSave",value:function(e,t){var n=this;E({title:e,type:t}).then(function(e){window.NS.singletons.DialogManager.newProjectDialog.hide(),window.NS.singletons.refs.setDrawingRef(e),zs(n.username).then(function(t){var i=t[e.id];n.onSelected(i)})}).catch(function(e){window.NS.singletons.DialogManager.newProjectDialog.onError(),console.log("error",e)})}},{key:"onNewProjectCancel",value:function(){window.NS.singletons.DialogManager.newProjectDialog.hide()}}])&&Xs(t.prototype,n),i&&Xs(t,i),e}();function qs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Js=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.userRef=null,this.drawingRef=null,this.paramContainerRef={},this.nodesRefs={},this.groupsRefs={}}var t,n,i;return t=e,(n=[{key:"hasUserRef",value:function(){return!!this.userRef}},{key:"setUserRef",value:function(e){this.userRef=e}},{key:"getUserRef",value:function(){return this.userRef}},{key:"hasDrawingRef",value:function(){return!!this.drawingRef}},{key:"setDrawingRef",value:function(e){this.drawingRef=e}},{key:"getDrawingRef",value:function(){return this.drawingRef}},{key:"addNodeRef",value:function(e){this.nodesRefs[e.id]=e}},{key:"removeNodeRef",value:function(e){delete this.nodesRefs[e]}},{key:"getNodeRef",value:function(e){return this.nodesRefs[e]}},{key:"hasNodeRef",value:function(e){return!!this.nodesRefs[e]}},{key:"addGroupRef",value:function(e){this.groupsRefs[e.id]=e}},{key:"hasGroupRef",value:function(e){return!!this.groupsRefs[e]}},{key:"getGroupRef",value:function(e){return this.groupsRefs[e]}},{key:"removeGroupRef",value:function(e){delete this.groupsRefs[e]}}])&&qs(t.prototype,n),i&&qs(t,i),e}();function Zs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,"default",function(){return $s});var Qs=Object.freeze({space:{title:"Rymden",id:"space",settings:{showActiveMeshHelper:!0}},chemistry:{title:"Kemi",id:"chemistry",settings:{showActiveMeshHelper:!1}}});var $s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),window.NS={},window.NS.transform=function(){var e=document.createElement("div");if(null==e.style.transform){var t=["Webkit","Moz","ms"];for(var n in t)if(void 0!==e.style[t[n]+"Transform"])return t[n]+"Transform"}return"transform"}(),window.NS.iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,window.NS.singletons={},window.NS.singletons.TYPES=Qs,this.onDrawingSelectedBound=this.onDrawingSelected.bind(this);var n=new Js;window.NS.singletons.refs=n,this.main=new _s;var i=window.location.pathname.split("/"),o=i.length>1?i.slice(1):"";this.drawingsWindow=new Ws(document.body,t,this.onDrawingSelectedBound,o[0])}var t,n,i;return t=e,(n=[{key:"onDrawingSelected",value:function(e){var t=this;this.drawingsWindow.hide(),window.NS.singletons.PROJECT_TYPE=e.drawing.doc.type,new Promise(function(e,t){window.NS.singletons.refs.getUserRef().get().then(function(t){t.exists&&e(t.data()),e(void 0)}).catch(function(e){t(e)})}).then(function(n){window.NS.userData=n,window.NS.showDebug=function(){return window.NS.userData&&window.NS.userData.dev},t.initDrawing(e)})}},{key:"initDrawing",value:function(e){var t=this;this.main.init(e),this.onResize(),window.addEventListener("resize",function(){t.onResize()}),this.reqFrameBound=this.reqFrame.bind(this),this.reqFrame()}},{key:"onLogout",value:function(){this.drawingsWindow.hide(),this.main.onLogout()}},{key:"onLogin",value:function(){this.main.onLogin()}},{key:"reqFrame",value:function(){window.requestAnimationFrame(this.reqFrameBound),this.main.update(),this.main.render()}},{key:"onResize",value:function(){var e=window.innerWidth,t=window.innerHeight;this.main.onResize(e,t)}}])&&Zs(t.prototype,n),i&&Zs(t,i),e}()}]]);