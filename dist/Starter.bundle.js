(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{30:function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}n.r(t);var i=function(){function e(t,n,o,i,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isActive=!1,this.onClickCallback=n,this.parentEl=t,this.isParamOutput=o,this.el=document.createElement("div");this.el.className="node-output node-component ".concat(i?"":"right-align"," ").concat(o?"param":"");var s=document.createElement("div");s.className="dot",this.el.appendChild(s);var u=document.createElement("p");u.className="label",u.innerHTML=o?"Data ut":r?"Grafik ut":"Ljud ut",this.el.appendChild(u),this.parentEl.appendChild(this.el),this.onClickBound=this.onClick.bind(this),a?this.el.style.display="none":(this.el.addEventListener("click",this.onClickBound),this.offsetLeft=void 0,this.offsetTop=void 0)}var t,n,i;return t=e,(n=[{key:"getOffsetLeft",value:function(){return this.offsetLeft||(this.offsetLeft=this.el.offsetLeft),this.offsetLeft}},{key:"getOffsetTop",value:function(){return this.offsetTop||(this.offsetTop=this.el.offsetTop),this.offsetTop}},{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.el.classList.add("selected"),this.onClickCallback({x:e.x,y:e.y})}},{key:"enable",value:function(){this.isActive=!0,this.el.classList.add("active"),this.el.classList.remove("selected")}},{key:"disable",value:function(){this.isActive=!1,this.el.classList.remove("active")}}])&&o(t.prototype,n),i&&o(t,i),e}();function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(){function e(t,n,o,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isActive=!1,this.onClickCallback=n,this.parentEl=t,this.inputType=a,this.el=document.createElement("div"),this.el.className="node-input node-component";var r=document.createElement("div");r.className="dot",this.el.appendChild(r);var s=document.createElement("p");s.className="label",s.innerHTML=o?i||"Grafik in":"Ljud in",this.el.appendChild(s),this.parentEl.appendChild(this.el),this.onClickBound=this.onClick.bind(this),this.el.addEventListener("click",this.onClickBound),this.offsetLeft=void 0,this.offsetTop=void 0}var t,n,o;return t=e,(n=[{key:"getOffsetLeft",value:function(){return this.offsetLeft||(this.offsetLeft=this.el.offsetLeft),this.offsetLeft}},{key:"getOffsetTop",value:function(){return this.offsetTop||(this.offsetTop=this.el.offsetTop),this.offsetTop}},{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.onClickCallback()}},{key:"enable",value:function(){this.isActive=!0,this.el.classList.add("active"),this.deactivatePossible()}},{key:"disable",value:function(){this.isActive=!1,this.el.classList.remove("active")}},{key:"activatePossible",value:function(){this.el.classList.add("not-possible")}},{key:"deactivatePossible",value:function(){this.el.classList.remove("not-possible")}}])&&a(t.prototype,n),o&&a(t,o),e}();function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onClickCallback=n,this.parentEl=t,this.el=document.createElement("div"),this.el.className="node-remove";var o=document.createElement("h5");o.className="label",o.innerHTML="Remove",this.el.appendChild(o),this.parentEl.appendChild(this.el),this.onClickBound=this.onClick.bind(this),this.el.addEventListener("click",this.onClickBound)}var t,n,o;return t=e,(n=[{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.onClickCallback()}}])&&s(t.prototype,n),o&&s(t,o),e}();function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hasOutput=!0,this.isGraphicsNode=!1,this.isLightNode=!1,this.hasGraphicsInput=!1,this.needsUpdate=!1,this.hasMultipleOutputs=!1,this.outDotPos=void 0,this.inDotPos=void 0}var t,n,o;return t=e,(n=[{key:"init",value:function(e,t,n,o,a,s,l,c){this.initNodeConfig=!!s,this.ID=this.initNodeConfig?s.id:"_"+Math.random().toString(36).substr(2,9),this.onConnectingCallback=n,this.onInputConnectionCallback=o,this.hasActiveInput=!1,this.type=a,this.onNodeActive=l,this.onNodeRemove=c,this.parentEl=t,this.lastDelta={x:0,y:0};var h=document.createElement("h4");h.innerHTML=this.type,h.className="node-type",this.el.appendChild(h),this.parentEl.appendChild(this.el),this.onOutputClickBound=this.onOutputClick.bind(this),this.onInputClickBound=this.onInputClick.bind(this),this.onRemoveClickBound=this.onRemoveClick.bind(this),this.remove=new u(this.topPartEl,this.onRemoveClickBound);var p=!this.isParam&&this.hasAudioInput||this.hasGraphicsInput;p&&!this.isCanvasNode&&(this.input=new r(this.bottomPartEl,this.onInputClickBound,this.isGraphicsNode)),this.hasOutput&&!this.hasMultipleOutputs&&(this.output=new i(this.bottomPartEl,this.onOutputClickBound,this.isParam,p,this.isSpeaker,this.isGraphicsNode)),this.moveCoords={start:{x:0,y:0},offset:{x:this.initNodeConfig?s.pos[0]:e.x,y:this.initNodeConfig?s.pos[1]:e.y}},this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0)"),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this)}},{key:"getOutputPos",value:function(){return{x:this.output.el.offsetLeft,y:this.output.el.offsetTop}}},{key:"getOutDotPos",value:function(e){return this.inDotPos||(this.inDotPos=e.getBoundingClientRect()),this.inDotPos}},{key:"getInDotPos",value:function(e){return this.outDotPos||(this.outDotPos=e.getBoundingClientRect()),this.outDotPos}},{key:"onRemoveClick",value:function(){this.onNodeRemove(this)}},{key:"activateDrag",value:function(){this.el.addEventListener("mousedown",this.onMouseDownBound)}},{key:"getOutputEl",value:function(){return this.output}},{key:"getInputEl",value:function(){return this.input}},{key:"getConnectNode",value:function(){return this}},{key:"enableOutput",value:function(){this.output.enable()}},{key:"disableOutput",value:function(){this.output.disable()}},{key:"enableInput",value:function(e){this.input&&this.input.enable()}},{key:"disableInput",value:function(){this.input&&this.input.disable()}},{key:"onOutputClick",value:function(e){this.onConnectingCallback(this,e)}},{key:"onInputClick",value:function(e){this.onInputConnectionCallback(this,"main",e)}},{key:"removeFromDom",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"onMouseDown",value:function(e){"INPUT"===e.target.nodeName||e.target.classList.contains("prevent-drag")||(e.stopPropagation(),e.preventDefault(),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,this.lastDelta.x=0,this.lastDelta.y=0,window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound))}},{key:"onMouseMove",value:function(e){var t=e.x-this.moveCoords.start.x,n=e.y-this.moveCoords.start.y;this.moveCoords.offset.x=t,this.moveCoords.offset.y=n,this.lastDelta.x=t,this.lastDelta.y=n,this.el.style[window.NS.transform]="translate3d(".concat(t,"px, ").concat(n,"px, 0)")}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}}])&&l(t.prototype,n),o&&l(t,o),e}();function h(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var p=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.el=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.el.classList.add("line-renderer"),t.appendChild(this.el),this.nodeManager=n,this.onMouseEnterRemoveCircleBound=this.onMouseEnterRemoveCircle.bind(this),this.onMouseLeaveRemoveCircleBound=this.onMouseLeaveRemoveCircle.bind(this),this.onRemoveClickBound=this.onRemoveClick.bind(this),this.currentMouseOverObj=void 0}var t,n,o;return t=e,(n=[{key:"addLine",value:function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","g"),n=document.createElementNS("http://www.w3.org/2000/svg","line"),o=document.createElementNS("http://www.w3.org/2000/svg","circle"),i=document.createElementNS("http://www.w3.org/2000/svg","text");return t.appendChild(n),t.appendChild(o),t.appendChild(i),t.setAttribute("id",e),n.setAttribute("x1","0"),n.setAttribute("y1","0"),n.setAttribute("x2","0"),n.setAttribute("y2","0"),n.setAttribute("stroke-width","2"),n.setAttribute("stroke","white"),n.setAttribute("stroke-linecap","round"),o.setAttribute("cx","0"),o.setAttribute("cy","0"),o.setAttribute("fill","black"),o.setAttribute("stroke","red"),o.setAttribute("stroke-width","2"),o.setAttribute("r","10"),o.addEventListener("mouseenter",this.onMouseEnterRemoveCircleBound),o.addEventListener("mouseleave",this.onMouseLeaveRemoveCircleBound),o.addEventListener("click",this.onRemoveClickBound),i.setAttribute("fill","white"),this.el.appendChild(t),{g:t,line:n,removeCircle:o,removeText:i}}},{key:"removeLine",value:function(e){var t=e.removeCircle;t.removeEventListener("mouseenter",this.onMouseEnterRemoveCircleBound),t.removeEventListener("mouseleave",this.onMouseLeaveRemoveCircleBound),t.removeEventListener("click",this.onRemoveClickBound),this.el.removeChild(e.g)}},{key:"onRemoveClick",value:function(e){var t=e.target.parentNode.getAttribute("id"),n=this.nodeManager._nodeConnections.find(function(e){return e.lineEl.g.getAttribute("id")===t});n&&this.nodeManager.removeConnection(n)}},{key:"onMouseEnterRemoveCircle",value:function(e){var t=e.target.parentNode.querySelector("text");t.textContent="Ta bort koppling",this.currentMouseOverObj=t}},{key:"onMouseLeaveRemoveCircle",value:function(e){this.currentMouseOverObj&&this.currentMouseOverObj.textContent&&(this.currentMouseOverObj.textContent=""),this.currentMouseOverObj=void 0}},{key:"update",value:function(){}},{key:"render",value:function(){for(var e=this.nodeManager._nodeConnections.length,t=0;t<e;t++){var n=this.nodeManager._nodeConnections[t].out,o=this.nodeManager._nodeConnections[t].in,i=this.nodeManager._nodeConnections[t].param,a=this.nodeManager._nodeConnections[t].inputType,r=this.nodeManager._nodeConnections[t].outputType,s=void 0;s=!!i?o.inputParams[i.title]:o.getInputEl(a);var u=n.getOutputEl(r),l=n.getOutDotPos(n.output?n.output.el:null,r),c=u.getOffsetLeft(),h=u.getOffsetTop(),p=n.moveCoords.offset.x+c+l.width-3,d=n.moveCoords.offset.y+h+7,f=s.getOffsetLeft(),m=s.getOffsetTop(),v=o.moveCoords.offset.x+f+4,y=o.moveCoords.offset.y+m+7,g=this.nodeManager._nodeConnections[t].lineEl.line;g.setAttribute("x1",p),g.setAttribute("y1",d),g.setAttribute("x2",v),g.setAttribute("y2",y);var b=this.nodeManager._nodeConnections[t].param?"yellow":"red";g.setAttribute("stroke",b);var C=this.nodeManager._nodeConnections[t].lineEl.removeCircle,w=(p+v)/2,k=(d+y)/2;C.setAttribute("cx",w),C.setAttribute("cy",k),C.setAttribute("stroke",b);var E=this.nodeManager._nodeConnections[t].lineEl.removeText;E.setAttribute("x",w-35),E.setAttribute("y",k-20)}}}])&&h(t.prototype,n),o&&h(t,o),e}(),d="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\tuniform float time;\n\tuniform vec2 resolution;\n\tvoid main()\t{\n\t\tgl_Position = vec4( position, 1.0 );\n\t}\n",f="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\tuniform float time;\n\tuniform vec2 resolution;\n\tuniform sampler2D u_texture0;\n    uniform sampler2D u_texture1;\n\tuniform vec2 u_res;\n\tuniform float u_connection0;\n    uniform float u_connection1;\n    uniform float u_finalConnection;\n    uniform float u_multiConnection;\n\tvoid main()\t{\n\t\tvec2 st = gl_FragCoord.xy/u_res.xy;\n\t\tvec4 bgColor = texture2D(u_texture0, st);\n        vec4 fgColor = texture2D(u_texture1, st);\n\t\tvec4 whiteColor = vec4(1., 1., 1., 1.);\n        vec4 transparentColor = vec4(1.0, 1.0, 1.0, 0.0);\n        vec4 finalFgColor = mix(transparentColor, fgColor, u_connection1);\n        vec4 finalBgColor = mix(transparentColor, bgColor, u_connection0);\n        \n        float ra = (finalFgColor.a) * finalFgColor.r + (1.0 - finalFgColor.a) * finalBgColor.r;\n        float ga = (finalFgColor.a) * finalFgColor.g + (1.0 - finalFgColor.a) * finalBgColor.g;\n        float ba = (finalFgColor.a) * finalFgColor.b + (1.0 - finalFgColor.a) * finalBgColor.b;\n\n        vec4 overlayColor = vec4(ra, ga, ba, 1.0);\n\n        vec4 finalColor = mix(fgColor + bgColor, overlayColor, u_multiConnection);\n\n        gl_FragColor = mix(whiteColor, finalColor, u_finalConnection);\n\t} \n\n",m="\nvoid main() {\n\tvec2 st = gl_FragCoord.xy/u_resolution.xy;\n    //st.x *= u_resolution.x/u_resolution.y;\n    vec3 color = vec3(1.);\n",v="\n\tgl_FragColor = vec4(color,1.0);\n}",y="\n\tvec2 center_st = vec2(0.5)-st;\n\tcolor *= (vec3(1.0) * shapeBorderCircle(center_st,0.6,0.06));\n",g="\n    \n    // float u_user_speed3 = 0.500;\n    // float u_user_pattern_scale = -0.294;\n    // float u_user_scale = 6.632;\n    // float u_user_rotation = 0.804;\n    // float u_user_speed2 = 0.028;\n    // float u_user_blur = 0.7;\n    // vec3 u_user_color1 = vec3(0.256,0.351,0.620);\n    // vec3 u_user_color2 = vec3(1.000,0.420,0.420);\n    \n    \n    // vec2 st = gl_FragCoord.xy/u_resolution.xy;\n    st.x *= u_resolution.x/u_resolution.y;\n    color = vec3(0.0);\n    vec2 pos = vec2(st*u_user_scale);\n\n    float DF = 0.0;\n\n    \n    // Add a random position\n    float a = 0.0;\n    vec2 vel = vec2(u_time*u_user_speed3);\n    DF += snoise(pos+vel)*u_user_pattern_scale+.25;\n\n    // Add a random position\n    a = snoise(pos*vec2(cos(u_time*.15),sin(u_time*u_user_rotation))*u_user_speed2)*3.405;\n    vel = vec2(cos(a),sin(a));\n    DF += snoise(pos+vel)*.25+.25;\n\n    color = vec3( smoothstep(u_user_blur,.75,fract(DF)) );\n    \n    color = mix(u_user_color1, u_user_color2, color);\n",b="\n    // vec2 st = gl_FragCoord.xy/u_resolution.xy;\n    st.x *= u_resolution.x/u_resolution.y;\n    color = vec3(.0);\n    \n    // Scale \n    st *= 5.;\n    \n    // Tile the space\n    vec2 i_st = floor(st);\n    vec2 f_st = fract(st);\n\n    float m_dist = 10.;  // minimun distance\n    vec2 m_point;        // minimum point\n    \n    for (int j=-1; j<=1; j++ ) {\n        for (int i=-1; i<=1; i++ ) {\n            vec2 neighbor = vec2(float(i),float(j));\n            vec2 point = random2(i_st + neighbor);\n            point = 0.5 + 0.5*sin(u_time + 6.2831*point);\n            vec2 diff = neighbor + point - f_st;\n            float dist = length(diff);\n\n            if( dist < m_dist ) {\n                m_dist = dist;\n                m_point = point;\n            }\n        }\n    }\n\n    // Assign a color using the closest point position\n    color += dot(m_point,vec2(0.30,0.60));\n    \n    // Add distance field to closest point center \n    color.g = m_dist;\n\n    // Show isolines\n    //color -= abs(sin(40.0*m_dist*(u_mouse.x/u_resolution.x)))*0.07;\n    \n    color = mix(u_user_fgColor, u_user_bgColor, m_dist);\n    //color *= vec3(.2, .6, .8);\n",C="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform vec2 u_resolution;\nuniform vec2 u_mouse;\nuniform float u_time;\n\n//CIRCLE\nuniform float u_noise_amount;\n\n//LAVA\nuniform float u_user_speed3;\nuniform float u_user_pattern_scale;\nuniform float u_user_scale;\nuniform float u_user_rotation;\nuniform float u_user_speed2;\nuniform float u_user_blur;\nuniform vec3 u_user_color1;\nuniform vec3 u_user_color2;\n\n//VORONOI\nuniform vec3 u_user_fgColor;\nuniform vec3 u_user_bgColor;\n\n// YUV to RGB matrix\nmat3 yuv2rgb = mat3(1.0, 0.0, 1.13983,\n                    1.0, -0.39465, -0.58060,\n                    1.0, 2.03211, 0.0);\n\nvec2 random2(vec2 st){\n    st = vec2( dot(st,vec2(127.1,311.7)),\n              dot(st,vec2(269.5,183.3)) );\n    return -1.0 + 2.0*fract(sin(st)*43758.5453123);\n}\n\n// Value Noise by Inigo Quilez - iq/2013\n// https://www.shadertoy.com/view/lsf3WH\nfloat noise(vec2 st) {\n    vec2 i = floor(st);\n    vec2 f = fract(st);\n\n    vec2 u = f*f*(3.0-2.0*f);\n\n    return mix( mix( dot( random2(i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),\n                     dot( random2(i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),\n                mix( dot( random2(i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),\n                     dot( random2(i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x), u.y);\n}\n\nmat2 rotate2d(float _angle){\n    return mat2(cos(_angle),-sin(_angle),\n                sin(_angle),cos(_angle));\n}\n\nfloat shapeCircle(vec2 st, float radius) {\n\t//st = vec2(0.5)-st;\n    float r = length(st)*2.0;\n    float a = atan(st.y,st.x);\n    float m = abs(mod(a+u_time*2.080,3.14*2.0)-3.14)/3.688;\n    float f = radius;\n    float mod1 = radius;\n    m += noise(st+u_time*0.1)*.5;\n    mod1 = sin(a*50.000)*noise(st+u_time*0.536)*0.156;\n    mod1 += (sin(a*20.000)*0.116*pow(m,1.576));\n    f += mod1 * u_noise_amount;\n    return 1.-smoothstep(f,f+0.007,r);\n}\n\nfloat shapeBorderCircle(vec2 st, float radius, float width) {\n    return shapeCircle(st,radius) - shapeCircle(st,radius-width);\n}\n\nvec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }\n\nfloat snoise(vec2 v) {\n    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                        -0.577350269189626,  // -1.0 + 2.0 * C.x\n                        0.024390243902439); // 1.0 / 41.0\n    vec2 i  = floor(v + dot(v, C.yy) );\n    vec2 x0 = v -   i + dot(i, C.xx);\n    vec2 i1;\n    i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n    vec4 x12 = x0.xyxy + C.xxzz;\n    x12.xy -= i1;\n    i = mod289(i); // Avoid truncation effects in permutation\n    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n        + i.x + vec3(0.0, i1.x, 1.0 ));\n\n    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n    m = m*m ;\n    m = m*m ;\n    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n    vec3 h = abs(x) - 0.5;\n    vec3 ox = floor(x + 0.5);\n    vec3 a0 = x - ox;\n    m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n    vec3 g;\n    g.x  = a0.x  * x0.x  + h.x  * x0.y;\n    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n    return 130.0 * dot(m, g);\n}\n";var w=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=new THREE.WebGLRenderer({alpha:!0})};function k(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var E=function(){function e(t,n,o,i,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onConnectingCallback=n,this.onInputConnectionCallback=o,this.addCallback=i,this.onNodeActive=a,this.removeCallback=r,this.mainRenderer=new w}var t,n,o;return t=e,(n=[{key:"createNode",value:function(e,t){var n=new e.obj(this.mainRenderer);n.init(t,this.parentEl,this.onConnectingCallback,this.onInputConnectionCallback,e.type,void 0,void 0,this.removeCallback),n.onResize({w:540,h:538}),this.addCallback(n)}}])&&k(t.prototype,n),o&&k(t,o),e}();function O(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var P=function(){function e(t,n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="node-param node-component",this.param=n;var a=document.createElement("div");a.className="dot",this.el.appendChild(a);var r=document.createElement("p");r.className="label",r.innerHTML=n.param,this.el.appendChild(r),t.appendChild(this.el),this.el.addEventListener("click",function(e){console.log("param click"),e.preventDefault(),e.stopPropagation(),o(n)}),this.offsetLeft=void 0,this.offsetTop=void 0}var t,n,o;return t=e,(n=[{key:"getOffsetLeft",value:function(){return this.offsetLeft||(this.offsetLeft=this.el.offsetLeft),this.offsetLeft}},{key:"getOffsetTop",value:function(){return this.offsetTop||(this.offsetTop=this.el.offsetTop),this.offsetTop}},{key:"enable",value:function(){this.el.classList.add("active")}},{key:"disable",value:function(){this.el.classList.remove("active")}},{key:"activatePossible",value:function(){this.el.classList.add("not-possible")}},{key:"deactivatePossible",value:function(){this.el.classList.remove("not-possible")}}])&&O(t.prototype,n),o&&O(t,o),e}(),_={single:{isValid:function(e,t,n,o){var i=!0;return o.some(function(e){return e.in.ID===t.ID&&!e.param})&&(i=!1),i}},multiple:{isValid:function(e,t,n,o,i){if(e.outputs&&e.outputs[i]&&e.outputs[i].isParamOutput&&!t.isParam)return!1;return!0}},oscillatorTrigger:{isValid:function(e,t,n,o){var i=!0;return o.some(function(n){return n.out.ID===e.ID&&n.in.ID===t.ID})&&(i=!1),e.isSequencer||(i=!1),i}},gain:{isValid:function(e,t,n,o){var i=!0;return o.some(function(n){return n.in.ID===t.ID&&n.out.ID===e.ID})&&(i=!1),e.isEnvelope||(i=!1),i}},frequency:{isValid:function(e,t,n,o){var i=!0;return o.some(function(n){return n.in.ID===t.ID&&n.out.ID===e.ID})&&(i=!1),e.isEnvelope||e.isLFO||(i=!1),i}}};function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function R(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e,t,n){return(S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var N=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=R(this,T(t).call(this))).audioNode=null,e.isParam=!1,e.isKeyboardListener=!1,e.isOscillator=!1,e.isEnvelope=!1,e.isSpeaker=!1,e.isSignalMath=!1,e.hasAudioInput=!0,e.isSequencer=!1,e.isLFO=!1,e.isAnalyser=!1,e.isSynthOscillator=!1,e.inputHelpersType=_.single,e.params={},e.canBeConnected=!1,e.el=document.createElement("div"),e.el.className="node",e.topPartEl=document.createElement("div"),e.topPartEl.className="top-part",e.el.appendChild(e.topPartEl),e.bottomPartEl=document.createElement("div"),e.bottomPartEl.className="bottom-part",e.el.appendChild(e.bottomPartEl),e.inputParams={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,c),n=t,(o=[{key:"init",value:function(e,n,o,i,a,r,s,u,l){for(var c in S(T(t.prototype),"init",this).call(this,e,n,o,i,a,r,s,l),this.onParameterChange=u,this.connectedInputs=[],this.connectedOutputs=[],this.params)if(this.params[c].useAsInput){var h=new P(this.topPartEl,this.params[c],this.onInputClickBound);this.inputParams[this.params[c].title]=h}this.isSequencer&&(this.el.classList.add("sequencer"),this.createUI(),this.setup()),this.activateDrag()}},{key:"enableParam",value:function(e){var t=this.inputParams[e.title];e.isConnected=!0,t.enable(),e.slider&&e.disableSliderOnConnection&&e.slider.disableSlider()}},{key:"disableParam",value:function(e){var t=this.inputParams[e.title];e.isConnected=!1,t.disable(),e.slider&&e.slider.enableSlider()}},{key:"onParameterUpdate",value:function(){var e=this.getParams();this.onParameterChange(this,e)}},{key:"getParams",value:function(){var e={};for(var t in this.params){var n=this.params[t];e[n.param]=this.params[n.param].value}return e}},{key:"enableOutput",value:function(e,n){S(T(t.prototype),"enableOutput",this).call(this),this.connectedOutputs.push(n.in.ID)}},{key:"disableOutput",value:function(e,n){var o=this.connectedOutputs.filter(function(t){return t!==e.ID});this.connectedOutputs=o,0===this.connectedOutputs.length&&S(T(t.prototype),"disableOutput",this).call(this)}},{key:"enableInput",value:function(e){S(T(t.prototype),"enableInput",this).call(this),this.connectedInputs.push("".concat(e.ID,"-").concat(this.ID))}},{key:"disableInput",value:function(e){var n="".concat(e.ID,"-").concat(this.ID),o=this.connectedInputs.filter(function(e){return e!==n});this.connectedInputs=o,0===this.connectedInputs.length&&S(T(t.prototype),"disableInput",this).call(this)}}])&&M(n.prototype,o),i&&M(n,i),t}(),I=n(6),D=n.n(I);function B(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var j=function(){function e(t,n,o,i,a,r,s,u){var l=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=a,this.parameter=r,this.decimals=s,this.disable=u,this.value=(o-i.min)/(i.max-i.min),this.settings=i,this.el=document.createElement("div"),this.el.className="node-control node-range";var c=document.createElement("h5");c.innerHTML=n,c.className="node-range-title",this.el.appendChild(c),this.sliderBg=document.createElement("div"),this.sliderBg.className="node-range-slider-bg",this.knobEl=document.createElement("div"),this.knobEl.className="node-range-knob",this.sliderBg.appendChild(this.knobEl),this.el.appendChild(this.sliderBg),this.valueEl=document.createElement("p"),this.valueEl.className="node-range-value",this.valueEl.innerHTML=o,this.el.appendChild(this.valueEl),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),setTimeout(function(){l.setPos(l.sliderBg.clientHeight)},0),this.sliderBg.addEventListener("mousedown",this.onMouseDownBound)}var t,n,o;return t=e,(n=[{key:"disableSlider",value:function(){this.disable=!0,this.el.style.opacity=.1}},{key:"enableSlider",value:function(){this.disable=!1,this.el.style.opacity=1}},{key:"remove",value:function(){this.sliderBg.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"getValue",value:function(){return this.value*(this.settings.max-this.settings.min)+this.settings.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onMouseDown",value:function(e){if(!this.disable){e.preventDefault(),e.stopPropagation();var t=this.sliderBg.getBoundingClientRect(),n=this.sliderBg.clientHeight,o=1-Math.round(100*(e.y-t.top))/100/n;this.value=o>1?1:o<0?0:o,this.setPos(n),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)),this.parameter),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}}},{key:"onMouseMove",value:function(e){var t=this.sliderBg.getBoundingClientRect(),n=this.sliderBg.clientHeight,o=1-Math.round(100*(e.y-t.top))/100/n;this.value=o>1?1:o<0?0:o,this.setPos(n),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)),this.parameter),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){this.value;var t=this.value*e;this.knobEl.style.height="".concat(t,"px")}}])&&B(t.prototype,n),o&&B(t,o),e}();function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function V(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function H(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e,t,n){return(F="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=U(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var q=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=U(t).call(this))||"object"!==A(o)&&"function"!=typeof o?H(n):o).el.classList.add("no-height"),e.hasConnectedTrigger=!1,e.connectedTriggerID=-1,t.BASE_FREQ=440,t.ROOT=Math.pow(2,1/12),e.isKeyboardListener=!0,e.isOscillator=!0,e.hasAudioInput=!1,e.hasEnvelopeConnection=!1;var i=document.createElement("div");i.className="range-container",e.topPartEl.appendChild(i),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(H(e));var a={parentEl:i,title:"Oktav",initValue:0,settings:{min:-3,max:3},valChangeCallback:e.onRangeChangeCallbackBound,param:"octave",decimals:0,disable:!1};e.octaveRangeSlider=new j(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={useAsInput:!1,value:a.initValue,param:"octave",slider:e.octaveRangeSlider,title:"Octave"},s={useAsInput:!0,param:"trigger",title:"Trigger",helper:_.oscillatorTrigger};return e.params[r.param]=r,e.params[s.param]=s,e.paramVals={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,N),n=t,(o=[{key:"enableParam",value:function(e,n){F(U(t.prototype),"enableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!0,this.connectedTriggerID=n.out.ID)}},{key:"disableParam",value:function(e){F(U(t.prototype),"disableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!1,this.connectedTriggerID=-1)}},{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getParams",value:function(e){e||(e=0);var t={};return t.frequency=this.getFrequency(e),t.type="sawtooth",t}},{key:"getAudioNode",value:function(){var e=new D.a.Oscillator;return e.type="sawtooth",e}},{key:"getFrequency",value:function(e){var n=12*parseInt(this.params.octave.value)+e;return t.BASE_FREQ*Math.pow(t.ROOT,n)}},{key:"onParameterChange",value:function(e,t){}}])&&V(n.prototype,o),i&&V(n,i),t}();function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Q=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=W(t).call(this))||"object"!==K(o)&&"function"!=typeof o?Y(n):o).inputHelpersType=_.multiple,e.el.classList.add("no-height"),e.audioNode=D.a.context.createGain();var i=document.createElement("div");i.className="range-container",e.topPartEl.appendChild(i),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(Y(e));var a={parentEl:i,title:"Vol",initValue:.5,settings:{min:0,max:1},valChangeCallback:e.onRangeChangeCallbackBound,param:"gain",decimals:2,disable:!1};e.gainRangeSlider=new j(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={useAsInput:!0,value:a.initValue,param:"gain",slider:e.gainRangeSlider,title:"Gain",helper:_.gain,disableSliderOnConnection:!0};return e.paramVals={},e.params[r.param]=r,e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}(t,N),n=t,(o=[{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getAudioNode",value:function(){return D.a.context.createGain()}}])&&G(n.prototype,o),i&&G(n,i),t}();function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function $(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ne=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=$(this,ee(t).call(this))).inputHelpersType=_.multiple,e.audioNode=D.a.context.destination,e.isSpeaker=!0,e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(t,N),n=t,(o=[{key:"getAudioNode",value:function(){var e=new D.a.Limiter;return e.connect(D.a.context.destination),e}}])&&J(n.prototype,o),i&&J(n,i),t}();function oe(e){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ie(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ae(e){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ue=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=ae(t).call(this))||"object"!==oe(o)&&"function"!=typeof o?re(n):o).audioNode=new D.a.Filter,e.el.classList.add("no-height");var i=document.createElement("div");i.className="range-container",e.topPartEl.appendChild(i),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(re(e));var a={parentEl:i,title:"Frekvens",initValue:350,settings:{min:0,max:22e3},valChangeCallback:e.onRangeChangeCallbackBound,param:"frequency",decimals:0,disable:!1};e.freqRangeSlider=new j(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={parentEl:i,title:"Q",initValue:1,settings:{min:0,max:10},valChangeCallback:e.onRangeChangeCallbackBound,param:"Q",decimals:0,disable:!1};e.qRangeSlider=new j(r.parentEl,r.title,r.initValue,r.settings,r.valChangeCallback,r.param,r.decimals,r.disable);var s={useAsInput:!0,value:a.initValue,param:"frequency",slider:e.freqRangeSlider,title:"Filter Frequency",helper:_.frequency,disableSliderOnConnection:!1},u={useAsInput:!1,value:r.initValue,param:"Q",slider:e.qRangeSlider,title:"Q"};return e.paramVals={},e.params[s.param]=s,e.params[u.param]=u,e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&se(e,t)}(t,N),n=t,(o=[{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getAudioNode",value:function(){var e=new D.a.Filter;for(var t in this.params)e[t].value=this.params[t].value;return e}}])&&ie(n.prototype,o),i&&ie(n,i),t}();function le(e){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function de(e,t){return(de=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var fe=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=he(t).call(this))||"object"!==le(o)&&"function"!=typeof o?pe(n):o).el.classList.add("no-height"),e.isParam=!0,e.isKeyboardListener=!0,e.isEnvelope=!0,e.audioNode=new D.a.Envelope;var i=document.createElement("div");i.className="range-container",e.topPartEl.appendChild(i),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(pe(e));var a={parentEl:i,title:"A",initValue:.25,settings:{min:.01,max:2},valChangeCallback:e.onRangeChangeCallbackBound,param:"attack",decimals:2,disable:!1};e.attackRangeSlider=new j(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={parentEl:i,title:"D",initValue:.77,settings:{min:.01,max:2},valChangeCallback:e.onRangeChangeCallbackBound,param:"decay",decimals:2,disable:!1};e.decayRangeSlider=new j(r.parentEl,r.title,r.initValue,r.settings,r.valChangeCallback,r.param,r.decimals,r.disable);var s={parentEl:i,title:"S",initValue:.11,settings:{min:.01,max:1},valChangeCallback:e.onRangeChangeCallbackBound,param:"sustain",decimals:2,disable:!1};e.sustainRangeSlider=new j(s.parentEl,s.title,s.initValue,s.settings,s.valChangeCallback,s.param,s.decimals,s.disable);var u={parentEl:i,title:"R",initValue:.11,settings:{min:.01,max:2},valChangeCallback:e.onRangeChangeCallbackBound,param:"release",decimals:2,disable:!1};e.releaseRangeSlider=new j(u.parentEl,u.title,u.initValue,u.settings,u.valChangeCallback,u.param,u.decimals,u.disable);var l={useAsInput:!1,value:a.initValue,param:"attack",slider:e.attackRangeSlider,title:"Attack"},c={useAsInput:!1,value:r.initValue,param:"decay",slider:e.decayRangeSlider,title:"Decay"},h={useAsInput:!1,value:s.initValue,param:"sustain",slider:e.sustainRangeSlider,title:"Sustain"},p={useAsInput:!1,value:u.initValue,param:"release",slider:e.releaseRangeSlider,title:"Release"},d={};return d[l.param]=l,d[c.param]=c,d[h.param]=h,d[p.param]=p,e.paramDefaults={ADSR:d},e.params=Object.assign({},e.paramDefaults.ADSR),e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&de(e,t)}(t,N),n=t,(o=[{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getAudioNode",value:function(e){var t=new(0,D.a.Envelope);for(var n in this.params)t[n]=this.params[n].value;return t}}])&&ce(n.prototype,o),i&&ce(n,i),t}();function me(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ve=function(){function e(t,n,o,i,a,r,s,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onConnectingCallback=n,this.onInputConnectionCallback=o,this.addCallback=i,this.initData=a,this.onParameterChange=r,this.onNodeActive=s,this.onNodeRemove=u}var t,n,o;return t=e,(n=[{key:"init",value:function(){if(this.initData)for(var e=0;e<this.initData.length;e++)this.initData[e].node.init(this.parentEl,this.onConnectingCallback,this.onInputConnectionCallback,this.initData[e].type,this.initData[e],this.onNodeActive,this.onParameterChange,this.onNodeRemove),this.addCallback(this.initData[e].node)}},{key:"createNode",value:function(e,t){var n=new e.obj;n.init(t,this.parentEl,this.onConnectingCallback,this.onInputConnectionCallback,e.type,void 0,this.onNodeActive,this.onParameterChange,this.onNodeRemove),this.addCallback(n)}}])&&me(t.prototype,n),o&&me(t,o),e}();function ye(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ge=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ID=999999999,this.resetConnecting=n,this.startPos={x:0,y:0},this.endPos={x:0,y:0},this.line=document.createElementNS("http://www.w3.org/2000/svg","line"),this.line.setAttribute("id",this.ID),this.line.setAttribute("x1",this.startPos.x),this.line.setAttribute("y1",this.startPos.y),this.line.setAttribute("x2",this.endPos.x),this.line.setAttribute("y2",this.endPos.y),this.line.setAttribute("stroke-width","2"),this.line.setAttribute("stroke","white"),this.line.setAttribute("stroke-linecap","round"),t.appendChild(this.line),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseClickBound=this.onMouseClick.bind(this)}var t,n,o;return t=e,(n=[{key:"onConnectionActive",value:function(e,t,n){var o=e.getOutDotPos(e.output?e.output.el:null,n),i=e.getOutputPos(n),a=e.moveCoords.offset.x+i.x+o.width,r=e.moveCoords.offset.y+i.y+7;this.startPos.x=t.x,this.startPos.y=t.y;var s=this.line,u=e.isParam?"yellow":"red";e.outputs&&e.outputs[n]&&(e.outputs[n].isParamOutput&&(u="yellow"));s.setAttribute("x1",a),s.setAttribute("y1",r),s.setAttribute("x2",a),s.setAttribute("y2",r),s.setAttribute("stroke",u),s.setAttribute("stroke-opacity",.6),window.addEventListener("mousemove",this.onMouseMoveBound),window.addEventListener("click",this.onMouseClickBound)}},{key:"onInputClick",value:function(e,t,n){window.removeEventListener("mousemove",this.onMouseMoveBound),window.removeEventListener("click",this.onMouseClickBound);var o=this.line,i=t.moveCoords.offset.x+200,a=t.moveCoords.offset.y+50,r=n.moveCoords.offset.x+200,s=n.moveCoords.offset.y+50,u=e?i:r,l=e?a:s;o.setAttribute("stroke","white"),o.setAttribute("stroke-opacity",0),o.setAttribute("x1",u),o.setAttribute("y1",l),o.setAttribute("x2",u),o.setAttribute("y2",l)}},{key:"onMouseMove",value:function(e){var t=this.line,n=parseFloat(t.getAttribute("x1")),o=parseFloat(t.getAttribute("y1")),i=n+(e.x-this.startPos.x),a=o+(e.y-this.startPos.y);this.endPos.x=i,this.endPos.y=a,t.setAttribute("x2",i),t.setAttribute("y2",a)}},{key:"onMouseClick",value:function(e){window.removeEventListener("mousemove",this.onMouseMoveBound),window.removeEventListener("click",this.onMouseClickBound),this.resetConnecting();var t=this.line;t.setAttribute("stroke","white"),t.setAttribute("x1",0),t.setAttribute("y1",0),t.setAttribute("x2",0),t.setAttribute("y2",0),t.setAttribute("stroke-opacity",0),console.log("click connection")}},{key:"resetLine",value:function(){window.removeEventListener("mousemove",this.onMouseMoveBound),window.removeEventListener("click",this.onMouseClickBound);var e=this.line;e.setAttribute("stroke","white"),e.setAttribute("x1",0),e.setAttribute("y1",0),e.setAttribute("x2",0),e.setAttribute("y2",0),e.setAttribute("stroke-opacity",0),console.log("reset connection")}}])&&ye(t.prototype,n),o&&ye(t,o),e}(),be=function(e){return e.framebuffer||e.texture},Ce=function(e,t,n){return!(e.framebuffer||e.texture||e.picker||e.isSequencer)&&(e.isParam&&!n.isConnected||e.isAnalyser&&!n.isConnected)},we=function(e,t,n){t.defaultVal=n.getValue(t)},ke={texture:{update:function(e,t){e.material.needsUpdate=!0,e.material.map=t.framebuffer?t.framebuffer.texture:t.texture},isValid:be,disconnect:function(e){e.material.needsUpdate=!0,e.material.map=null}},normalMap:{update:function(e,t){e.material.normalMap=t.framebuffer.texture,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0},isValid:be,disconnect:function(e){e.material.normalMap=null,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0}},bumpMap:{update:function(e,t){e.material.displacementMap=t.framebuffer.texture,e.material.displacementScale=.1,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0},isValid:be,disconnect:function(e){e.material.displacementMap=null,e.mesh.needsUpdate=!0,e.material.needsUpdate=!0}},color:{update:function(e,t){e.material.color=t.currentColor},isValid:function(e){return!!e.picker},disconnect:we},position:{update:function(e,t,n){e.mesh.position[n.param]=t.getValue(n)},isValid:Ce,disconnect:we},rotation:{update:function(e,t,n){e.mesh.rotation[n.param]=t.getValue(n)},isValid:Ce,disconnect:we},scale:{update:function(e,t,n){var o=t.getValue();new THREE.Vector3(o,o,o);e.mesh.scale.set(o,o,o)},isValid:Ce,disconnect:function(e,t,n){n.isAnalyser?e.mesh.scale.set(1,1,1):t.defaultVal=n.getValue(t)}},shaderParam:{update:function(e,t,n){e.mesh.material.uniforms[n.param].value=t.getValue()},isValid:Ce,disconnect:we},light:{update:function(e,t,n){var o=t.getValue(n);e.mesh.position[n.param]=o,e.light.position[n.param]=o},isValid:Ce,disconnect:we}};function Ee(e){return(Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Oe=function(e,t,n){for(var o=function(o){if(function t(o){var i=e.filter(function(e){return e.in.ID===o.ID&&!e.param});return!!i.find(function(e){return e.out.isOscillator&&e.out.ID===n.ID})||i.length>0&&t(i[0].out)}(t[o].in))return{v:!0}},i=0;i<t.length;i++){var a=o(i);if("object"===Ee(a))return a.v}return!1},Pe={updateOscillators:function(e){for(var t=e.filter(function(e){return e.param&&"gain"===e.param.param&&e.out.isEnvelope}),n=e.filter(function(e){return e.out.isOscillator&&!e.param}),o=0;o<n.length;o++){var i=Oe(e,t,n[o].out);n[o].out.hasEnvelopeConnection=i}}};function _e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var xe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.collectedInputs=[]}var t,n,o;return t=e,(n=[{key:"showAvailable",value:function(e,t,n,o){var i=t.map(function(e){return e});this.collectedInputs=[];for(var a=0;a<i.length;a++){var r=i[a],s={node:r,inputs:[],params:[]};if(r.input)s.inputs.push(r.input);else if(r.inputs)for(var u in r.inputs)s.inputs.push(r.inputs[u]);for(var l in r.inputParams)s.params.push(r.inputParams[l]);this.collectedInputs.push(s)}for(var c=0;c<this.collectedInputs.length;c++){var h=this.collectedInputs[c].inputs,p=this.collectedInputs[c].params,d=this.collectedInputs[c].node;if(d.isGraphicsNode){for(var f=0;f<h.length;f++){var m=h[f];d.inputHelpersType.isValid(e,d,m.inputType)||m.activatePossible()}for(var v=0;v<p.length;v++){var y=p[v];ke[y.param.paramHelpersType].isValid(e,d,y.param)||y.activatePossible()}}else{for(var g=0;g<h.length;g++){var b=h[g];d.inputHelpersType.isValid(e,d,void 0,n,o)||b.activatePossible()}for(var C=0;C<p.length;C++){var w=p[C];w.param.helper.isValid(e,d,w.param,n)||w.activatePossible()}}}}},{key:"resetAvailable",value:function(){for(var e=0;e<this.collectedInputs.length;e++){for(var t=this.collectedInputs[e].inputs,n=this.collectedInputs[e].params,o=0;o<t.length;o++){t[o].deactivatePossible()}for(var i=0;i<n.length;i++){n[i].deactivatePossible()}}}}])&&_e(t.prototype,n),o&&_e(t,o),e}();function Me(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Re=function(){function e(t,n,o,i){var a=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.hasConfig=!!t,this.onNodeActiveCallback=o,this.availableConnections=new xe,this.constructorIsDone=!1,this.keyboardManager=n,this._nodes=[],this._nodeConnections=[],this._graphicNodes=[],this._graphicNodeLength=0,this.resetConnectingBound=this.resetConnecting.bind(this),this.nodeConnectionRenderer=new p(i,this),this.nodeConnectionLine=new ge(this.nodeConnectionRenderer.el,this.resetConnectingBound),this.isConnecting=!1,this.outputActiveNode=null,this.outputActiveType=void 0,this.onConnectingBound=this.onConnecting.bind(this),this.onInputConnectionBound=this.onInputConnection.bind(this),this.addBound=this.add.bind(this),this.removeBound=this.onNodeRemove.bind(this),this.onAudioNodeParamChangeBound=this.onAudioNodeParamChange.bind(this),this.audioNodeManager=new ve(i,this.onConnectingBound,this.onInputConnectionBound,this.addBound,this.hasConfig?this.config.nodes:[],this.onAudioNodeParamChangeBound,o,this.removeBound),this.audioNodeManager.init(),this.graphicsNodeManager=new E(i,this.onConnectingBound,this.onInputConnectionBound,this.addBound,o,this.removeBound),this.hasConfig){for(var r=function(e){a.isConnecting=!0;var t=a._nodes.find(function(t){return t.ID===a.config.connections[e].out}),n=a._nodes.find(function(t){return t.ID===a.config.connections[e].in});a.outputActiveNode=t,a.onInputConnection(n)},s=0;s<this.config.connections.length;s++)r(s);this.outputActiveNode=null;var u=this.getAudioConnections(this._nodeConnections);this.keyboardManager.onAudioNodeConnectionUpdate(u);var l=u.filter(function(e){return e.out.isSequencer}),c=[];for(s=0;s<l.length;s++){var h=l[s].out.ID;c.indexOf(h)<0&&(l[s].out.sequencerManager.onAudioNodeConnectionUpdate(u),c.push(h))}c=[]}this.constructorIsDone=!0}var t,n,o;return t=e,(n=[{key:"onNodeAddedFromLibrary",value:function(e,t,n){if("graphics"===e){if(this._graphicNodes.some(function(e){return e.isCanvasNode})&&"Canvas"===t.type)return;this.graphicsNodeManager.createNode(t,n)}else this.audioNodeManager.createNode(t,n)}},{key:"onNodeRemove",value:function(e){for(var t=this._nodeConnections.filter(function(t){return t.out.ID===e.ID||t.in.ID===e.ID}),n=0;n<t.length;n++)this.removeConnection(t[n]);this.remove(e)}},{key:"onAudioNodeParamChange",value:function(e,t){this.keyboardManager.onAudioNodeParamChange(e,t)}},{key:"disconnectAnalyserNodes",value:function(e){for(var t=e.filter(function(e){return e.in.isAnalyser}),n=0;n<t.length;n++)t[n].in.dispose()}},{key:"getAudioConnections",value:function(e){return e.filter(function(e){return!e.out.isGraphicsNode&&!e.in.isGraphicsNode})}},{key:"resetConnecting",value:function(){this.isConnecting=!1,this.outputActiveNode=null,this.outputActiveType=void 0,this.nodeConnectionLine.resetLine(),this.availableConnections.resetAvailable()}},{key:"onConnecting",value:function(e,t,n){if(!this.isConnecting&&!this.outputActiveNode){this._nodeConnections.some(function(t){return t.out.ID===e.ID});this.isConnecting=!0,this.outputActiveNode=e,this.outputActiveType=n,this.nodeConnectionLine.onConnectionActive(e,t,n),this.availableConnections.showAvailable(e,this._nodes,this._nodeConnections,n)}}},{key:"onInputConnection",value:function(e,t,n){if(this.availableConnections.resetAvailable(),this.isConnecting&&this.outputActiveNode){if(e.isGraphicsNode){if(n&&!ke[n.paramHelpersType].isValid(this.outputActiveNode,e,n,this._nodeConnections))return void this.resetConnecting();if(!e.inputHelpersType.isValid(this.outputActiveNode,e,t))return void this.resetConnecting()}else if(n&&n.helper){if(!n.helper.isValid(this.outputActiveNode,e,n,this._nodeConnections))return void this.resetConnecting()}else if(!e.inputHelpersType.isValid(this.outputActiveNode,e,void 0,this._nodeConnections,this.outputActiveType))return void this.resetConnecting();this.nodeConnectionLine.onInputClick(!0,e,this.outputActiveNode),this.isConnecting=!1;var o=n?"".concat(n.parent,"-").concat(n.param):"",i="".concat(e.ID,"---").concat(this.outputActiveNode.ID,"---").concat(o),a={param:n,out:this.outputActiveNode,in:e,lineEl:this.nodeConnectionRenderer.addLine(i),inputType:t,outputType:this.outputActiveType};if(this.outputActiveNode.enableOutput(n||void 0,a),n?e.enableParam(n,a):e.enableInput(this.outputActiveNode,t),this._nodeConnections.push(a),this.constructorIsDone){var r=this.getAudioConnections(this._nodeConnections);Pe.updateOscillators(r),this.disconnectAnalyserNodes(r),this.keyboardManager.onAudioNodeConnectionUpdate(r);for(var s=r.filter(function(e){return e.out.isSequencer}),u=[],l=0;l<s.length;l++){var c=s[l].out.ID;u.indexOf(c)<0&&(s[l].out.sequencerManager.onAudioNodeConnectionUpdate(r),u.push(c))}u=[]}this.resetConnecting()}}},{key:"removeConnection",value:function(e){e.param?e.in.disableParam(e.param,e):e.in.disableInput(e.out,e.inputType),e.out.disableOutput(e.in,e.param,e.outputType);var t=this._nodeConnections.filter(function(t){return t.out.ID!==e.out.ID||t.in.ID!==e.in.ID});e.param&&(t=this._nodeConnections.filter(function(t){return!t.param||(t.param.title!==e.param.title||t.in.ID!==e.in.ID)})),this._nodeConnections=t;var n=this.getAudioConnections(this._nodeConnections);Pe.updateOscillators(n),this.disconnectAnalyserNodes(n),this.keyboardManager.onAudioNodeConnectionUpdate(n);for(var o=n.filter(function(e){return e.out.isSequencer}),i=[],a=0;a<o.length;a++){var r=o[a].out.ID;i.indexOf(r)<0&&(o[a].out.sequencerManager.onAudioNodeConnectionUpdate(n),i.push(r))}i=[],this.nodeConnectionRenderer.removeLine(e.lineEl)}},{key:"onNodePlaced",value:function(e){console.log("node placed",e)}},{key:"add",value:function(e){if(this._nodes.push(e),(e.isRenderNode||e.isCanvasNode||e.needsUpdate)&&(this._graphicNodes.push(e),this._graphicNodeLength=this._graphicNodes.length),e.isSequencer){var t=this.getAudioConnections(this._nodeConnections);e.sequencerManager.init(t)}}},{key:"remove",value:function(e){if(e.isGraphicsNode||e.needsUpdate){var t=this._graphicNodes.filter(function(t){return t.ID!==e.ID});this._graphicNodes=t,this._graphicNodeLength=this._graphicNodes.length}e.removeFromDom();var n=this._nodes.filter(function(t){return t.ID!==e.ID});this._nodes=n}},{key:"update",value:function(){this.nodeConnectionRenderer.update();for(var e=0;e<this._graphicNodeLength;e++)this._graphicNodes[e].update()}},{key:"render",value:function(){this.nodeConnectionRenderer.render();for(var e=0;e<this._graphicNodeLength;e++)this._graphicNodes[e].render()}}])&&Me(t.prototype,n),o&&Me(t,o),e}();function Se(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Te=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.workspaceManager=t,this.parentEl=t.el,this.el=document.createElement("div"),this.el.style.width="200px",this.el.style.height="200px",this.el.style.position="absolute",this.el.style.top="0",this.el.style.left="0",this.el.style.background="rgba(50, 50, 50, .9)",this.el.style.borderRadius="4px",this.parentEl.appendChild(this.el),this.moveCoords={start:{x:0,y:0},offset:{x:n.x,y:n.y}},this.deltaX=0,this.deltaY=0,this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this)}var t,n,o;return t=e,(n=[{key:"getPos",value:function(){var e=Math.abs(this.workspaceManager.moveCoords.offset.x),t=Math.abs(this.workspaceManager.moveCoords.offset.y);return{x:this.moveCoords.offset.x+e,y:this.moveCoords.offset.y+t}}},{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this.deltaX=0,this.deltaY=0,this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y}},{key:"onMouseMove",value:function(e){var t=e.x,n=e.y,o=t-this.moveCoords.start.x,i=n-this.moveCoords.start.y;this.moveCoords.offset.x=o,this.moveCoords.offset.y=i;var a=Math.abs(this.workspaceManager.moveCoords.offset.x),r=Math.abs(this.workspaceManager.moveCoords.offset.y);this.el.style[window.NS.transform]="translate3d(".concat(o+a,"px, ").concat(i+r,"px, 0)"),this.deltaX=o,this.deltaY=i}},{key:"onMouseUp",value:function(e){this.parentEl.removeChild(this.el)}}])&&Se(t.prototype,n),o&&Se(t,o),e}();function Le(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ne=function(){function e(t,n,o,i){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.onNodeAddedCallback=o,this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.workspaceManager=i,this.nodeToPlaceData={type:void 0,data:void 0},this.el=document.createElement("div"),this.el.className="node-library";var r=document.createElement("div");r.className="inner-scroll",this.el.appendChild(r),this.parentEl.appendChild(this.el);var s=function(e){var t=document.createElement("div");t.className="level-0";var o=document.createElement("h4");o.className="level-title",o.innerHTML=e,t.appendChild(o);var i=function(i){var r=document.createElement("div");r.className="level-1",(o=document.createElement("h4")).className="level-title",o.innerHTML=i,r.appendChild(o),t.appendChild(r);var s=document.createElement("div");s.className="node-container",r.appendChild(s);for(var u=function(t){var o=document.createElement("div");o.className="library-node audio",o.setAttribute("data-type-0",e),o.setAttribute("data-type-1",i);var r=document.createElement("h4");r.className="node-type",r.innerHTML=n[e][i][t].type;var u=document.createElement("img");u.className="node-add",u.src="assets/add.svg",o.appendChild(r),o.appendChild(u),s.appendChild(o),o.addEventListener("mousedown",function(o){a.nodeToPlaceData.type=e,a.nodeToPlaceData.data=n[e][i][t],a.onMouseDown(o)})},l=0;l<n[e][i].length;l++)u(l)};for(var s in n[e])i(s);r.appendChild(t)};for(var u in n)s(u)}var t,n,o;return t=e,(n=[{key:"hide",value:function(){this.el.style.transform="translateX(100%)"}},{key:"show",value:function(){this.el.style.transform="translateX(0)"}},{key:"onMouseDown",value:function(e){this.el.style.opacity=.1,this.nodePlaceHelper=new Te(this.workspaceManager,{x:e.clientX,y:e.clientY}),this.nodePlaceHelper.onMouseDown(e),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){this.nodePlaceHelper.onMouseMove(e)}},{key:"onMouseUp",value:function(){this.nodePlaceHelper.onMouseUp(),this.el.style.opacity=1,window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound);var e=this.nodePlaceHelper.getPos();Math.abs(this.nodePlaceHelper.deltaX)>4&&this.onNodeAddedCallback(this.nodeToPlaceData.type,this.nodeToPlaceData.data,e),this.nodeToPlaceData={type:void 0,data:void 0}}}])&&Le(t.prototype,n),o&&Le(t,o),e}();function Ie(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var De=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nodes={},this.step=t,this.currentConnections=[],this.oscillatorNodes=[],this.synthOscillatorNodes=[],this.triggerNodes=[]}var t,n,o;return t=e,(n=[{key:"reset",value:function(e){for(var t=0;t<this.currentConnections.length;t++){var n=this.currentConnections[t],o=this.nodes[n.out.ID]?this.nodes[n.out.ID].audioNode:void 0,i=this.nodes[n.in.ID]?this.nodes[n.in.ID].audioNode:void 0,a=this.nodes[n.in.ID]?this.nodes[n.in.ID].musicNode:void 0;if(o&&i)if(n.out.isParam);else{if(a&&a.isAnalyser)continue;i.disconnect()}}this.nodes={},this.oscillatorNodes=[],this.currentConnections=e,this.triggerNodes=[],this.synthOscillatorNodes=[]}},{key:"updateConnections",value:function(e){this.reset(e);for(var t=0;t<e.length;t++){var n=e[t];if(!n.out.isSequencer){if(!this.nodes[n.in.ID]){var o={audioNode:n.in.getAudioNode(),musicNode:n.in};this.nodes[n.in.ID]=o}if(!this.nodes[n.out.ID]){var i=n.out.getAudioNode(n.param?n.param.param:void 0),a={audioNode:i,musicNode:n.out};this.nodes[n.out.ID]=a,n.out.isEnvelope&&this.triggerNodes.push(i),(n.out.isOscillator||n.out.isLFO)&&this.oscillatorNodes.push(a),n.out.isSynthOscillator&&this.synthOscillatorNodes.push(a)}}}for(var r=0;r<e.length;r++){var s=e[r],u=this.nodes[s.out.ID]?this.nodes[s.out.ID].audioNode:void 0,l=this.nodes[s.in.ID]?this.nodes[s.in.ID].audioNode:void 0;this.nodes[s.out.ID]&&this.nodes[s.out.ID].musicNode,this.nodes[s.in.ID]&&this.nodes[s.in.ID].musicNode;if(!s.out.isSequencer||u)if(s.out.isParam){var c=s.param.param;u.connect(l[c])}else u.connect(l)}}},{key:"onParamChange",value:function(e){this.nodes[e.ID]&&(e.isOscillator?this._updateOscillatorParams(this.nodes[e.ID].audioNode,e):e.isSynthOscillator||this._updateParams(this.nodes[e.ID].audioNode,e))}},{key:"_updateSynthOscillatorParams",value:function(e,t){for(var n=0;n<t.synthParams.length;n++){var o=t.params[t.synthParams[n]];o.setParam?o.setParam(e,o.value):e[t.synthParams[n]].value=o.value}}},{key:"_updateOscillatorParams",value:function(e,t){e.frequency.value=t.getFrequency(this.step)}},{key:"_updateParams",value:function(e,t){var n=function(e,t){for(var n in e.params)if(e.params[n].param===t)return e.params[n].isConnected};for(var o in t.params)"gain"===o&&n(t,o)||("frequency"===o||"amplitude"===o||"Q"===o||"gain"===o||"threshold"===o||"ratio"===o?e[o].value=t.params[o].value:e[o]=t.params[o].value)}},{key:"play",value:function(e,t){var n=this.triggerNodes.length,o=this.oscillatorNodes.length,i=this.synthOscillatorNodes.length;for(var a in this.nodes){var r=this.nodes[a];r.musicNode.isOscillator?this._updateOscillatorParams(r.audioNode,r.musicNode):r.musicNode.isSynthOscillator?this._updateSynthOscillatorParams(r.audioNode,r.musicNode):this._updateParams(r.audioNode,r.musicNode)}for(var s=0;s<n;s++)this.triggerNodes[s].triggerAttackRelease(D.a.Time("8n"),e);for(var u=0;u<o;u++){var l=this.oscillatorNodes[u];l.musicNode.isOscillator&&l.musicNode.hasConnectedTrigger&&l.musicNode.connectedTriggerID===t?l.musicNode.hasEnvelopeConnection?l.audioNode.start(e).stop(e+D.a.Time(2)):l.audioNode.start(e).stop(e+D.a.Time("8n")):l.musicNode.isLFO&&(l.audioNode.phase=0,l.audioNode.start(e))}for(var c=0;c<i;c++){var h=this.synthOscillatorNodes[c];if(h.musicNode.connectedTriggerID===t){var p=h.musicNode.getFrequency(this.step);h.audioNode.triggerAttackRelease(p,"8n")}}}},{key:"keyDown",value:function(){var e=this.triggerNodes.length,t=this.oscillatorNodes.length,n=this.synthOscillatorNodes.length;for(var o in this.nodes){var i=this.nodes[o];i.musicNode.isOscillator?this._updateOscillatorParams(i.audioNode,i.musicNode):i.musicNode.isSynthOscillator?this._updateSynthOscillatorParams(i.audioNode,i.musicNode):this._updateParams(i.audioNode,i.musicNode)}for(var a=0;a<t;a++){var r=this.oscillatorNodes[a];r.musicNode.isOscillator?r.audioNode.start():r.musicNode.isLFO&&(r.audioNode.phase=0,r.audioNode.start())}for(var s=0;s<e;s++)this.triggerNodes[s].triggerAttack();for(var u=0;u<n;u++){var l=this.synthOscillatorNodes[u],c=l.musicNode.getFrequency(this.step);l.audioNode.triggerAttack(c)}}},{key:"keyUp",value:function(){for(var e=this.triggerNodes.length,t=this.oscillatorNodes.length,n=this.synthOscillatorNodes.length,o=0;o<t;o++){var i=this.oscillatorNodes[o];i.musicNode.isOscillator?i.musicNode.hasEnvelopeConnection||i.audioNode.stop():i.musicNode.isLFO}for(var a=0;a<e;a++)this.triggerNodes[a].triggerRelease();for(var r=0;r<n;r++){var s=this.synthOscillatorNodes[r];s.musicNode.getFrequency(this.step);s.audioNode.triggerRelease()}}}])&&Ie(t.prototype,n),o&&Ie(t,o),e}();function Be(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var je=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),e.KEY_INTS=[65,83,68,70,71,72,74,75,76,186,222,219],this.keys=[];for(var t=0;t<e.KEY_INTS.length;t++){var n={keyNr:e.KEY_INTS[t],step:t,triggered:!1,synth:new De(t)};this.keys.push(n)}this.onKeyDownBound=this.onKeyDown.bind(this),this.onKeyUpBound=this.onKeyUp.bind(this),window.addEventListener("keydown",this.onKeyDownBound),window.addEventListener("keyup",this.onKeyUpBound)}var t,n,o;return t=e,(n=[{key:"onKeyDown",value:function(e){var t=e.keyCode,n=this.getKey(t);if(null!==n){if(e.preventDefault(),n.triggered)return;n.triggered=!0,n.synth.keyDown()}}},{key:"onKeyUp",value:function(e){var t=e.keyCode,n=this.getKey(t);if(null!==n){if(!n.triggered)return;n.triggered=!1,n.synth.keyUp()}}},{key:"enable",value:function(){window.addEventListener("keydown",this.onKeyDownBound),window.addEventListener("keyup",this.onKeyUpBound)}},{key:"disable",value:function(){window.removeEventListener("keydown",this.onKeyDownBound),window.removeEventListener("keyup",this.onKeyUpBound)}},{key:"play",value:function(e,t){this.keys[e].synth.play(t)}},{key:"onAudioNodeConnectionUpdate",value:function(e){for(var t=0;t<this.keys.length;t++)this.keys[t].synth.updateConnections(e)}},{key:"onAudioNodeParamChange",value:function(e,t){for(var n=0;n<this.keys.length;n++)this.keys[n].synth.onParamChange(e,t)}},{key:"getKey",value:function(e){for(var t=null,n=0;n<this.keys.length;n++)this.keys[n].keyNr!==e||(t=this.keys[n]);return t}}])&&Be(t.prototype,n),o&&Be(t,o),e}();function Ae(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ve=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=3e3,this.height=2e3,this.containerEl=document.createElement("div"),this.containerEl.className="workspace-container",t.appendChild(this.containerEl),this.el=document.createElement("div"),this.el.className="workspace",this.el.style.width=this.width+"px",this.el.style.height=this.height+"px",this.containerEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.currentScale=1,this.moveCoords={start:{x:0,y:0},offset:{x:-(this.width/2-window.innerWidth/2),y:-(this.height/2-window.innerHeight/2)}},this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0)"),this.el.addEventListener("mousedown",this.onMouseDownBound)}var t,n,o;return t=e,(n=[{key:"disable",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound)}},{key:"enable",value:function(){this.el.addEventListener("mousedown",this.onMouseDownBound)}},{key:"setScale",value:function(e){this.currentScale=e,this.el.style[window.NS.transform]="translate3d(".concat(this.moveCoords.offset.x,"px, ").concat(this.moveCoords.offset.y,"px, 0) scale(").concat(e,")")}},{key:"onMouseDown",value:function(e){"INPUT"===e.target.nodeName||e.target.classList.contains("prevent-drag")||(e.preventDefault(),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,window.addEventListener("mousemove",this.onMouseMoveBound),window.addEventListener("mouseup",this.onMouseUpBound))}},{key:"onMouseMove",value:function(e){e.preventDefault();var t=e.x-this.moveCoords.start.x,n=e.y-this.moveCoords.start.y;this.moveCoords.offset.x=t,this.moveCoords.offset.y=n,this.el.style[window.NS.transform]="translate3d(".concat(t,"px, ").concat(n,"px, 0) scale(").concat(this.currentScale,")")}},{key:"onMouseUp",value:function(e){window.removeEventListener("mousemove",this.onMouseMoveBound),window.removeEventListener("mouseup",this.onMouseUpBound)}},{key:"onResize",value:function(e,t){this.containerEl.style.width="".concat(e,"px"),this.containerEl.style.height="".concat(t,"px")}}])&&Ae(t.prototype,n),o&&Ae(t,o),e}();function He(e){return(He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ze(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qe(e,t){return(qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ke=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=Ue(t).call(this))||"object"!==He(o)&&"function"!=typeof o?ze(n):o).isParam=!0,e.isLFO=!0,e.el.classList.add("no-height"),e.audioNode=new D.a.LFO;var i=document.createElement("div");i.className="range-container",e.topPartEl.appendChild(i),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(ze(e));var a={parentEl:i,title:"Frekvens",initValue:6,settings:{min:.1,max:17},valChangeCallback:e.onRangeChangeCallbackBound,param:"frequency",decimals:2,disable:!1};e.freqRangeSlider=new j(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={useAsInput:!0,value:a.initValue,param:"frequency",slider:e.freqRangeSlider,title:"LFO Frequency",helper:_.frequency,disableSliderOnConnection:!1},s={parentEl:i,title:"Amplitud",initValue:.25,settings:{min:.1,max:.5},valChangeCallback:e.onRangeChangeCallbackBound,param:"amplitude",decimals:2,disable:!1};e.amplitudeRangeSlider=new j(s.parentEl,s.title,s.initValue,s.settings,s.valChangeCallback,s.param,s.decimals,s.disable);var u={useAsInput:!0,value:s.initValue,param:"amplitude",slider:e.amplitudeRangeSlider,title:"Amplitude",helper:_.frequency,disableSliderOnConnection:!1};return e.params[r.param]=r,e.params[u.param]=u,e.paramVals={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qe(e,t)}(t,N),n=t,(o=[{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getAudioNode",value:function(){var e=new D.a.LFO;return e.min=-22e3,e.max=22e3,e}}])&&Fe(n.prototype,o),i&&Fe(n,i),t}();function Ge(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var We=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.triggerID=o,this.cols=t,this.rows=n,this.synths=[],this.masterSynth=new De(0);for(var i=0;i<t;i++){for(var a=[],r=0;r<n;r++)a.push({synth:null,isActive:!1});this.synths.push(a)}}var t,n,o;return t=e,(n=[{key:"init",value:function(e){this.masterSynth.updateConnections(e)}},{key:"removeAllSynths",value:function(){for(var e=this.cols,t=this.rows,n=0;n<e;n++)for(var o=0;o<t;o++)this.synths[n][o].isActive&&(this.synths[n][o].synth.reset(),this.synths[n][o].isActive=!1)}},{key:"addSynth",value:function(e,t){var n=new De(t);n.updateConnections(this.masterSynth.currentConnections),this.synths[e][t].synth=n,this.synths[e][t].isActive=!0}},{key:"removeSynth",value:function(e,t){this.synths[e][t].isActive&&(this.synths[e][t].synth.reset(),this.synths[e][t].isActive=!1)}},{key:"play",value:function(e,t,n){this.synths[e][t].synth.play(n,this.triggerID)}},{key:"onAudioNodeConnectionUpdate",value:function(e){for(var t=this.cols,n=this.rows,o=0;o<t;o++)for(var i=0;i<n;i++)this.synths[o][i].isActive&&this.synths[o][i].synth.updateConnections(e);this.masterSynth.updateConnections(e)}},{key:"onAudioNodeParamChange",value:function(e,t){for(var n=this.cols,o=this.rows,i=0;i<n;i++)for(var a=0;a<o;a++)this.synths[i][a].isActive&&this.synths[i][a].synth.onParamChange(e,t);this.masterSynth.onParamChange(e,t)}}])&&Ge(t.prototype,n),o&&Ge(t,o),e}();function Ye(e){return(Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Qe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ze(e,t,n){return(Ze="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Je(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Je(e){return(Je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $e(e,t){return($e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var et=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,e=!(o=Je(t).call(this))||"object"!==Ye(o)&&"function"!=typeof o?Qe(n):o,t.ROWS=12,t.COLS=16,e.isSequencer=!0,e.loop=null,e.hasAudioInput=!1,e.isParam=!0,e.data=[];for(var i=t.ROWS,a=t.COLS,r=0;r<a;r++){for(var s=[],u=0;u<i;u++){var l={active:!1,el:null,parentEl:null,step:i-1-u};s.push(l)}e.data.push(s)}return e.outConnections=[],e.outConnectionsLength=0,e.isPlaying=!1,e.onBtnClickBound=e.onBtnClick.bind(Qe(e)),e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$e(e,t)}(t,N),n=t,(o=[{key:"init",value:function(e,n,o,i,a,r,s,u,l){Ze(Je(t.prototype),"init",this).call(this,e,n,o,i,a,r,s,u,l),this.sequencerManager=new We(t.COLS,t.ROWS,this.ID)}},{key:"removeFromDom",value:function(){this.sequencerManager.removeAllSynths(),Ze(Je(t.prototype),"removeFromDom",this).call(this)}},{key:"getKey",value:function(e,t){return"col".concat(e,"-row").concat(t)}},{key:"onRemoveClick",value:function(){this.loop.stop(),this.playEl.removeEventListener("click",this.onPlayClickBound),this.pauseEl.removeEventListener("click",this.onPauseClickBound),Ze(Je(t.prototype),"onRemoveClick",this).call(this)}},{key:"createUI",value:function(){var e=t.ROWS,n=t.COLS,o=document.createElement("div");o.className="sequencer-container";for(var i=0;i<n;i++){var a=document.createElement("div");a.className="sequencer-col",o.appendChild(a);for(var r=0;r<e;r++){var s=document.createElement("div");s.className="sequencer-btn",s.setAttribute("data-col",i),s.setAttribute("data-row",r),a.appendChild(s),s.addEventListener("click",this.onBtnClickBound),this.data[i][r].el=s,this.data[i][r].parentEl=a}}this.topPartEl.appendChild(o);var u=document.createElement("div");u.className="sequencer-controls";var l=document.createElement("div");l.className="inner-controls",this.playEl=document.createElement("h5"),this.playEl.innerHTML="Spela",this.pauseEl=document.createElement("h5"),this.pauseEl.innerHTML="Nollstll",this.onPlayClickBound=this.onPlayClick.bind(this),this.onPauseClickBound=this.onPauseClick.bind(this),this.playEl.addEventListener("click",this.onPlayClickBound),this.pauseEl.addEventListener("click",this.onPauseClickBound),l.appendChild(this.playEl),l.appendChild(this.pauseEl),u.appendChild(l),this.topPartEl.appendChild(u)}},{key:"onPlayClick",value:function(){this.isPlaying||(this.isPlaying=!0,this.loop.start())}},{key:"onPauseClick",value:function(){this.isPlaying=!1,this.loop.stop(),this.reset()}},{key:"reset",value:function(){for(var e=t.ROWS,n=t.COLS,o=0;o<n;o++){this.data[o][0].parentEl.classList.remove("active");for(var i=0;i<e;i++)this.data[o][i].active=!1}this.sequencerManager.removeAllSynths(),this.update()}},{key:"setup",value:function(){var e=this;this.loop=new D.a.Sequence(function(n,o){for(var i=0;i<t.COLS;i++){e.data[i][0].parentEl.classList.remove("active")}var a=e.data[o];e.data[o][0].parentEl.classList.add("active");for(var r=0;r<t.ROWS;r++)a[r].active&&e.outConnectionsLength>0&&e.sequencerManager.play(o,a[r].step,n)},[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],"8n")}},{key:"onBtnClick",value:function(e){e.stopPropagation(),e.preventDefault();var t=parseInt(e.target.getAttribute("data-col")),n=parseInt(e.target.getAttribute("data-row")),o=this.data[t][n];o.active=!o.active,o.active?this.sequencerManager.addSynth(t,o.step):this.sequencerManager.removeSynth(t,o.step),this.update()}},{key:"onOutputClick",value:function(e){0===this.outConnectionsLength&&this.onConnectingCallback(this,e)}},{key:"enableOutput",value:function(e,t){this.output.enable(),this.outConnections.push(t.in),this.outConnectionsLength=this.outConnections.length}},{key:"disableOutput",value:function(e,t){this.outConnections=this.outConnections.filter(function(t){return t.ID!==e.ID}),this.outConnectionsLength=this.outConnections.length,0===this.outConnections.length&&(this.output.disable(),this.sequencerManager.removeAllSynths(),this.onPauseClick())}},{key:"update",value:function(){for(var e=t.ROWS,n=t.COLS,o=0;o<n;o++)for(var i=0;i<e;i++){var a=this.data[o][i];a.active?a.el.classList.add("active"):a.el.classList.remove("active")}}}])&&Xe(n.prototype,o),i&&Xe(n,i),t}();function tt(e){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ot(e,t){return!t||"object"!==tt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function it(e,t,n){return(it="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=at(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function at(e){return(at=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rt(e,t){return(rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var st=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ot(this,at(t).call(this))).el.classList.add("no-height"),e.el.classList.add("waveform-node"),e.needsUpdate=!0,e.isAnalyser=!0,e.isDisposed=!1,e.hasMultipleOutputs=!0,e.arrSize=256,e.audioValue=0,e.isConnected=!1,e.audioConnections=[],e.audioNode=D.a.context.createAnalyser(),e.audioNode.fftSize=e.arrSize,e.canvas=document.createElement("canvas"),e.canvas.className="waveform-canvas",e.canvas.width="200",e.canvas.height="100",e.ctx=e.canvas.getContext("2d"),e.value=new Uint8Array(e.arrSize),e.topPartEl.appendChild(e.canvas),e.params={},e}var n,o,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rt(e,t)}(t,N),n=t,(o=[{key:"init",value:function(e,n,o,a,r,s,u,l,c){it(at(t.prototype),"init",this).call(this,e,n,o,a,r,s,u,l,c),this.onOutputClickAudioBound=this.onOutputClickAudio.bind(this),this.onOutputClickDataBound=this.onOutputClickData.bind(this);var h=document.createElement("div");h.className="multiple-outputs",this.bottomPartEl.appendChild(h),this.outputAudio=new i(h,this.onOutputClickAudioBound,!1,!1,!1,!1),this.outputData=new i(h,this.onOutputClickDataBound,!0,!1,!1,!1),this.outputDataConnection=null,this.outputs={"analyser-audio":this.outputAudio,"analyser-data":this.outputData},this.enabledOutputs=[],this.inDotPos={"analyser-audio":null,"analyser-data":null}}},{key:"onOutputClickAudio",value:function(e){this.onConnectingCallback(this,e,"analyser-audio")}},{key:"onOutputClickData",value:function(e){this.onConnectingCallback(this,e,"analyser-data")}},{key:"getOutputPos",value:function(e){return{x:this.outputs[e].el.offsetLeft,y:this.outputs[e].el.offsetTop}}},{key:"getOutDotPos",value:function(e,t){return this.inDotPos[t]||(this.inDotPos[t]=this.outputs[t].el.getBoundingClientRect()),this.inDotPos[t]}},{key:"getOutputEl",value:function(e){return this.outputs[e]}},{key:"dispose",value:function(){this.isDisposed||(this.audioNode.disconnect(),this.isDisposed=!0)}},{key:"enableInput",value:function(e){it(at(t.prototype),"enableInput",this).call(this,e),this.isConnected=!0}},{key:"disableInput",value:function(e){it(at(t.prototype),"disableInput",this).call(this,e),this.isConnected=!1}},{key:"enableOutput",value:function(e,t){var n=t.outputType;this.outputs[n].enable(),this.enabledOutputs.push(n),"analyser-data"===n&&(this.outputDataConnection=t)}},{key:"disableOutput",value:function(e,t,n){this.outputs[n].disable(),this.enabledOutputs=this.enabledOutputs.filter(function(e){return e!==n}),"analyser-data"===n&&(this.audioValue=0,this.outputDataConnection=null)}},{key:"getAudioNode",value:function(){return this.isDisposed&&(this.audioNode=D.a.context.createAnalyser(),this.audioNode.fftSize=this.arrSize,this.isDisposed=!1),this.audioNode}},{key:"getValue",value:function(){return this.isConnected?this.audioValue:0}},{key:"update",value:function(){this.isConnected&&this.audioNode.getByteTimeDomainData(this.value)}},{key:"render",value:function(){var e=this.canvas.width,t=this.canvas.height;this.ctx.clearRect(0,0,e,t),this.ctx.fillStyle="black",this.ctx.strokeStyle="red";var n=0;this.ctx.beginPath();for(var o=0;o<this.arrSize;o++){var i=o/this.arrSize*e,a=(1-this.value[o]/256)*t;n+=1-this.value[o]/256,this.ctx.lineTo(i,a)}if(this.audioValue=100*(n/this.arrSize-.5),this.ctx.stroke(),this.outputDataConnection&&this.outputDataConnection.param){var r=this.outputDataConnection.param;this.outputDataConnection.in.updateParam(r,this)}}}])&&nt(n.prototype,o),a&&nt(n,a),t}();function ut(e){return(ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ct(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ht(e,t,n){return(ht="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=pt(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function pt(e){return(pt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dt(e,t){return(dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ft=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=pt(t).call(this))||"object"!==ut(o)&&"function"!=typeof o?ct(n):o).el.classList.add("no-height"),e.hasConnectedTrigger=!1,e.connectedTriggerID=-1,e.synthParams=[],t.BASE_FREQ=440,t.ROOT=Math.pow(2,1/12),e.isKeyboardListener=!0,e.isSynthOscillator=!0,e.hasAudioInput=!1,e.hasEnvelopeConnection=!1;var i=document.createElement("div");i.className="range-container",e.topPartEl.appendChild(i),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(ct(e));var a={parentEl:i,title:"Oktav",initValue:-2,settings:{min:-4,max:0},valChangeCallback:e.onRangeChangeCallbackBound,param:"octave",decimals:0,disable:!1};e.octaveRangeSlider=new j(a.parentEl,a.title,a.initValue,a.settings,a.valChangeCallback,a.param,a.decimals,a.disable);var r={useAsInput:!1,value:a.initValue,param:"octave",slider:e.octaveRangeSlider,title:"Octave"},s={useAsInput:!0,param:"trigger",title:"Trigger",helper:_.oscillatorTrigger};return e.params[r.param]=r,e.params[s.param]=s,e.paramVals={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dt(e,t)}(t,N),n=t,(o=[{key:"enableParam",value:function(e,n){ht(pt(t.prototype),"enableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!0,this.connectedTriggerID=n.out.ID)}},{key:"disableParam",value:function(e){ht(pt(t.prototype),"disableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!1,this.connectedTriggerID=-1)}},{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getParams",value:function(e){e||(e=0);return{}}},{key:"getAudioNode",value:function(){return new D.a.MembraneSynth}},{key:"getFrequency",value:function(e){var n=12*parseInt(this.params.octave.value)+e;return t.BASE_FREQ*Math.pow(t.ROOT,n)}}])&&lt(n.prototype,o),i&&lt(n,i),t}();function mt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var vt=function(){function e(t,n,o,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.waves=["sine","sawtooth","square","triangle"],this.parentEl=t,this.onChange=n,this.param=i,this.partialCount=0;var r=document.createElement("h4");r.className="wave-type-label",r.innerHTML=a;var s=document.createElement("div");s.className="wave-type-selector-container",s.appendChild(r);var u=document.createElement("div");u.className="wave-types-container",s.appendChild(u),this.onWaveClickBound=this.onWaveClick.bind(this),this.waveTypeEls=[];for(var l=0;l<this.waves.length;l++){var c=document.createElement("h4");c.className="wave-type",c.innerHTML=this.waves[l],c.setAttribute("data-wave",this.waves[l]),c.addEventListener("click",this.onWaveClickBound),this.waveTypeEls.push(c),u.appendChild(c)}t.appendChild(s)}var t,n,o;return t=e,(n=[{key:"onWaveClick",value:function(e){for(var t=0;t<this.waveTypeEls.length;t++)this.waveTypeEls[t].classList.remove("active");var n=e.target.getAttribute("data-wave");e.target.classList.add("active"),this.onChange(n,this.param)}},{key:"remove",value:function(){for(var e=0;e<this.waveTypeEls.length;e++)this.waveTypeEls[e].removeEventListener("click",this.onWaveClickBound);this.parentEl.removeChild(this.el)}}])&&mt(t.prototype,n),o&&mt(t,o),e}();function yt(e){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function bt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ct(e,t,n){return(Ct="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wt(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function wt(e){return(wt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function kt(e,t){return(kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Et=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=wt(t).call(this))||"object"!==yt(o)&&"function"!=typeof o?bt(n):o).el.classList.add("no-height"),e.hasConnectedTrigger=!1,e.connectedTriggerID=-1,e.synthParams=[],t.BASE_FREQ=440,t.ROOT=Math.pow(2,1/12),e.isKeyboardListener=!0,e.isSynthOscillator=!0,e.hasAudioInput=!1,e.hasEnvelopeConnection=!1;var i=document.createElement("div");i.className="range-container";var a=document.createElement("div");a.className="wave-type-container",e.topPartEl.appendChild(a),e.onWaveChangeCallbackBound=e.onWaveChangeCallback.bind(bt(e)),e.waveTypeSelector=new vt(a,e.onWaveChangeCallbackBound,"sine","oscillator-type","Oscillator vgtyp"),e.topPartEl.appendChild(i),e.onRangeChangeCallbackBound=e.onRangeChangeCallback.bind(bt(e));var r={parentEl:i,title:"Oktav",initValue:0,settings:{min:-4,max:4},valChangeCallback:e.onRangeChangeCallbackBound,param:"octave",decimals:0,disable:!1};e.octaveRangeSlider=new j(r.parentEl,r.title,r.initValue,r.settings,r.valChangeCallback,r.param,r.decimals,r.disable);var s={useAsInput:!1,value:r.initValue,param:"octave",slider:e.octaveRangeSlider,title:"Octave"},u={useAsInput:!1,value:"sine",param:"oscillator-type",title:"oscillator type",setParam:function(e,t){e.oscillator.type=t}},l={useAsInput:!0,param:"trigger",title:"Trigger",helper:_.oscillatorTrigger};return e.params[s.param]=s,e.params[l.param]=l,e.params[u.param]=u,e.synthParams.push(u.param),e.paramVals={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&kt(e,t)}(t,N),n=t,(o=[{key:"enableParam",value:function(e,n){Ct(wt(t.prototype),"enableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!0,this.connectedTriggerID=n.out.ID)}},{key:"disableParam",value:function(e){Ct(wt(t.prototype),"disableParam",this).call(this,e),"trigger"===e.param&&(this.hasConnectedTrigger=!1,this.connectedTriggerID=-1)}},{key:"onWaveChangeCallback",value:function(e,t){this.params[t].value=e}},{key:"onRangeChangeCallback",value:function(e,t){this.params[t].value=e,this.onParameterChange(this)}},{key:"getParams",value:function(e){e||(e=0);return{}}},{key:"getAudioNode",value:function(){return new D.a.FMSynth}},{key:"getFrequency",value:function(e){var n=12*parseInt(this.params.octave.value)+e;return t.BASE_FREQ*Math.pow(t.ROOT,n)}}])&&gt(n.prototype,o),i&&gt(n,i),t}();n(7),n(11),n(13),n(8),n(14),n(9),n(15),n(16),n(17),n(10),n(18),n(19),n(20),n(21),n(22),n(23),n(24),n(25);var Ot=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="node-param-header node-component",o&&(this.el.style.marginTop="10px");var i=document.createElement("h2");i.innerHTML=n,this.el.appendChild(i),t.appendChild(this.el)},Pt={general:{isValid:function(e){return!0}},needsFramebuffer:{isValid:function(e){return e.framebuffer||e.isForegroundNode}},sceneNode:{isValid:function(e,t,n){return!(t.enabledInputs.some(function(t){return t.out.ID===e.ID})||!n)&&{background:function(){return e.isBackgroundNode},foreground:function(){return e.isForegroundNode},light:function(){return e.isLightNode&&!t.foregroundRender.hasConnectedLight}}[n]()}}};function _t(e){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Mt(e,t){return!t||"object"!==_t(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Rt(e,t,n){return(Rt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=St(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function St(e){return(St=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Tt(e,t){return(Tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Lt=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Mt(this,St(t).call(this))).params={},e.inputParams={},e.isForegroundNode=!1,e.isBackgroundNode=!1,e.currentOutConnections=[],e.currentOutConnectionsLength=0,e.el=document.createElement("div"),e.el.className="node",e.topPartEl=document.createElement("div"),e.topPartEl.className="top-part",e.el.appendChild(e.topPartEl),e.bottomPartEl=document.createElement("div"),e.bottomPartEl.className="bottom-part",e.el.appendChild(e.bottomPartEl),e.inputHelpersType=Pt.general,e.isGraphicsNode=!0,e.isRenderNode=!1,e.canConnectToMaterial=!1,e.isCanvasNode=!1,e.dotPos=void 0,e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tt(e,t)}(t,c),n=t,(o=[{key:"init",value:function(e,n,o,i,a,r,s,u){var l=this;Rt(St(t.prototype),"init",this).call(this,e,n,o,i,a,r,s,u);var c=[];for(var h in this.params)this.params[h].useAsInput&&this.params[h].parent&&function(){var e=l.params[h].parent;if(c.some(function(t){return t.parent===e})){c.find(function(t){return t.parent===e}).children.push(l.params[h])}else{var t={parent:e,children:[]};c.push(t),t.children.push(l.params[h])}}();if(c.length>0)for(var p=0;p<c.length;p++)for(var d=c[p],f=(new Ot(this.topPartEl,d.parent,p>0),0);f<d.children.length;f++){var m=new P(this.topPartEl,d.children[f],this.onInputClickBound);this.inputParams[d.children[f].title]=m}else for(var v in this.params)if(this.params[v].useAsInput){var y=new P(this.topPartEl,this.params[v],this.onInputClickBound);this.inputParams[this.params[v].title]=y}this.activateDrag()}},{key:"enableParam",value:function(e,t){var n=this.inputParams[e.title];e.isConnected=!0,n.enable(),ke[e.paramHelpersType].update(this,t.out,e)}},{key:"updateParam",value:function(e,t){ke[e.paramHelpersType].update(this,t,e)}},{key:"disableParam",value:function(e,t){var n=this.inputParams[e.title];e.isConnected=!1,n.disable(),ke[e.paramHelpersType].disconnect(this,e,t.out)}},{key:"getDotPos",value:function(e){return this.dotPos||(this.dotPos=e.getBoundingClientRect()),this.dotPos}},{key:"setParamVal",value:function(e,t){this.paramVals[t]=e}},{key:"onParameterUpdate",value:function(){this.getParams()}},{key:"getParams",value:function(){var e={};for(var t in this.params){var n=this.params[t];e[n.objSettings.param]=this.paramVals[n.objSettings.param]}return e}},{key:"onResize",value:function(){}}])&&xt(n.prototype,o),i&&xt(n,i),t}();function Nt(e){return(Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function It(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Dt(e,t){return!t||"object"!==Nt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Bt(e){return(Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function jt(e,t){return(jt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var At=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Dt(this,Bt(t).call(this))).isRenderNode=!0,n.canConnectToMaterial=!0,n.scene=new THREE.Scene,n.renderer=e.renderer,n.framebuffer=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter}),n}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jt(e,t)}(t,Lt),n=t,(o=[{key:"update",value:function(){}},{key:"render",value:function(){this.renderer.setRenderTarget(this.framebuffer),this.renderer.render(this.scene,this.camera),this.renderer.setRenderTarget(null)}},{key:"onResize",value:function(e){var t=e.w,n=e.h;this.framebuffer.setSize(t,n),this.camera.aspect?this.camera.aspect=t/n:(this.camera.left=t/-2,this.camera.right=t/2,this.camera.top=n/-2,this.camera.bottom=n/2),this.camera.updateProjectionMatrix()}}])&&It(n.prototype,o),i&&It(n,i),t}();function Vt(e){return(Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ht(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ft(e,t){return!t||"object"!==Vt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ut(e,t,n){return(Ut="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=zt(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function zt(e){return(zt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qt(e,t){return(qt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Kt=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Ft(this,zt(t).call(this,e))).isBackgroundNode=!0,n.el.classList.add("no-height"),n.shader="".concat(C).concat(m).concat(g).concat(v);var o=window.innerWidth,i=window.innerHeight;n.camera=new THREE.OrthographicCamera(o/-2,o/2,i/2,i/-2,1,1e3),n.startTime=Date.now();var a=new THREE.PlaneGeometry(2,2),r={};r.u_resolution={value:new THREE.Vector2(window.innerWidth,window.innerHeight)},r.u_time={value:0};var s={u_user_speed3:{value:.5},u_user_pattern_scale:{value:-.358},u_user_scale:{value:7.032},u_user_rotation:{value:.804},u_user_speed2:{value:.028},u_user_blur:{value:.7}};s.u_user_color1={value:new THREE.Color(.256,.351,.62)},s.u_user_color2={value:new THREE.Color(1,.42,.42)};var u=Object.assign({},r,s);n.material=new THREE.ShaderMaterial({uniforms:u,vertexShader:d,fragmentShader:n.shader}),n.mesh=new THREE.Mesh(a,n.material),n.scene.add(n.mesh),n.paramVals={};return n.params={blurParam:{title:"Blur",param:"u_user_blur",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:.01,max:10},defaultVal:.7,decimals:2},distortionParam:{title:"Distortion",param:"u_user_speed2",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:.001,max:10},defaultVal:.02,decimals:2},rotationParam:{title:"Rotation",param:"u_user_rotation",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:.01,max:2},defaultVal:.8,decimals:2},patternScaleParam:{title:"Pattern Scale",param:"u_user_pattern_scale",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0,decimals:2},scaleParam:{title:"Scale",param:"u_user_scale",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:1,max:20},defaultVal:7,decimals:2},speed3Param:{title:"Speed3",param:"u_user_speed3",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:0,max:2},value:.5,decimals:2}},n}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qt(e,t)}(t,At),n=t,(o=[{key:"enableOutput",value:function(e,n){Ut(zt(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&Ut(zt(t.prototype),"disableOutput",this).call(this)}},{key:"update",value:function(){Ut(zt(t.prototype),"update",this).call(this);var e=Date.now()-this.startTime;this.mesh.material.uniforms.u_time.value=.005*e}},{key:"onResize",value:function(e){Ut(zt(t.prototype),"onResize",this).call(this,e);var n=e.w,o=e.h;this.mesh.material.uniforms.u_resolution.value=new THREE.Vector2(n,o)}}])&&Ht(n.prototype,o),i&&Ht(n,i),t}();function Gt(e){return(Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Yt(e,t){return!t||"object"!==Gt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Xt(e,t,n){return(Xt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Qt(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Qt(e){return(Qt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zt(e,t){return(Zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Jt=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Yt(this,Qt(t).call(this,e))).isBackgroundNode=!0,n.el.classList.add("no-height"),n.shader="".concat(C).concat(m).concat(b).concat(v);var o=window.innerWidth,i=window.innerHeight;n.camera=new THREE.OrthographicCamera(o/-2,o/2,i/2,i/-2,1,1e3),n.startTime=Date.now();var a=new THREE.PlaneGeometry(2,2),r={};r.u_resolution={value:new THREE.Vector2(window.innerWidth,window.innerHeight)},r.u_time={value:0};var s={};s.u_user_fgColor={value:new THREE.Color(1,1,1)},s.u_user_bgColor={value:new THREE.Color(0,0,0)};var u=Object.assign({},r,s);n.material=new THREE.ShaderMaterial({uniforms:u,vertexShader:d,fragmentShader:n.shader}),n.mesh=new THREE.Mesh(a,n.material),n.scene.add(n.mesh),n.paramVals={};var l={title:"FG Color",param:"u_user_fgColor",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,defaultVal:n.material.uniforms.u_user_fgColor.value},c={title:"BG Color",param:"u_user_bgColor",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,defaultVal:n.material.uniforms.u_user_bgColor.value};return n.params={fgColorParam:l,bgColorParam:c},n}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zt(e,t)}(t,At),n=t,(o=[{key:"enableOutput",value:function(e,n){Xt(Qt(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&Xt(Qt(t.prototype),"disableOutput",this).call(this)}},{key:"update",value:function(){Xt(Qt(t.prototype),"update",this).call(this);var e=Date.now()-this.startTime;this.mesh.material.uniforms.u_time.value=.005*e}},{key:"onResize",value:function(e){Xt(Qt(t.prototype),"onResize",this).call(this,e);var n=e.w,o=e.h;this.mesh.material.uniforms.u_resolution.value=new THREE.Vector2(n,o)}}])&&Wt(n.prototype,o),i&&Wt(n,i),t}();function $t(e){return($t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function en(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function tn(e,t){return!t||"object"!==$t(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function nn(e,t,n){return(nn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=on(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function on(e){return(on=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function an(e,t){return(an=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var rn=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=tn(this,on(t).call(this,e))).isBackgroundNode=!0,n.shader="".concat(C).concat(m).concat(y).concat(v);var o=window.innerWidth,i=window.innerHeight;n.camera=new THREE.OrthographicCamera(o/-2,o/2,i/2,i/-2,1,1e3),n.startTime=Date.now();var a=new THREE.PlaneGeometry(2,2),r={};r.u_resolution={value:new THREE.Vector2(window.innerWidth,window.innerHeight)},r.u_time={value:0};var s={u_noise_amount:{value:.5}},u=Object.assign({},r,s);n.material=new THREE.ShaderMaterial({uniforms:u,vertexShader:d,fragmentShader:n.shader}),n.mesh=new THREE.Mesh(a,n.material),n.scene.add(n.mesh),n.paramVals={};return n.params={amountParam:{title:"Amount",param:"u_noise_amount",useAsInput:!0,paramHelpersType:"shaderParam",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0}},n}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&an(e,t)}(t,At),n=t,(o=[{key:"enableOutput",value:function(e,n){nn(on(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&nn(on(t.prototype),"disableOutput",this).call(this)}},{key:"update",value:function(){nn(on(t.prototype),"update",this).call(this);var e=Date.now()-this.startTime;this.mesh.material.uniforms.u_time.value=.005*e}},{key:"onResize",value:function(e){nn(on(t.prototype),"onResize",this).call(this,e);var n=e.w,o=e.h;this.mesh.material.uniforms.u_resolution.value=new THREE.Vector2(n,o)}}])&&en(n.prototype,o),i&&en(n,i),t}();function sn(e){return(sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function un(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ln(e,t){return!t||"object"!==sn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function cn(e,t,n){return(cn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=hn(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function hn(e){return(hn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pn(e,t){return(pn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var dn=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ln(this,hn(t).call(this))).isForegroundNode=!0,e.el.classList.add("no-height");window.innerWidth,window.innerHeight;e.geometry=new THREE.BoxGeometry(3,3,3,10,10,10),e.material=new THREE.MeshPhongMaterial({}),e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Material",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Material",paramHelpersType:"texture",needsFrameUpdate:!1},colorParam:n,bumpMapParam:{title:"Displacement",param:"normalMap",useAsInput:!0,parent:"Material",paramHelpersType:"normalMap",needsFrameUpdate:!1},positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},rotationXParam:{title:"Rotation x",param:"x",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},scaleParam:{title:"Scale",param:"scale",useAsInput:!0,parent:"Scale",paramHelpersType:"scale",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:0}},e.paramVals={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pn(e,t)}(t,Lt),n=t,(o=[{key:"getMesh",value:function(){return this.mesh}},{key:"enableOutput",value:function(e,n){cn(hn(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&cn(hn(t.prototype),"disableOutput",this).call(this)}},{key:"update",value:function(){cn(hn(t.prototype),"update",this).call(this)}}])&&un(n.prototype,o),i&&un(n,i),t}();function fn(e){return(fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function vn(e,t){return!t||"object"!==fn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function yn(e,t,n){return(yn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=gn(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function gn(e){return(gn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bn(e,t){return(bn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Cn=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=vn(this,gn(t).call(this))).isForegroundNode=!0,e.el.classList.add("no-height");window.innerWidth,window.innerHeight;e.geometry=new THREE.SphereGeometry(2,32,32),e.material=new THREE.MeshPhongMaterial({}),e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Material",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Material",paramHelpersType:"texture",needsFrameUpdate:!1},colorParam:n,bumpMapParam:{title:"Displacement",param:"normalMap",useAsInput:!0,parent:"Material",paramHelpersType:"normalMap",needsFrameUpdate:!1},positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"position",needsFrameUpdate:!1,minMax:{min:-2,max:2},defaultVal:0},rotationXParam:{title:"Rotation x",param:"x",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},rotationYParam:{title:"Rotation y",param:"y",useAsInput:!0,parent:"Rotation",paramHelpersType:"rotation",needsFrameUpdate:!1,minMax:{min:-6,max:6},defaultVal:0},scaleParam:{title:"Scale",param:"scale",useAsInput:!0,parent:"Scale",paramHelpersType:"scale",needsFrameUpdate:!1,minMax:{min:.1,max:6},defaultVal:1}},e.paramVals={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bn(e,t)}(t,Lt),n=t,(o=[{key:"getMesh",value:function(){return this.mesh}},{key:"enableOutput",value:function(e,n){yn(gn(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&yn(gn(t.prototype),"disableOutput",this).call(this)}}])&&mn(n.prototype,o),i&&mn(n,i),t}();function wn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var kn=function(){function e(t,n,o,i,a){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=o,this.onInputChangeCallback=a,this.decimals=i,this.onInputChangeBound=this.onInputChange.bind(this),this.el=document.createElement("div"),this.el.className="horizontal-range-slider";var s=document.createElement("div");s.className="input-container";var u=document.createElement("p");u.innerHTML="Min",s.appendChild(u),this.inputLowEl=document.createElement("input"),this.inputLowEl.type="number",this.inputLowEl.value=-2,this.inputLowEl.step=1,this.inputLowEl.min=-10,this.inputLowEl.max=1,this.inputLowEl.addEventListener("change",this.onInputChangeBound),s.appendChild(this.inputLowEl);var l=document.createElement("div");l.className="input-container";var c=document.createElement("p");c.innerHTML="Max",l.appendChild(c),this.inputHighEl=document.createElement("input"),this.inputHighEl.type="number",this.inputHighEl.value=2,this.inputHighEl.step=.1,this.inputHighEl.min=2,this.inputHighEl.max=10,this.inputHighEl.addEventListener("change",this.onInputChangeBound),l.appendChild(this.inputHighEl),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var h=document.createElement("div");h.appendChild(s),h.appendChild(this.rangeInnerContainer),h.appendChild(l),h.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=this.inputLowEl.value;var p=document.createElement("div");p.className="value-container";var d=document.createElement("p");d.innerHTML="Value",p.appendChild(d),p.appendChild(this.valueEl),this.el.appendChild(h),this.el.appendChild(p),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),this.value=0,setTimeout(function(){r.setPos(100)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,o;return t=e,(n=[{key:"onInputChange",value:function(e){this.onInputChangeCallback()}},{key:"setDefaultValues",value:function(e){var t=e.minMax;this.inputLowEl.value=t.min,this.inputLowEl.min=t.min-20,this.inputLowEl.max=t.max+20,this.inputHighEl.value=t.max,this.inputHighEl.min=t.max-20,this.inputHighEl.max=t.max+20;var n=e.defaultVal;this.value=(n-t.min)/(t.max-t.min),this.valueEl.innerHTML=n,this.setPos(100),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals)))}},{key:"getMinMaxValue",value:function(){return{min:parseFloat(this.inputLowEl.value),max:parseFloat(this.inputHighEl.value)}}},{key:"remove",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e){this.value=e,this.setPos(100);var t=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=t,this.valChangeCallback&&this.valChangeCallback(t)}},{key:"getValue",value:function(){var e=this.getMinMaxValue();return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.setPos(100),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.setPos(100),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=1-Math.round(100*(e.y-t.top))/100/100;this.value=n>1?1:n<0?0:n,this.setPos(100),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=e-this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(0px, ".concat(t,"px, 0)")}}])&&wn(t.prototype,n),o&&wn(t,o),e}(),En={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}};function On(e){return(On="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xn(e,t,n){return(xn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Mn(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Mn(e){return(Mn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rn(e,t){return(Rn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Sn=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=Mn(t).call(this))||"object"!==On(o)&&"function"!=typeof o?_n(n):o).el.classList.add("no-height"),e.el.classList.add("left-padding"),e.el.classList.add("param-driver-node"),e.isParam=!0,e.animateValues={isRunning:!1,timestamp:0,duration:0,reqAnimFrame:-1,firstRunOffset:0},e.onRangeValChangeBound=e.onRangeValChange.bind(_n(e)),e.onInputChangeBound=e.onInputChange.bind(_n(e)),e.horizontalRangeSlider=new kn(e.topPartEl,0,e.onRangeValChangeBound,2,e.onInputChangeBound),e.durationEl=document.createElement("input"),e.durationEl.type="number",e.durationEl.value=2e3,e.durationEl.step=1,e.durationEl.min=400,e.durationEl.max=1e4,e.durationEl.addEventListener("change",e.onInputChangeBound);var i=document.createElement("div");i.className="duration-container (ms)";var a=document.createElement("p");a.innerHTML="Duration",i.appendChild(a),i.appendChild(e.durationEl);var r=document.createElement("div");return r.className="top-bottom-container",r.appendChild(i),e.onToggleStartClickBound=e.onToggleStartClick.bind(_n(e)),e.toggleStartBtn=document.createElement("div"),e.toggleStartBtn.className="toggle-start",e.toggleStartBtn.addEventListener("click",e.onToggleStartClickBound),e.toggleBtnText=document.createElement("p"),e.toggleBtnText.innerHTML="Start",e.toggleStartBtn.appendChild(e.toggleBtnText),r.appendChild(e.toggleStartBtn),e.topPartEl.appendChild(r),e.modifier={},e.paramVals={},e.params={},e.updateBound=e.update.bind(_n(e)),e.update(),e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rn(e,t)}(t,Lt),n=t,(o=[{key:"onInputChange",value:function(e){this.reset()}},{key:"reset",value:function(){this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"}},{key:"onToggleStartClick",value:function(){this.animateValues.isRunning?(this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"):(this.toggleBtnText.innerHTML="Stop",this.animateValues.timestamp=Date.now(),this.animateValues.duration=parseInt(this.durationEl.value),this.animateValues.firstRunOffset=Math.floor(this.horizontalRangeSlider.value*this.animateValues.duration),this.animateValues.isReverse=!1,this.animateValues.easing=En.linear,this.animateValues.isRunning=!0)}},{key:"getValue",value:function(){return this.horizontalRangeSlider.getReadyValue()}},{key:"update",value:function(){if(this.animateValues.reqAnimFrame=requestAnimationFrame(this.updateBound),this.animateValues.isRunning){var e=Date.now(),t=e-this.animateValues.timestamp+this.animateValues.firstRunOffset,n=this.animateValues.easing(Math.min(t/this.animateValues.duration,1)),o=this.animateValues.isReverse?1-n:n;o>=1?(this.animateValues.timestamp=e,this.animateValues.isReverse=!0,this.animateValues.firstRunOffset=0):o<=0&&(this.animateValues.timestamp=e,this.animateValues.isReverse=!1),this.horizontalRangeSlider.setValue(o)}}},{key:"onRangeValChange",value:function(e){for(var t=0;t<this.currentOutConnectionsLength;t++){var n=this.currentOutConnections[t].param;this.currentOutConnections[t].in.updateParam(n,this)}}},{key:"enableOutput",value:function(e,n){xn(Mn(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length,1===this.currentOutConnectionsLength&&this.horizontalRangeSlider.setDefaultValues(e)}},{key:"enableInput",value:function(e){xn(Mn(t.prototype),"enableInput",this).call(this)}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(e){return e.in.ID!==nodeIn.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&xn(Mn(t.prototype),"disableOutput",this).call(this)}},{key:"removeFromDom",value:function(){this.reset(),window.cancelAnimationFrame(this.animateValues.reqAnimFrame),xn(Mn(t.prototype),"removeFromDom",this).call(this)}}])&&Pn(n.prototype,o),i&&Pn(n,i),t}();function Tn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ln=function(){function e(t,n,o,i,a,r,s){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=o,this.height=s||60,this.decimals=i,this.value=(n-a.min)/(a.max-a.min),this.settings=a,this.el=document.createElement("div"),this.el.className="vertical-slider prevent-drag";var l=document.createElement("h4");l.className="vertical-slider-label",l.innerHTML=r,this.el.appendChild(l),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeInnerContainer.style.height="".concat(this.height,"px"),this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var c=document.createElement("div");c.appendChild(this.rangeInnerContainer),c.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=n;var h=document.createElement("div");h.className="value-container",h.appendChild(this.valueEl),this.el.appendChild(c),this.el.appendChild(h),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),setTimeout(function(){u.setPos(u.height)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,o;return t=e,(n=[{key:"remove",value:function(){this.rangeInnerContainer.removeEventListener("click",this.onRangeClickBound),this.rangeKnob.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e){this.value=e,this.setPos(this.height);var t=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=t,this.valChangeCallback&&this.valChangeCallback(t)}},{key:"getValue",value:function(){var e=this.settings;return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),o=1-Math.round(100*(e.y-n.top))/100/t;this.value=o>1?1:o<0?0:o,this.setPos(t),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),o=1-Math.round(100*(e.y-n.top))/100/t;this.value=o>1?1:o<0?0:o,this.setPos(t),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.height,n=this.rangeInnerContainer.getBoundingClientRect(),o=1-Math.round(100*(e.y-n.top))/100/t;this.value=o>1?1:o<0?0:o,this.setPos(t),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=e-this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(0px, ".concat(t,"px, 0)")}}])&&Tn(t.prototype,n),o&&Tn(t,o),e}();function Nn(e){return(Nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function In(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Dn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bn(e,t,n){return(Bn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=jn(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function jn(e){return(jn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function An(e,t){return(An=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Vn=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=jn(t).call(this))||"object"!==Nn(o)&&"function"!=typeof o?Dn(n):o).needsUpdate=!0,e.el.classList.add("no-height"),e.el.classList.add("left-padding"),e.el.classList.add("orbit-driver-node"),e.isParam=!0,e.animateValues={isRunning:!1,reqAnimFrame:-1,counter:1552337385540},e.currentOrbit=10,e.currentSpeed=0,e.currentRotationY=0,e.currentRotationX=0,e.outValues={Position:{x:0,y:0,z:0},Rotation:{x:0,y:0}},e.onSpeedChangeBound=e.onSpeedChange.bind(Dn(e)),e.onOrbitChangeBound=e.onOrbitChange.bind(Dn(e)),e.onRotationChangeYBound=e.onRotationChangeY.bind(Dn(e)),e.onRotationChangeXBound=e.onRotationChangeX.bind(Dn(e));var i=document.createElement("div");return i.className="settings-container-outer",e.topPartEl.appendChild(i),e.speedSlider=new Ln(i,0,e.onSpeedChangeBound,2,{min:-2,max:2},"Orbit speed"),e.orbitSlider=new Ln(i,0,e.onOrbitChangeBound,0,{min:0,max:20},"Orbit radie"),e.rotationXSlider=new Ln(i,0,e.onRotationChangeXBound,3,{min:-.1,max:.1},"Rotation X"),e.rotationYSlider=new Ln(i,0,e.onRotationChangeYBound,3,{min:-.1,max:.1},"Rotation Y"),e.topPartEl.appendChild(i),e.onToggleStartClickBound=e.onToggleStartClick.bind(Dn(e)),e.toggleStartBtn=document.createElement("div"),e.toggleStartBtn.className="toggle-start",e.toggleStartBtn.addEventListener("click",e.onToggleStartClickBound),e.toggleBtnText=document.createElement("p"),e.toggleBtnText.innerHTML="Start",e.toggleStartBtn.appendChild(e.toggleBtnText),e.topPartEl.appendChild(e.toggleStartBtn),e.modifier={},e.paramVals={},e.params={},e.updateBound=e.update.bind(Dn(e)),e.update(),e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&An(e,t)}(t,Lt),n=t,(o=[{key:"onRotationChangeX",value:function(e){this.currentRotationX=e}},{key:"onRotationChangeY",value:function(e){this.currentRotationY=e}},{key:"onOrbitChange",value:function(e){this.currentOrbit=e}},{key:"onSpeedChange",value:function(e){this.currentSpeed=e}},{key:"reset",value:function(){this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"}},{key:"onToggleStartClick",value:function(){this.animateValues.isRunning?(this.animateValues.isRunning=!1,this.toggleBtnText.innerHTML="Start"):(this.toggleBtnText.innerHTML="Stop",this.animateValues.isRunning=!0)}},{key:"getValue",value:function(e){return this.outValues[e.parent][e.param]}},{key:"update",value:function(){if(this.animateValues.isRunning){var e=.01*this.animateValues.counter,t=Math.cos(e*this.currentSpeed)*this.currentOrbit,n=Math.sin(e*this.currentSpeed)*this.currentOrbit;this.outValues.Position.x=t,this.outValues.Position.z=n,this.outValues.Rotation.y+=this.currentRotationY,this.outValues.Rotation.x+=this.currentRotationX;for(var o=0;o<this.currentOutConnectionsLength;o++){var i=this.currentOutConnections[o].param;this.currentOutConnections[o].in.updateParam(i,this)}this.animateValues.counter++}}},{key:"render",value:function(){}},{key:"enableOutput",value:function(e,n){Bn(jn(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"enableInput",value:function(e){Bn(jn(t.prototype),"enableInput",this).call(this)}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(e){return e.in.ID!==nodeIn.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&(Bn(jn(t.prototype),"disableOutput",this).call(this),this.onToggleStartClick())}},{key:"removeFromDom",value:function(){this.reset(),window.cancelAnimationFrame(this.animateValues.reqAnimFrame),this.speedSlider.remove(),this.orbitSlider.remove(),this.rotationXSlider.remove(),this.rotationYSlider.remove(),Bn(jn(t.prototype),"removeFromDom",this).call(this)}}])&&In(n.prototype,o),i&&In(n,i),t}();function Hn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Fn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=window.innerWidth,i=window.innerHeight;this.camera=new THREE.PerspectiveCamera(75,o/i,.1,1e3),this.camera.position.z=10,this.cameraControls=new THREE.OrbitControls(this.camera,n),this.cameraControls.enabled=!1,this.scene=new THREE.Scene,this.renderer=t.renderer,this.axesHelper=new THREE.AxesHelper(5),this.axesHelper.name="AxesHelper",this.ambientLight=new THREE.AmbientLight,this.scene.add(this.ambientLight),this.connectedNodes=[],this.hasConnectedLight=!1,this.framebuffer=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter})}var t,n,o;return t=e,(n=[{key:"toggleAxesHelper",value:function(e){if(e)this.scene.add(this.axesHelper);else{this.scene.getObjectByName(this.axesHelper.name);this.scene.remove(this.axesHelper)}}},{key:"toggleCameraControl",value:function(e){e?(this.cameraControls.enabled=!0,this.renderer.domElement.classList.add("prevent-drag")):(this.cameraControls.enabled=!1,this.renderer.domElement.classList.remove("prevent-drag"))}},{key:"addLight",value:function(e){var t="".concat(e.ID,"-light");e.light.name=t;var n="".concat(e.ID,"-mesh");e.mesh.name=n,this.scene.add(e.light),this.scene.add(e.mesh),this.hasConnectedLight=!0}},{key:"removeLight",value:function(e){var t="".concat(e.ID,"-light"),n=this.scene.getObjectByName(t);this.scene.remove(n);var o="".concat(e.ID,"-mesh"),i=this.scene.getObjectByName(o);this.scene.remove(i),this.hasConnectedLight=!1}},{key:"addNode",value:function(e){this.connectedNodes.push(e);var t="".concat(e.ID,"-mesh");e.mesh.name=t,this.scene.add(e.mesh)}},{key:"removeNode",value:function(e){this.connectedNodes=this.connectedNodes.filter(function(t){return t.ID!==e.ID});var t="".concat(e.ID,"-mesh"),n=this.scene.getObjectByName(t);this.scene.remove(n)}},{key:"update",value:function(){}},{key:"render",value:function(){this.renderer.setRenderTarget(this.framebuffer),this.renderer.render(this.scene,this.camera)}},{key:"onResize",value:function(e){var t=e.w,n=e.h;this.framebuffer.setSize(t,n),this.camera.aspect?this.camera.aspect=t/n:(this.camera.left=t/-2,this.camera.right=t/2,this.camera.top=n/-2,this.camera.bottom=n/2),this.camera.updateProjectionMatrix()}}])&&Hn(t.prototype,n),o&&Hn(t,o),e}();function Un(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var zn=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onResizeCallback=n,this.onNodeResizerDown=o,this.el=document.createElement("div"),this.el.className="node-resizer",this.innerEl=document.createElement("div"),this.innerEl.className="node-resizer-inner",this.el.appendChild(this.innerEl),t.appendChild(this.el),this.currentDims={w:0,h:0},this.currentNodeDims={w:0,h:0},this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.moveCoords={start:{x:0,y:0},offset:{x:0,y:0}},this.innerEl.addEventListener("mousedown",this.onMouseDownBound)}var t,n,o;return t=e,(n=[{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this.onNodeResizerDown(),this.moveCoords.start.x=e.x-this.moveCoords.offset.x,this.moveCoords.start.y=e.y-this.moveCoords.offset.y,window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){e.stopPropagation(),e.preventDefault();var t=e.x-this.moveCoords.start.x,n=e.y-this.moveCoords.start.y;this.onResizeCallback({x:t,y:n})}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"remove",value:function(){this.innerEl.removeEventListener("mousedown",this.onMouseDownBound)}}])&&Un(t.prototype,n),o&&Un(t,o),e}();function qn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Kn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="camera-control-setting",this.foregroundController=n,this.label=document.createElement("h4"),this.label.innerHTML="Kamera kontroll (inaktiv)",this.el.appendChild(this.label),this.toggleEl=document.createElement("div"),this.toggleEl.className="toggle-el",this.isEnabled=!1,this.el.appendChild(this.toggleEl),this.onClickBound=this.onClick.bind(this),this.toggleEl.addEventListener("click",this.onClickBound),t.appendChild(this.el)}var t,n,o;return t=e,(n=[{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.isEnabled=!this.isEnabled,this.isEnabled?(this.toggleEl.classList.add("enabled"),this.label.innerHTML="Kamera kontroll (aktiv)"):(this.toggleEl.classList.remove("enabled"),this.label.innerHTML="Kamera kontroll (inaktiv)"),this.foregroundController.toggleCameraControl(this.isEnabled)}}])&&qn(t.prototype,n),o&&qn(t,o),e}();function Gn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Wn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=document.createElement("div"),this.el.className="axes-helper-setting",this.foregroundController=n,this.label=document.createElement("h4"),this.label.innerHTML="Visa x y z axlar (inaktiv)",this.el.appendChild(this.label),this.toggleEl=document.createElement("div"),this.toggleEl.className="toggle-el",this.isEnabled=!1,this.el.appendChild(this.toggleEl),this.onClickBound=this.onClick.bind(this),this.toggleEl.addEventListener("click",this.onClickBound),t.appendChild(this.el)}var t,n,o;return t=e,(n=[{key:"onClick",value:function(e){e.stopPropagation(),e.preventDefault(),this.isEnabled=!this.isEnabled,this.isEnabled?(this.toggleEl.classList.add("enabled"),this.label.innerHTML="Visa x y z axlar (aktiv)"):(this.toggleEl.classList.remove("enabled"),this.label.innerHTML="Visa x y z axlar (inaktiv)"),this.foregroundController.toggleAxesHelper(this.isEnabled)}}])&&Gn(t.prototype,n),o&&Gn(t,o),e}();function Yn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Xn=function(){function e(t,n,o,i,a,r,s){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.valChangeCallback=o,this.decimals=i,this.value=(n-a.min)/(a.max-a.min),this.settings=a,this.el=document.createElement("div"),this.el.className="horizontal-slider prevent-drag "+r;var l=document.createElement("h4");l.className="horizontal-slider-label",l.innerHTML=s,this.el.appendChild(l),this.rangeInnerContainer=document.createElement("div"),this.rangeInnerContainer.className="range-inner-container prevent-drag",this.rangeKnob=document.createElement("div"),this.rangeKnob.className="range-knob prevent-drag",this.rangeInnerContainer.appendChild(this.rangeKnob);var c=document.createElement("div");c.appendChild(this.rangeInnerContainer),c.className="range-container",this.valueEl=document.createElement("div"),this.valueEl.className="value-display",this.valueEl.innerHTML=n;var h=document.createElement("div");h.className="value-container",h.appendChild(this.valueEl),this.el.appendChild(c),this.el.appendChild(h),this.parentEl.appendChild(this.el),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onRangeClickBound=this.onRangeClick.bind(this),setTimeout(function(){u.setPos(120)},0),this.rangeInnerContainer.addEventListener("click",this.onRangeClickBound),this.rangeKnob.addEventListener("mousedown",this.onMouseDownBound)}var t,n,o;return t=e,(n=[{key:"remove",value:function(){this.el.removeEventListener("mousedown",this.onMouseDownBound),this.parentEl.removeChild(this.el)}},{key:"setValue",value:function(e){this.value=e,this.setPos(120);var t=this.getValue().toFixed(this.decimals);this.valueEl.innerHTML=t,this.valChangeCallback&&this.valChangeCallback(t)}},{key:"getValue",value:function(){var e=this.settings;return this.value*(e.max-e.min)+e.min}},{key:"getReadyValue",value:function(){return parseFloat(this.getValue().toFixed(this.decimals))}},{key:"onRangeClick",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals),window.addEventListener("mouseup",this.onMouseUpBound),window.addEventListener("mousemove",this.onMouseMoveBound)}},{key:"onMouseMove",value:function(e){var t=this.rangeInnerContainer.getBoundingClientRect(),n=Math.round(100*(e.x-t.left))/100/120;this.value=n>1?1:n<0?0:n,this.setPos(120),this.valChangeCallback&&this.valChangeCallback(parseFloat(this.getValue().toFixed(this.decimals))),this.valueEl.innerHTML=this.getValue().toFixed(this.decimals)}},{key:"onMouseUp",value:function(e){window.removeEventListener("mouseup",this.onMouseUpBound),window.removeEventListener("mousemove",this.onMouseMoveBound)}},{key:"setPos",value:function(e){var t=this.value*e;this.value;this.rangeKnob.style[window.NS.transform]="translate3d(".concat(t,"px, 0px, 0)")}}])&&Yn(t.prototype,n),o&&Yn(t,o),e}();function Qn(e){return(Qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Jn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $n(e,t,n){return($n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=eo(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function eo(e){return(eo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function to(e,t){return(to=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var no=function(e){function t(e){var n,o,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(i=eo(t).call(this))||"object"!==Qn(i)&&"function"!=typeof i?Jn(o):i).mainRender=e,n.hasOutput=!1,n.isGraphicsNode=!0,n.hasGraphicsInput=!0,n.isCanvasNode=!0,n.inputHelpersType=Pt.sceneNode,n.enabledInputs=[],n.el=document.createElement("div"),n.el.className="node canvas",n.topPartEl=document.createElement("div"),n.topPartEl.className="top-part",n.el.appendChild(n.topPartEl),n.bottomPartEl=document.createElement("div"),n.bottomPartEl.className="bottom-part",n.bottomPartSettings=document.createElement("div"),n.bottomPartSettings.className="bottom-part-settings",n.bottomPartEl.appendChild(n.bottomPartSettings),n.onNodeResizerDownBound=n.onNodeResizerDown.bind(Jn(n)),n.onResizeFromNodeResizerBound=n.onResizeFromNodeResizer.bind(Jn(n)),n.nodeResizer=new zn(n.bottomPartEl,n.onResizeFromNodeResizerBound,n.onNodeResizerDownBound),n.el.appendChild(n.bottomPartEl),n.foregroundRender=new Fn(n.mainRender,n.topPartEl),n.cameraControlSetting=new Kn(n.bottomPartSettings,n.foregroundRender),n.onAmbientLightSettingChangeBound=n.onAmbientLightSettingChange.bind(Jn(n)),n.ambientLightSetting=new Xn(n.bottomPartSettings,1,n.onAmbientLightSettingChangeBound,2,{min:0,max:1},"ambient-light","Ambient light"),n.axesHelper=new Wn(n.bottomPartSettings,n.foregroundRender),n.scene=new THREE.Scene,n.renderer=n.mainRender.renderer,n.renderer.setSize(n.topPartEl.clientWidth,n.topPartEl.clientHeight),n.topPartEl.appendChild(n.renderer.domElement);var a=new THREE.PlaneGeometry(2,2),r={};r.u_res={value:new THREE.Vector2(window.innerWidth,window.innerHeight)};var s={u_connection0:{value:0}};s.u_texture0={value:new Image},s.u_connection1={value:0},s.u_texture1={value:new Image},s.u_finalConnection={value:0},s.u_multiConnection={value:0};var u=Object.assign({},r,s);return n.material=new THREE.ShaderMaterial({uniforms:u,vertexShader:d,fragmentShader:f}),n.mesh=new THREE.Mesh(a,n.material),n.scene.add(n.mesh),n}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&to(e,t)}(t,c),n=t,(o=[{key:"init",value:function(e,n,o,i,a,s,u,l){var c=this;$n(eo(t.prototype),"init",this).call(this,e,n,o,i,a,s,u,l);var h=window.innerWidth,p=window.innerHeight;this.orthoCamera=new THREE.OrthographicCamera(h/-2,h/2,p/2,p/-2,1,1e3),this.bottomPartEl.classList.add("multiple-inputs"),this.onInputClickBackgroundBound=this.onInputClickBackground.bind(this),this.onInputClickForegroundBound=this.onInputClickForeground.bind(this),this.onInputClickLightBound=this.onInputClickLight.bind(this),this.inputBackground=new r(this.bottomPartEl,this.onInputClickBackgroundBound,this.isGraphicsNode,"Bakgrund In","background"),this.inputForeground=new r(this.bottomPartEl,this.onInputClickForegroundBound,this.isGraphicsNode,"Frgrund In","foreground"),this.inputLight=new r(this.bottomPartEl,this.onInputClickLightBound,this.isGraphicsNode,"Ljus In","light"),this.inputs={background:this.inputBackground,foreground:this.inputForeground,light:this.inputLight},setTimeout(function(){c.onResize()},100),this.activateDrag()}},{key:"onAmbientLightSettingChange",value:function(e){this.foregroundRender.ambientLight.intensity=e}},{key:"onNodeResizerDown",value:function(){this.nodeResizer.currentDims.w=this.topPartEl.clientWidth,this.nodeResizer.currentDims.h=this.topPartEl.clientHeight,this.nodeResizer.currentNodeDims.w=this.el.clientWidth,this.nodeResizer.currentNodeDims.h=this.el.clientHeight}},{key:"onResizeFromNodeResizer",value:function(e){this.el.style.width=this.nodeResizer.currentNodeDims.w+e.x+"px",this.el.style.height=this.nodeResizer.currentNodeDims.h+e.y+"px",this.topPartEl.style.width=this.nodeResizer.currentDims.w+e.x+"px",this.topPartEl.style.height=this.nodeResizer.currentDims.h+e.y+"px",this.inputBackground.offsetLeft=this.inputBackground.el.offsetLeft,this.inputBackground.offsetTop=this.inputBackground.el.offsetTop,this.inputForeground.offsetLeft=this.inputForeground.el.offsetLeft,this.inputForeground.offsetTop=this.inputForeground.el.offsetTop,this.inputLight.offsetLeft=this.inputLight.el.offsetLeft,this.inputLight.offsetTop=this.inputLight.el.offsetTop,this.onResize()}},{key:"onInputClickBackground",value:function(e){this.onInputConnectionCallback(this,"background",e)}},{key:"onInputClickForeground",value:function(e){this.onInputConnectionCallback(this,"foreground",e)}},{key:"onInputClickLight",value:function(e){this.onInputConnectionCallback(this,"light",e)}},{key:"getInputEl",value:function(e){return this.inputs[e]}},{key:"getDotPos",value:function(e){return e.getBoundingClientRect()}},{key:"setBackgroundTexture",value:function(e){this.mesh.material.uniforms.u_texture0.value=e}},{key:"enableInput",value:function(e,t){if(this.inputs[t].enable(),e.isBackgroundNode){var n=e.framebuffer?e.framebuffer.texture:e.texture;this.mesh.material.uniforms.u_texture0.value=n,this.mesh.material.uniforms.u_connection0.value=1}else if(e.isForegroundNode){if(this.foregroundRender.addNode(e),1===this.foregroundRender.connectedNodes.length){var o=this.foregroundRender.framebuffer.texture;this.mesh.material.uniforms.u_texture1.value=o,this.mesh.material.uniforms.u_connection1.value=1}}else e.isLightNode&&this.foregroundRender.addLight(e);var i={out:e,type:t};this.enabledInputs.push(i),e.isLightNode||(this.mesh.material.uniforms.u_finalConnection.value=1,this.inputs.background.isActive&&this.inputs.foreground.isActive&&(this.mesh.material.uniforms.u_multiConnection.value=1))}},{key:"disableInput",value:function(e,t){"background"===t?(this.inputs[t].disable(),this.mesh.material.uniforms.u_texture0.value=null,this.mesh.material.uniforms.u_connection0.value=0,this.mesh.material.uniforms.u_multiConnection.value=0):"foreground"===t?(this.foregroundRender.removeNode(e),0===this.foregroundRender.connectedNodes.length&&(this.inputs[t].disable(),this.mesh.material.uniforms.u_texture1.value=null,this.mesh.material.uniforms.u_connection1.value=0)):"light"===t&&(this.inputs[t].disable(),this.foregroundRender.removeLight(e)),this.enabledInputs=this.enabledInputs.filter(function(t){return t.out.ID!==e.ID}),0===this.enabledInputs.filter(function(e){return!e.out.isLightNode}).length?this.mesh.material.uniforms.u_finalConnection.value=0:this.inputs.foreground.isActive||(this.mesh.material.uniforms.u_multiConnection.value=0)}},{key:"update",value:function(){this.foregroundRender.update()}},{key:"render",value:function(){this.renderer.clear(),this.foregroundRender.render(),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.orthoCamera)}},{key:"onResize",value:function(){var e=this.topPartEl.clientWidth,t=this.topPartEl.clientHeight;this.foregroundRender.onResize({w:e,h:t}),this.mesh.material.uniforms.u_res.value=new THREE.Vector2(e,t),this.orthoCamera.left=e/-2,this.orthoCamera.right=e/2,this.orthoCamera.top=t/-2,this.orthoCamera.bottom=t/2,this.orthoCamera.updateProjectionMatrix(),this.renderer.setSize(e,t)}}])&&Zn(n.prototype,o),i&&Zn(n,i),t}(),oo=n(27);function io(e){return(io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ao(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ro(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function so(e,t,n){return(so="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=uo(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function uo(e){return(uo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lo(e,t){return(lo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var co=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(e=!(o=uo(t).call(this))||"object"!==io(o)&&"function"!=typeof o?ro(n):o).el.classList.add("no-height"),e.el.classList.add("color-node"),e.isParam=!0,e.paramVals={},e.params={};var i=document.createElement("div");i.className="color-picker-parent prevent-drag";var a=document.createElement("h4");a.innerHTML="Vlj frg",e.colorPreview=document.createElement("div"),e.colorPreview.className="color-preview",i.appendChild(a),i.appendChild(e.colorPreview),e.topPartEl.appendChild(i);var r={parent:i,color:"#FFFFFF",alpha:!1};return e.currentColor=void 0,e.picker=new oo.a(r),e.onPickerChangeBound=e.onPickerChange.bind(ro(e)),e.picker.onChange=e.onPickerChangeBound,e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lo(e,t)}(t,Lt),n=t,(o=[{key:"onPickerChange",value:function(e){var t="rgb(".concat(e._rgba[0],",").concat(e._rgba[1],",").concat(e._rgba[2],")");this.setColor(t),this.currentColor=new THREE.Color(e.rgbString);for(var n=0;n<this.currentOutConnectionsLength;n++){var o=this.currentOutConnections[n].param;this.currentOutConnections[n].in.updateParam(o,this)}}},{key:"getValue",value:function(){return this.currentColor}},{key:"setColor",value:function(e){this.colorPreview.style.background=e}},{key:"enableOutput",value:function(e,n){if(so(uo(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length,1===this.currentOutConnectionsLength){var o="#".concat(e.defaultVal.getHexString());this.picker.color=o,this.currentColor=e.defaultVal,this.setColor(o)}}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(e){return e.in.ID!==nodeIn.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&so(uo(t.prototype),"disableOutput",this).call(this)}}])&&ao(n.prototype,o),i&&ao(n,i),t}();function ho(e){return(ho="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function po(e,t){return!t||"object"!==ho(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function fo(e){return(fo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mo(e,t){return(mo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var vo=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=po(this,fo(t).call(this))).isLightNode=!0,e.el.classList.add("no-height"),e.light=new THREE.DirectionalLight(16777215,1),e.light.position.set(0,0,0),e.geometry=new THREE.SphereGeometry(1,10,10),e.material=new THREE.MeshBasicMaterial,e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Material",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={colorParam:n,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:4}},e.paramVals={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mo(e,t)}(t,Lt),t}();function yo(e){return(yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function go(e,t){return!t||"object"!==yo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function bo(e){return(bo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Co(e,t){return(Co=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var wo=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=go(this,bo(t).call(this))).isLightNode=!0,e.el.classList.add("no-height"),e.light=new THREE.PointLight(16777215,1,100),e.light.position.set(0,0,0),e.geometry=new THREE.SphereGeometry(1,20,20),e.material=new THREE.MeshBasicMaterial,e.mesh=new THREE.Mesh(e.geometry,e.material);var n={title:"Color",param:"color",useAsInput:!0,defaultVal:new THREE.Color(1,1,1),parent:"Material",paramHelpersType:"color",needsFrameUpdate:!1};return e.params={textureParam:{title:"Texture",param:"map",useAsInput:!0,parent:"Material",paramHelpersType:"texture",needsFrameUpdate:!1},colorParam:n,positionXParam:{title:"Position X",param:"x",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionYParam:{title:"Position Y",param:"y",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:0},positionZParam:{title:"Position Z",param:"z",useAsInput:!0,parent:"Position",paramHelpersType:"light",needsFrameUpdate:!1,minMax:{min:-10,max:10},defaultVal:4}},e.paramVals={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Co(e,t)}(t,Lt),t}();function ko(e){return(ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Eo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Oo(e,t){return!t||"object"!==ko(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Po(e,t,n){return(Po="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_o(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function _o(e){return(_o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xo(e,t){return(xo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Mo=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Oo(this,_o(t).call(this))).isGraphicsNode=!0,e.isBackgroundNode=!0,e.currentOutConnections=[],e.el.classList.add("no-height"),e.el.classList.add("texture-selector-node"),e.texture=(new THREE.TextureLoader).load("assets/test/Image1.png"),e.texture.magFilter=THREE.LinearFilter,e.texture.minFilter=THREE.LinearFilter;var n=[{rymden:[{title:"Jorden",name:"space/2k_earth_daymap.jpg"},{title:"Solen",name:"space/2k_sun.jpg"},{title:"Mars",name:"space/2k_mars.jpg"}]}];e.wrapper=document.createElement("div"),e.wrapper.className="wrapper";for(var o=0;o<n.length;o++){var i=n[o],a=function(t){var n=i[t],o=document.createElement("h4");o.innerHTML=t;var a=document.createElement("div");a.className="children-container",a.appendChild(o);for(var r=function(t){var o=document.createElement("div");o.className="child-wrapper";var i=document.createElement("h4");i.innerHTML=n[t].title,o.onclick=function(i){i.preventDefault(),i.stopPropagation(),e.onTextureSelected(n[t],o)},o.appendChild(i),a.appendChild(o)},s=0;s<n.length;s++)r(s);e.wrapper.appendChild(a)};for(var r in i)a(r)}return e.topPartEl.appendChild(e.wrapper),e.params={},e.paramVals={},e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xo(e,t)}(t,Lt),n=t,(o=[{key:"onTextureSelected",value:function(e,t){var n="assets/textures/".concat(e.name);this.texture=(new THREE.TextureLoader).load(n);for(var o=0;o<this.currentOutConnectionsLength;o++){var i=this.currentOutConnections[o].param;this.currentOutConnections[o].in.isCanvasNode?this.currentOutConnections[o].in.setBackgroundTexture(this.texture):i&&this.currentOutConnections[o].in.updateParam(i,this)}for(var a=this.wrapper.querySelectorAll(".child-wrapper"),r=0;r<a.length;r++)a[r].classList.remove("active");t.classList.add("active")}},{key:"enableOutput",value:function(e,n){Po(_o(t.prototype),"enableOutput",this).call(this),this.currentOutConnections.push(n),this.currentOutConnectionsLength=this.currentOutConnections.length}},{key:"disableOutput",value:function(e,n){var o=this.currentOutConnections.map(function(e){return e}),i=o.filter(function(e){return e.param}),a=o.filter(function(e){return!e.param});n?i=i.filter(function(e){return e.param&&e.param.title!==n.title}):a=a.filter(function(t){return t.in.ID!==e.ID});var r=i.concat(a);this.currentOutConnections=r,this.currentOutConnectionsLength=this.currentOutConnections.length,this.currentOutConnectionsLength<=0&&Po(_o(t.prototype),"disableOutput",this).call(this)}}])&&Eo(n.prototype,o),i&&Eo(n,i),t}();function Ro(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var So=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),D.a.Transport.bpm.value=140,D.a.Transport.start(),this.historyState={id:window.location.pathname},window.addEventListener("popstate",this.onPopStateChange.bind(this)),window.addEventListener("resize",function(){t.onResize()}),this.nodeTypes={audio:{audio:[{type:"Oscillator",obj:q},{type:"Gain",obj:Q},{type:"Filter",obj:ue},{type:"Speaker",obj:ne}],synthar:[{type:"Kick",obj:ft},{type:"FM Synth",obj:Et}],data:[{type:"LFO",obj:Ke},{type:"Envelope",obj:fe}],triggers:[{type:"SequencerNode",obj:et}],"Ljud analys":[{type:"Ljudvg",obj:st}]},graphics:{Canvas:[{type:"Canvas",obj:no}],"3D - Shapes":[{type:"Cube",obj:dn},{type:"Sphere",obj:Cn}],"Procedural Texture (Material)":[{type:"Circle",obj:rn},{type:"Voronoi",obj:Jt},{type:"LavaNoise",obj:Kt}],Modifiers:[{type:"Color",obj:co},{type:"ParamDriver",obj:Sn},{type:"OrbitDriver",obj:Vn}],Ljus:[{type:"Directional Light",obj:vo},{type:"Point Light",obj:wo}],Textures:[{type:"Texture Selector",obj:Mo}]}},this.onNodeAddedFromLibraryBound=this.onNodeAddedFromLibrary.bind(this),this.workspaceManager=new Ve(document.body),this.onScaleChangeBound=this.onScaleChange.bind(this),this.onResize(),this.nodeLibrary=new Ne(document.body,this.nodeTypes,this.onNodeAddedFromLibraryBound,this.workspaceManager);new ue,new ne,new q,new Q,new fe,new Ke;this.keyboardManager=new je,this.onNodeActiveBound=this.onNodeActive.bind(this),this.nodeManager=new Re(null,this.keyboardManager,this.onNodeActiveBound,this.workspaceManager.el)}var t,n,o;return t=e,(n=[{key:"onLogout",value:function(){this.nodeLibrary.hide(),this.workspaceManager.disable(),this.keyboardManager.disable();for(var e=this.nodeManager._nodes,t=0;t<e.length;t++)this.nodeManager.onNodeRemove(e[t])}},{key:"onLogin",value:function(){this.nodeLibrary.show(),this.workspaceManager.enable(),this.keyboardManager.enable()}},{key:"onScaleChange",value:function(e){console.log(e)}},{key:"onNodeActive",value:function(e){this.nodeSettings.show(e)}},{key:"onNodeAddedFromLibrary",value:function(e,t,n){this.nodeManager.onNodeAddedFromLibrary(e,t,n)}},{key:"onPopStateChange",value:function(e){console.log("hash change: ",e)}},{key:"pushState",value:function(e,t){window.history.pushState({id:e},"",t)}},{key:"update",value:function(){this.nodeManager.update()}},{key:"render",value:function(){this.nodeManager.render()}},{key:"onResize",value:function(e,t){this.workspaceManager.onResize(e,t)}}])&&Ro(t.prototype,n),o&&Ro(t,o),e}();function To(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}n.d(t,"default",function(){return Lo});var Lo=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),window.NS={},window.NS.transform=function(){var e=document.createElement("div");if(null==e.style.transform){var t=["Webkit","Moz","ms"];for(var n in t)if(void 0!==e.style[t[n]+"Transform"])return t[n]+"Transform"}return"transform"}(),window.NS.iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,this.main=new So,this.onResize(),window.addEventListener("resize",function(){t.onResize()}),this.reqFrame()}var t,n,o;return t=e,(n=[{key:"init",value:function(){console.log("test")}},{key:"onLogout",value:function(){console.log("starter logout"),this.main.onLogout()}},{key:"onLogin",value:function(){this.main.onLogin()}},{key:"reqFrame",value:function(){var e=this;this.main.update(),this.main.render(),requestAnimationFrame(function(){e.reqFrame()})}},{key:"onResize",value:function(){var e=window.innerWidth,t=window.innerHeight;this.main.onResize(e,t)}}])&&To(t.prototype,n),o&&To(t,o),e}()}}]);